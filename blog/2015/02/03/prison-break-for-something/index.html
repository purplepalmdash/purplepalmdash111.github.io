
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Prison-Break for Something - Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="I&rsquo;ve worked two days on prison-break something, this will greatly improve my working efficiency. There are so many steps for recording, so I &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/blog/2015/02/03/prison-break-for-something">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.useso.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Prison-Break for Something</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-03T04:02:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>4:02 am</span></time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>I&rsquo;ve worked two days on prison-break something, this will greatly improve my working efficiency. There are so many steps for recording, so I will detailed described them in following parts.</p>

<h3>Single MOde</h3>

<p>In Single Mode you could get an terminal with root then you could do anything you want, simply pass <code>init=/bin/bash</code> in Grub then you could do anything.   <br/>
Question: why Unix-like system enable this command?  <br/>
Answer: In Unix-like systems, init is the first process to be run, and the ultimate ancestor of all processes ever run. It&rsquo;s responsible for running all the init scripts.  <br/>
We could add sudo users, with sudo users, you could get more priviledges.</p>

<h3>privoxy</h3>

<p>This fantanstic software could let you setup your own proxy server, simply compile it and let it run under user <code>root</code>, after it starts up, a proxy which listens on 8118 will be available for using.</p>

<h3>System Upgrade</h3>

<p>!!!Notice!!!: Always keep at least 2 root loginned terminal alive, thus if any problem happens you could do debugging. <br/>
Since you have the privoxy for using proxy, you could do anything you want, you could upgrade system from default 11.3 to the latest 13.2. The reference URLs are listed as following:   <br/>
Upgrade from 11.3 to 12.3:  <br/>
<a href="https://zh.opensuse.org/SDB:%E7%B3%BB%E7%BB%9F%E5%8D%87%E7%BA%A7">https://zh.opensuse.org/SDB:%E7%B3%BB%E7%BB%9F%E5%8D%87%E7%BA%A7</a>  <br/>
Main tips:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo zypper addrepo --check --name 'openSUSE-11.3-Update' http://download.opensuse.org/update/11.3/repo-update
</span><span class='line'>$ sudo zypper ref && zypper update
</span><span class='line'>$ sudo reboot
</span><span class='line'>.....
</span><span class='line'>$ sudo zypper mr -da
</span><span class='line'>$ sudo zypper ar -f http://download.openSUSE.org/distribution/12.3/repo/oss/ openSUSE:12.3:OSS
</span><span class='line'>$ sudo zypper ar -f http://download.openSUSE.org/distribution/12.3/repo/non-oss/ openSUSE:12.3:NON-OSS
</span><span class='line'>$ sudo zypper addlock liblzma0
</span><span class='line'>$ sudo zypper dup --download "in-advance"
</span><span class='line'>$ sudo shutdown -hP now                                                                                                                       
</span></code></pre></td></tr></table></div></figure>


<p>                                                                                                                                         <br/>
Upgrade from 11.3 to 12.3 won&rsquo;t cause any problems, and on my machine the new system become available for using immediately.                <br/>
Upgrade from 12.3 to 13.2:  <br/>
<a href="https://en.opensuse.org/SDB:System_upgrade">https://en.opensuse.org/SDB:System_upgrade</a>  <br/>
Main tips:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo zypper addrepo --check --name 'openSUSE-12.3-Update' http://download.opensuse.org/update/12.3/repo-update
</span><span class='line'>$ sudo zypper ref && zypper update
</span><span class='line'>$ sudo reboot
</span><span class='line'>.....
</span><span class='line'>$ sudo zypper mr -da
</span><span class='line'>$ sudo zypper ar -f http://download.openSUSE.org/distribution/13.2/repo/oss/ openSUSE:13.2:OSS
</span><span class='line'>$ sudo zypper ar -f http://download.openSUSE.org/distribution/13.2/repo/non-oss/ openSUSE:13.2:NON-OSS
</span><span class='line'>$ sudo zypper addlock liblzma0
</span><span class='line'>$ sudo zypper dup --download "in-advance"
</span><span class='line'>$ sudo shutdown -hP now
</span></code></pre></td></tr></table></div></figure>


<p>Trouble shooting:   <br/>
1. When upgrading the system, zypper will halt(hang) at following packages:  <br/>
zypper dup locks up Bug #802525. Workaround: make sure to keep a root shell open while zypper dup is running. Run &ldquo;killall dbus-send&rdquo; when zypper dup hangs at rtkit.  <br/>
<a href="https://en.opensuse.org/openSUSE:Most_annoying_bugs_13.1_dev">https://en.opensuse.org/openSUSE:Most_annoying_bugs_13.1_dev</a>   <br/>
2. tuned installation got stuck:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ps -ef | grep tuned
</span><span class='line'>$ kill tunned
</span><span class='line'>$ ps -ef | grep rpm 
</span><span class='line'>$ kill greped_rpm_install
</span></code></pre></td></tr></table></div></figure>


<h3>Route</h3>

<p>References:  <br/>
<a href="http://w.gdu.me/wiki/Linux/iptables_forward_internetshare.html">http://w.gdu.me/wiki/Linux/iptables_forward_internetshare.html</a>  <br/>
First in the middleware machine, add following rules in iptables:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># iptables -P FORWARD ALLOW
</span><span class='line'># iptables -A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT
</span><span class='line'># iptables -t nat -A POSTROUTING -s 10.1.1.0/24 -j SNAT --to 60.1.1.1
</span><span class='line'># iptables -A FORWARD -s 10.1.1.9 -j ACCEPT
</span></code></pre></td></tr></table></div></figure>


<p>Now you could use this middle machine for acrossing something.   <br/>
But, in your own machine, should use the following command for deleting the routes and add new routes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># route del default gw xxx.xxx.xxx.xxx
</span><span class='line'># route add default gw xxx.xxx.xxx.xxx
</span></code></pre></td></tr></table></div></figure>


<p>There are also some complicated commands for holding the routes, but we could also edit the following files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pwd
</span><span class='line'>/etc/sysconfig/network
</span><span class='line'>linux:/etc/sysconfig/network # cat routes 
</span><span class='line'>default xxx.xx.xxx.xxx - - 
</span><span class='line'>any net xxx.xx.0.0 netmask 255.255.0.0 gw xxx.xxx.xxx.200
</span></code></pre></td></tr></table></div></figure>


<p>Now even if you reboot the machine, the default route and the exchange route will be also added into the system.</p>

<h3>More Safer</h3>

<p>Change the opensshd listenning port.  <br/>
More and more.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Dash</span></span>

           




<time class='entry-date' datetime='2015-02-03T04:02:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>4:02 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/linux/'>linux</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <br />
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/01/31/try-opencontrail-in-ubuntu/" title="Previous Post: Try OpenContrail In Ubuntu">&laquo; Try OpenContrail In Ubuntu</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/02/03/install-gitlab-and-gogs/" title="Next Post: Install GitLab And Gogs">Install GitLab And Gogs &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/11/01/moving-cloudstack-from-vm-to-physical-node/">Moving CloudStack From VM to Physical Node</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/29/thinking-in-vr/">Thinking in VR</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/29/use-autohotkey-together-with-synergy/">Use AutoHotKey Together With Synergy</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/25/openstack-libertyan-zhuang-1/">OpenStack Liberty安装(1)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/23/tips-on-ceph-on-docker/">Tips on Ceph on Docker</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://purplepalmdash.github.io/blog/2015/02/03/prison-break-for-something/';
        var disqus_url = 'http://purplepalmdash.github.io/blog/2015/02/03/prison-break-for-something/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
