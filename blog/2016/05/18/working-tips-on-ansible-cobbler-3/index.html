
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Working Tips on Ansible-cobbler(3) - Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="APT Packages The downloaded deb files should be under /var/cache/apt, use following command for copying to
another position: 1
2
$ find . | grep -i &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/blog/2016/05/18/working-tips-on-ansible-cobbler-3">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//fonts.googleapis.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Working Tips on Ansible-cobbler(3)</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-05-18T21:15:10+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:15 pm</span></time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><h3>APT Packages</h3>

<p>The downloaded deb files should be under <code>/var/cache/apt</code>, use following command for copying to
another position:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ find . | grep -i deb$ | xargs % cp % ~/Dest_Folder
</span><span class='line'>$ scp -r ~/Dest_Folder Your_Cobbler_Machine</span></code></pre></td></tr></table></div></figure>


<h3>Repositories</h3>

<p>Install <code>dpkg-dev</code> package, so we could generate the dpkg packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install -y dpkg-dev</span></code></pre></td></tr></table></div></figure>


<p>Create a new repository:</p>

<p><img src="/images/2016_05_18_21_28_37_717x452.jpg" alt="/images/2016_05_18_21_28_37_717x452.jpg" /></p>

<p>Edit the advanced options:</p>

<p><img src="/images/2016_05_18_21_30_04_508x314.jpg" alt="/images/2016_05_18_21_30_04_508x314.jpg" /></p>

<p>Report the repository info via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@cobbler-ubuntu:~# cobbler repo report --name=ubuntu1604Mate
</span><span class='line'>Name                           : ubuntu1604Mate
</span><span class='line'>Apt Components (apt only)      : ['main']
</span><span class='line'>Apt Dist Names (apt only)      : ['stable']
</span><span class='line'>Arch                           : x86_64
</span><span class='line'>Breed                          : apt
</span><span class='line'>Comment                        : Ubuntu 16.04 Repository For installing MATE
</span><span class='line'>Createrepo Flags               : &lt;&lt;inherit&gt;&gt;
</span><span class='line'>Environment Variables          : {}
</span><span class='line'>Keep Updated                   : False
</span><span class='line'>Mirror                         : 
</span><span class='line'>Mirror locally                 : True
</span><span class='line'>Owners                         : ['admin']
</span><span class='line'>Priority                       : 99
</span><span class='line'>External proxy URL             : 
</span><span class='line'>RPM List                       : []
</span><span class='line'>Yum Options                    : {}</span></code></pre></td></tr></table></div></figure>


<p>Repository Structure Creation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir /srv/www/cobbler/repo_mirror/ubuntu1604Mate
</span><span class='line'>$ cd /srv/www/cobbler/repo_mirror/ubuntu1604Mate
</span><span class='line'>$ mkdir -p pool/main dists/stable/main/binary-i386 dists/stable/main/binary-amd64
</span><span class='line'>$ cp ~/apt/debs/*.deb ./pool/main/</span></code></pre></td></tr></table></div></figure>


<p>Enable the <code>allow_unauthenticated</code> options in kickstart file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /var/lib/cobbler/kickstarts/sample.seed
</span><span class='line'> d-i debian-installer/allow_unauthenticated boolean true</span></code></pre></td></tr></table></div></figure>


<p>Generate the gpg key:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># gpg --gen-key
</span><span class='line'>  gpg (GnuPG) 2.0.14; Copyright (C) 2009 Free Software Foundation, Inc.
</span><span class='line'>  This is free software: you are free to change and redistribute it.
</span><span class='line'>  There is NO WARRANTY, to the extent permitted by law.
</span><span class='line'>
</span><span class='line'>  gpg: directory `/root/.gnupg' created
</span><span class='line'>  gpg: new configuration file `/root/.gnupg/gpg.conf' created
</span><span class='line'>  gpg: WARNING: options in `/root/.gnupg/gpg.conf' are not yet active during this run
</span><span class='line'>  gpg: keyring `/root/.gnupg/secring.gpg' created
</span><span class='line'>  gpg: keyring `/root/.gnupg/pubring.gpg' created
</span><span class='line'> Please select what kind of key you want:
</span><span class='line'>    (1) RSA and RSA (default)
</span><span class='line'>    (2) DSA and Elgamal
</span><span class='line'>    (3) DSA (sign only)
</span><span class='line'>    (4) RSA (sign only)
</span><span class='line'> Your selection? 1
</span><span class='line'> RSA keys may be between 1024 and 4096 bits long.
</span><span class='line'> What keysize do you want? (2048)
</span><span class='line'> Requested keysize is 2048 bits
</span><span class='line'> Please specify how long the key should be valid.
</span><span class='line'>          0 = key does not expire
</span><span class='line'>       &lt;n&gt;  = key expires in n days
</span><span class='line'>       &lt;n&gt;w = key expires in n weeks
</span><span class='line'>       &lt;n&gt;m = key expires in n months
</span><span class='line'>       &lt;n&gt;y = key expires in n years
</span><span class='line'> Key is valid for? (0)
</span><span class='line'> Key does not expire at all
</span><span class='line'> Is this correct? (y/N) y</span></code></pre></td></tr></table></div></figure>


<p>For generating the random key, install the <code>haveged</code> in system:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo aptitude install haveged</span></code></pre></td></tr></table></div></figure>


<p>List the keys via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># gpg --list-keys
</span><span class='line'>/home/vagrant/.gnupg/pubring.gpg
</span><span class='line'>--------------------------------
</span><span class='line'>pub   2048R/16D87321 2016-05-18
</span><span class='line'>uid                  xxxxx &lt;xxxxxx@gmail.com&gt;
</span><span class='line'>sub   2048R/8C4A318A 2016-05-18</span></code></pre></td></tr></table></div></figure>


<p>Generate the pgp signature via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># gpg --export -a 16D87321&gt;~/junk.key
</span><span class='line'># gpg --no-default-keyring --keyring /srv/www/cobbler/repo_mirror/ubuntu1604Mate/public.pgp --import ~/junk.key
</span><span class='line'># rm -f ~/junk.key
</span><span class='line'># chmod a+r /srv/www/cobbler/repo_mirror/ubuntu1604Mate/public.pgp</span></code></pre></td></tr></table></div></figure>


<p>Re-Generate the repository infos via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd /srv/www/cobbler/repo_mirror/ubuntu1604Mate/
</span><span class='line'>$ vim reindex_apt.sh
</span><span class='line'>$ chmod 777 reindex_apt.sh 
</span><span class='line'>$ ./reindex_apt.sh </span></code></pre></td></tr></table></div></figure>


<p>The content of <code>reindex_apt.sh</code> is listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/bin/bash
</span><span class='line'>
</span><span class='line'>GPG_NAME=16D87321
</span><span class='line'>REPONAME=stable
</span><span class='line'>VERSION=1.0
</span><span class='line'>
</span><span class='line'>for bindir in `find dists/${REPONAME} -type d -name "binary*"`; do
</span><span class='line'>    arch=`echo $bindir|cut -d"-" -f 2`
</span><span class='line'>    echo "Processing ${bindir} with arch ${arch}"
</span><span class='line'>
</span><span class='line'>    overrides_file=/tmp/overrides
</span><span class='line'>    package_file=$bindir/Packages
</span><span class='line'>    release_file=$bindir/Release
</span><span class='line'>
</span><span class='line'>    # Create simple overrides file to stop warnings
</span><span class='line'>    cat /dev/null &gt; $overrides_file
</span><span class='line'>    for pkg in `ls pool/main/ | grep -E "(all|${arch})\.deb"`; do
</span><span class='line'>        pkg_name=`/usr/bin/dpkg-deb -f pool/main/${pkg} Package`
</span><span class='line'>        echo "${pkg_name} Priority extra" &gt;&gt; $overrides_file
</span><span class='line'>    done
</span><span class='line'>
</span><span class='line'>    # Index of packages is written to Packages which is also zipped
</span><span class='line'>    dpkg-scanpackages -a ${arch} pool/main $overrides_file &gt; $package_file
</span><span class='line'>    # The line above is also commonly written as:
</span><span class='line'>    # dpkg-scanpackages -a ${arch} pool/main /dev/null &gt; $package_file
</span><span class='line'>    gzip -9c $package_file &gt; ${package_file}.gz
</span><span class='line'>    bzip2 -c $package_file &gt; ${package_file}.bz2
</span><span class='line'>
</span><span class='line'>    # Cleanup
</span><span class='line'>    rm $overrides_file
</span><span class='line'>done
</span><span class='line'>
</span><span class='line'># Release info goes into Release & Release.gpg which includes an md5 & sha1 hash of Packages.*
</span><span class='line'># Generate & sign release file
</span><span class='line'>cd dists/${REPONAME}
</span><span class='line'>cat &gt; Release &lt;&lt;ENDRELEASE
</span><span class='line'>Suite: ${REPONAME}
</span><span class='line'>Version: ${VERSION}
</span><span class='line'>Component: main
</span><span class='line'>Origin: somewhere
</span><span class='line'>Label: ubuntu1604Mate
</span><span class='line'>Architecture: i386 amd64
</span><span class='line'>Date: `date`
</span><span class='line'>ENDRELEASE
</span><span class='line'>
</span><span class='line'># Generate hashes
</span><span class='line'>echo "MD5Sum:" &gt;&gt; Release
</span><span class='line'>for hashme in `find main -type f`; do
</span><span class='line'>    md5=`openssl dgst -md5 ${hashme}|cut -d" " -f 2`
</span><span class='line'>    size=`stat -c %s ${hashme}`
</span><span class='line'>    echo " ${md5} ${size} ${hashme}" &gt;&gt; Release
</span><span class='line'>done
</span><span class='line'>echo "SHA1:" &gt;&gt; Release
</span><span class='line'>for hashme in `find main -type f`; do
</span><span class='line'>    sha1=`openssl dgst -sha1 ${hashme}|cut -d" " -f 2`
</span><span class='line'>    size=`stat -c %s ${hashme}`
</span><span class='line'>    echo " ${sha1} ${size} ${hashme}" &gt;&gt; Release
</span><span class='line'>done
</span><span class='line'>
</span><span class='line'># Sign!
</span><span class='line'>gpg --yes -u $GPG_NAME --sign -bao Release.gpg Release
</span><span class='line'>cd -</span></code></pre></td></tr></table></div></figure>


<p>Now continue to modify the kickstart file for using the generated gpgs:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pwd
</span><span class='line'>/var/lib/cobbler/snippets
</span><span class='line'># cp preseed_apt_repo_config preseed_apt_repo_config_pgpkey</span></code></pre></td></tr></table></div></figure>


<p>The <code>preseed_apt_repo_config_pgpkey</code> should be listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Additional repositories, local[0-9] available
</span><span class='line'>#set $cur=1
</span><span class='line'>#set $repo_data = $getVar("repo_data",[])
</span><span class='line'>#for $repo in $repo_data
</span><span class='line'> #for $dist in $repo.apt_dists
</span><span class='line'> #set $comps = " ".join($repo.apt_components)
</span><span class='line'>d-i apt-setup/local${cur}/repository string \
</span><span class='line'> #if $repo.mirror_locally
</span><span class='line'>      http://$http_server/cblr/repo_mirror/${repo.name} $dist $comps
</span><span class='line'> #else
</span><span class='line'>      ${repo.mirror} $dist $comps
</span><span class='line'> #end if
</span><span class='line'> #if $repo.comment != ""
</span><span class='line'>d-i apt-setup/local${cur}/comment string ${repo.comment}
</span><span class='line'> #end if
</span><span class='line'> #if $repo.breed == "src"
</span><span class='line'># Enable deb-src lines
</span><span class='line'>d-i apt-setup/local${cur}/source boolean false
</span><span class='line'> #end if
</span><span class='line'>+++ # Add repo pgp pub key
</span><span class='line'>+++ d-i apt-setup/local${cur}/key string \
</span><span class='line'>+++       http://$http_server/cblr/repo_mirror/${repo.name}/public.pgp
</span><span class='line'> #set $cur=$cur+1
</span><span class='line'> #end for
</span><span class='line'>#end for</span></code></pre></td></tr></table></div></figure>


<p>Using the new preseed file, and changint the <code>preseed_apt_repo_config_pgpkey</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pwd
</span><span class='line'>/var/lib/cobbler/kickstarts
</span><span class='line'># cp sample.seed ubuntu1604.seed
</span><span class='line'># vim ubuntu1604.seed
</span><span class='line'>-  $SNIPPET('preseed_apt_repo_config')
</span><span class='line'>+  $SNIPPET('preseed_apt_repo_config_pgpkey')</span></code></pre></td></tr></table></div></figure>


<p>Changing the seed in the <code>cobbler_web</code>:</p>

<p><img src="/images/2016_05_18_22_25_48_732x294.jpg" alt="/images/2016_05_18_22_25_48_732x294.jpg" /></p>

<p>Use <code>cobbler sync</code> for syncing the configuration.</p>

<h3>Use the Repository</h3>

<p>Add the <code>ubuntu1604Mate</code> into the Repos:</p>

<p><img src="/images/2016_05_18_22_31_42_731x486.jpg" alt="/images/2016_05_18_22_31_42_731x486.jpg" /></p>

<p>After added, the configuration should be:</p>

<p><img src="/images/2016_05_18_22_33_00_471x149.jpg" alt="/images/2016_05_18_22_33_00_471x149.jpg" /></p>

<p>Now <code>cobbler sync</code> for syncing the configuration.</p>

<p>Bug: you should move the <code>preseed_apt_repo_config</code> and  then <code>cobbler sync</code> then your deployment will be OK:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mv /var/lib/cobbler/snippets/preseed_apt_repo_config /root/
</span><span class='line'>$ cobbler sync</span></code></pre></td></tr></table></div></figure>


<h3>Added Mate Installation</h3>

<p>Configure the preseed late:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cp /var/lib/cobbler/scripts/preseed_late_default /var/lib/cobbler/scripts/preseed_late_default_mate
</span><span class='line'># vim /var/lib/cobbler/scripts/preseed_late_default_mate
</span><span class='line'># vim preseed_late_default_mate 
</span><span class='line'>$SNIPPET('post_install_network_config_deb')
</span><span class='line'>$SNIPPET('late_apt_repo_config')
</span><span class='line'>$SNIPPET('post_run_deb')
</span><span class='line'>$SNIPPET('download_config_files')
</span><span class='line'>+ $SNIPPET('ubuntumate')
</span><span class='line'>$SNIPPET('kickstart_done')</span></code></pre></td></tr></table></div></figure>


<p>Now add the snippet of <code>ubuntumate</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat ../snippets/ubuntumate 
</span><span class='line'>echo "debconf debconf/frontend select noninteractive" | sudo debconf-set-selections
</span><span class='line'>apt-get --allow-unauthenticated update -y
</span><span class='line'>apt-get --allow-unauthenticated upgrade -y
</span><span class='line'>apt-get --allow-unauthenticated install -y build-essential
</span><span class='line'>### apt-get --allow-unauthenticated install -y ubuntu-mate-desktop
</span><span class='line'>apt-get --allow-unauthenticated install -y vim
</span><span class='line'>### apt-get --allow-unauthenticated install -y chromium-browser
</span><span class='line'>### apt-get --allow-unauthenticated install -y meld vim-gtk
</span><span class='line'>### apt-get --allow-unauthenticated install -y evince
</span><span class='line'>### sudo apt-get --allow-unauthenticated install -y language-pack-zh-hans language-pack-zh-hans-base language-pack-gnome-zh-hans language-pack-gnome-zh-hans-base
</span><span class='line'>### sudo apt-get --allow-unauthenticated install -y `check-language-support -l zh`
</span><span class='line'>### sudo localectl set-locale LANG=zh_CN.UTF-8
</span><span class='line'>### # TW/HK language support
</span><span class='line'>### sudo apt-get --allow-unauthenticated install -y language-pack-zh-hant language-pack-zh-hant-base language-pack-gnome-zh-hant language-pack-gnome-zh-hant-base
</span><span class='line'>### sudo apt-get --allow-unauthenticated install -y `check-language-support -l zh`
</span><span class='line'>### apt-get --allow-unauthenticated install -y fcitx
</span><span class='line'>### apt-get --allow-unauthenticated install -y fcitx-table-wubi fcitx-table-wubi-large
</span><span class='line'>### apt-get --allow-unauthenticated install -y fcitx-googlepinyin
</span><span class='line'>### apt-get --allow-unauthenticated install -y gimp
</span><span class='line'>### apt-get --allow-unauthenticated install -y ibus-pinyin 
</span><span class='line'>### apt-get --allow-unauthenticated install -y thunderbird-locale-en-us mythes-en-au hunspell-en-gb thunderbird-locale-en-gb fonts-arphic-ukai wbritish fcitx-sunpinyin openoffice.org-hyphenation language-pack-gnome-en hunspell-en-za fcitx-chewing fcitx-table-cangjie gimp-help-en language-pack-en mythes-en-us thunderbird-locale-en fcitx-module-cloudpinyin libreoffice-help-en-us firefox-locale-en libreoffice-help-en-gb fonts-arphic-uming hyphen-en-gb libreoffice-l10n-en-za fcitx-ui-qimpanel hunspell-en-au libreoffice-l10n-en-gb hyphen-en-us hunspell-en-ca 
</span><span class='line'>### apt-get --allow-unauthenticated install -y zsh
</span><span class='line'>### apt-get --allow-unauthenticated install -y fonts-wqy-zenhei fonts-wqy-microhei ttf-wqy-microhei  ttf-wqy-zenhei  xfonts-wqy
</span><span class='line'>### apt-get --allow-unauthenticated install -y eclipse
</span><span class='line'>### apt-get --allow-unauthenticated install -y gpicview
</span><span class='line'>### apt-get --allow-unauthenticated install -y scrot
</span><span class='line'>### apt-get --allow-unauthenticated install -y byobu
</span><span class='line'>### apt-get --allow-unauthenticated install -y subversion git
</span><span class='line'>### apt-get --allow-unauthenticated install -y kdiff3
</span><span class='line'>### apt-get --allow-unauthenticated install -y docker
</span></code></pre></td></tr></table></div></figure>


<p>Use <code>cobbler sync</code>, and now you could deploy mate desktop via cobbler.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Dash</span></span>

           




<time class='entry-date' datetime='2016-05-18T21:15:10+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:15 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/linux/'>linux</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <br />
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/05/12/tips-on-maas-2-dot-0/" title="Previous Post: Tips On Maas 2.0">&laquo; Tips On Maas 2.0</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/05/18/working-tips-on-ansible-cobbler-3/">Working Tips on Ansible-cobbler(3)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/12/tips-on-maas-2-dot-0/">Tips on Maas 2.0</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/11/setup-lxd-on-ubuntu1604/">Setup LXD on Ubuntu1604</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/10/tips-on-lxc/">Tips on Lxc</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/09/working-tips-on-mesos-slash-ansible/">Working Tips on Mesos/Ansible</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://purplepalmdash.github.io/blog/2016/05/18/working-tips-on-ansible-cobbler-3/';
        var disqus_url = 'http://purplepalmdash.github.io/blog/2016/05/18/working-tips-on-ansible-cobbler-3/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
