<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Linux | Dash]]></title>
  <link href="http://purplepalmdash.github.io/blog/categories/linux/atom.xml" rel="self"/>
  <link href="http://purplepalmdash.github.io/"/>
  <updated>2015-11-04T11:02:32+08:00</updated>
  <id>http://purplepalmdash.github.io/</id>
  <author>
    <name><![CDATA[Dash]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Use OpenWRT Router for Lan Forwarding]]></title>
    <link href="http://purplepalmdash.github.io/blog/2015/10/15/use-openwrt-router-for-lan-forwarding/"/>
    <updated>2015-10-15T11:50:28+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2015/10/15/use-openwrt-router-for-lan-forwarding</id>
    <content type="html"><![CDATA[<h3>USB Ethernet</h3>

<p>Insert the USB Ethernet Dongle into the Ubuntu14.04, it will be automatically
recognized and initialized.</p>

<pre><code>$ dmesg | tail 
    [10323.307662] asix 2-2.2:1.0 eth1: register 'asix' at usb-0000:00:1d.7-2.2, ASIX
    AX88772B USB 2.0 Ethernet, 84:xx:xx:xx:xx
    [10323.307704] usbcore: registered new interface driver asix
    [10324.285425] IPv6: ADDRCONF(NETDEV_UP): eth1: link is not ready
$ ifconfig eth1
    eth1      Link encap:Ethernet  HWaddr 84:xx:xx:xx:
</code></pre>

<p>Be care to see the udev rules definition:</p>

<pre><code>$ cat /etc/udev/rules.d/70-persistent-net.rules 

# USB device 0x:0x (asix)
SUBSYSTEM=="net", ACTION=="add", DRIVERS=="?*", ATTR{address}=="84:xx:xx:xx:xx",
ATTR{dev_id}=="0x0", ATTR{type}=="1", KERNEL=="eth*", NAME="eth1"
</code></pre>

<h3>IP Configuration</h3>

<p>Add the following items into the network configuration file:</p>

<pre><code># vim /etc/network/interfaces 
    # usb network eth1
    allow-hotplug eth1
    iface eth1 inet static
    address 10.0.80.1
    netmask 255.255.255.0
</code></pre>

<p>Now restart the network, to see the ethernet has been enabled.</p>

<h3>DHCPD Configuration</h3>

<p>Add following configuration to the /etc/dhcp/dhcpd.conf:</p>

<pre><code>### this is for USB NET

subnet
10.0.80.0 netmask 255.255.255.0 {
# --- default gateway
option routers
10.0.80.1;
# --- Netmask
option subnet-mask
255.255.255.0;
# --- Broadcast Address
option broadcast-address
10.0.80.255;
# --- Domain name servers, tells the clients which DNS servers to use.
option domain-name-servers
223.5.5.5,180.76.76.76;
option time-offset 0;
range 10.0.80.3 10.0.80.13;
default-lease-time 1209600;
max-lease-time 1814400;
}
</code></pre>

<h3>IPtables and dhcpd</h3>

<p>Add following items into the ~/.config/awesome/rc.lua</p>

<pre><code>autorunApps =
{
--.........
"blueman-manager",
"fcitx",
"/home/dash/Downloads/what/whatpulse",
-- "pidgin",
"sudo iptables -t nat -A POSTROUTING -s 10.0.70.0/24 ! -d 10.0.70.0/24  -j MASQUERADE",
"sudo iptables -t nat -A POSTROUTING -s 10.0.80.0/24 ! -d 10.0.80.0/24 -j MASQUERADE" 
"sudo dhcpd wlan0 eth1",
</code></pre>

<p>Now everytime we reboot the system, it will automatically start the dhcpd server and
let OpenWRT as the access Point.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linux Tips 3]]></title>
    <link href="http://purplepalmdash.github.io/blog/2015/10/13/linux-tips-3.markdown/"/>
    <updated>2015-10-13T10:43:51+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2015/10/13/linux-tips-3.markdown</id>
    <content type="html"><![CDATA[<h3>1. Tips on Cloud-Init</h3>

<p><a href="http://www.cnblogs.com/smallcoderhujin/p/4238609.html">http://www.cnblogs.com/smallcoderhujin/p/4238609.html</a></p>

<h3>2. Access CloudStack VR</h3>

<p>Get the VR IP address from the CloudStack Web Interface:</p>

<p><img src="/images/2015_10_13_15_46_59_464x499.jpg" alt="/images/2015_10_13_15_46_59_464x499.jpg" /></p>

<p>Then get the ssh connection via(On Agent Node):</p>

<pre><code>[root@csmgmt ~]# ssh -i .ssh/id_rsa.cloud -p3922 169.254.1.177  
Linux r-9-VM 3.2.0-4-amd64 #1 SMP Debian 3.2.65-1+deb7u2 x86_64
.......
root@r-9-VM:~#
</code></pre>

<h3>3. Cloudmonkey issue</h3>

<p>Couldnot start cloudmonkey, use virtualenv for starting:</p>

<pre><code>$ yum install -y python-virtualenv
$ virtualenv venv --python=python2.6
$ . venv/bin/activate
$ pip install cloudmonkey
</code></pre>

<p>Then you could start cloudmonkey in venv environment.</p>

<h3>4. Cloud Performance Testing</h3>

<p>Cloud Performance testing URL.</p>

<pre><code>http://www.qyjohn.net/?p=2715
http://www.ccf.org.cn/resources/1190201776262/2011/10/17/2.pdf
http://www.os-easy.com/News/2014-10/526.html
</code></pre>

<h3>5. Installation Of VBox Ext Packs</h3>

<p>When installing the ext packages:</p>

<p><img src="/images/2015_10_16_06_46_53_640x268.jpg" alt="/images/2015_10_16_06_46_53_640x268.jpg" /></p>

<p>The reason is because the installation program need the root priviledge while
the awesome desktop didn&rsquo;t support it. By installing the <code>gksu</code> packages from
pacman you could solve it.</p>

<p>More tips on uninstalling ext and re-installing ext:</p>

<pre><code>$ VBoxManage extpack install
Oracle_VM_VirtualBox_Extension_Pack-5.0.4.vbox-extpack 
0%...
Progress state: NS_ERROR_FAILURE
VBoxManage: error: Failed to install
"/home/xxxxxxx/.config/VirtualBox/Oracle_VM_VirtualBox_Extension_Pack-5.0.4.vbox-extpack"
VBoxManage: error: Extension pack 'Oracle VM VirtualBox Extension Pack' is
already installed. In case of a reinstallation, please uninstall it first
VBoxManage: error: Details: code NS_ERROR_FAILURE (0x80004005), component
ExtPackManagerWrap, interface IExtPackManager
VBoxManage: error: Context: "RTEXITCODE handleExtPack(HandlerArg*)" at line
1158 of file VBoxManageMisc.cpp
$ VBoxManage list extpacks
Extension Packs: 1
Pack no. 0:   Oracle VM VirtualBox Extension Pack
Version:      5.0.0
Revision:     101573
Edition:      
Description:  USB 2.0 and USB 3.0 Host Controller, Host Webcam, VirtualBox
RDP, PXE ROM, Disk Encryption.
VRDE Module:  VBoxVRDP
Usable:       true 
Why unusable: 
$ VBoxManage extpack uninstall 'Oracle VM
VirtualBox Extension Pack'
0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%
Successfully uninstalled "Oracle VM VirtualBox Extension Pack".
$ VBoxManage extpack install
Oracle_VM_VirtualBox_Extension_Pack-5.0.4.vbox-extpack
0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%
Successfully installed "Oracle VM VirtualBox Extension Pack".
</code></pre>

<p>Now you got the newest ext packages installed for VirtualBox.</p>

<h3>6. Change Cursor In Awesome</h3>

<p>Download the theme from:  <br/>
<a href="http://gnome-look.org/content/show.php?content=48837">http://gnome-look.org/content/show.php?content=48837</a></p>

<p>Extract it to your ~/.icon/, and add following items into your configuration
file:</p>

<pre><code>$ cat ~/.xinitrc
etroot -cursor_name Neutral_Plus
$ cat ~/.Xdefaults
Xcursor.theme: Neutral_Plus
</code></pre>

<p>Now restart your X you could got Neutral_Plus working. The same method could
be done to aero mouse or more, but the background image is a big issue.</p>

<h3>7. CloudStack Chinese Docs</h3>

<pre><code>http://cloudstack-installation-zh-cn.readthedocs.org/zh_CN/latest/hypervisor/lxc.html
</code></pre>

<h3>8. Iptables forward</h3>

<p>Added at the first:</p>

<pre><code>sudo iptables -t filter -I FORWARD -j ACCEPT
</code></pre>

<h3>9. preseed using local repository</h3>

<p>Using the local repository for installation.</p>

<pre><code>d-i mirror/country string manual
d-i mirror/http/hostname string 192.168.1.13
d-i mirror/http/directory string /ubuntu
d-i mirror/http/proxy string

d-i apt-setup/restricted boolean true
d-i apt-setup/universe boolean true
d-i apt-setup/backports boolean true
d-i apt-setup/services-select multiselect security
d-i apt-setup/security_host string 192.168.1.13
d-i apt-setup/security_path string /ubuntu
</code></pre>

<p>Change the repository after installation:</p>

<pre><code>d-i preseed/late_command string wget http://192.168.1.13/sources.list.13 -O
/target/etc/apt/sources.list
</code></pre>

<h3>10. Static IP Configuration For Cloud-Init</h3>

<p>On Cloud-Init Configuration of Static IP.</p>

<pre><code>https://access.redhat.com/articles/rhel-atomic-cloud-init-faq
</code></pre>

<h3>11. Forwarding SSH Access To Inner</h3>

<p>This will forward the connection to 10003 to 10.0.0.3&rsquo;s 22 port, thus you will access
the inner machine via <code>ssh -p 10003 xxxx@192.168.10.187</code>.</p>

<pre><code># iptables -t nat -A PREROUTING -d 192.168.10.187 -p tcp --dport 10003 -j DNAT \
--to-destination 10.0.0.3:22
# iptables-save &gt;/etc/sysconfig/iptables
</code></pre>

<h3>12. On Perforce Monitor Tools</h3>

<p>graphite and collectd:</p>

<pre><code>http://www.infoq.com/cn/articles/graphite-intro
http://www.vpsee.com/2012/05/install-graphite-on-ubuntu-12-04/
http://www.vpsee.com/2012/05/use-collectd-with-graphite-to-monitor-servers/
https://collectd.org/wiki/index.php/Plugin:libvirt
http://www.drupal001.com/2012/07/system-monitor-collectd/
</code></pre>

<h3>13. More tips for Performance Monitor</h3>

<pre><code>http://www.unixmen.com/install-graphite-centos-7/
http://blog.csdn.net/crazyhacking/article/details/8363235
http://blog.csdn.net/puncha/article/details/9112293
http://skaka.me/blog/2015/07/21/kamon-statsd-graphite-grafana-introduction/
https://codeascraft.com/2011/02/15/measure-anything-measure-everything/
http://devops.com/2014/09/02/guide-modern-monitoring-alerting/
http://network.51cto.com/art/201505/475518_5.htm
</code></pre>

<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
Discussion on monitoring:</p>

<h1><a href="http://segmentfault.com/q/1010000000116157">http://segmentfault.com/q/1010000000116157</a>    </h1>

<h3>14. Log System</h3>

<pre><code>http://devops.com/2014/09/02/guide-modern-monitoring-alerting/
http://network.51cto.com/art/201505/475518_all.htm
https://linux.cn/article-5252-shareweibo.html
http://kibana.logstash.es/content/logstash/index.html
https://www.digitalocean.com/community/tutorials/how-to-install-and-use-graphite-on-an-ubuntu-14-04-server
</code></pre>

<blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><p>4edb5176b018d3fd67f1864992c7994eb9a5a3bf</p></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linux Tips 3]]></title>
    <link href="http://purplepalmdash.github.io/blog/2015/10/13/linux-tips-3/"/>
    <updated>2015-10-13T10:43:51+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2015/10/13/linux-tips-3</id>
    <content type="html"><![CDATA[<h3>1. Tips on Cloud-Init</h3>

<p><a href="http://www.cnblogs.com/smallcoderhujin/p/4238609.html">http://www.cnblogs.com/smallcoderhujin/p/4238609.html</a></p>

<h3>2. Access CloudStack VR</h3>

<p>Get the VR IP address from the CloudStack Web Interface:</p>

<p><img src="/images/2015_10_13_15_46_59_464x499.jpg" alt="/images/2015_10_13_15_46_59_464x499.jpg" /></p>

<p>Then get the ssh connection via(On Agent Node):</p>

<pre><code>[root@csmgmt ~]# ssh -i .ssh/id_rsa.cloud -p3922 169.254.1.177  
Linux r-9-VM 3.2.0-4-amd64 #1 SMP Debian 3.2.65-1+deb7u2 x86_64
.......
root@r-9-VM:~#
</code></pre>

<h3>3. Cloudmonkey issue</h3>

<p>Couldnot start cloudmonkey, use virtualenv for starting:</p>

<pre><code>$ yum install -y python-virtualenv
$ virtualenv venv --python=python2.6
$ . venv/bin/activate
$ pip install cloudmonkey
</code></pre>

<p>Then you could start cloudmonkey in venv environment.</p>

<h3>4. Cloud Performance Testing</h3>

<p>Cloud Performance testing URL.</p>

<pre><code>http://www.qyjohn.net/?p=2715
http://www.ccf.org.cn/resources/1190201776262/2011/10/17/2.pdf
http://www.os-easy.com/News/2014-10/526.html
</code></pre>

<h3>5. Installation Of VBox Ext Packs</h3>

<p>When installing the ext packages:</p>

<p><img src="/images/2015_10_16_06_46_53_640x268.jpg" alt="/images/2015_10_16_06_46_53_640x268.jpg" /></p>

<p>The reason is because the installation program need the root priviledge while
the awesome desktop didn&rsquo;t support it. By installing the <code>gksu</code> packages from
pacman you could solve it.</p>

<p>More tips on uninstalling ext and re-installing ext:</p>

<pre><code>$ VBoxManage extpack install
Oracle_VM_VirtualBox_Extension_Pack-5.0.4.vbox-extpack 
0%...
Progress state: NS_ERROR_FAILURE
VBoxManage: error: Failed to install
"/home/xxxxxxx/.config/VirtualBox/Oracle_VM_VirtualBox_Extension_Pack-5.0.4.vbox-extpack"
VBoxManage: error: Extension pack 'Oracle VM VirtualBox Extension Pack' is
already installed. In case of a reinstallation, please uninstall it first
VBoxManage: error: Details: code NS_ERROR_FAILURE (0x80004005), component
ExtPackManagerWrap, interface IExtPackManager
VBoxManage: error: Context: "RTEXITCODE handleExtPack(HandlerArg*)" at line
1158 of file VBoxManageMisc.cpp
$ VBoxManage list extpacks
Extension Packs: 1
Pack no. 0:   Oracle VM VirtualBox Extension Pack
Version:      5.0.0
Revision:     101573
Edition:      
Description:  USB 2.0 and USB 3.0 Host Controller, Host Webcam, VirtualBox
RDP, PXE ROM, Disk Encryption.
VRDE Module:  VBoxVRDP
Usable:       true 
Why unusable: 
$ VBoxManage extpack uninstall 'Oracle VM
VirtualBox Extension Pack'
0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%
Successfully uninstalled "Oracle VM VirtualBox Extension Pack".
$ VBoxManage extpack install
Oracle_VM_VirtualBox_Extension_Pack-5.0.4.vbox-extpack
0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%
Successfully installed "Oracle VM VirtualBox Extension Pack".
</code></pre>

<p>Now you got the newest ext packages installed for VirtualBox.</p>

<h3>6. Change Cursor In Awesome</h3>

<p>Download the theme from:  <br/>
<a href="http://gnome-look.org/content/show.php?content=48837">http://gnome-look.org/content/show.php?content=48837</a></p>

<p>Extract it to your ~/.icon/, and add following items into your configuration
file:</p>

<pre><code>$ cat ~/.xinitrc
etroot -cursor_name Neutral_Plus
$ cat ~/.Xdefaults
Xcursor.theme: Neutral_Plus
</code></pre>

<p>Now restart your X you could got Neutral_Plus working. The same method could
be done to aero mouse or more, but the background image is a big issue.</p>

<h3>7. CloudStack Chinese Docs</h3>

<pre><code>http://cloudstack-installation-zh-cn.readthedocs.org/zh_CN/latest/hypervisor/lxc.html
</code></pre>

<h3>8. Iptables forward</h3>

<p>Added at the first:</p>

<pre><code>sudo iptables -t filter -I FORWARD -j ACCEPT
</code></pre>

<h3>9. preseed using local repository</h3>

<p>Using the local repository for installation.</p>

<pre><code>d-i mirror/country string manual
d-i mirror/http/hostname string 192.168.1.13
d-i mirror/http/directory string /ubuntu
d-i mirror/http/proxy string

d-i apt-setup/restricted boolean true
d-i apt-setup/universe boolean true
d-i apt-setup/backports boolean true
d-i apt-setup/services-select multiselect security
d-i apt-setup/security_host string 192.168.1.13
d-i apt-setup/security_path string /ubuntu
</code></pre>

<p>Change the repository after installation:</p>

<pre><code>d-i preseed/late_command string wget http://192.168.1.13/sources.list.13 -O
/target/etc/apt/sources.list
</code></pre>

<h3>10. Static IP Configuration For Cloud-Init</h3>

<p>On Cloud-Init Configuration of Static IP.</p>

<pre><code>https://access.redhat.com/articles/rhel-atomic-cloud-init-faq
</code></pre>

<h3>11. Forwarding SSH Access To Inner</h3>

<p>This will forward the connection to 10003 to 10.0.0.3&rsquo;s 22 port, thus you will access
the inner machine via <code>ssh -p 10003 xxxx@192.168.10.187</code>.</p>

<pre><code># iptables -t nat -A PREROUTING -d 192.168.10.187 -p tcp --dport 10003 -j DNAT \
--to-destination 10.0.0.3:22
# iptables-save &gt;/etc/sysconfig/iptables
</code></pre>

<h3>12. On Perforce Monitor Tools</h3>

<p>graphite and collectd:</p>

<pre><code>http://www.infoq.com/cn/articles/graphite-intro
http://www.vpsee.com/2012/05/install-graphite-on-ubuntu-12-04/
http://www.vpsee.com/2012/05/use-collectd-with-graphite-to-monitor-servers/
https://collectd.org/wiki/index.php/Plugin:libvirt
http://www.drupal001.com/2012/07/system-monitor-collectd/
</code></pre>

<h3>13. More tips for Performance Monitor</h3>

<pre><code>http://www.unixmen.com/install-graphite-centos-7/
http://blog.csdn.net/crazyhacking/article/details/8363235
http://blog.csdn.net/puncha/article/details/9112293
http://skaka.me/blog/2015/07/21/kamon-statsd-graphite-grafana-introduction/
https://codeascraft.com/2011/02/15/measure-anything-measure-everything/
http://devops.com/2014/09/02/guide-modern-monitoring-alerting/
http://network.51cto.com/art/201505/475518_5.htm
</code></pre>

<h3>14. Log System</h3>

<pre><code>http://devops.com/2014/09/02/guide-modern-monitoring-alerting/
http://network.51cto.com/art/201505/475518_all.htm
https://linux.cn/article-5252-shareweibo.html
http://kibana.logstash.es/content/logstash/index.html
https://www.digitalocean.com/community/tutorials/how-to-install-and-use-graphite-on-an-ubuntu-14-04-server
</code></pre>

<h3>15. Discussion on monitor</h3>

<p><a href="http://segmentfault.com/q/1010000000116157">http://segmentfault.com/q/1010000000116157</a></p>

<h3>16. Simulation</h3>

<p>Online simulation for electronics:  <br/>
<a href="https://www.systemvision.com/">https://www.systemvision.com/</a></p>

<h3>17. Website Generator</h3>

<p>hugo:</p>

<p><a href="http://gohugo.io/overview/introduction/">http://gohugo.io/overview/introduction/</a></p>

<h3>18. Install Collectd On CentOS6</h3>

<pre><code>$ http://giovannitorres.me/how-to-build-rpms-collectd-example.html
$ http://giovannitorres.me/enabling-almost-all-collectd-plugins-on-centos-6.html
</code></pre>

<h3>19. View CentOS Version</h3>

<pre><code># cat /etc/redhat-release 
CentOS Linux release 7.1.1503 (Core) 
</code></pre>

<h3>20. Get Collectd Packages</h3>

<pre><code># wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo
# yum install --downloadonly --downloaddir=/root/Collectd collectd*
</code></pre>

<h3>21. Vagrant Verification</h3>

<pre><code># mkdir collectdtest
# cd collectdtest/
# vagrant box list
centos66        (virtualbox, 0)
vagrant_machine (virtualbox, 0)
# vagrant init centos66
# vagrant up
Bringing machine 'default' up with 'virtualbox' provider...
</code></pre>

<h3>22. Cockpit</h3>

<pre><code>Cockpit由红帽公司开发，旨在让服务器管理起来更容易。借助这个基于Web的GUI，你就能处理众多任务，比如管理存储资源、检查日志、启动/终止服务以及监控多台服务器。Cockpi可以在Fedora Server、Arch Linux、CentOS Atomic、Fedora Atomic和红帽企业级Linux(RHEL)上运行。

相关链接：http://cockpit-project.org
</code></pre>

<h3>23. OpenWRT DHCP Pool Configuration</h3>

<p>By Luci is very hard to find, so directly edit it under terminal.</p>

<pre><code># vi /etc/config/dhcp
config dhcp 'lan'
        option interface 'lan'
        option start '100'
        option limit '150'
        option leasetime '12h'
</code></pre>

<h3>24. Read-Only System In CentOS 6</h3>

<p>Enter root&rsquo;s password, and then remount the filesystem via following command:</p>

<pre><code>#  mount -o remount,rw /
</code></pre>

<p>Now you could edit your filesystem and configure its configuration files.</p>

<h3>25. ArchLinux nf_conntrack limitation</h3>

<pre><code># vim /etc/sysctl.d/99-sysctl.conf
net.netfilter.nf_conntrack_max = 1048576
# sysctl --system
</code></pre>

<h3>26. Conntrack调优</h3>

<p><a href="http://www.linuxsky.org/doc/admin/200704/35.html">http://www.linuxsky.org/doc/admin/200704/35.html</a></p>

<h3>27. Qemu With OpenVswitch</h3>

<p><a href="http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.KVM;hb=HEAD">http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.KVM;hb=HEAD</a></p>

<p><a href="https://airtower.wordpress.com/2012/12/26/multiple-network-devices-in-kvm/">https://airtower.wordpress.com/2012/12/26/multiple-network-devices-in-kvm/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[20151009备注]]></title>
    <link href="http://purplepalmdash.github.io/blog/2015/10/09/20151009bei-zhu/"/>
    <updated>2015-10-09T22:21:11+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2015/10/09/20151009bei-zhu</id>
    <content type="html"><![CDATA[<h3>Mirantis</h3>

<p>定时任务，更新Mirantis镜像</p>

<h3>Autossh Issue</h3>

<p>取远端服务器上的某个值，若该值为真，则临时建立反向链接。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Dockerize Markdown Written CV]]></title>
    <link href="http://purplepalmdash.github.io/blog/2015/10/08/dockerize-markdown-written-cv/"/>
    <updated>2015-10-08T10:08:02+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2015/10/08/dockerize-markdown-written-cv</id>
    <content type="html"><![CDATA[<h3>Tips</h3>

<p>Manually run the commands for generating the CVs.</p>

<pre><code>$ sudo apt-get install -y build-essential
$ sudo apt-get install -y pandoc
$ sudo apt-get install -y wkhtmltopdf 
$ sudo apt-get install xvfb
$  echo 'xvfb-run --server-args="-screen 0, 1024x768x24" /usr/bin/wkhtmltopdf $*' &gt; \
/usr/bin/wkhtmltopdf.sh
$ chmod a+x /usr/bin/wkhtmltopdf
$ chmod a+x /usr/bin/wkhtmltopdf.sh 
$ ln -s /usr/bin/wkhtmltopdf.sh /usr/local/bin/wkhtmltopdf
$ apt-get install -y ttf-wqy-zenhei
$ apt-get install -y git
$ apt-get install -y rubygems-integration ruby-dev
$ apt-get install -y libimage-exiftool-perl
$ gem install compass
$ gem install susy
$ git clone https://github.com/barraq/pandoc-moderncv.git
$ cd pandoc-moderncv/
$ mkdir -p cv/images/
$ vim cv/cv.md
$ gem install gempass
$ gem install 
$ make
#####$ apt-get install python-software-properties
#####$ apt-get install software-properties-common
$ vim Makefile 
   -&gt; Change the wkpdf to wkhtmltopdf
$ make pdf
</code></pre>

<h3>Dockerfile</h3>

<p>Write the Dockerfile like following:</p>

<pre><code># Based on Ubuntu 14.04
FROM ubuntu:trusty

# Install Packages, via apt-get. 
RUN apt-get update &amp;&amp; apt-get install -y \
    build-essential \
    pandoc \
    wkhtmltopdf \
    xvfb \
    ttf-wqy-zenhei \
    git \
    rubygems-integration \
    ruby-dev \
    libimage-exiftool-perl \
    python-twisted

# Now Change wkhtmltopdf
RUN echo 'xvfb-run --server-args="-screen 0, 1024x768x24" /usr/bin/wkhtmltopdf $*' &gt; /usr/bin/wkhtmltopdf.sh
RUN chmod a+x /usr/bin/wkhtmltopdf
RUN chmod a+x /usr/bin/wkhtmltopdf.sh 
RUN ln -s /usr/bin/wkhtmltopdf.sh /usr/local/bin/wkhtmltopdf

# Now Run gems 
RUN gem install compass
RUN gem install susy

# Git Clone the CV FrameWork from github.
RUN mkdir -p /opt/Code/
RUN git clone https://github.com/barraq/pandoc-moderncv.git  /opt/Code/pandoc-moderncv

# Now begin to build the cv, using the demo 'scaffold'
RUN cd /opt/Code/pandoc-moderncv/ &amp;&amp; make scaffold &amp;&amp; make pdf HTMLTOPDF=wkhtmltopdf

# Run http server on server 5177, since in dist/ folder we will have the html and pdf
EXPOSE 5177
CMD ["twistd", "-n", "web", "-p", "5177", "--path", "/opt/Code/pandoc-moderncv/dist/"]
</code></pre>

<p>Put it on github, and trigger an auto-build on dockerhub, pulling it and you could get
the well built docker image.</p>

<h3>Use this Container</h3>

<p>Use it via:</p>

<pre><code>$ sudo docker build -t mycv/mycvapp /home/dash/Code/DockerBuild
$ sudo docker run -d -p 5000:5177 mycv/mycvapp
</code></pre>

<p>Since our Docker Container listens 5177 port, we use <code>-p</code> for mapping local machine&rsquo;s
5000 port to 5177, visit localmachine:5000 then you could found the CV based directory.</p>

<h3>Change to Debian Based</h3>

<p>Maybe Debian based will be much more slim? But this involves the pandoc issue.</p>

<pre><code># Based on Debian Wheezy
FROM debian:wheezy

# Install Packages, via apt-get. 
RUN apt-get update &amp;&amp; apt-get install -y \
        build-essential \
        cabal-install \
        wkhtmltopdf \
        xvfb \
        ttf-wqy-zenhei \
        git \
        rubygems-integration \
        ruby-dev \
        libimage-exiftool-perl \
    zlib1g-dev \
    libdigest-perl \
        python-twisted &amp;&amp; rm -rf /var/lib/apt/lists/*

# Via cabal for installing pandoc, latest one will have the markdown plugins
RUN cabal update &amp;&amp; cabal install pandoc

# After install pandoc via cabal, update the $PATH
ENV PATH /root/.cabal/bin:$PATH

# Now Change wkhtmltopdf
RUN echo 'xvfb-run --server-args="-screen 0, 1024x768x24" /usr/bin/wkhtmltopdf $*' &gt;
/usr/bin/wkhtmltopdf.sh
RUN chmod a+x /usr/bin/wkhtmltopdf
RUN chmod a+x /usr/bin/wkhtmltopdf.sh 
RUN ln -s /usr/bin/wkhtmltopdf.sh /usr/local/bin/wkhtmltopdf

# Now Run gems 
RUN gem install compass
RUN gem install susy

# Git Clone the CV FrameWork from github.
RUN mkdir -p /opt/Code/
RUN git clone https://github.com/barraq/pandoc-moderncv.git  /opt/Code/pandoc-moderncv

# Now begin to build the cv, using the demo 'scaffold'
RUN cd /opt/Code/pandoc-moderncv/ &amp;&amp; make scaffold &amp;&amp; make pdf HTMLTOPDF=wkhtmltopdf

# Run http server on server 5177, since in dist/ folder we will have the html and pdf
EXPOSE 5177
CMD ["twistd", "-n", "web", "-p", "5177", "--path", "/opt/Code/pandoc-moderncv/dist/"]
</code></pre>
]]></content>
  </entry>
  
</feed>
