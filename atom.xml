<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Dash]]></title>
  <link href="http://purplepalmdash.github.io/atom.xml" rel="self"/>
  <link href="http://purplepalmdash.github.io/"/>
  <updated>2016-06-29T19:55:55+08:00</updated>
  <id>http://purplepalmdash.github.io/</id>
  <author>
    <name><![CDATA[Dash]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Site-to-site VPN]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/06/29/site-to-site-vpn/"/>
    <updated>2016-06-29T18:51:40+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/06/29/site-to-site-vpn</id>
    <content type="html"><![CDATA[<h3>Reference</h3>

<p>Refers to:</p>

<p><a href="https://clauseriksen.net/2011/02/02/ipsec-on-debianubuntu/">https://clauseriksen.net/2011/02/02/ipsec-on-debianubuntu/</a>  <br/>
And
<a href="http://xmodulo.com/create-site-to-site-ipsec-vpn-tunnel-openswan-linux.html">http://xmodulo.com/create-site-to-site-ipsec-vpn-tunnel-openswan-linux.html</a></p>

<h3>Network Topology</h3>

<p>The topology is listed as following:</p>

<p>Host1 &ndash; LAN1 &ndash; Router1 &ndash;[BIG, BAD INTERNET]&ndash; Router2 &ndash; LAN2 &ndash; Host2</p>

<p>Router1 and Router2 are Ubuntu14.04 machine, which runs in virt-manager,thus you have
to create 2 new networks, each in one physical machine.</p>

<p>Physical Machine 1: 192.168.1.79  <br/>
Router1:   <br/>
eth0: bridge to physical machine&rsquo;s networking. 192.168.10.100   <br/>
eth1: 10.47.70.2.  <br/>
DHCP on eth1.</p>

<p>Physical Machine 2: 192.168.1.69  <br/>
Router2:   <br/>
eth0: bridge to physical machine&rsquo;s networking. 192.168.10.200   <br/>
eth1: 10.47.67.2.  <br/>
DHCP on eth1.</p>

<h3>Router Network Configuration</h3>

<p>Router1&rsquo;s networking configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /etc/network/interfaces
</span><span class='line'>    # The loopback network interface
</span><span class='line'>    auto lo
</span><span class='line'>    iface lo inet loopback
</span><span class='line'>    
</span><span class='line'>    # The primary network interface
</span><span class='line'>    auto eth0
</span><span class='line'>    iface eth0 inet static
</span><span class='line'>    address 192.168.10.100
</span><span class='line'>    netmask 255.255.0.0
</span><span class='line'>    gateway 192.168.0.176
</span><span class='line'>    dns-nameservers 223.5.5.5
</span><span class='line'>    
</span><span class='line'>    auto eth1
</span><span class='line'>    iface eth1 inet static
</span><span class='line'>    address 10.47.70.2
</span><span class='line'>    netmask 255.255.255.0</span></code></pre></td></tr></table></div></figure>


<p>Router2&rsquo;s networking configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /etc/network/interfaces
</span><span class='line'>    # The loopback network interface
</span><span class='line'>    auto lo
</span><span class='line'>    iface lo inet loopback
</span><span class='line'>    
</span><span class='line'>    # The primary network interface
</span><span class='line'>    auto eth0
</span><span class='line'>    iface eth0 inet static
</span><span class='line'>    address 192.168.10.200
</span><span class='line'>    netmask 255.255.0.0
</span><span class='line'>    gateway 192.168.0.176
</span><span class='line'>    dns-nameservers 223.5.5.5
</span><span class='line'>    auto eth1
</span><span class='line'>    iface eth1 inet static
</span><span class='line'>    address 10.47.67.2
</span><span class='line'>    netmask 255.255.255.0</span></code></pre></td></tr></table></div></figure>


<p>After configuration , restart the Router1 and Router2.</p>

<h3>IPSEC Configuration</h3>

<h4>Router1</h4>

<p>Install following package:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install -y openswan</span></code></pre></td></tr></table></div></figure>


<p>Append following lines at the end of <code>/etc/sysctl.conf</code>,then run <code>sysctl -p
/etc/sysctl.conf</code> to take effects.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /etc/sysctl.conf
</span><span class='line'>net.ipv4.ip_forward=1
</span><span class='line'>net.ipv4.conf.all.accept_redirects = 0
</span><span class='line'>net.ipv4.conf.all.send_redirects = 0
</span><span class='line'>net.ipv4.conf.default.send_redirects = 0
</span><span class='line'>net.ipv4.conf.eth0.send_redirects = 0
</span><span class='line'>net.ipv4.conf.default.accept_redirects = 0
</span><span class='line'>net.ipv4.conf.eth0.accept_redirects = 0</span></code></pre></td></tr></table></div></figure>


<p>Also you have to disable the redirects via following commands:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>for vpn in /proc/sys/net/ipv4/conf/*;
</span><span class='line'>do echo 0 &gt; $vpn/accept_redirects;
</span><span class='line'>echo 0 &gt; $vpn/send_redirects;
</span><span class='line'>done</span></code></pre></td></tr></table></div></figure>


<p>iptables rules should be done via following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>iptables -A INPUT -p udp --dport 500 -j ACCEPT
</span><span class='line'>iptables -A INPUT -p tcp --dport 4500 -j ACCEPT
</span><span class='line'>iptables -A INPUT -p udp --dport 4500 -j ACCEPT
</span><span class='line'>iptables -t nat -A POSTROUTING -s 10.47.70.0/24 -d 10.47.67.0/24 -j SNAT --to 192.168.10.100
</span><span class='line'>#iptables -t nat -A POSTROUTING -s site-A-private-subnet -d site-B-private-subnet -j SNAT --to site-A-Public-IP
</span><span class='line'>iptables -A POSTROUTING -t nat -d 10.47.70.0/24 -o eth1 -m policy --dir out --pol ipsec -j ACCEPT
</span><span class='line'>iptables -A INPUT -m policy --dir in --pol ipsec -j ACCEPT
</span><span class='line'>iptables -A INPUT -p udp -m multiport --dports 500,4500 -j ACCEPT
</span><span class='line'>iptables -A INPUT -p esp -j ACCEPT
</span><span class='line'>iptables -A FORWARD -m policy --dir in --pol ipsec -j ACCEPT</span></code></pre></td></tr></table></div></figure>


<p>Now continue to configure the ipsec:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo vim /etc/ipsec.conf
</span><span class='line'>    ## general configuration parameters ##
</span><span class='line'>     
</span><span class='line'>    config setup
</span><span class='line'>            plutodebug=all
</span><span class='line'>            plutostderrlog=/var/log/pluto.log
</span><span class='line'>            protostack=netkey
</span><span class='line'>            nat_traversal=yes
</span><span class='line'>            virtual_private=%v4:10.0.0.0/8,%v4:192.168.0.0/16,%v4:172.16.0.0/12
</span><span class='line'>            ## disable opportunistic encryption in Red Hat ##
</span><span class='line'>            oe=off
</span><span class='line'>     
</span><span class='line'>    ## disable opportunistic encryption in Debian ##
</span><span class='line'>    ## Note: this is a separate declaration statement ##
</span><span class='line'>    #include /etc/ipsec.d/examples/no_oe.conf 
</span><span class='line'>     
</span><span class='line'>    ## connection definition in Debian ##
</span><span class='line'>    conn demo-connection-debian
</span><span class='line'>            authby=secret
</span><span class='line'>            auto=start
</span><span class='line'>            ## phase 1 ##
</span><span class='line'>            keyexchange=ike
</span><span class='line'>            ## phase 2 ##
</span><span class='line'>            esp=3des-md5
</span><span class='line'>            pfs=yes
</span><span class='line'>            type=tunnel
</span><span class='line'>            left=192.168.10.100
</span><span class='line'>            leftsourceip=192.168.10.100
</span><span class='line'>            leftsubnet=10.47.70.0/24
</span><span class='line'>            ## for direct routing ##
</span><span class='line'>            #leftsubnet=192.168.10.100/32
</span><span class='line'>            #leftnexthop=%defaultroute
</span><span class='line'>            leftnexthop=192.168.10.200
</span><span class='line'>            right=192.168.10.200
</span><span class='line'>            rightsubnet=10.47.67.0/24</span></code></pre></td></tr></table></div></figure>


<p>Notice the left/right configuration, should corresponding the our definition
of the networking.</p>

<p>Now generate the pre-shared keys via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ dd if=/dev/random count=24 bs=1 | xxd -ps
</span><span class='line'>24+0 records in
</span><span class='line'>24+0 records out
</span><span class='line'>24 bytes copied, 4.5529e-05 s, 527 kB/s
</span><span class='line'>cece1b0ffe27f82c27efc94339f08c418abb9e5f5c0d5bf5</span></code></pre></td></tr></table></div></figure>


<p>the <code>cece1b0ffe27f82c27efc94339f08c418abb9e5f5c0d5bf5</code> is the keys we want to
fill into the secrets:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo cat /etc/ipsec.secrets 
</span><span class='line'>    # This file holds shared secrets or RSA private keys for inter-Pluto
</span><span class='line'>    # authentication.  See ipsec_pluto(8) manpage, and HTML documentation.
</span><span class='line'>    
</span><span class='line'>    # RSA private key for this host, authenticating it to any other host
</span><span class='line'>    # which knows the public part.  Suitable public keys, for ipsec.conf, DNS,
</span><span class='line'>    # or configuration of other implementations, can be extracted conveniently
</span><span class='line'>    # with "ipsec showhostkey".
</span><span class='line'>    
</span><span class='line'>    # this file is managed with debconf and will contain the automatically created RSA keys
</span><span class='line'>    include /var/lib/openswan/ipsec.secrets.inc
</span><span class='line'>    192.168.10.100  192.168.10.200:  PSK  "cece1b0ffe27f82c27efc94339f08c418abb9e5f5c0d5bf5"</span></code></pre></td></tr></table></div></figure>


<p>Now Router1 is configured, we continue to configure Router2.</p>

<h4>Router2</h4>

<p>Ipsec and sysctl are the same as in Router1, the iptables scripts is listed as:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>iptables -A INPUT -p udp --dport 500 -j ACCEPT
</span><span class='line'>iptables -A INPUT -p tcp --dport 4500 -j ACCEPT
</span><span class='line'>iptables -A INPUT -p udp --dport 4500 -j ACCEPT
</span><span class='line'>iptables -t nat -A POSTROUTING -s 10.47.67.0/24 -d 10.47.70.0/24 -j SNAT --to 192.168.10.200
</span><span class='line'>
</span><span class='line'>#iptables -A POSTROUTING -t nat -d 192.168.1.0/24 -o eth0 -m policy --dir out --pol ipsec -j ACCEPT
</span><span class='line'>iptables -A POSTROUTING -t nat -d 10.47.67.0/24 -o eth1 -m policy --dir out --pol ipsec -j ACCEPT
</span><span class='line'>iptables -A INPUT -m policy --dir in --pol ipsec -j ACCEPT
</span><span class='line'>iptables -A INPUT -p udp -m multiport --dports 500,4500 -j ACCEPT
</span><span class='line'>iptables -A INPUT -p esp -j ACCEPT
</span><span class='line'>iptables -A FORWARD -m policy --dir in --pol ipsec -j ACCEPT</span></code></pre></td></tr></table></div></figure>


<p>Now configure the ipsec.conf like following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo vim /etc/ipsec.conf
</span><span class='line'>## general configuration parameters ##
</span><span class='line'> 
</span><span class='line'>config setup
</span><span class='line'>        plutodebug=all
</span><span class='line'>        plutostderrlog=/var/log/pluto.log
</span><span class='line'>        protostack=netkey
</span><span class='line'>        nat_traversal=yes
</span><span class='line'>        virtual_private=%v4:10.0.0.0/8,%v4:192.168.0.0/16,%v4:172.16.0.0/12
</span><span class='line'>        ## disable opportunistic encryption in Red Hat ##
</span><span class='line'>        oe=off
</span><span class='line'> 
</span><span class='line'>## disable opportunistic encryption in Debian ##
</span><span class='line'>## Note: this is a separate declaration statement ##
</span><span class='line'>#include /etc/ipsec.d/examples/no_oe.conf 
</span><span class='line'> 
</span><span class='line'>## connection definition in Debian ##
</span><span class='line'>conn demo-connection-debian
</span><span class='line'>        authby=secret
</span><span class='line'>        auto=start
</span><span class='line'>        ## phase 1 ##
</span><span class='line'>        keyexchange=ike
</span><span class='line'>        ## phase 2 ##
</span><span class='line'>        esp=3des-md5
</span><span class='line'>        pfs=yes
</span><span class='line'>        type=tunnel
</span><span class='line'>        left=192.168.10.200
</span><span class='line'>        leftsourceip=192.168.10.200
</span><span class='line'>        leftsubnet=10.47.67.0/24
</span><span class='line'>        ## for direct routing ##
</span><span class='line'>        #leftsubnet=192.168.10.200/32
</span><span class='line'>        #leftnexthop=%defaultroute
</span><span class='line'>        leftnexthop=192.168.10.100
</span><span class='line'>        right=192.168.10.100
</span><span class='line'>        rightsubnet=10.47.70.0/24</span></code></pre></td></tr></table></div></figure>


<p>Notice the definition&rsquo;s differences comparing to Router1.</p>

<p>The ipsec.secrets is the same as Router1, but you have to change like following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo vim /etc/ipsec.secrets
</span><span class='line'>192.168.10.200  192.168.10.100:  PSK  "3030804556207bde9fc5c9a043c6ac13fce136ce41eb98a6"</span></code></pre></td></tr></table></div></figure>


<p></p>

<h3>Examine</h3>

<p>Restart the ipsec services on both Router.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo  /etc/init.d/ipsec restart</span></code></pre></td></tr></table></div></figure>


<p>Examine the route via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adminubuntu@vpn1:~$ ip route
</span><span class='line'>default via 192.168.0.176 dev eth0 
</span><span class='line'>10.47.67.0/24 dev eth0  scope link  src 192.168.10.100 
</span><span class='line'>10.47.70.0/24 dev eth1  proto kernel  scope link  src 10.47.70.2 
</span><span class='line'>192.168.0.0/16 dev eth0  proto kernel  scope link  src 192.168.10.100 
</span><span class='line'>adminubuntu@vpn2:~$ ip route
</span><span class='line'>default via 192.168.0.176 dev eth0 
</span><span class='line'>10.47.67.0/24 dev eth1  proto kernel  scope link  src 10.47.67.2 
</span><span class='line'>10.47.70.0/24 dev eth0  scope link  src 192.168.10.200 
</span><span class='line'>192.168.0.0/16 dev eth0  proto kernel  scope link  src 192.168.10.200 </span></code></pre></td></tr></table></div></figure>


<p>So we can see the route shows the connection of the vpn.</p>

<p>Now examine the ipsec status:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo service ipsec status
</span><span class='line'>IPsec running  - pluto pid: 930
</span><span class='line'>pluto pid 930
</span><span class='line'>1 tunnels up
</span><span class='line'>some eroutes exist</span></code></pre></td></tr></table></div></figure>


<p>More detailed infos could be examine via: <code>sudo ipsec auto --status</code>.</p>

<h3>DHCP Server</h3>

<p>Install dhcpd and configure it via following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install -y isc-dhcp-server
</span><span class='line'>$ sudo vim /etc/default/isc-dhcp-server
</span><span class='line'>INTERFACES="eth1"</span></code></pre></td></tr></table></div></figure>


<p>Append following lines to <code>/etc/dhcp/dhcpd.conf</code>:  <br/>
Router1:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>subnet
</span><span class='line'>10.47.70.0 netmask 255.255.255.0 {
</span><span class='line'># --- default gateway
</span><span class='line'>option routers
</span><span class='line'>10.47.70.2;
</span><span class='line'># --- Netmask
</span><span class='line'>option subnet-mask
</span><span class='line'>255.255.255.0;
</span><span class='line'># --- Broadcast Address
</span><span class='line'>option broadcast-address
</span><span class='line'>10.47.70.255;
</span><span class='line'># --- Domain name servers, tells the clients which DNS servers to use.
</span><span class='line'>option domain-name-servers
</span><span class='line'>223.5.5.5,180.76.76.76;
</span><span class='line'>option time-offset 0;
</span><span class='line'>range 10.47.70.3 10.47.70.254;
</span><span class='line'>default-lease-time 1209600;
</span><span class='line'>max-lease-time 1814400;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Router2:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>subnet
</span><span class='line'>10.47.67.0 netmask 255.255.255.0 {
</span><span class='line'># --- default gateway
</span><span class='line'>option routers
</span><span class='line'>10.47.67.2;
</span><span class='line'># --- Netmask
</span><span class='line'>option subnet-mask
</span><span class='line'>255.255.255.0;
</span><span class='line'># --- Broadcast Address
</span><span class='line'>option broadcast-address
</span><span class='line'>10.47.67.255;
</span><span class='line'># --- Domain name servers, tells the clients which DNS servers to use.
</span><span class='line'>option domain-name-servers
</span><span class='line'>223.5.5.5,180.76.76.76;
</span><span class='line'>option time-offset 0;
</span><span class='line'>range 10.47.67.3 10.47.67.254;
</span><span class='line'>default-lease-time 1209600;
</span><span class='line'>max-lease-time 1814400;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Now your subnet is ready, restart the Router1 and Router2, next step we will
verify our site-to-site VPN.</p>

<h3>Verification</h3>

<p>Create 2 new vm on 2 physical machine, each of them attached to our Router&rsquo;s
eth1 networking. I use tinycore for experiment.</p>

<p>Tinycore Attaches to Router1:  <br/>
<img src="http://purplepalmdash.github.io/images/2016_06_29_19_23_50_469x212.jpg" alt="/images/2016_06_29_19_23_50_469x212.jpg" />  <br/>
Tinycore Attaches to Router2: <br/>
<img src="http://purplepalmdash.github.io/images/2016_06_29_19_25_18_497x351.jpg" alt="/images/2016_06_29_19_25_18_497x351.jpg" /></p>

<p>The picture also shows the ping each other without any problem.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[搭建基于docker的监控系统]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/06/20/da-jian-ji-yu-dockerde-jian-kong-xi-tong/"/>
    <updated>2016-06-20T09:39:55+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/06/20/da-jian-ji-yu-dockerde-jian-kong-xi-tong</id>
    <content type="html"><![CDATA[<h3>Graphite/Grafana</h3>

<p>这两个用于记录和展示监控数据，通过以下命令可以快速搭建:</p>

<h4>Graphite</h4>

<p>开启容器:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir -p /local/path/to/graphite/storage/whisper/
</span><span class='line'>$ sudo docker run -d \
</span><span class='line'>  --name graphite \
</span><span class='line'>  -p 8080:80 \
</span><span class='line'>  -p 2003:2003 \
</span><span class='line'>  -v /local/path/to/.htpasswd:/etc/nginx/.htpasswd \
</span><span class='line'>  -v /local/path/to/graphite/storage/whisper:/opt/graphite/storage/whisper \
</span><span class='line'>  sitespeedio/graphite</span></code></pre></td></tr></table></div></figure>


<p>创建htpasswd文件的方法可以参阅:    <br/>
<a href="http://httpd.apache.org/docs/2.2/programs/htpasswd.html">http://httpd.apache.org/docs/2.2/programs/htpasswd.html</a></p>

<p>当然如果你使用默认的密码的话，用户名/密码是:guest/guest.</p>

<h4>Grafana</h4>

<p>开启容器:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mkdir -p /local/path/to/grafana
</span><span class='line'># docker run -d -p 3000:3000 --name=grafana -v /local/path/to/grafana:/var/lib/grafana  grafana/grafana</span></code></pre></td></tr></table></div></figure>


<p>
默认用户名/密码为admin/admin.</p>

<h3>Collectd</h3>

<p>用于采集节点机上的数据，</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># docker run -d --net=host --privileged -v /:/hostfs:ro --name=collectd -e \
</span><span class='line'>HOST_NAME=localhost -e \
</span><span class='line'>GRAPHITE_HOST=192.168.1.79 andreasjansson/collectd-write-graphite</span></code></pre></td></tr></table></div></figure>


<p>参数说明:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>--net=host :     使用主机上的网络配置
</span><span class='line'>GRAPHITE_HOST:  前面设置的graphite机器的地址</span></code></pre></td></tr></table></div></figure>


<h3>systemd 启动方式</h3>

<p>collectd启动方式:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo vim /usr/lib/systemd/system/collectddocker.service
</span><span class='line'>[Unit]
</span><span class='line'>Description=collectd container
</span><span class='line'>Requires=docker.service
</span><span class='line'>After=docker.service
</span><span class='line'>
</span><span class='line'>[Service]
</span><span class='line'>Restart=always
</span><span class='line'>ExecStart=/usr/bin/docker start -a collectd
</span><span class='line'>ExecStop=/usr/bin/docker stop -t 2 collectd
</span><span class='line'>
</span><span class='line'>[Install]
</span><span class='line'>WantedBy=multi-user.target</span></code></pre></td></tr></table></div></figure>


<p>启动并使能服务:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo systemctl enable collectddocker.service</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[搭建无盘CentOS桌面环境]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/06/18/da-jian-wu-pan-centoszhuo-mian-huan-jing/"/>
    <updated>2016-06-18T13:43:48+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/06/18/da-jian-wu-pan-centoszhuo-mian-huan-jing</id>
    <content type="html"><![CDATA[<h3>网络准备</h3>

<p>创建一个无DHCP的网络:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_06_18_13_53_06_399x429.jpg" alt="/images/2016_06_18_13_53_06_399x429.jpg" /></p>

<p>DHCP服务器我们将配置在PXE服务器节点上。</p>

<h3>PXE节点配置</h3>

<h4>初始化配置</h4>

<p>最小化安装CentOS 7 Server。并配置其IP地址为<code>10.19.20.2</code>.  <br/>
关闭selinux和firewalld服务:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vi /etc/selinux/config 
</span><span class='line'>SELINUX=disabled
</span><span class='line'>
</span><span class='line'># systemctl disable firewalld.service</span></code></pre></td></tr></table></div></figure>


<h4>使用DVD作为源</h4>

<p>创建挂载目录并挂在DVD：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mkdir /cdrom
</span><span class='line'># mount -t iso9660 -o loop ./CentOS-7-x86_64-Everything-1511.iso /cdrom/</span></code></pre></td></tr></table></div></figure>


<p>创建新的repo文件:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vi /etc/yum.repos.d/local.repo
</span><span class='line'>
</span><span class='line'>[LocalRepo]
</span><span class='line'>name=Local Repository
</span><span class='line'>baseurl=file:///cdrom
</span><span class='line'>enabled=1
</span><span class='line'>gpgcheck=1
</span><span class='line'>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span></code></pre></td></tr></table></div></figure>


<p>生成新的缓存：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mkdir back
</span><span class='line'># mv CentOS-* back
</span><span class='line'># yum makecache</span></code></pre></td></tr></table></div></figure>


<p>安装一些必要的包:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># yum install -y vim wget</span></code></pre></td></tr></table></div></figure>


<h4>TFTP Server</h4>

<p>安装必要的包:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># yum -y install syslinux xinetd tftp-server
</span><span class='line'># mkdir /var/lib/tftpboot/pxelinux.cfg 
</span><span class='line'># cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/ </span></code></pre></td></tr></table></div></figure>


<p>配置PXE：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim /etc/xinetd.d/tftp 
</span><span class='line'>disable = no
</span><span class='line'># systemctl start xinetd
</span><span class='line'># systemctl enable xinetd</span></code></pre></td></tr></table></div></figure>


<h4>DHCP服务器</h4>

<p>安装:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># yum install -y dhcp</span></code></pre></td></tr></table></div></figure>


<p>配置:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim /etc/dhcp/dhcpd.conf
</span><span class='line'>    #
</span><span class='line'>    # DHCP Server Configuration file.
</span><span class='line'>    #   see /usr/share/doc/dhcp*/dhcpd.conf.example
</span><span class='line'>    #   see dhcpd.conf(5) man page
</span><span class='line'>    #
</span><span class='line'>    # create new
</span><span class='line'>    
</span><span class='line'>    # specify domain name
</span><span class='line'>    option domain-name "srv.world";
</span><span class='line'>    # specify name server's hostname or IP address
</span><span class='line'>    option domain-name-servers dlp.srv.world;
</span><span class='line'>    # default lease time
</span><span class='line'>    default-lease-time 600;
</span><span class='line'>    # max lease time
</span><span class='line'>    max-lease-time 7200;
</span><span class='line'>    # this DHCP server to be declared valid
</span><span class='line'>    authoritative;
</span><span class='line'>    # specify network address and subnet mask
</span><span class='line'>    subnet 10.19.20.0 netmask 255.255.255.0 {
</span><span class='line'>        # specify the range of lease IP address
</span><span class='line'>        range dynamic-bootp 10.19.20.200 10.19.20.254;
</span><span class='line'>        # specify broadcast address
</span><span class='line'>        option broadcast-address 10.19.20.255;
</span><span class='line'>        # specify default gateway
</span><span class='line'>        option routers 10.19.20.1;
</span><span class='line'>        option domain-name-servers   10.19.20.2;
</span><span class='line'>        filename        "pxelinux.0";
</span><span class='line'>        next-server     10.19.20.2;
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<p>启动并使能服务:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># systemctl start dhcpd 
</span><span class='line'># systemctl enable dhcpd </span></code></pre></td></tr></table></div></figure>


<h4>PXE服务器</h4>

<p>安装一些必要的包:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># yum -y install dracut-network nfs-utils</span></code></pre></td></tr></table></div></figure>


<p>在PXE服务器上构建一个无盘系统用的文件系统</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mkdir -p /var/lib/tftpboot/centos7/root 
</span><span class='line'># yum groups -y install "Server with GUI" --releasever=7 --installroot=/var/lib/tftpboot/centos7/root/</span></code></pre></td></tr></table></div></figure>


<p>给出root用户的默认密码:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># python -c 'import crypt,getpass; \ 
</span><span class='line'>print(crypt.crypt(getpass.getpass(), \
</span><span class='line'>crypt.mksalt(crypt.METHOD_SHA512)))' 
</span><span class='line'>Password:
</span><span class='line'>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span></code></pre></td></tr></table></div></figure>


<p>填入root密码到/etc/shadown中:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim /var/lib/tftpboot/centos7/root/etc/shadow
</span><span class='line'>root:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx:16372:0:99999:7:::</span></code></pre></td></tr></table></div></figure>


<p>构建<code>/etc/fstab</code>文件:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vi /var/lib/tftpboot/centos7/root/etc/fstab
</span><span class='line'> none    /tmp        tmpfs   defaults   0 0
</span><span class='line'>tmpfs   /dev/shm    tmpfs   defaults   0 0
</span><span class='line'>sysfs   /sys        sysfs   defaults   0 0
</span><span class='line'>proc    /proc       proc    defaults   0 0</span></code></pre></td></tr></table></div></figure>


<p>下载pxe所需要的vmlinuz和initrd.img文件:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># wget -P /var/lib/tftpboot/centos7/ \
</span><span class='line'>http://mirrors.aliyun.com/centos/7/os/x86_64/images/pxeboot/vmlinuz \
</span><span class='line'>http://mirrors.aliyun.com/centos/7/os/x86_64/images/pxeboot/initrd.img</span></code></pre></td></tr></table></div></figure>


<p>创建默认的pxe启动项目:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vi /var/lib/tftpboot/pxelinux.cfg/default
</span><span class='line'># create new
</span><span class='line'> default centos7
</span><span class='line'>
</span><span class='line'>label centos7
</span><span class='line'>    kernel centos7/vmlinuz
</span><span class='line'>    append initrd=centos7/initrd.img root=nfs:10.19.20.2:/var/lib/tftpboot/centos7/root rw selinux=0 </span></code></pre></td></tr></table></div></figure>


<p>映射NFS服务器:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vi /etc/exports
</span><span class='line'>/var/lib/tftpboot/centos7/root 10.19.20.0/24(rw,no_root_squash)
</span><span class='line'># systemctl start rpcbind nfs-server 
</span><span class='line'># systemctl enable rpcbind nfs-server </span></code></pre></td></tr></table></div></figure>


<p>现在在网络中加入新的机器，从PXE启动后，将直接进入到CentOS7的桌面。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RackHD Worktips]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/06/07/rackhd-worktips/"/>
    <updated>2016-06-07T17:05:19+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/06/07/rackhd-worktips</id>
    <content type="html"><![CDATA[<h3>Vagrant Preparation</h3>

<p>rackhd/rackhd vagrant box could be downloaded from following link:</p>

<p><a href="https://atlas.hashicorp.com/rackhd/boxes/rackhd">https://atlas.hashicorp.com/rackhd/boxes/rackhd</a></p>

<p>Clone the repository from the github:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pwd
</span><span class='line'>/home/dash/Code/Jun13
</span><span class='line'>$ git clone https://github.com/RackHD/RackHD
</span><span class='line'>$ cd RackHD</span></code></pre></td></tr></table></div></figure>


<p>Change into the directory example, create config and run the setup command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd example
</span><span class='line'>$ cp config/monorail_rack.cfg.example config/monorail_rack.cfg</span></code></pre></td></tr></table></div></figure>


<p>Edits can be made to this new file to adjust the number of pxe clients created.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ bin/monorail_rack</span></code></pre></td></tr></table></div></figure>


<p>The <code>monorail_rack</code> script will auto-start all of the services by default, but you can also run them manually if you prefer.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant ssh
</span><span class='line'>vagrant:~$ sudo nf start</span></code></pre></td></tr></table></div></figure>


<p>Unfortunately, the vagrant machine won&rsquo;t work due to bad networking.</p>

<h3>Customization Deployment</h3>

<p>Use a trusty based vagrant box for creating the rackhd node.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant init trustyvirtualbox
</span><span class='line'>$ vim Vagrantfile</span></code></pre></td></tr></table></div></figure>


<p>Vagrantfile&rsquo;s configuration modification is listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Vagrant.configure(2) do |config|
</span><span class='line'>  # The most common configuration options are documented and commented below.
</span><span class='line'>  # For a complete reference, please see the online documentation at
</span><span class='line'>  # https://docs.vagrantup.com.
</span><span class='line'>
</span><span class='line'>  # Added more disks
</span><span class='line'>+   file_to_disk = File.realpath( "." ).to_s + "/disk.vdi"
</span><span class='line'>
</span><span class='line'>  # config.vm.network "private_network", ip: "192.168.33.10"
</span><span class='line'>+   config.vm.network "private_network", ip: "172.31.128.1", virtualbox__intnet:  "closednet"
</span><span class='line'>
</span><span class='line'>+  config.vm.provider "virtualbox" do |vb|
</span><span class='line'>+    if ARGV[0] == "up" && ! File.exist?(file_to_disk) 
</span><span class='line'>+      puts "Creating 5GB disk #{file_to_disk}."
</span><span class='line'>+      vb.customize [
</span><span class='line'>+        'createhd', 
</span><span class='line'>+        '--filename', file_to_disk, 
</span><span class='line'>+        '--format', 'VDI', 
</span><span class='line'>+        '--size', 5000 * 1024 # 5 GB
</span><span class='line'>+      ] 
</span><span class='line'>+      vb.customize [
</span><span class='line'>+        'storageattach', :id, 
</span><span class='line'>+        '--storagectl', 'IDE Controller', 
</span><span class='line'>+        '--port', 1, '--device', 0, 
</span><span class='line'>+        '--type', 'hdd', '--medium', 
</span><span class='line'>+        file_to_disk
</span><span class='line'>+      ] 
</span><span class='line'>+    end
</span><span class='line'>+    vb.memory = "4096"
</span><span class='line'>+    vb.cpus = 2
</span><span class='line'>+    vb.customize ["modifyvm", :id, "--nicpromisc2", "allow-all", "--ioapic", "on"]
</span><span class='line'>+  end</span></code></pre></td></tr></table></div></figure>


<p>Then <code>vagrant up</code> for start up the machine.</p>

<p>Notice: the controller of the disk should be noticed very carefully, you could choose
&ldquo;IDE Controller&rdquo; Or &ldquo;SATA Controller&rdquo;, depending on your virtualbox configuration.  <br/>
Then follow the tips on:</p>

<p><a href="http://purplepalmdash.github.io/blog/2016/06/01/use-rakehd-for-deploying-systems/">http://purplepalmdash.github.io/blog/2016/06/01/use-rakehd-for-deploying-systems/</a>  <br/>
Extend the root partition of vagrant disk via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pvcreate /dev/sdb
</span><span class='line'>$ sudo vgextend vagrant-vg /dev/sdb
</span><span class='line'>$ sudo lvextend -l +100%FREE /dev/vagrant-vg/root
</span><span class='line'>$ sudo resize2fs  /dev/vagrant-vg/root</span></code></pre></td></tr></table></div></figure>


<h3>Adding Ubuntu Deployment</h3>

<p>Install <code>apt-mirror</code> first, then using following mirror configuration file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /etc/apt/mirror.list
</span><span class='line'>############# config ##################
</span><span class='line'>#
</span><span class='line'># set base_path    /var/spool/apt-mirror
</span><span class='line'>#
</span><span class='line'># set mirror_path  $base_path/mirror
</span><span class='line'># set skel_path    $base_path/skel
</span><span class='line'># set var_path     $base_path/var
</span><span class='line'># set cleanscript $var_path/clean.sh
</span><span class='line'># set defaultarch  &lt;running host architecture&gt;
</span><span class='line'># set postmirror_script $var_path/postmirror.sh
</span><span class='line'># set run_postmirror 0
</span><span class='line'>set base_path /var/mirrors/ubuntu/14.04
</span><span class='line'>set nthreads     20
</span><span class='line'>set _tilde 0
</span><span class='line'>#
</span><span class='line'>############# end config ##############
</span><span class='line'>
</span><span class='line'>deb-amd64 http://mirrors.aliyun.com/ubuntu    trusty main main/debian-installers
</span><span class='line'>deb http://mirrors.aliyun.com/ubuntu  trusty main/installer-amd64
</span><span class='line'>deb-amd64 http://mirrors.aliyun.com/ubuntu    trusty-updates main
</span><span class='line'>deb-amd64 http://mirrors.aliyun.com/ubuntu    trusty-security main
</span><span class='line'>clean http://mirrors.aliyun.com/ubuntu</span></code></pre></td></tr></table></div></figure>


<p>Also you have to create following script for downloading the debian-installer:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /var/mirrors/ubuntu/14.04/var/postmirror.sh 
</span><span class='line'>#!/bin/sh -x 
</span><span class='line'># the udebs script gets the actual files we need 
</span><span class='line'>#/mnt/repo/apt-mirror/var/udebs.sh  
</span><span class='line'># A quick apt directory structure primer: 
</span><span class='line'># an apt server (e.g. archive.ubuntu.com) contains repositories (e.g. trusty-backports), 
</span><span class='line'># which contain archives (e.g. multiverse), which contain directories 
</span><span class='line'># a complete example - http://archive.ubuntu.com/ubuntu/dists/trusty-backports/multiverse/debian-installer/  
</span><span class='line'># With this in mind, we create bash 'arrays' of the structure: 
</span><span class='line'># server we're syncing against 
</span><span class='line'>#MIRROR="cn.archive.ubuntu.com" 
</span><span class='line'>MIRROR="archive.ubuntu.com" 
</span><span class='line'># repositories we're mirroring 
</span><span class='line'>#REPOS="trusty trusty-updates trusty-security trusty-proposed trusty-backports" 
</span><span class='line'>REPOS="trusty"
</span><span class='line'># archives in repositories 
</span><span class='line'>#ARCHIVES="main multiverse restricted universe" 
</span><span class='line'>ARCHIVES="main"
</span><span class='line'># installer location inside archive 
</span><span class='line'>#DIRECTORIES="debian-installer dist-upgrader-all installer-amd64 installer-i386" 
</span><span class='line'>DIRECTORIES="debian-installer installer-amd64"
</span><span class='line'>#where we're storing it locally 
</span><span class='line'>LOCALDIR="/var/mirrors/ubuntu/14.04/mirror/mirrors.aliyun.com"
</span><span class='line'>#LOCALDIR="/mnt/repo/apt-mirror/mirror/archive.ubuntu.com"  
</span><span class='line'>for REPO in $REPOS; do 
</span><span class='line'>for ARCHIVE in $ARCHIVES; do 
</span><span class='line'>for DIRECTORY in $DIRECTORIES;do 
</span><span class='line'># create directory structure 
</span><span class='line'>if [ ! -e "$LOCALDIR/ubuntu/dists/$REPO/$ARCHIVE/$DIRECTORY" ]; then
</span><span class='line'>mkdir -p "$LOCALDIR/ubuntu/dists/$REPO/$ARCHIVE/$DIRECTORY"
</span><span class='line'>fi
</span><span class='line'># do the sync 
</span><span class='line'>rsync --recursive --times --links --hard-links --delete --delete-after \
</span><span class='line'>rsync://$MIRROR/ubuntu/dists/$REPO/$ARCHIVE/$DIRECTORY/ $LOCALDIR/ubuntu/dists/$REPO/$ARCHIVE/$DIRECTORY
</span><span class='line'>done
</span><span class='line'>done
</span><span class='line'>done</span></code></pre></td></tr></table></div></figure>


<p>Now run <code>sudo apt-mirror</code> for syncing the repository to local storage.</p>

<p>Also create a shortcut to the repository in RackHD System:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo ln -s /var/mirrors/ubuntu/14.04/mirror/mirrors.aliyun.com/ubuntu/ /opt/monorail/static/http/</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Now restart the rackhd node, the ubuntu deployment is ready for use.</p>

<h3>Ubuntu Deployment</h3>

<p>Add the json file which holds the ubuntu deployment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pwd
</span><span class='line'>/home/vagrant/RackHD/example
</span><span class='line'>$ vim samples/ubuntu_boot.json 
</span><span class='line'>{
</span><span class='line'>    "name": "Graph.InstallUbuntu",
</span><span class='line'>    "options": {
</span><span class='line'>        "defaults": {
</span><span class='line'>            "obmServiceName": "noop-obm-service"
</span><span class='line'>        },
</span><span class='line'>        "install-os": {
</span><span class='line'>            "repo": "/ubuntu",
</span><span class='line'>            "rootPassword": "ubuntu",
</span><span class='line'>            "profile": "install-trusty.ipxe",
</span><span class='line'>            "completionUri": "renasar-ansible.pub"
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>In fact the <code>rootPassword</code> is not ready for use, the real password after deployment
 is <code>RackHDRocks!</code>.</p>

<p>Add one node(first you should make it pxed):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ curl -H "Content-Type: application/json" -X POST --data @samples/noop_body.json http://localhost:8080/api/1.1/nodes/575fce38d23ba028051b4711/obm
</span><span class='line'>$ curl -H "Content-Type: application/json" -X POST --data @samples/ubuntu_boot.json http://localhost:8080/api/1.1/nodes/575fce38d23ba028051b4711/workflows</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Then restart the machine, you will get it installing ubuntu.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Use RackHD for Deploying Systems]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/06/01/use-rakehd-for-deploying-systems/"/>
    <updated>2016-06-01T09:14:18+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/06/01/use-rakehd-for-deploying-systems</id>
    <content type="html"><![CDATA[<p>Following are the steps for using the RackHD for deploying systems. Mainly refers to
<a href="http://dojoblog.emc.com/rackhd-cpi/setting-up-rackhd/">http://dojoblog.emc.com/rackhd-cpi/setting-up-rackhd/</a></p>

<p>But the tutorial from emc includes lots of mistakes, so I listed all of the steps in
following chapters.</p>

<h3>Vagrant Env Preparation</h3>

<p>Initialize the vagrant env via(ubuntu1404 is my box name):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant init ubuntu1404
</span><span class='line'>A `Vagrantfile` has been placed in this directory. 
</span><span class='line'>$ vim Vagrantfile
</span><span class='line'>  config.vm.provider "virtualbox" do |vb|
</span><span class='line'>  #   # Display the VirtualBox GUI when booting the machine
</span><span class='line'>  #   vb.gui = true
</span><span class='line'>  #
</span><span class='line'>  #   # Customize the amount of memory on the VM:
</span><span class='line'>    vb.memory = "4096"
</span><span class='line'>    vb.cpus = 4
</span><span class='line'>    vb.customize ["modifyvm", :id, "--nicpromisc2", "allow-all", "--ioapic", "on"]
</span><span class='line'>  end
</span><span class='line'>$ vagrant up</span></code></pre></td></tr></table></div></figure>


<h3>Prerequisites</h3>

<p>Use following scripts for installing the prerequisites for RackHD(<code>pre_rackhd.sh</code>):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/bin/bash 
</span><span class='line'>set -­e
</span><span class='line'>
</span><span class='line'>sudo apt-get -y update
</span><span class='line'>sudo apt-get -y dist-upgrade
</span><span class='line'>sudo apt-get autoremove
</span><span class='line'>sudo apt-get install -y nodejs nodejs-legacy npm
</span><span class='line'>
</span><span class='line'># Runtime Dependencies
</span><span class='line'>sudo apt-get install -y rabbitmq-server mongodb isc-dhcp-server
</span><span class='line'>sudo apt-get install -y snmp ipmitool ansible amtterm apt-mirror unzip libkrb5-dev
</span><span class='line'>
</span><span class='line'># upstart will be installed after Ubuntu15.04.
</span><span class='line'># sudo apt-get -y install upstart­sysv
</span><span class='line'>sudo update-initramfs -u
</span><span class='line'>
</span><span class='line'># amttool
</span><span class='line'>wget http://downloads.sourceforge.net/project/amttooltng/1.7/amttool
</span><span class='line'>sudo chmod 777 amttool
</span><span class='line'>sudo mv amttool /usr/bin/amttooltng
</span><span class='line'>
</span><span class='line'># Compile Dependencies
</span><span class='line'>sudo apt-get install -y git openssh-server pbuilder dh-make devscripts ubuntu-dev-tools
</span><span class='line'>
</span><span class='line'># Git clone all of the repositories
</span><span class='line'>RACKHD_INSTALL_DIR=~;cd $RACKHD_INSTALL_DIR
</span><span class='line'>git clone https://github.com/RackHD/RackHD
</span><span class='line'>RACKHD_PROJECT_DIR=${RACKHD_INSTALL_DIR}/RackHD
</span><span class='line'>cd $RACKHD_PROJECT_DIR
</span><span class='line'>git submodule update --init --recursive
</span><span class='line'>git submodule foreach git pull origin master
</span><span class='line'>
</span><span class='line'># Configuration files
</span><span class='line'>sudo touch /etc/default/on-http
</span><span class='line'>sudo touch /etc/default/on-dhcp-proxy
</span><span class='line'>sudo touch /etc/default/on-taskgraph
</span><span class='line'>sudo touch /etc/default/on-syslog
</span><span class='line'>sudo touch /etc/default/on-tftp
</span><span class='line'>
</span><span class='line'># Build And Install
</span><span class='line'>cd ${RACKHD_PROJECT_DIR}/on-http
</span><span class='line'>./HWIMO-BUILD
</span><span class='line'>sudo dpkg -i on-http_*.deb
</span><span class='line'> 
</span><span class='line'>cd ${RACKHD_PROJECT_DIR}/on-dhcp-proxy
</span><span class='line'>./HWIMO-BUILD
</span><span class='line'>sudo dpkg -i on-dhcp-proxy_*.deb
</span><span class='line'>
</span><span class='line'>cd ${RACKHD_PROJECT_DIR}/on-taskgraph
</span><span class='line'>./HWIMO-BUILD
</span><span class='line'>sudo dpkg -i on-taskgraph_*.deb
</span><span class='line'>
</span><span class='line'>cd ${RACKHD_PROJECT_DIR}/on-syslog
</span><span class='line'>./HWIMO-BUILD
</span><span class='line'>sudo dpkg -i on-syslog_*.deb
</span><span class='line'>
</span><span class='line'>cd ${RACKHD_PROJECT_DIR}/on-tftp
</span><span class='line'>./HWIMO-BUILD
</span><span class='line'>sudo dpkg -i on-tftp_*.deb</span></code></pre></td></tr></table></div></figure>


<p>Now shutdown the vm, add one networking interface, because we want to add PXE in this
network apdater.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim Vagrantfile
</span><span class='line'>config.vm.network "private_network", ip: "172.31.128.1", virtualbox__intnet: "closednet"</span></code></pre></td></tr></table></div></figure>


<p>Now startup the vagrant vm again. continue to configure the PXE.</p>

<h3>Configuration</h3>

<p>Examine the eth1 IP Configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vagrant@ubuntu-1404:~$ ifconfig eth1
</span><span class='line'>eth1      Link encap:Ethernet  HWaddr 08:00:27:c2:cf:3e  
</span><span class='line'>          inet addr:172.31.128.1  Bcast:172.31.128.255  Mask:255.255.255.0</span></code></pre></td></tr></table></div></figure>


<p>Configure the isc-dhcp:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo vim /etc/default/isc-dhcp-server
</span><span class='line'>INTERFACES="eth1"</span></code></pre></td></tr></table></div></figure>


<p>Add the following configuration into <code>/etc/dhcp/dhcp.conf</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># RackHD Added Lines
</span><span class='line'>deny duplicates;
</span><span class='line'>
</span><span class='line'>ignore-client-uids true;
</span><span class='line'>
</span><span class='line'>subnet 172.31.128.0 netmask 255.255.252.0 {
</span><span class='line'>    range 172.31.128.2 172.31.131.254;
</span><span class='line'>    # Use this option to signal to the PXE client that we are doing proxy DHCP
</span><span class='line'>    option vendor-class-identifier "PXEClient";
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Download the config.json for monorail usage, and modify its tftpRoot Configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd /opt/monorail/
</span><span class='line'>$ sudo wget https://raw.githubusercontent.com/RackHD/RackHD/master/packer/ansible/roles/monorail/files/config.json
</span><span class='line'>$ sudo vim config.json
</span><span class='line'>    "tftpRoot": "/opt/monorail/static/tftp",</span></code></pre></td></tr></table></div></figure>


<p>Prepare the http and tftp folder:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo mkdir -p /opt/monorail/static/http/common/
</span><span class='line'>$ sudo mkdir -p /opt/monorail/static/tftp/</span></code></pre></td></tr></table></div></figure>


<p>Download the tftp and http static files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd /opt/monorail/static/tftp
</span><span class='line'>$ sudo wget https://bintray.com/artifact/download/rackhd/binary/ipxe/monorail.ipxe
</span><span class='line'>$ sudo wget https://bintray.com/artifact/download/rackhd/binary/ipxe/monorail-undionly.kpxe
</span><span class='line'>$ sudo wget https://bintray.com/artifact/download/rackhd/binary/ipxe/monorail-efi32-snponly.efi
</span><span class='line'>$ sudo wget https://bintray.com/artifact/download/rackhd/binary/ipxe/monorail-efi64-snponly.efi
</span><span class='line'>$ cd /opt/monorail/static/http/common/
</span><span class='line'>$ sudo wget https://bintray.com/artifact/download/rackhd/binary/builds/discovery.overlay.cpio.gz
</span><span class='line'>$ sudo wget https://bintray.com/artifact/download/rackhd/binary/builds/base.trusty.3.16.0-25-generic.squashfs.img
</span><span class='line'>$ sudo wget https://bintray.com/artifact/download/rackhd/binary/builds/initrd.img-3.16.0-25-generic
</span><span class='line'>$ sudo wget https://bintray.com/artifact/download/rackhd/binary/builds/vmlinuz-3.16.0-25-generic</span></code></pre></td></tr></table></div></figure>


<p>Now reboot the vm again, next step we will test the PXE boot.</p>

<h3>PXE Clients</h3>

<p>The PXE will be avaiable and after it finishes, the vm will look like:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_06_01_11_47_57_712x236.jpg" alt="/images/2016_06_01_11_47_57_712x236.jpg" />  <br/>
Now you could get the node info via following RESTFUL api call:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ curl http://localhost:8080/api/1.1/nodes | python -m json.tool
</span><span class='line'>        "createdAt": "2016-06-01T03:44:09.064Z",
</span><span class='line'>        "id": "574e5a0944ff724a05284005",
</span><span class='line'>        "identifiers": [
</span><span class='line'>            "08:00:27:02:5f:7a"
</span><span class='line'>        ],
</span><span class='line'>        "name": "08:00:27:02:5f:7a",
</span></code></pre></td></tr></table></div></figure>


<p>Examine the mac correponding node ID <code>574e5a0944ff724a05284005</code>, later we wil use this id for deploying CentOS.</p>

<h3>Add CentOS7 Deployment</h3>

<p>Add CentOS7 DVD into the deployment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo python ~/RackHD/on-tools/scripts/setup_iso.py /mnt/CentOS-7-x86_64-Everything-1511.iso  /opt/monorail/static/http --link=/home/vagrant/RackHD</span></code></pre></td></tr></table></div></figure>


<p>This will takes around 10 mins for importing the iso into the RackHD.</p>

<p>Configure the node:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ curl -H "Content-Type: application/json" -X POST --data @samples/noop_body.json http://localhost:8080/api/1.1/nodes/574e5a0944ff724a05284005/obm | python -m json.tool
</span><span class='line'>$ curl -H "Content-Type: application/json" -X POST --data @samples/centos_iso_boot.json http://localhost:8080/api/1.1/nodes/574e5a517c6c03440553dd0f/workflows | python -m json.tool</span></code></pre></td></tr></table></div></figure>


<p><img src="http://purplepalmdash.github.io/images/2016_06_01_14_12_33_449x503.jpg" alt="/images/2016_06_01_14_12_33_449x503.jpg" /> <br/>
Then added the configuration for deploying CentOS7 via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd ~/RackHD/example/
</span><span class='line'>$ curl -H "Content-Type: application/json" -X POST --data @samples/noop_body.json http://localhost:8080/api/1.1/nodes/574e6516224a4449056183e7/obm | python -m json.tool
</span><span class='line'>$ curl -H "Content-Type: application/json" -X POST --data @samples/centos_iso_boot.json http://localhost:8080/api/1.1/nodes/574e6516224a4449056183e7/workflows | python -m json.tool</span></code></pre></td></tr></table></div></figure>


<p>
PXE the node, thus you will get a CentOS7 installed.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[不同桌面环境占用内存/CPU对比]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/05/31/bu-tong-zhuo-mian-huan-jing-zhan-yong-nei-cun-slash-cpudui-bi/"/>
    <updated>2016-05-31T09:25:38+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/05/31/bu-tong-zhuo-mian-huan-jing-zhan-yong-nei-cun-slash-cpudui-bi</id>
    <content type="html"><![CDATA[<p>对比xfce4, lxde, gnome, mate等桌面环境占用内存/CPU对比</p>

<h3>先决条件</h3>

<p>使用vagrant的镜像(ubuntu14.04):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant box list
</span><span class='line'>ubuntu1404                                   (virtualbox, 0)</span></code></pre></td></tr></table></div></figure>


<p>每一个桌面环境的验证如下:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant init ubuntu1404
</span><span class='line'>$ vim Vagrantfile
</span><span class='line'>  config.vm.provider "virtualbox" do |vb|
</span><span class='line'>    # Display the VirtualBox GUI when booting the machine
</span><span class='line'>  #  vb.gui = true
</span><span class='line'>  
</span><span class='line'>    # Customize the amount of memory on the VM:
</span><span class='line'>    vb.memory = "1024"
</span><span class='line'>  end
</span><span class='line'>$ vagrant up</span></code></pre></td></tr></table></div></figure>


<h3>基础镜像占用内存</h3>

<p>用<code>free -m</code>来查看系统运行时所占用内存：</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_31_09_42_54_688x111.jpg" alt="/images/2016_05_31_09_42_54_688x111.jpg" /></p>

<h3>xfce4(xubuntu)</h3>

<p>安装:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get update
</span><span class='line'>$ sudo apt-get install xubuntu-desktop</span></code></pre></td></tr></table></div></figure>


<p>启动xfce4桌面后，内存占用结果为：</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_31_09_57_44_483x164.jpg" alt="/images/2016_05_31_09_57_44_483x164.jpg" /></p>

<h3>lxde(lubuntu)</h3>

<p>安装:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get update
</span><span class='line'>$ sudo apt-get install -y lubuntu-desktop</span></code></pre></td></tr></table></div></figure>


<p>启动lxde后，内存占用为:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_31_10_07_46_458x84.jpg" alt="/images/2016_05_31_10_07_46_458x84.jpg" /></p>

<h3>gnome(gnome-session-fallback)</h3>

<p>安装:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get update; sudo apt-get install gnome-session-fallback
</span><span class='line'>$ sudo apt-get install -y gdm xterm</span></code></pre></td></tr></table></div></figure>


<p>启动gnome-session-fallback后，内存占用为:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_31_10_22_08_490x185.jpg" alt="/images/2016_05_31_10_22_08_490x185.jpg" /></p>

<h3>unity</h3>

<p>安装:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get update && sudo apt-get install -y ubuntu-desktop</span></code></pre></td></tr></table></div></figure>


<p>启动unity后，内存占用为:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_31_10_26_22_553x168.jpg" alt="/images/2016_05_31_10_26_22_553x168.jpg" /></p>

<h3>mate</h3>

<p>安装:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-add-repository ppa:ubuntu-mate-dev/ppa
</span><span class='line'>$ sudo apt-add-repository ppa:ubuntu-mate-dev/trusty-mate
</span><span class='line'>$ sudo apt-get update && sudo apt-get upgrade
</span><span class='line'>$ sudo apt-get install --no-install-recommends ubuntu-mate-core ubuntu-mate-desktop</span></code></pre></td></tr></table></div></figure>


<p>启动mate后，内存占用为:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_31_10_50_58_486x148.jpg" alt="/images/2016_05_31_10_50_58_486x148.jpg" /></p>

<h3>KDE</h3>

<p>安装:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get update && sudo apt-get install -y kubuntu-desktop</span></code></pre></td></tr></table></div></figure>


<p>内存占用:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_31_11_06_50_487x108.jpg" alt="/images/2016_05_31_11_06_50_487x108.jpg" /></p>

<h3>对比</h3>

<p>统计结果:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_31_11_08_35_342x269.jpg" alt="/images/2016_05_31_11_08_35_342x269.jpg" /></p>

<p>图例:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_31_11_10_32_896x593.jpg" alt="/images/2016_05_31_11_10_32_896x593.jpg" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[羊城漫步(二)]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/05/29/yang-cheng-man-bu-er/"/>
    <updated>2016-05-29T22:27:39+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/05/29/yang-cheng-man-bu-er</id>
    <content type="html"><![CDATA[<p>计划不如变化，昨天说要去南越文王博物馆，结果上午下暴雨，中午有饭局，延后。饭局中有
小伙伴说去看广美的毕业设计，想起来几天前在微博上看到一广美学生关于GFW的讽刺毕业设计，
酒足饭饱后一行人即赶赴大学城观展。</p>

<h3>广美毕业设计展</h3>

<p>广美毕业展分五楼，每个展厅都有数百平米，囊括了绘画、动画、建筑设计、服装设计、模型设计、
汽车设计…………内容。一路看来，真是让人大开眼界。</p>

<p>设计是很重要的，有了好的设计才会有好的产品。在制造业已然日薄西山的当下，往设计转型也许
是个不错的发展方向。好了，以下是一些走马观花的掠影。</p>

<p>彩陶制作的城堡摆件。笨拙的造型和鲜活的配色让诸多小朋友流连往返:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_30_53_1432x815.jpg" alt="/images/2016_05_29_22_30_53_1432x815.jpg" /></p>

<p>这组憨态可掬的作品叫《不减肥挺好的》，一个妹子的本科毕业设计:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_35_13_691x825.jpg" alt="/images/2016_05_29_22_35_13_691x825.jpg" /></p>

<p>这个屏风摆件很有想象力：</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_37_07_658x825.jpg" alt="/images/2016_05_29_22_37_07_658x825.jpg" /></p>

<p>如果家里有一个温馨如此的阳台:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_38_31_1237x816.jpg" alt="/images/2016_05_29_22_38_31_1237x816.jpg" /></p>

<p>适合培养多肉植物的摆盘:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_39_29_1386x819.jpg" alt="/images/2016_05_29_22_39_29_1386x819.jpg" /></p>

<p>生活在绿色里:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_40_34_1479x831.jpg" alt="/images/2016_05_29_22_40_34_1479x831.jpg" /></p>

<p>破烂狗熊和它的朋友们:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_41_38_624x826.jpg" alt="/images/2016_05_29_22_41_38_624x826.jpg" /></p>

<p>这几个皮革的配色相当不错，有手工打造一个键盘皮套的冲动:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_44_15_734x796.jpg" alt="/images/2016_05_29_22_44_15_734x796.jpg" /></p>

<p>喵星人专属的浴室设计, 这个真的要狂赞:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_45_29_468x828.jpg" alt="/images/2016_05_29_22_45_29_468x828.jpg" /></p>

<p>萌爆了的拖鞋！</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_46_30_1230x826.jpg" alt="/images/2016_05_29_22_46_30_1230x826.jpg" /></p>

<p>让人马上能安静下来的书桌设计，萌萌的北极熊，蓝+白色调。超赞的设计！</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_47_26_1076x831.jpg" alt="/images/2016_05_29_22_47_26_1076x831.jpg" /></p>

<p>这个家居摆设让人无法抗拒一杯咖啡或者啤酒的诱惑:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_50_25_470x828.jpg" alt="/images/2016_05_29_22_50_25_470x828.jpg" /></p>

<p>一位兰州籍学子为家乡设计的兰州珍品包装，也是超级赞哦！！！</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_51_15_466x828.jpg" alt="/images/2016_05_29_22_51_15_466x828.jpg" /></p>

<p>这里头的一个吊牌，就是一个被GFW屏蔽的网站, 叹气。。。</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_53_16_1396x834.jpg" alt="/images/2016_05_29_22_53_16_1396x834.jpg" /></p>

<p>而吊牌下的小卡片，则是该网站不能访问的起始时间，9个卡片里，有twitter,facebook,google等：</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_54_18_1442x829.jpg" alt="/images/2016_05_29_22_54_18_1442x829.jpg" /></p>

<p>视觉跟踪的小黄鸭们，用传感器，实现小黄鸭随着观众的体感而转动，老大哥能从任一方向都看着你:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_55_39_1004x821.jpg" alt="/images/2016_05_29_22_55_39_1004x821.jpg" /></p>

<p>中国人用了太多抗生素，滥用了太多。这幅作品就是指的这个:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_57_17_572x819.jpg" alt="/images/2016_05_29_22_57_17_572x819.jpg" /></p>

<p>水墨展示的乐师们的神态。虽然没有面部表情，但是，那种陶醉的形态已经栩栩如生:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_22_58_38_1092x833.jpg" alt="/images/2016_05_29_22_58_38_1092x833.jpg" /></p>

<p>好作品真是太多。限于时间，没法一一展示了。我们只是看了4层，还有一层没看。这次展览
完全出乎我的意料之外，首先我没想到本科生的毕业设计水准已经如此之高；再次我没想到美术学院
的学生，他们所着眼的范围已经覆盖得如此之广，他们涉及了城市设计、环境保护、家居设计、工业
包装等等等等诸多领域。而我们这群技术工人，相比之下，做的只是一点点微小的工作吧。</p>

<p>Life is long, play more.</p>

<h3>纯吃货贴</h3>

<p>本日主打斑鱼，顺祝某位小伙伴生日快乐。</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_23_03_30_1385x819.jpg" alt="/images/2016_05_29_23_03_30_1385x819.jpg" /></p>

<p>传说中的斑鱼：</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_23_04_13_1366x826.jpg" alt="/images/2016_05_29_23_04_13_1366x826.jpg" /></p>

<p>晚餐呢接着腐败，驴肉:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_23_05_55_1159x650.jpg" alt="/images/2016_05_29_23_05_55_1159x650.jpg" /></p>

<p>好烧鹅：</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_23_06_36_1149x647.jpg" alt="/images/2016_05_29_23_06_36_1149x647.jpg" /></p>

<p>天上龙肉，地下驴肉:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_29_23_07_34_489x795.jpg" alt="/images/2016_05_29_23_07_34_489x795.jpg" /></p>

<p>酒足饭饱外加精神愉悦的一天！好了，周末再见，周一继续狠狠的上班吧！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[羊城漫步(一)]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/05/28/yang-cheng-man-bu-yi/"/>
    <updated>2016-05-28T21:23:34+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/05/28/yang-cheng-man-bu-yi</id>
    <content type="html"><![CDATA[<h3>题记</h3>

<p>近来多了不少个人时间，周末得以在广州和周边自由行走。又鉴于一直以来对朋友圈封闭生态系统的反感
、有限文字带来的表达能力的局限的顾虑，决定把游记整理在blog中。</p>

<p>2016.05.28，周六，雨，行程：陈家祠，越秀山。</p>

<h3>陈家祠</h3>

<p>陈家祠实在是名声在外得太响，俨然成为岭南建筑的一大地标性建筑，以至于我一个朋友出差路过广州还
专程去访了一次(WMZDBD,说你呢:)哈哈哈)。我想可能和它地处闹市区外加交通便利有很大关系&mdash;-地铁1号线坐到陈家祠站，出D口，
票价10元，好了，陈家祠欢迎你。</p>

<p>下图是祠堂正门。中国各地的祠堂并无两样，牌坊打先锋，往后两根大旗杆，门口用石狮镇门，对联则用来表示
本宗姓优越感的字句，无非也是诗书耕读勤俭发奋一类的语调。本族子弟一接近这门，心底的自豪感嗖的
一下即提升到爆表。祠堂里供奉的，当是本姓人里的成大器者。从这个意义上讲，宗祠可算得上是某个姓的”靖国神社“。</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_21_36_34_1558x817.jpg" alt="/images/2016_05_28_21_36_34_1558x817.jpg" /></p>

<p>陈家祠堂有名的就是它的各种雕刻了。网上说这些雕刻美仑美奂(&ldquo;图案题材广泛，造型生动逼真，雕刻技艺精湛，
用笔简炼粗放却又精雕细琢，与雄伟的厅堂浑然一体&rdquo;)。</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_21_52_35_1475x827.jpg" alt="/images/2016_05_28_21_52_35_1475x827.jpg" /></p>

<p>讲真，我觉得网上的说法言过其实。来广州一年多，喜欢游走的缘故，看过不少岭南派建筑。砖雕做得好的
我推荐：佛山祖庙和顺德城煌庙。若是以前从没见过岭南雕刻艺术的，到了陈家祠可能觉得“哇噻好漂亮”， 但
若是看得多、有了比较，就会有高下立判之感。陈家祠砖雕的人物造型过于呆板，层次感对比于我提起的两个
地方显得不够分明。而且它们都高高的站在了屋顶上，原谅我的老颈椎实在没法承受仰望星空的45度角。很多砖雕又
太新了，就像是刻意做新的一般。</p>

<p>还有就是，看各种雕刻一定要慢慢看，干扰越少越好。陈家祠里爱自拍的小姑娘和爱玩单反的大爷大妈太多了，拜托，
我已经抑制住了很多次做V字型手势的冲动。</p>

<p>据说这是在陈家祠的文物仓库里发现的一个用于祭拜神像的木质建筑，官方介绍说它在仓库里沉睡了数十年后，终于
于2015年被发现而后组装出来展览喽！我比较怀疑这个建筑展览人做策划时的智商及情商，我也可以花几万找文物贩子
做旧一个然后说成是"沉睡数十年"啊。。。。。。</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_04_17_597x830.jpg" alt="/images/2016_05_28_22_04_17_597x830.jpg" /></p>

<p>陈家祠还有个身份是广东民俗博物馆，因而在它里头有很多民俗藏品，譬如：</p>

<p>大潮汕剪纸：</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_11_36_828x830.jpg" alt="/images/2016_05_28_22_11_36_828x830.jpg" /></p>

<p>特别强调一下”红头船“和”妈祖“, 怡乐路上有家馆子，名字就叫红头船, 鹅肝专卖：</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_12_39_524x487.jpg" alt="/images/2016_05_28_22_12_39_524x487.jpg" /></p>

<p>做桃粿，潮汕的一种过年用的食物：</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_20_55_1010x814.jpg" alt="/images/2016_05_28_22_20_55_1010x814.jpg" /></p>

<p>汕头那边的漆版画，这张是说”李白醉酒应诏答番书“:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_14_46_1038x831.jpg" alt="/images/2016_05_28_22_14_46_1038x831.jpg" /></p>

<p>木雕中的上品，没想到一块木头里即可幻化出人生万象：</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_17_31_1343x777.jpg" alt="/images/2016_05_28_22_17_31_1343x777.jpg" /></p>

<p>一副刻填彩漆画，50年代创作，浓郁的时代风情，《蔗糖丰收》：</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_19_10_1308x809.jpg" alt="/images/2016_05_28_22_19_10_1308x809.jpg" /></p>

<p>此外还有各种绘画/刺绣/雕刻艺术等等，个人喜好问题，我没有完全拍下来。</p>

<p>个人表示很排斥陈家祠里的象牙雕刻展览及售卖场所，你可以说象牙雕刻出来的东西很精美，富有收藏价值等等。但
如果一件艺术品要建立在一条生命的泯灭上，那这种艺术可以说成是杀戮。从这个意义上讲，那些标价数百万的象牙雕刻作品
，背后站着的都是一头或是数头可怜的惨遭虐杀的大象。</p>

<p>综上所述, 陈家祠我勉强给它给到60分。我给它的评价是一个岭南派建筑的快餐式消费产品。做新痕迹太重，商业气息太浓，
而且，贩卖象牙制品。有朋友路过想走马观花看一下岭南建筑及民俗的，又不想出市区的话，可以带过来走一走。</p>

<h3>越秀山</h3>

<p>基于陈家祠实在没啥好逛的，出门我就上了109,一路坐到越秀山, 电车，很平稳，很舒服。</p>

<p>越秀山的植被相当好。在市区里来讲，NO.1。 它让我想起南宁的青秀山，青秀山也是个植被很不错的地方，比越秀山要大很多。
雨后的越秀山空气清新，各种热带植物在视野里简直是青翠欲滴，赤裸裸的挑战着你的视觉神经。生态好，所以随处可以看到
小动物，比如:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_33_28_1480x829.jpg" alt="/images/2016_05_28_22_33_28_1480x829.jpg" /></p>

<p>越秀山里残存了一段明城墙，全广州唯一。 一棵开花的树VS明城墙，很奇妙。要知道在南京的明城墙，大部分都是光秃秃的：</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_35_28_927x804.jpg" alt="/images/2016_05_28_22_35_28_927x804.jpg" /></p>

<p>红花残，满地伤，适合发呆一下午的所在:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_37_46_1411x775.jpg" alt="/images/2016_05_28_22_37_46_1411x775.jpg" /></p>

<p>越秀山里的标志性建筑有两个，先说第一个： 镇海楼, 别名”五层楼“， 广州地标建筑，感兴趣的自行Google之.  见图。</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_39_51_1478x828.jpg" alt="/images/2016_05_28_22_39_51_1478x828.jpg" /></p>

<p>进到楼里，即是广州博物馆，各种文物古玩众多，值得细细品尝。 当然文物这东西的喜好个人都不一样，这里仅列举几例，
展示一下窝的品味，勾引一下泥的欲望:</p>

<p>南越国(公元前100多年)时陶器，上塑"食官第一"。 说人话就是：吃货才是老大:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_43_04_1117x827.jpg" alt="/images/2016_05_28_22_43_04_1117x827.jpg" /></p>

<p>陶制小船，公元前作品:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_48_03_1395x789.jpg" alt="/images/2016_05_28_22_48_03_1395x789.jpg" /></p>

<p>来呀，快活呀，反正有大把时光：</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_49_33_1367x805.jpg" alt="/images/2016_05_28_22_49_33_1367x805.jpg" /></p>

<p>各种各样的陶制建筑，东汉作品:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_51_27_1462x822.jpg" alt="/images/2016_05_28_22_51_27_1462x822.jpg" /></p>

<p>特写一个，上层住人，下层养猪的陶屋:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_52_42_1033x790.jpg" alt="/images/2016_05_28_22_52_42_1033x790.jpg" /></p>

<p>把灯放在大脸人的头上真的很好咩, 陶娃娃无辜的表情说明了一切。</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_53_53_1192x805.jpg" alt="/images/2016_05_28_22_53_53_1192x805.jpg" /></p>

<p>南朝时的一张地契，刻在石头上的, 买卖双方都以为可以一直如约下去，没想到过了2000年，全TM国有了:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_56_16_1082x812.jpg" alt="/images/2016_05_28_22_56_16_1082x812.jpg" /></p>

<p>元代的计时器，运用滴水的原理，判断时辰：</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_58_26_627x828.jpg" alt="/images/2016_05_28_22_58_26_627x828.jpg" /></p>

<p>这是清代的一套出口丹麦的盘子:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_22_59_57_1477x827.jpg" alt="/images/2016_05_28_22_59_57_1477x827.jpg" /></p>

<p>清朝的西洋钟，非常精美:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_23_01_13_688x834.jpg" alt="/images/2016_05_28_23_01_13_688x834.jpg" /></p>

<p>民国时期的陪嫁，好想在这钢琴上来一首《Somewhere in time》 :</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_23_02_25_717x833.jpg" alt="/images/2016_05_28_23_02_25_717x833.jpg" /></p>

<p>这是一份民国时中国基督教徒的结婚证书。</p>

<p>上写"神所配合人不可分”。  <br/>
右边新娘位写"上帝曰不可使人独处"。  <br/>
左边新郎位写"必须造一相助为理者"。</p>

<p>接下来写新郎新娘的名字、出生年月。结婚日期，秉神的旨意，于某年某月结为连理。再下来，是用中文
书写的家谱，有籍贯、家人姓名等。最后是证婚人的亲笔签名。</p>

<p>结婚证制作精美，温情、温馨。留意看新郎新娘的面相，会发现他们真的很有夫妻相。照片里的那一对年轻夫妻
如今早已离别人世，然而一份正式、郑重、真诚、温馨的契约，依然在这红尘中流芳百世。</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_23_03_58_907x830.jpg" alt="/images/2016_05_28_23_03_58_907x830.jpg" /></p>

<p>镇海楼1～5层就这样从石器时代到近代、当代，展现了整个南粤文化的发展。最后上到5楼，你看到的风景是
这样的：</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_23_15_23_1479x821.jpg" alt="/images/2016_05_28_23_15_23_1479x821.jpg" /></p>

<p>没什么卵意思！ 于是下楼，去看五羊雕塑，沿途经过总统纪念碑，拍一张:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_23_16_46_571x785.jpg" alt="/images/2016_05_28_23_16_46_571x785.jpg" /></p>

<p>依然没什么卵意思嘛！国民党最近都失了台湾的总统，英文妹子上台来，搞得风风火火嘛！好了，继续往前走，看
雕塑去。</p>

<p>羊：</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_23_18_39_924x824.jpg" alt="/images/2016_05_28_23_18_39_924x824.jpg" /></p>

<p>羊：</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_23_19_31_728x820.jpg" alt="/images/2016_05_28_23_19_31_728x820.jpg" /></p>

<p>羊:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_28_23_20_18_974x826.jpg" alt="/images/2016_05_28_23_20_18_974x826.jpg" /></p>

<p>好了，羊羊羊，恒源祥，回家吧。</p>

<p>小总结一下:</p>

<p>越秀山我给到90分。越秀，粤秀，果然景色秀美，植被繁茂。山下有湖，可以带情侣或者小朋友来泛舟，价格有点小贵，
不过呢，泡妞这种事，泡熊孩子这种事，忍忍吧，谁让它环境那么好！</p>

<p>广州博物馆是出乎我意料之外的，我没想到广州这种"蛮夷之地"居然也有数目如此众多、质量如此精美的文物。所以说大
汉族主义真是要不得哈。</p>

<p>广州博物馆里还有诸多展品，限于篇幅没法一一列举了，文物这种东西，就是个人喜好。譬如说， 那份结婚证书会让我
想起来在南京紫金山中山纪念馆里看过的的孙中山与宋庆龄的结婚契约。</p>

<p>2010年我初次看到那份契约，端正抄写在绢上，一丝不苟，三人手印（孙、宋、证婚人）历经近百年依然清晰。
其实吧，我后来又看了很多书，也了解了很多八卦，发现孙和宋之间也没那么简单，有些情节简直狗血。但，怎么说呢？
至少相信他们按手印那一刻是真心吧。人这一世，又能有多少个真心如此的瞬间呢？</p>

<p>好了闲话不多说，谁看谁知道，广州博物馆10块钱的门票欢迎你！</p>

<p>越秀山很大，我今天走的大概是50%， 以后可以再找个机会去闲逛、发呆。</p>

<p>《羊城漫步(一)》完结。明天继续(如果可以的话)，打算把南越文王博物馆给逛了， 谁让哥每次坐地铁经过它都提醒你
”去往南越文王博物馆的乘客请在此站下车“呢？</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Working Tips on Ansible-cobbler(3)]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/05/18/working-tips-on-ansible-cobbler-3/"/>
    <updated>2016-05-18T21:15:10+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/05/18/working-tips-on-ansible-cobbler-3</id>
    <content type="html"><![CDATA[<h3>APT Packages</h3>

<p>The downloaded deb files should be under <code>/var/cache/apt</code>, use following command for copying to
another position:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ find . | grep -i deb$ | xargs % cp % ~/Dest_Folder
</span><span class='line'>$ scp -r ~/Dest_Folder Your_Cobbler_Machine</span></code></pre></td></tr></table></div></figure>


<h3>Repositories</h3>

<p>Install <code>dpkg-dev</code> package, so we could generate the dpkg packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install -y dpkg-dev</span></code></pre></td></tr></table></div></figure>


<p>Create a new repository:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_18_21_28_37_717x452.jpg" alt="/images/2016_05_18_21_28_37_717x452.jpg" /></p>

<p>Edit the advanced options:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_18_21_30_04_508x314.jpg" alt="/images/2016_05_18_21_30_04_508x314.jpg" /></p>

<p>Report the repository info via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@cobbler-ubuntu:~# cobbler repo report --name=ubuntu1604Mate
</span><span class='line'>Name                           : ubuntu1604Mate
</span><span class='line'>Apt Components (apt only)      : ['main']
</span><span class='line'>Apt Dist Names (apt only)      : ['stable']
</span><span class='line'>Arch                           : x86_64
</span><span class='line'>Breed                          : apt
</span><span class='line'>Comment                        : Ubuntu 16.04 Repository For installing MATE
</span><span class='line'>Createrepo Flags               : &lt;&lt;inherit&gt;&gt;
</span><span class='line'>Environment Variables          : {}
</span><span class='line'>Keep Updated                   : False
</span><span class='line'>Mirror                         : 
</span><span class='line'>Mirror locally                 : True
</span><span class='line'>Owners                         : ['admin']
</span><span class='line'>Priority                       : 99
</span><span class='line'>External proxy URL             : 
</span><span class='line'>RPM List                       : []
</span><span class='line'>Yum Options                    : {}</span></code></pre></td></tr></table></div></figure>


<p>Repository Structure Creation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir /srv/www/cobbler/repo_mirror/ubuntu1604Mate
</span><span class='line'>$ cd /srv/www/cobbler/repo_mirror/ubuntu1604Mate
</span><span class='line'>$ mkdir -p pool/main dists/stable/main/binary-i386 dists/stable/main/binary-amd64
</span><span class='line'>$ cp ~/apt/debs/*.deb ./pool/main/</span></code></pre></td></tr></table></div></figure>


<p>Enable the <code>allow_unauthenticated</code> options in kickstart file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /var/lib/cobbler/kickstarts/sample.seed
</span><span class='line'> d-i debian-installer/allow_unauthenticated boolean true</span></code></pre></td></tr></table></div></figure>


<p>Generate the gpg key:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># gpg --gen-key
</span><span class='line'>  gpg (GnuPG) 2.0.14; Copyright (C) 2009 Free Software Foundation, Inc.
</span><span class='line'>  This is free software: you are free to change and redistribute it.
</span><span class='line'>  There is NO WARRANTY, to the extent permitted by law.
</span><span class='line'>
</span><span class='line'>  gpg: directory `/root/.gnupg' created
</span><span class='line'>  gpg: new configuration file `/root/.gnupg/gpg.conf' created
</span><span class='line'>  gpg: WARNING: options in `/root/.gnupg/gpg.conf' are not yet active during this run
</span><span class='line'>  gpg: keyring `/root/.gnupg/secring.gpg' created
</span><span class='line'>  gpg: keyring `/root/.gnupg/pubring.gpg' created
</span><span class='line'> Please select what kind of key you want:
</span><span class='line'>    (1) RSA and RSA (default)
</span><span class='line'>    (2) DSA and Elgamal
</span><span class='line'>    (3) DSA (sign only)
</span><span class='line'>    (4) RSA (sign only)
</span><span class='line'> Your selection? 1
</span><span class='line'> RSA keys may be between 1024 and 4096 bits long.
</span><span class='line'> What keysize do you want? (2048)
</span><span class='line'> Requested keysize is 2048 bits
</span><span class='line'> Please specify how long the key should be valid.
</span><span class='line'>          0 = key does not expire
</span><span class='line'>       &lt;n&gt;  = key expires in n days
</span><span class='line'>       &lt;n&gt;w = key expires in n weeks
</span><span class='line'>       &lt;n&gt;m = key expires in n months
</span><span class='line'>       &lt;n&gt;y = key expires in n years
</span><span class='line'> Key is valid for? (0)
</span><span class='line'> Key does not expire at all
</span><span class='line'> Is this correct? (y/N) y</span></code></pre></td></tr></table></div></figure>


<p>For generating the random key, install the <code>haveged</code> in system:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo aptitude install haveged</span></code></pre></td></tr></table></div></figure>


<p>List the keys via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># gpg --list-keys
</span><span class='line'>/home/vagrant/.gnupg/pubring.gpg
</span><span class='line'>--------------------------------
</span><span class='line'>pub   2048R/16D87321 2016-05-18
</span><span class='line'>uid                  xxxxx &lt;xxxxxx@gmail.com&gt;
</span><span class='line'>sub   2048R/8C4A318A 2016-05-18</span></code></pre></td></tr></table></div></figure>


<p>Generate the pgp signature via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># gpg --export -a 16D87321&gt;~/junk.key
</span><span class='line'># gpg --no-default-keyring --keyring /srv/www/cobbler/repo_mirror/ubuntu1604Mate/public.pgp --import ~/junk.key
</span><span class='line'># rm -f ~/junk.key
</span><span class='line'># chmod a+r /srv/www/cobbler/repo_mirror/ubuntu1604Mate/public.pgp</span></code></pre></td></tr></table></div></figure>


<p>Re-Generate the repository infos via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd /srv/www/cobbler/repo_mirror/ubuntu1604Mate/
</span><span class='line'>$ vim reindex_apt.sh
</span><span class='line'>$ chmod 777 reindex_apt.sh 
</span><span class='line'>$ ./reindex_apt.sh </span></code></pre></td></tr></table></div></figure>


<p>The content of <code>reindex_apt.sh</code> is listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/bin/bash
</span><span class='line'>
</span><span class='line'>GPG_NAME=16D87321
</span><span class='line'>REPONAME=stable
</span><span class='line'>VERSION=1.0
</span><span class='line'>
</span><span class='line'>for bindir in `find dists/${REPONAME} -type d -name "binary*"`; do
</span><span class='line'>    arch=`echo $bindir|cut -d"-" -f 2`
</span><span class='line'>    echo "Processing ${bindir} with arch ${arch}"
</span><span class='line'>
</span><span class='line'>    overrides_file=/tmp/overrides
</span><span class='line'>    package_file=$bindir/Packages
</span><span class='line'>    release_file=$bindir/Release
</span><span class='line'>
</span><span class='line'>    # Create simple overrides file to stop warnings
</span><span class='line'>    cat /dev/null &gt; $overrides_file
</span><span class='line'>    for pkg in `ls pool/main/ | grep -E "(all|${arch})\.deb"`; do
</span><span class='line'>        pkg_name=`/usr/bin/dpkg-deb -f pool/main/${pkg} Package`
</span><span class='line'>        echo "${pkg_name} Priority extra" &gt;&gt; $overrides_file
</span><span class='line'>    done
</span><span class='line'>
</span><span class='line'>    # Index of packages is written to Packages which is also zipped
</span><span class='line'>    dpkg-scanpackages -a ${arch} pool/main $overrides_file &gt; $package_file
</span><span class='line'>    # The line above is also commonly written as:
</span><span class='line'>    # dpkg-scanpackages -a ${arch} pool/main /dev/null &gt; $package_file
</span><span class='line'>    gzip -9c $package_file &gt; ${package_file}.gz
</span><span class='line'>    bzip2 -c $package_file &gt; ${package_file}.bz2
</span><span class='line'>
</span><span class='line'>    # Cleanup
</span><span class='line'>    rm $overrides_file
</span><span class='line'>done
</span><span class='line'>
</span><span class='line'># Release info goes into Release & Release.gpg which includes an md5 & sha1 hash of Packages.*
</span><span class='line'># Generate & sign release file
</span><span class='line'>cd dists/${REPONAME}
</span><span class='line'>cat &gt; Release &lt;&lt;ENDRELEASE
</span><span class='line'>Suite: ${REPONAME}
</span><span class='line'>Version: ${VERSION}
</span><span class='line'>Component: main
</span><span class='line'>Origin: somewhere
</span><span class='line'>Label: ubuntu1604Mate
</span><span class='line'>Architecture: i386 amd64
</span><span class='line'>Date: `date`
</span><span class='line'>ENDRELEASE
</span><span class='line'>
</span><span class='line'># Generate hashes
</span><span class='line'>echo "MD5Sum:" &gt;&gt; Release
</span><span class='line'>for hashme in `find main -type f`; do
</span><span class='line'>    md5=`openssl dgst -md5 ${hashme}|cut -d" " -f 2`
</span><span class='line'>    size=`stat -c %s ${hashme}`
</span><span class='line'>    echo " ${md5} ${size} ${hashme}" &gt;&gt; Release
</span><span class='line'>done
</span><span class='line'>echo "SHA1:" &gt;&gt; Release
</span><span class='line'>for hashme in `find main -type f`; do
</span><span class='line'>    sha1=`openssl dgst -sha1 ${hashme}|cut -d" " -f 2`
</span><span class='line'>    size=`stat -c %s ${hashme}`
</span><span class='line'>    echo " ${sha1} ${size} ${hashme}" &gt;&gt; Release
</span><span class='line'>done
</span><span class='line'>
</span><span class='line'># Sign!
</span><span class='line'>gpg --yes -u $GPG_NAME --sign -bao Release.gpg Release
</span><span class='line'>cd -</span></code></pre></td></tr></table></div></figure>


<p>Now continue to modify the kickstart file for using the generated gpgs:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pwd
</span><span class='line'>/var/lib/cobbler/snippets
</span><span class='line'># cp preseed_apt_repo_config preseed_apt_repo_config_pgpkey</span></code></pre></td></tr></table></div></figure>


<p>The <code>preseed_apt_repo_config_pgpkey</code> should be listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Additional repositories, local[0-9] available
</span><span class='line'>#set $cur=1
</span><span class='line'>#set $repo_data = $getVar("repo_data",[])
</span><span class='line'>#for $repo in $repo_data
</span><span class='line'> #for $dist in $repo.apt_dists
</span><span class='line'> #set $comps = " ".join($repo.apt_components)
</span><span class='line'>d-i apt-setup/local${cur}/repository string \
</span><span class='line'> #if $repo.mirror_locally
</span><span class='line'>      http://$http_server/cblr/repo_mirror/${repo.name} $dist $comps
</span><span class='line'> #else
</span><span class='line'>      ${repo.mirror} $dist $comps
</span><span class='line'> #end if
</span><span class='line'> #if $repo.comment != ""
</span><span class='line'>d-i apt-setup/local${cur}/comment string ${repo.comment}
</span><span class='line'> #end if
</span><span class='line'> #if $repo.breed == "src"
</span><span class='line'># Enable deb-src lines
</span><span class='line'>d-i apt-setup/local${cur}/source boolean false
</span><span class='line'> #end if
</span><span class='line'>+++ # Add repo pgp pub key
</span><span class='line'>+++ d-i apt-setup/local${cur}/key string \
</span><span class='line'>+++       http://$http_server/cblr/repo_mirror/${repo.name}/public.pgp
</span><span class='line'> #set $cur=$cur+1
</span><span class='line'> #end for
</span><span class='line'>#end for</span></code></pre></td></tr></table></div></figure>


<p>Using the new preseed file, and changint the <code>preseed_apt_repo_config_pgpkey</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pwd
</span><span class='line'>/var/lib/cobbler/kickstarts
</span><span class='line'># cp sample.seed ubuntu1604.seed
</span><span class='line'># vim ubuntu1604.seed
</span><span class='line'>-  $SNIPPET('preseed_apt_repo_config')
</span><span class='line'>+  $SNIPPET('preseed_apt_repo_config_pgpkey')</span></code></pre></td></tr></table></div></figure>


<p>Changing the seed in the <code>cobbler_web</code>:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_18_22_25_48_732x294.jpg" alt="/images/2016_05_18_22_25_48_732x294.jpg" /></p>

<p>Use <code>cobbler sync</code> for syncing the configuration.</p>

<h3>Use the Repository</h3>

<p>Add the <code>ubuntu1604Mate</code> into the Repos:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_18_22_31_42_731x486.jpg" alt="/images/2016_05_18_22_31_42_731x486.jpg" /></p>

<p>After added, the configuration should be:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_18_22_33_00_471x149.jpg" alt="/images/2016_05_18_22_33_00_471x149.jpg" /></p>

<p>Now <code>cobbler sync</code> for syncing the configuration.</p>

<p>Bug: you should move the <code>preseed_apt_repo_config</code> and  then <code>cobbler sync</code> then your deployment will be OK:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mv /var/lib/cobbler/snippets/preseed_apt_repo_config /root/
</span><span class='line'>$ cobbler sync</span></code></pre></td></tr></table></div></figure>


<h3>Added Mate Installation</h3>

<p>Configure the preseed late:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cp /var/lib/cobbler/scripts/preseed_late_default /var/lib/cobbler/scripts/preseed_late_default_mate
</span><span class='line'># vim /var/lib/cobbler/scripts/preseed_late_default_mate
</span><span class='line'># vim preseed_late_default_mate 
</span><span class='line'>$SNIPPET('post_install_network_config_deb')
</span><span class='line'>$SNIPPET('late_apt_repo_config')
</span><span class='line'>$SNIPPET('post_run_deb')
</span><span class='line'>$SNIPPET('download_config_files')
</span><span class='line'>+ $SNIPPET('ubuntumate')
</span><span class='line'>$SNIPPET('kickstart_done')</span></code></pre></td></tr></table></div></figure>


<p>Now add the snippet of <code>ubuntumate</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat ../snippets/ubuntumate 
</span><span class='line'>echo "debconf debconf/frontend select noninteractive" | sudo debconf-set-selections
</span><span class='line'>apt-get --allow-unauthenticated update -y
</span><span class='line'>apt-get --allow-unauthenticated upgrade -y
</span><span class='line'>apt-get --allow-unauthenticated install -y build-essential
</span><span class='line'>### apt-get --allow-unauthenticated install -y ubuntu-mate-desktop
</span><span class='line'>apt-get --allow-unauthenticated install -y vim
</span><span class='line'>### apt-get --allow-unauthenticated install -y chromium-browser
</span><span class='line'>### apt-get --allow-unauthenticated install -y meld vim-gtk
</span><span class='line'>### apt-get --allow-unauthenticated install -y evince
</span><span class='line'>### sudo apt-get --allow-unauthenticated install -y language-pack-zh-hans language-pack-zh-hans-base language-pack-gnome-zh-hans language-pack-gnome-zh-hans-base
</span><span class='line'>### sudo apt-get --allow-unauthenticated install -y `check-language-support -l zh`
</span><span class='line'>### sudo localectl set-locale LANG=zh_CN.UTF-8
</span><span class='line'>### # TW/HK language support
</span><span class='line'>### sudo apt-get --allow-unauthenticated install -y language-pack-zh-hant language-pack-zh-hant-base language-pack-gnome-zh-hant language-pack-gnome-zh-hant-base
</span><span class='line'>### sudo apt-get --allow-unauthenticated install -y `check-language-support -l zh`
</span><span class='line'>### apt-get --allow-unauthenticated install -y fcitx
</span><span class='line'>### apt-get --allow-unauthenticated install -y fcitx-table-wubi fcitx-table-wubi-large
</span><span class='line'>### apt-get --allow-unauthenticated install -y fcitx-googlepinyin
</span><span class='line'>### apt-get --allow-unauthenticated install -y gimp
</span><span class='line'>### apt-get --allow-unauthenticated install -y ibus-pinyin 
</span><span class='line'>### apt-get --allow-unauthenticated install -y thunderbird-locale-en-us mythes-en-au hunspell-en-gb thunderbird-locale-en-gb fonts-arphic-ukai wbritish fcitx-sunpinyin openoffice.org-hyphenation language-pack-gnome-en hunspell-en-za fcitx-chewing fcitx-table-cangjie gimp-help-en language-pack-en mythes-en-us thunderbird-locale-en fcitx-module-cloudpinyin libreoffice-help-en-us firefox-locale-en libreoffice-help-en-gb fonts-arphic-uming hyphen-en-gb libreoffice-l10n-en-za fcitx-ui-qimpanel hunspell-en-au libreoffice-l10n-en-gb hyphen-en-us hunspell-en-ca 
</span><span class='line'>### apt-get --allow-unauthenticated install -y zsh
</span><span class='line'>### apt-get --allow-unauthenticated install -y fonts-wqy-zenhei fonts-wqy-microhei ttf-wqy-microhei  ttf-wqy-zenhei  xfonts-wqy
</span><span class='line'>### apt-get --allow-unauthenticated install -y eclipse
</span><span class='line'>### apt-get --allow-unauthenticated install -y gpicview
</span><span class='line'>### apt-get --allow-unauthenticated install -y scrot
</span><span class='line'>### apt-get --allow-unauthenticated install -y byobu
</span><span class='line'>### apt-get --allow-unauthenticated install -y subversion git
</span><span class='line'>### apt-get --allow-unauthenticated install -y kdiff3
</span><span class='line'>### apt-get --allow-unauthenticated install -y docker
</span></code></pre></td></tr></table></div></figure>


<p>Use <code>cobbler sync</code>, and now you could deploy mate desktop via cobbler.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tips on Maas 2.0]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/05/12/tips-on-maas-2-dot-0/"/>
    <updated>2016-05-12T14:10:48+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/05/12/tips-on-maas-2-dot-0</id>
    <content type="html"><![CDATA[<h3>Installation</h3>

<p>Based on Ubuntu16.04, install maas via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install -y maas</span></code></pre></td></tr></table></div></figure>


<p>After installation, create the default username/password via following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo maas-region createadmin --username=root --email=xxyy@xxyy.com
</span><span class='line'>Password: 
</span><span class='line'>Again: </span></code></pre></td></tr></table></div></figure>


<p>Now you could login to the <code>http://YourIP/MAAS</code> via:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_12_14_25_12_456x494.jpg" alt="/images/2016_05_12_14_25_12_456x494.jpg" /></p>

<h3>Using API to talk</h3>

<p>In maas cli, using following steps for generate the API key and use:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># sudo maas-region apikey --username=root
</span><span class='line'>AYnuZY3gWTnpxJb7Kp:AtDG3yUmaDu8tXGzTc:tumR29xsRGL6A7T6M2G7LTETPP5kkDwC
</span><span class='line'># maas login mymaas http://10.17.17.2/MAAS/api/2.0
</span><span class='line'>AYnuZY3gWTnpxJb7Kp:AtDG3yUmaDu8tXGzTc:tumR29xsRGL6A7T6M2G7LTETPP5kkDwC
</span><span class='line'>
</span><span class='line'>You are now logged in to the MAAS server at
</span><span class='line'>http://10.17.17.2/MAAS/api/2.0/ with the profile name 'mymaas'.
</span><span class='line'>
</span><span class='line'>For help with the available commands, try:
</span><span class='line'>
</span><span class='line'>  maas mymaas --help
</span></code></pre></td></tr></table></div></figure>


<p>Later we will use <code>mymaas</code> for talk to MAAS Controller.</p>

<h3>Add Boot Source</h3>

<p>Click <code>Images</code>, you won&rsquo;t see anything because the images are not downloaded. you could
download it manually via following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install simplestreams ubuntu-cloudimage-keyring apache2
</span><span class='line'>$ sudo sstream-mirror --keyring=/usr/share/keyrings/ubuntu-cloudimage-keyring.gpg \
</span><span class='line'>https://images.maas.io/ephemeral-v2/daily/ /var/www/html/maas/images/ephemeral-v2/daily \
</span><span class='line'>'arch=amd64' 'subarch~(generic|hwe-t)' 'release~(trusty|precise|xenial)' --max=1</span></code></pre></td></tr></table></div></figure>


<p>After downloading, the image content will be available under <code>/var/www/html/</code>.</p>

<p>Or, if you downloaded the html files before, do following steps for using your
pre-downloaded packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ tar xJvf html.tar.bz2 -C /var/www/html/
</span><span class='line'>$ sudo maas mymaas boot-sources create url=http://10.17.17.2/mirror/images/ephemeral-v2/releases/ keyring_filename=/usr/share/keyrings/ubuntu-cloudimage-keyring.gpg </span></code></pre></td></tr></table></div></figure>


<p>
Now there are two boot-sources in maas, delete the default one(Because we are in china,
and its goddamned GFW!)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dash@maascontroller:~$ sudo maas mymaas boot-source delete 1
</span><span class='line'>Success.
</span><span class='line'>Machine-readable output follows:
</span><span class='line'>
</span><span class='line'>dash@maascontroller:~$ sudo maas mymaas boot-sources read
</span><span class='line'>Success.
</span><span class='line'>Machine-readable output follows:
</span><span class='line'>[
</span><span class='line'>    {
</span><span class='line'>        "keyring_data": "&lt;memory at 0x7f4e9478b288&gt;",
</span><span class='line'>        "resource_uri": "/MAAS/api/2.0/boot-sources/2/",
</span><span class='line'>        "id": 2,
</span><span class='line'>        "url": "http://10.17.17.2/mirror/images/ephemeral-v2/releases/",
</span><span class='line'>        "keyring_filename": "/usr/share/keyrings/ubuntu-cloudimage-keyring.gpg"
</span><span class='line'>    }
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<p>Import boot-sources via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo maas mymaas boot-resources import</span></code></pre></td></tr></table></div></figure>


<p>It will takes a little bit time for importing the boot images.</p>

<p>For adding nodes:</p>

<p><a href="https://maas.ubuntu.com/docs2.0/nodes.html">https://maas.ubuntu.com/docs2.0/nodes.html</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Setup LXD on Ubuntu1604]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/05/11/setup-lxd-on-ubuntu1604/"/>
    <updated>2016-05-11T15:38:23+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/05/11/setup-lxd-on-ubuntu1604</id>
    <content type="html"><![CDATA[<h3>Preparation</h3>

<p>By default the lxd is installed in ubuntu1604.</p>

<h3>Image</h3>

<p>The image file are downloaded before we actually install it, install the image via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ lxc image import ubuntu-16.04-server-cloudimg-amd64-lxd.tar.xz ubuntu-16.04-server-cloudimg-amd64-root.tar.xz --alias ubuntu1604
</span><span class='line'>$ lxc image list
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+
</span><span class='line'>|    ALIAS     | FINGERPRINT  | PUBLIC |             DESCRIPTION              |  ARCH  |   SIZE   |         UPLOAD DATE          |
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+
</span><span class='line'>| ubuntu1604   | f4c4c60a6b75 | no     | Ubuntu 16.04 LTS server (20160420.3) | x86_64 | 137.54MB | May 10, 2016 at 2:18pm (UTC) </span></code></pre></td></tr></table></div></figure>


<h3>Start Container</h3>

<p>Start the container via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ lxc launch ubuntu1604 first1404
</span><span class='line'>$ lxc list
</span><span class='line'>+------------+---------+------+------+------------+-----------+
</span><span class='line'>|    NAME    |  STATE  | IPV4 | IPV6 |    TYPE    | SNAPSHOTS |
</span><span class='line'>+------------+---------+------+------+------------+-----------+
</span><span class='line'>| first1404  | RUNNING |      |      | PERSISTENT | 0         |
</span><span class='line'>+------------+---------+------+------+------------+-----------+</span></code></pre></td></tr></table></div></figure>


<p>Attach to the running container via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ lxc exec first1404 /bin/bash</span></code></pre></td></tr></table></div></figure>


<p>In this container you could do anything, for your customization of the container.</p>

<h3>More Images</h3>

<p>After your modification is done, shutdown the running container, and submit your
modification to a new container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ lxc publish second1604 --alias my-new-image
</span><span class='line'>$ lxc image list
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+
</span><span class='line'>|    ALIAS     | FINGERPRINT  | PUBLIC |             DESCRIPTION              |  ARCH  |   SIZE   |         UPLOAD DATE          |
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+
</span><span class='line'>| my-new-image | 67de38342bfa | no     |                                      | x86_64 | 192.29MB | May 11, 2016 at 7:07am (UTC) |
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+
</span><span class='line'>| ubuntu1604   | f4c4c60a6b75 | no     | Ubuntu 16.04 LTS server (20160420.3) | x86_64 | 137.54MB | May 10, 2016 at 2:18pm (UTC) |
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+</span></code></pre></td></tr></table></div></figure>


<h3>Container Networking</h3>

<p>The default networking is a seperated network, but we could set the lxd using the hosted
network, via following steps:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /etc/network/interfaces
</span><span class='line'>
</span><span class='line'>auto ens3
</span><span class='line'>iface ens3 inet manual
</span><span class='line'>
</span><span class='line'>auto containerbr 
</span><span class='line'>iface containerbr inet static
</span><span class='line'>address 192.168.10.193
</span><span class='line'>netmask 255.255.0.0
</span><span class='line'>gateway 192.168.0.176
</span><span class='line'>dns-nameservers 180.76.76.76
</span><span class='line'>bridge_ports ens3</span></code></pre></td></tr></table></div></figure>


<p>Reboot the machine, you have the running bridge <code>containerbr</code>, now you could set your bridge to this
newly created bridge:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ lxc profile device set default eth0 parent containerbr</span></code></pre></td></tr></table></div></figure>


<p>Via this you cuold set the same subnet networking address just as in <code>containerbr</code>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tips on Lxc]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/05/10/tips-on-lxc/"/>
    <updated>2016-05-10T22:17:35+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/05/10/tips-on-lxc</id>
    <content type="html"><![CDATA[<h3>Working Tips</h3>

<p>Just for importing the images and let it run in lxc</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dash@ubuntu:~/may10$ ls
</span><span class='line'>ubuntu-14.04-server-cloudimg-amd64-lxd.tar.xz   ubuntu-15.04-snappy-amd64-generic.img.xz       ubuntu-16.04-server-cloudimg-amd64-root.tar.xz
</span><span class='line'>ubuntu-14.04-server-cloudimg-amd64-root.tar.xz  ubuntu-16.04-server-cloudimg-amd64-lxd.tar.xz
</span><span class='line'>dash@ubuntu:~/may10$ lxc image import ubuntu-14.04-server-cloudimg-amd64-lxd.tar.xz ubuntu-14.04-server-cloudimg-amd64-root.tar.xz --alias ubuntu:14.04
</span><span class='line'>Transferring image: 100%
</span><span class='line'>Image imported with fingerprint: b69c9370446a28c02ad5b0d41f07e028a1756a74bee62b7d59467201a6488fc2
</span><span class='line'>dash@ubuntu:~/may10$ lxc image list
</span><span class='line'>+--------------+--------------+--------+------------------------------------+--------+----------+------------------------------+
</span><span class='line'>|    ALIAS     | FINGERPRINT  | PUBLIC |            DESCRIPTION             |  ARCH  |   SIZE   |         UPLOAD DATE          |
</span><span class='line'>+--------------+--------------+--------+------------------------------------+--------+----------+------------------------------+
</span><span class='line'>| ubuntu:14.04 | b69c9370446a | no     | Ubuntu 14.04 LTS server (20160406) | x86_64 | 118.89MB | May 10, 2016 at 2:16pm (UTC) |
</span><span class='line'>+--------------+--------------+--------+------------------------------------+--------+----------+------------------------------+
</span><span class='line'>dash@ubuntu:~/may10$ lxc launch ubuntu:14.04 first1404
</span><span class='line'>Creating first1404
</span><span class='line'>error: Get https://cloud-images.ubuntu.com/releases/streams/v1/index.json: lookup cloud-images.ubuntu.com on 180.76.76.76:53: read udp 10.47.58.215:44871-&gt;180.76.76.76:53: i/o timeout
</span><span class='line'>dash@ubuntu:~/may10$ lxc launch b69c9370446a first1404
</span><span class='line'>Creating first1404
</span><span class='line'>Starting first1404
</span><span class='line'>dash@ubuntu:~/may10$ lxc image import ubuntu-16.04-server-cloudimg-amd64-lxd.tar.xz ubuntu-16.04-server-cloudimg-amd64-root.tar.xz --alias ubuntu1604
</span><span class='line'>Transferring image: 100%
</span><span class='line'>Transferring image: 100%
</span><span class='line'>Image imported with fingerprint: f4c4c60a6b752a381288ae72a1689a9da00f8e03b732c8d1b8a8fcd1a8890800
</span><span class='line'>dash@ubuntu:~/may10$ lxc image list
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+
</span><span class='line'>|    ALIAS     | FINGERPRINT  | PUBLIC |             DESCRIPTION              |  ARCH  |   SIZE   |         UPLOAD DATE          |
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+
</span><span class='line'>| ubuntu1604   | f4c4c60a6b75 | no     | Ubuntu 16.04 LTS server (20160420.3) | x86_64 | 137.54MB | May 10, 2016 at 2:18pm (UTC) |
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+
</span><span class='line'>| ubuntu:14.04 | b69c9370446a | no     | Ubuntu 14.04 LTS server (20160406)   | x86_64 | 118.89MB | May 10, 2016 at 2:16pm (UTC) |
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+
</span><span class='line'>dash@ubuntu:~/may10$ lxc launch ubuntu1604 first1404
</span><span class='line'>Creating first1404
</span><span class='line'>error: The container already exists
</span><span class='line'>dash@ubuntu:~/may10$ lxc launch ubuntu1604 first1604
</span><span class='line'>Creating first1604
</span><span class='line'>Starting first1604
</span><span class='line'>dash@ubuntu:~/may10$ lxc exec first1604 /bin/bash
</span><span class='line'>root@first1604:~# ls
</span><span class='line'>root@first1604:~# ifconfig
</span><span class='line'>eth0      Link encap:Ethernet  HWaddr 00:16:3e:b0:f2:c3  
</span><span class='line'>          inet addr:10.226.147.79  Bcast:10.226.147.255  Mask:255.255.255.0
</span><span class='line'>          inet6 addr: fe80::216:3eff:feb0:f2c3/64 Scope:Link
</span><span class='line'>dash@ubuntu:~/may10$ ls
</span><span class='line'>ubuntu-14.04-server-cloudimg-amd64-lxd.tar.xz   ubuntu-15.04-snappy-amd64-generic.img.xz       ubuntu-16.04-server-cloudimg-amd64-root.tar.xz
</span><span class='line'>ubuntu-14.04-server-cloudimg-amd64-root.tar.xz  ubuntu-16.04-server-cloudimg-amd64-lxd.tar.xz
</span><span class='line'>dash@ubuntu:~/may10$ lxc image import ubuntu-14.04-server-cloudimg-amd64-lxd.tar.xz ubuntu-14.04-server-cloudimg-amd64-root.tar.xz --alias ubuntu:14.04
</span><span class='line'>Transferring image: 100%
</span><span class='line'>Image imported with fingerprint: b69c9370446a28c02ad5b0d41f07e028a1756a74bee62b7d59467201a6488fc2
</span><span class='line'>dash@ubuntu:~/may10$ lxc image list
</span><span class='line'>+--------------+--------------+--------+------------------------------------+--------+----------+------------------------------+
</span><span class='line'>|    ALIAS     | FINGERPRINT  | PUBLIC |            DESCRIPTION             |  ARCH  |   SIZE   |         UPLOAD DATE          |
</span><span class='line'>+--------------+--------------+--------+------------------------------------+--------+----------+------------------------------+
</span><span class='line'>| ubuntu:14.04 | b69c9370446a | no     | Ubuntu 14.04 LTS server (20160406) | x86_64 | 118.89MB | May 10, 2016 at 2:16pm (UTC) |
</span><span class='line'>+--------------+--------------+--------+------------------------------------+--------+----------+------------------------------+
</span><span class='line'>dash@ubuntu:~/may10$ lxc launch ubuntu:14.04 first1404
</span><span class='line'>Creating first1404
</span><span class='line'>error: Get https://cloud-images.ubuntu.com/releases/streams/v1/index.json: lookup cloud-images.ubuntu.com on 180.76.76.76:53: read udp 10.47.58.215:44871-&gt;180.76.76.76:53: i/o timeout
</span><span class='line'>dash@ubuntu:~/may10$ lxc launch b69c9370446a first1404
</span><span class='line'>Creating first1404
</span><span class='line'>Starting first1404
</span><span class='line'>dash@ubuntu:~/may10$ lxc image import ubuntu-16.04-server-cloudimg-amd64-lxd.tar.xz ubuntu-16.04-server-cloudimg-amd64-root.tar.xz --alias ubuntu1604
</span><span class='line'>Transferring image: 100%
</span><span class='line'>Transferring image: 100%
</span><span class='line'>Image imported with fingerprint: f4c4c60a6b752a381288ae72a1689a9da00f8e03b732c8d1b8a8fcd1a8890800
</span><span class='line'>dash@ubuntu:~/may10$ lxc image list
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+
</span><span class='line'>|    ALIAS     | FINGERPRINT  | PUBLIC |             DESCRIPTION              |  ARCH  |   SIZE   |         UPLOAD DATE          |
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+
</span><span class='line'>| ubuntu1604   | f4c4c60a6b75 | no     | Ubuntu 16.04 LTS server (20160420.3) | x86_64 | 137.54MB | May 10, 2016 at 2:18pm (UTC) |
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+
</span><span class='line'>| ubuntu:14.04 | b69c9370446a | no     | Ubuntu 14.04 LTS server (20160406)   | x86_64 | 118.89MB | May 10, 2016 at 2:16pm (UTC) |
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+
</span><span class='line'>dash@ubuntu:~/may10$ lxc launch ubuntu1604 first1404
</span><span class='line'>Creating first1404
</span><span class='line'>error: The container already exists
</span><span class='line'>dash@ubuntu:~/may10$ lxc launch ubuntu1604 first1604
</span><span class='line'>Creating first1604
</span><span class='line'>Starting first1604
</span><span class='line'>dash@ubuntu:~/may10$ lxc exec first1604 /bin/bash
</span><span class='line'>root@first1604:~# ls
</span><span class='line'>root@first1604:~# ifconfig
</span><span class='line'>eth0      Link encap:Ethernet  HWaddr 00:16:3e:b0:f2:c3  
</span><span class='line'>          inet addr:10.226.147.79  Bcast:10.226.147.255  Mask:255.255.255.0
</span><span class='line'>          inet6 addr: fe80::216:3eff:feb0:f2c3/64 Scope:Link
</span><span class='line'>dash@ubuntu:~/may10$ ls
</span><span class='line'>ubuntu-14.04-server-cloudimg-amd64-lxd.tar.xz   ubuntu-15.04-snappy-amd64-generic.img.xz       ubuntu-16.04-server-cloudimg-amd64-root.tar.xz
</span><span class='line'>ubuntu-14.04-server-cloudimg-amd64-root.tar.xz  ubuntu-16.04-server-cloudimg-amd64-lxd.tar.xz
</span><span class='line'>dash@ubuntu:~/may10$ lxc image import ubuntu-14.04-server-cloudimg-amd64-lxd.tar.xz ubuntu-14.04-server-cloudimg-amd64-root.tar.xz --alias ubuntu:14.04
</span><span class='line'>Transferring image: 100%
</span><span class='line'>Image imported with fingerprint: b69c9370446a28c02ad5b0d41f07e028a1756a74bee62b7d59467201a6488fc2
</span><span class='line'>dash@ubuntu:~/may10$ lxc image list
</span><span class='line'>+--------------+--------------+--------+------------------------------------+--------+----------+------------------------------+
</span><span class='line'>|    ALIAS     | FINGERPRINT  | PUBLIC |            DESCRIPTION             |  ARCH  |   SIZE   |         UPLOAD DATE          |
</span><span class='line'>+--------------+--------------+--------+------------------------------------+--------+----------+------------------------------+
</span><span class='line'>| ubuntu:14.04 | b69c9370446a | no     | Ubuntu 14.04 LTS server (20160406) | x86_64 | 118.89MB | May 10, 2016 at 2:16pm (UTC) |
</span><span class='line'>+--------------+--------------+--------+------------------------------------+--------+----------+------------------------------+
</span><span class='line'>dash@ubuntu:~/may10$ lxc launch ubuntu:14.04 first1404
</span><span class='line'>Creating first1404
</span><span class='line'>error: Get https://cloud-images.ubuntu.com/releases/streams/v1/index.json: lookup cloud-images.ubuntu.com on 180.76.76.76:53: read udp 10.47.58.215:44871-&gt;180.76.76.76:53: i/o timeout
</span><span class='line'>dash@ubuntu:~/may10$ lxc launch b69c9370446a first1404
</span><span class='line'>Creating first1404
</span><span class='line'>Starting first1404
</span><span class='line'>dash@ubuntu:~/may10$ lxc image import ubuntu-16.04-server-cloudimg-amd64-lxd.tar.xz ubuntu-16.04-server-cloudimg-amd64-root.tar.xz --alias ubuntu1604
</span><span class='line'>Transferring image: 100%
</span><span class='line'>Transferring image: 100%
</span><span class='line'>Image imported with fingerprint: f4c4c60a6b752a381288ae72a1689a9da00f8e03b732c8d1b8a8fcd1a8890800
</span><span class='line'>dash@ubuntu:~/may10$ lxc image list
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+
</span><span class='line'>|    ALIAS     | FINGERPRINT  | PUBLIC |             DESCRIPTION              |  ARCH  |   SIZE   |         UPLOAD DATE          |
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+
</span><span class='line'>| ubuntu1604   | f4c4c60a6b75 | no     | Ubuntu 16.04 LTS server (20160420.3) | x86_64 | 137.54MB | May 10, 2016 at 2:18pm (UTC) |
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+
</span><span class='line'>| ubuntu:14.04 | b69c9370446a | no     | Ubuntu 14.04 LTS server (20160406)   | x86_64 | 118.89MB | May 10, 2016 at 2:16pm (UTC) |
</span><span class='line'>+--------------+--------------+--------+--------------------------------------+--------+----------+------------------------------+
</span><span class='line'>dash@ubuntu:~/may10$ lxc launch ubuntu1604 first1404
</span><span class='line'>Creating first1404
</span><span class='line'>error: The container already exists
</span><span class='line'>dash@ubuntu:~/may10$ lxc launch ubuntu1604 first1604
</span><span class='line'>Creating first1604
</span><span class='line'>Starting first1604
</span><span class='line'>dash@ubuntu:~/may10$ lxc exec first1604 /bin/bash
</span><span class='line'>root@first1604:~# ls
</span><span class='line'>root@first1604:~# ifconfig
</span><span class='line'>eth0      Link encap:Ethernet  HWaddr 00:16:3e:b0:f2:c3  
</span><span class='line'>          inet addr:10.226.147.79  Bcast:10.226.147.255  Mask:255.255.255.0
</span><span class='line'>          inet6 addr: fe80::216:3eff:feb0:f2c3/64 Scope:Link
</span><span class='line'>....</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Working Tips on Mesos/Ansible]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/05/09/working-tips-on-mesos-slash-ansible/"/>
    <updated>2016-05-09T12:20:34+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/05/09/working-tips-on-mesos-slash-ansible</id>
    <content type="html"><![CDATA[<h3>Package Prepare</h3>

<p>We have the default vagrant box generated by bento, listed it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>➜  mesos vagrant box list | grep -i centos | grep -i virtualbox
</span><span class='line'>centos72                                     (virtualbox, 0)</span></code></pre></td></tr></table></div></figure>


<p>Now we want to generate a new box from it, and added our own configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant init centos72
</span><span class='line'>$ vagrant up
</span><span class='line'>$ vagrant ssh</span></code></pre></td></tr></table></div></figure>


<p>Edit for keeping the cache:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /etc/yum.conf  | more
</span><span class='line'>[main]
</span><span class='line'>cachedir=/home/vagrant/rpms/$basearch/$releasever
</span><span class='line'>#keepcache=0
</span><span class='line'>keepcache=1</span></code></pre></td></tr></table></div></figure>


<p>Now poweroff the machine and export it to the new box:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant package --output centoslocalrpm.box
</span><span class='line'>$ vagrant box add centoslocalrpm centoslocalrpm.box</span></code></pre></td></tr></table></div></figure>


<p>Using the new box, the rpm packages could be saved into the folder
<code>/home/vagrant/rpms</code>.</p>

<h3>Deploy Using Ansible</h3>

<p>Refers to  <br/>
<a href="https://open.mesosphere.com/advanced-course/recreating-the-cluster-using-ansible/">https://open.mesosphere.com/advanced-course/recreating-the-cluster-using-ansible/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Working Tips on Ansible-cobbler(2)]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/05/06/working-tips-on-ansible-cobbler-2/"/>
    <updated>2016-05-06T15:03:59+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/05/06/working-tips-on-ansible-cobbler-2</id>
    <content type="html"><![CDATA[<h3>AIM</h3>

<p>Change the vagrant box to libvirt, and let this libvirt machine working properly.</p>

<h3>Image Transformation</h3>

<p>Transform the image via following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ VBoxManage clonehd /home/dash/VirtualBox\ VMs/ansible-cobbler_cobbler-ubuntu_1462410925173_15793/packer-virtualbox-iso-1454031074-disk1.vmdk /home/dash/output.img --format raw && qemu-img convert -f raw /home/dash/output.img -O qcow2 /home/dash/ansible-cobbler.qcow2
</span><span class='line'>0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%
</span><span class='line'>Clone medium created in format 'raw'. UUID: 6fbb99be-8004-43b5-831b-ec794a001c10</span></code></pre></td></tr></table></div></figure>


<h3>Qemu Virtual Machine</h3>

<p>Create a new machine, then configure the networking, edit the cobbler setting/dhcp setting, then <code>cobbler sync</code>, now the cobbler is adjusting to new environment.</p>

<p>More detailed info could be seen in:</p>

<p><a href="http://purplepalmdash.github.io/blog/2015/07/10/wh-worktips-9/">http://purplepalmdash.github.io/blog/2015/07/10/wh-worktips-9/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linux Tips(5)]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/05/04/linux-tips-5/"/>
    <updated>2016-05-04T20:03:21+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/05/04/linux-tips-5</id>
    <content type="html"><![CDATA[<h3>1. Detach Running Tasks</h3>

<p><code>Ctrl+Z</code> for suspend the tasks, then <code>bg</code> it, now you could use <code>disown %1</code> for
detaching the running process.</p>

<p>Next time you login, you will see this background task is also running.</p>

<h3>2. Installation of Cobbler</h3>

<p>Shell Scripts:</p>

<p><a href="https://gist.github.com/luisbolson/1d0dc42976d2468171d0">https://gist.github.com/luisbolson/1d0dc42976d2468171d0</a></p>

<h3>3. yum groups</h3>

<p><a href="http://ramblings.narrabilis.com/creating-a-yum-repository-repo-and-creating-a-yum-group-to-install-kickstart">http://ramblings.narrabilis.com/creating-a-yum-repository-repo-and-creating-a-yum-group-to-install-kickstart</a></p>

<h3>4. rvm issue</h3>

<p>rvm met <code>openssl.so (LoadError)</code>, could be solved via following steps.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$  curl https://github.com/ruby/ruby/commit/801e1fe46d83c856844ba18ae4751478c59af0d1.diff &gt; openssl.patch\n
</span><span class='line'>$  rvm install 1.9.3 --with-openssl-dir=$HOME/.rvm/usr --patch ./openssl.patch </span></code></pre></td></tr></table></div></figure>


<h3>5. Get the name of rpm packages</h3>

<p>Only print the name of the rpm package:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># rpm -qp --queryformat '%{NAME}\n' *.rpm&gt;package.list</span></code></pre></td></tr></table></div></figure>


<h3>6. xargs tips</h3>

<p>Example:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># find . -type f -exec grep -ilR "MY PATTERN" {} \; | xargs -I % cp % /dest/dir/</span></code></pre></td></tr></table></div></figure>


<p>For me, I find out all of the packges in cache file, and copy them to another position:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ find . | \grep rpm$ | xargs -I % cp % /home/dash/rpms</span></code></pre></td></tr></table></div></figure>


<h3>7. Make local repo</h3>

<p>From the stackoverflow answers.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Yes as you've described it, it sounds doable. I think I would be inclined to do the
</span><span class='line'>following steps.
</span><span class='line'>
</span><span class='line'>Setup directories
</span><span class='line'>$ mkdir {Desktop,Desktop_Platform,X_Window_System,Fonts}
</span><span class='line'>Download RPMs
</span><span class='line'>Then run these types of commands to download the RPMs for the given groups:
</span><span class='line'>
</span><span class='line'>$ repoquery --qf=%{name} -g --list --grouppkgs=all "Fonts" | \
</span><span class='line'>     xargs -I{} repotrack -a x86_64 -p Fonts/ {}
</span><span class='line'>You can wrap it in a for loop too:
</span><span class='line'>
</span><span class='line'>$ for i in "Desktop" "Desktop_Platform" "X_Window_System" "Fonts";do  
</span><span class='line'>    repoquery --qf=%{name} -g --list --grouppkgs=all "$i" | \
</span><span class='line'>       xargs -I{} repotrack -a x86_64 -p $i/ {}; 
</span><span class='line'>  done
</span><span class='line'>This will go through each group and download the packages into their respective
</span><span class='line'>directories.
</span><span class='line'>
</span><span class='line'>Re-installation
</span><span class='line'>Then use the command as you've described:
</span><span class='line'>
</span><span class='line'>$ yum --nogpgcheck localinstall {Desktop,Desktop_Platform,X_Window_System,Fonts}/*.rpm</span></code></pre></td></tr></table></div></figure>


<h3>8. Simple Screen Recorder</h3>

<p>Ubuntu:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo add-apt-repository ppa:maarten-baert/simplescreenrecorder
</span><span class='line'>sudo apt-get update
</span><span class='line'>sudo apt-get install simplescreenrecorder
</span><span class='line'># if you want to record 32-bit OpenGL applications on a 64-bit system:
</span><span class='line'>sudo apt-get install simplescreenrecorder-lib:i386</span></code></pre></td></tr></table></div></figure>


<p>ArchLinux:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S simplescreenrecorder</span></code></pre></td></tr></table></div></figure>


<h3>9. Convert virtualbox hd to qcow2</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>VBoxManage clonehd /home/dash/VirtualBox\ VMs/ansible-cobbler_cobbler-ubuntu_1462410925173_15793/packer-virtualbox-iso-1454031074-disk1.vmdk /home/dash/output.img --format raw && qemu-img convert -f raw /home/dash/output.img -O qcow2 /home/dash/ansible-cobbler.qcow2</span></code></pre></td></tr></table></div></figure>


<h3>10. Ansible issue</h3>

<p>The isssue is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ansible: ERROR: become is not a legal parameter in an Ansible Playbook</span></code></pre></td></tr></table></div></figure>


<p>Solved via upgrading to the newest version of ansible:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install software-properties-common
</span><span class='line'>$ sudo apt-add-repository ppa:ansible/ansible
</span><span class='line'>$ sudo apt-get update
</span><span class='line'>$ sudo apt-get install ansible</span></code></pre></td></tr></table></div></figure>


<p>Using the newest ansible you could aoid this error.</p>

<h3>11. Create customized lxc image</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>http://unix.stackexchange.com/questions/186638/how-to-make-a-local-template-for-a-linux-container-and-point-to-that</span></code></pre></td></tr></table></div></figure>


<p><a href="https://insights.ubuntu.com/2015/03/20/installing-lxd-and-the-command-line-tool/">https://insights.ubuntu.com/2015/03/20/installing-lxd-and-the-command-line-tool/</a></p>

<p><a href="https://www.stgraber.org/2016/03/30/lxd-2-0-image-management-512/">https://www.stgraber.org/2016/03/30/lxd-2-0-image-management-512/</a></p>

<p><a href="https://insights.ubuntu.com/2016/04/01/lxd-2-0-image-management-512/">https://insights.ubuntu.com/2016/04/01/lxd-2-0-image-management-512/</a></p>

<h3>12. Changing to eth0 in Ubuntu</h3>

<p>Modify the name of <code>enps*</code> to <code>eth0/1/2/3/4/</code>, via following steps:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>try this: Edit your /etc/default/grub. Change the line from
</span><span class='line'>
</span><span class='line'>GRUB_CMDLINE_LINUX=""
</span><span class='line'>to
</span><span class='line'>
</span><span class='line'>GRUB_CMDLINE_LINUX="net.ifnames=0 biosdevname=0"
</span><span class='line'>and, finally run:
</span><span class='line'>
</span><span class='line'># update-grub</span></code></pre></td></tr></table></div></figure>


<h3>13. MAAS Syncing PXE File</h3>

<p><a href="https://maas.ubuntu.com/docs/sstreams-mirror.html">https://maas.ubuntu.com/docs/sstreams-mirror.html</a>  <br/>
<a href="http://ytooyama.hatenadiary.jp/entry/2016/05/11/002532">http://ytooyama.hatenadiary.jp/entry/2016/05/11/002532</a></p>

<p>For building our own MAAS image:</p>

<p><a href="http://askubuntu.com/questions/744966/how-do-you-install-the-maas-image-builder-on-14-04-lts">http://askubuntu.com/questions/744966/how-do-you-install-the-maas-image-builder-on-14-04-lts</a></p>

<h3>14. Vagrant For MAAS</h3>

<p><a href="https://github.com/battlemidget/vagrant-maas">https://github.com/battlemidget/vagrant-maas</a></p>

<p><a href="https://github.com/battlemidget/vagrant-maas-in-a-box/blob/master/Vagrantfile">https://github.com/battlemidget/vagrant-maas-in-a-box/blob/master/Vagrantfile</a></p>

<h3>15. Convert vm to physical</h3>

<p>Thus you could enjoy packer building the physical machine! :)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /media/wherever-the-image-is/
</span><span class='line'>
</span><span class='line'># for VMWare
</span><span class='line'>sudo apt-get install qemu-kvm
</span><span class='line'>qemu-img convert your-vmware-disk.vmdk -O raw disk.img
</span><span class='line'>
</span><span class='line'># For VirtualBox
</span><span class='line'>VBoxManage internalcommands converttoraw your-virtualbox-disk.vdi /dev/sdX</span></code></pre></td></tr></table></div></figure>


<h3>16. Generate Random Seed</h3>

<p>Error message is <code>Please do some other work to give
the OS a chance to collect more entropy!</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo aptitude install haveged</span></code></pre></td></tr></table></div></figure>


<h3>17. DEB Repository in Cobbler</h3>

<p><a href="https://github.com/cobbler/cobbler/wiki/Creating-custom-apt-repositories-in-centos-or-el-based-cobbler">https://github.com/cobbler/cobbler/wiki/Creating-custom-apt-repositories-in-centos-or-el-based-cobbler</a></p>

<p>Trouble-Shooting:  <br/>
<a href="https://github.com/cobbler/cobbler/issues/1530">https://github.com/cobbler/cobbler/issues/1530</a></p>

<h3>18. Manually Install Mate Desktop</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo "debconf debconf/frontend select noninteractive" | sudo debconf-set-selections
</span><span class='line'>apt-get --allow-unauthenticated update -y
</span><span class='line'>apt-get --allow-unauthenticated upgrade -y
</span><span class='line'>apt-get --allow-unauthenticated install -y build-essential
</span><span class='line'>apt-get --allow-unauthenticated install -y ubuntu-mate-desktop
</span><span class='line'>apt-get --allow-unauthenticated install -y vim
</span><span class='line'>apt-get --allow-unauthenticated install -y chromium-browser
</span><span class='line'>apt-get --allow-unauthenticated install -y meld vim-gtk
</span><span class='line'>apt-get --allow-unauthenticated install -y evince
</span><span class='line'>sudo apt-get --allow-unauthenticated install -y language-pack-zh-hans language-pack-zh-hans-base language-pack-gnome-zh-hans language-pack-gnome-zh-hans-base
</span><span class='line'>sudo apt-get --allow-unauthenticated install -y `check-language-support -l zh`
</span><span class='line'>sudo localectl set-locale LANG=zh_CN.UTF-8
</span><span class='line'># TW/HK language support
</span><span class='line'>sudo apt-get --allow-unauthenticated install -y language-pack-zh-hant language-pack-zh-hant-base language-pack-gnome-zh-hant language-pack-gnome-zh-hant-base
</span><span class='line'>sudo apt-get --allow-unauthenticated install -y `check-language-support -l zh`
</span><span class='line'>apt-get --allow-unauthenticated install -y fcitx
</span><span class='line'>apt-get --allow-unauthenticated install -y fcitx-table-wubi fcitx-table-wubi-large
</span><span class='line'>apt-get --allow-unauthenticated install -y fcitx-googlepinyin
</span><span class='line'>apt-get --allow-unauthenticated install -y gimp
</span><span class='line'>apt-get --allow-unauthenticated install -y ibus-pinyin 
</span><span class='line'>apt-get --allow-unauthenticated install -y thunderbird-locale-en-us mythes-en-au hunspell-en-gb thunderbird-locale-en-gb fonts-arphic-ukai wbritish fcitx-sunpinyin openoffice.org-hyphenation language-pack-gnome-en hunspell-en-za fcitx-chewing fcitx-table-cangjie gimp-help-en language-pack-en mythes-en-us thunderbird-locale-en fcitx-module-cloudpinyin libreoffice-help-en-us firefox-locale-en libreoffice-help-en-gb fonts-arphic-uming hyphen-en-gb libreoffice-l10n-en-za fcitx-ui-qimpanel hunspell-en-au libreoffice-l10n-en-gb hyphen-en-us hunspell-en-ca 
</span><span class='line'>apt-get --allow-unauthenticated install -y zsh
</span><span class='line'>apt-get --allow-unauthenticated install -y fonts-wqy-zenhei fonts-wqy-microhei ttf-wqy-microhei  ttf-wqy-zenhei  xfonts-wqy
</span><span class='line'>apt-get --allow-unauthenticated install -y eclipse
</span><span class='line'>apt-get --allow-unauthenticated install -y gpicview
</span><span class='line'>apt-get --allow-unauthenticated install -y scrot
</span><span class='line'>apt-get --allow-unauthenticated install -y byobu
</span><span class='line'>apt-get --allow-unauthenticated install -y subversion git
</span><span class='line'>apt-get --allow-unauthenticated install -y kdiff3
</span><span class='line'>apt-get --allow-unauthenticated install -y docker</span></code></pre></td></tr></table></div></figure>


<p>Final Version should be:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo "debconf debconf/frontend select noninteractive" | sudo debconf-set-selections
</span><span class='line'>unset DEBIAN_HAS_FRONTEND DEBIAN_FRONTEND DEBCONF_REDIR DEBCONF_OLD_FD_BASE
</span><span class='line'>export DEBIAN_FRONTEND=noninteractive
</span><span class='line'>apt-get update --assume-yes
</span><span class='line'>apt-get dist-upgrade --assume-yes
</span><span class='line'>apt-get install --assume-yes vim build-essential ubuntu-mate-desktop chromium-browser meld vim-gtk evince language-pack-zh-hans language-pack-zh-hans-base language-pack-gnome-zh-hans language-pack-gnome-zh-hans-base language-pack-zh-hant language-pack-zh-hant-base language-pack-gnome-zh-hant language-pack-gnome-zh-hant-base fcitx fcitx-table-wubi fcitx-table-wubi-large fcitx-googlepinyin gimp ibus-pinyin thunderbird-locale-en-us mythes-en-au hunspell-en-gb thunderbird-locale-en-gb fonts-arphic-ukai wbritish fcitx-sunpinyin openoffice.org-hyphenation language-pack-gnome-en hunspell-en-za fcitx-chewing fcitx-table-cangjie gimp-help-en language-pack-en mythes-en-us thunderbird-locale-en fcitx-module-cloudpinyin libreoffice-help-en-us firefox-locale-en libreoffice-help-en-gb fonts-arphic-uming hyphen-en-gb libreoffice-l10n-en-za fcitx-ui-qimpanel hunspell-en-au libreoffice-l10n-en-gb hyphen-en-us hunspell-en-ca zsh fonts-wqy-zenhei fonts-wqy-microhei ttf-wqy-microhei  ttf-wqy-zenhei  xfonts-wqy eclipse gpicview scrot byobu subversion git kdiff3 docker
</span><span class='line'>apt-get install --assume-yes  `check-language-support -l zh`
</span></code></pre></td></tr></table></div></figure>


<h3>19. Use rync for resume tranferring</h3>

<p>Command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rsync -P -e ssh remoteuser@remotehost:/remote/path /local/path</span></code></pre></td></tr></table></div></figure>


<h3>20. RackHD Howto</h3>

<p><a href="http://dojoblog.emc.com/rackhd-cpi/setting-up-rackhd/">http://dojoblog.emc.com/rackhd-cpi/setting-up-rackhd/</a></p>

<h3>21. sync repo</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vagrant@ubuntu-1404:/etc/apt$ cat /var/mirrors/ubuntu/14.04/var/postmirror.sh 
</span><span class='line'>#!/bin/sh -x 
</span><span class='line'># the udebs script gets the actual files we need 
</span><span class='line'>#/mnt/repo/apt-mirror/var/udebs.sh  
</span><span class='line'># A quick apt directory structure primer: 
</span><span class='line'># an apt server (e.g. archive.ubuntu.com) contains repositories (e.g. trusty-backports), 
</span><span class='line'># which contain archives (e.g. multiverse), which contain directories 
</span><span class='line'># a complete example - http://archive.ubuntu.com/ubuntu/dists/trusty-backports/multiverse/debian-installer/  
</span><span class='line'># With this in mind, we create bash 'arrays' of the structure: 
</span><span class='line'># server we're syncing against 
</span><span class='line'>#MIRROR="cn.archive.ubuntu.com" 
</span><span class='line'>MIRROR="archive.ubuntu.com" 
</span><span class='line'># repositories we're mirroring 
</span><span class='line'>#REPOS="trusty trusty-updates trusty-security trusty-proposed trusty-backports" 
</span><span class='line'>REPOS="trusty"
</span><span class='line'># archives in repositories 
</span><span class='line'>#ARCHIVES="main multiverse restricted universe" 
</span><span class='line'>ARCHIVES="main"
</span><span class='line'># installer location inside archive 
</span><span class='line'>#DIRECTORIES="debian-installer dist-upgrader-all installer-amd64 installer-i386" 
</span><span class='line'>DIRECTORIES="debian-installer installer-amd64"
</span><span class='line'>#where we're storing it locally 
</span><span class='line'>LOCALDIR="/var/mirrors/ubuntu/14.04/mirror/mirrors.aliyun.com"
</span><span class='line'>#LOCALDIR="/mnt/repo/apt-mirror/mirror/archive.ubuntu.com"  
</span><span class='line'>for REPO in $REPOS; do 
</span><span class='line'>for ARCHIVE in $ARCHIVES; do 
</span><span class='line'>for DIRECTORY in $DIRECTORIES;do 
</span><span class='line'># create directory structure 
</span><span class='line'>if [ ! -e "$LOCALDIR/ubuntu/dists/$REPO/$ARCHIVE/$DIRECTORY" ]; then
</span><span class='line'>mkdir -p "$LOCALDIR/ubuntu/dists/$REPO/$ARCHIVE/$DIRECTORY"
</span><span class='line'>fi
</span><span class='line'># do the sync 
</span><span class='line'>rsync --recursive --times --links --hard-links --delete --delete-after \
</span><span class='line'>rsync://$MIRROR/ubuntu/dists/$REPO/$ARCHIVE/$DIRECTORY/ $LOCALDIR/ubuntu/dists/$REPO/$ARCHIVE/$DIRECTORY
</span><span class='line'>done
</span><span class='line'>done
</span><span class='line'>done
</span></code></pre></td></tr></table></div></figure>


<h3>22. Vagrantfile for adding more disks</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>To be done. </span></code></pre></td></tr></table></div></figure>


<h3>23. rvm install issue</h3>

<p>With openssl patched you can install rvm successfully:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget https://github.com/ruby/ruby/commit/801e1fe46d83c856844ba18ae4751478c59af0d1.diff -O openssl.patch
</span><span class='line'>$ rvm install --patch ./openssl.patch 2.2.3</span></code></pre></td></tr></table></div></figure>


<h3>24. performance tool</h3>

<p><a href="http://www.tecmint.com/linux-cpu-load-stress-test-with-stress-ng-tool/2/">http://www.tecmint.com/linux-cpu-load-stress-test-with-stress-ng-tool/2/</a></p>

<h3>25. X11 Forwarding Issue</h3>

<p>Problem:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>X11 forwarding request failed on channel 0</span></code></pre></td></tr></table></div></figure>


<p>Solved via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pacman -S xorg-xauth
</span><span class='line'># vim /etc/ssh/sshd_config
</span><span class='line'>AddressFamily any
</span><span class='line'>X11Forwarding yes</span></code></pre></td></tr></table></div></figure>


<p>Then restart the sshd daemon, you will get X11 on ssh forwarding enabled.</p>

<p>Add new user <code>clouder</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># useradd -d /home/clouder/ clouder
</span><span class='line'># chown -R clouder:clouder /home/clouder/
</span><span class='line'># usermod -aG kvm clouder
</span><span class='line'># usermod -aG libvirt clouder</span></code></pre></td></tr></table></div></figure>


<p>polkit configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim /etc/polkit-1/rules.d/50-libvirt.rules 
</span><span class='line'>/* Allow users in kvm group to manage the libvirt
</span><span class='line'>daemon without authentication */
</span><span class='line'>polkit.addRule(function(action, subject) {
</span><span class='line'>    if (action.id == "org.libvirt.unix.manage" &&
</span><span class='line'>        subject.isInGroup("kvm")) {
</span><span class='line'>            return polkit.Result.YES;
</span><span class='line'>    }
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>


<p>Install following packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pacman -Syu ebtables dnsmasq</span></code></pre></td></tr></table></div></figure>


<p>Open nested kvm.</p>

<h3>26. Hack into system</h3>

<p><a href="http://null-byte.wonderhowto.com/how-to/hack-like-pro-hack-shellshock-vulnerability-0157651/">http://null-byte.wonderhowto.com/how-to/hack-like-pro-hack-shellshock-vulnerability-0157651/</a></p>

<h3>27. Quickly setup graphite and grafana</h3>

<p>On ArchLinux, do following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir -p /root/data/graphite/storage/whisper/
</span><span class='line'>$ sudo docker run -d \
</span><span class='line'>  --name graphite \
</span><span class='line'>  -p 8080:80 \
</span><span class='line'>  -p 2003:2003 \
</span><span class='line'>  -v /local/path/to/.htpasswd:/etc/nginx/.htpasswd \
</span><span class='line'>  -v /root/data/graphite/storage/whisper:/opt/graphite/storage/whisper \
</span><span class='line'>  sitespeedio/graphite</span></code></pre></td></tr></table></div></figure>


<p>Now your graphite runs OK, default username/password is guest/guest.</p>

<p>Continue setup the docker container for grafana:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker run -i -p 3000:3000 grafana/grafana</span></code></pre></td></tr></table></div></figure>


<p>Or, setup our own persistent storage via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir -p /root/data/grafana/
</span><span class='line'>$ chmod 777 -R /root/data/grafana/
</span><span class='line'>$ docker run -d -v /root/data/grafana:/var/lib/grafana --name grafana-storage busybox:latest
</span><span class='line'>$ docker run  -d -p 3000:3000 --name=grafana --volumes-from grafana-storage grafana/grafana
</span><span class='line'>$ docker logs grafana</span></code></pre></td></tr></table></div></figure>


<p>The correct way for running grfafana via following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># docker run -d -p 3000:3000 --name=grafana -v /root/data/grafana:/var/lib/grafana  grafana/grafana</span></code></pre></td></tr></table></div></figure>


<h3>28. docker-enter issue</h3>

<p>If you met <code>importenv: not found</code> issue, do following to let docker-enter running:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># docker pull jpetazzo/nsenter
</span><span class='line'># docker run --rm -v /usr/local/bin:/target jpetazzo/nsenter
</span><span class='line'># docker-enter &lt;container_name&gt;</span></code></pre></td></tr></table></div></figure>


<h3>29. Docker-Collectd</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># docker run -d --net=host --privileged -v /:/hostfs:ro --name=collectd -e HOST_NAME=localhost -e \
</span><span class='line'>GRAPHITE_HOST=192.168.1.79 andreasjansson/collectd-write-graphite</span></code></pre></td></tr></table></div></figure>


<h3>30. For using bridged vagrant-libvirt</h3>

<p>An example Vagrantfile is listed as following , notice it&rsquo;s using ovsbr0.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># -*- mode: ruby -*-
</span><span class='line'># vi: set ft=ruby :
</span><span class='line'>
</span><span class='line'>############### Vagrant Configuration Here #############
</span><span class='line'>Vagrant.configure(2) do |config|
</span><span class='line'>
</span><span class='line'>  # vagrant issues #1673..fixes hang with configure_networks
</span><span class='line'>  config.ssh.shell = "bash -c 'BASH_ENV=/etc/profile exec bash'"
</span><span class='line'>  config.ssh.username = 'vagrant'
</span><span class='line'>  config.ssh.password = 'vagrant'
</span><span class='line'>  config.ssh.insert_key = 'true'
</span><span class='line'>  config.vm.provider :libvirt do |domain|
</span><span class='line'>    domain.nic_model_type = 'e1000'
</span><span class='line'>    domain.memory = 384
</span><span class='line'>    domain.nested = true
</span><span class='line'>    domain.cpu_mode = 'host-passthrough'
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  # bridge node. 
</span><span class='line'>  # Add one networking, modify hostname, define memory, CPU cores.
</span><span class='line'>  config.vm.define :bridge do |bridge|
</span><span class='line'>    bridge.vm.box = "csmgmtv4"
</span><span class='line'>    bridge.vm.hostname = "bridgenode"
</span><span class='line'>    bridge.vm.network :public_network, 
</span><span class='line'>  :dev =&gt; "ovsbr0",
</span><span class='line'>  :mode =&gt; "bridge",
</span><span class='line'>  :type =&gt; "bridge",
</span><span class='line'>  :ip =&gt; "192.168.178.2",
</span><span class='line'>  :ovs =&gt; "true"
</span><span class='line'>    bridge.vm.provider :libvirt do |domain|
</span><span class='line'>      domain.storage :file, :size =&gt; '100G'
</span><span class='line'>      domain.memory = 1024
</span><span class='line'>      domain.cpus = 1
</span><span class='line'>      domain.nested = true
</span><span class='line'>      domain.disk_bus = 'virtio'
</span><span class='line'>      domain.nic_model_type = 'virtio'
</span><span class='line'>      domain.volume_cache = 'writeback'
</span><span class='line'>    end
</span><span class='line'>  end
</span><span class='line'>end
</span></code></pre></td></tr></table></div></figure>


<h3>31. Using VPN in CloudStack</h3>

<p><a href="https://portal.redbridge.se/faq/getting-started/accessing-your-instance-from-the-outside/">https://portal.redbridge.se/faq/getting-started/accessing-your-instance-from-the-outside/</a></p>

<p><a href="https://blog.remibergsma.com/2012/11/18/securely-connect-an-advanced-private-cloudstack-network-by-using-a-vlan-aware-switch-and-a-basic-vpn-device/">https://blog.remibergsma.com/2012/11/18/securely-connect-an-advanced-private-cloudstack-network-by-using-a-vlan-aware-switch-and-a-basic-vpn-device/</a></p>

<p><a href="http://www.furorteutonicus.eu/2013/08/04/enabling-host-guest-networking-with-kvm-macvlan-and-macvtap/">http://www.furorteutonicus.eu/2013/08/04/enabling-host-guest-networking-with-kvm-macvlan-and-macvtap/</a></p>

<h3>32. python issue(easy_install)</h3>

<p>Solved via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget https://bootstrap.pypa.io/ez_setup.py -O - | python</span></code></pre></td></tr></table></div></figure>


<h3>33. VPN Over ssh</h3>

<p>Established via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pppd updetach noauth silent nodeflate pty "/usr/bin/ssh root@192.168.1.79 \ 
</span><span class='line'>/usr/bin/pppd nodetach notty noauth" ipparam vpn 10.0.8.1:10.0.8.2</span></code></pre></td></tr></table></div></figure>


<h3>34. X Windows for normal user</h3>

<p>X Window for normal user</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>➜  ~ chmod u+s /usr/bin/Xorg </span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Working Tips on Ansible-cobbler]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/05/04/working-tips-on-ansible-cobbler/"/>
    <updated>2016-05-04T15:36:55+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/05/04/working-tips-on-ansible-cobbler</id>
    <content type="html"><![CDATA[<h3>Source</h3>

<p>The source are downloaded from:  <br/>
<a href="https://github.com/signed8bit/ansible-cobbler">https://github.com/signed8bit/ansible-cobbler</a></p>

<p>Git clone it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/signed8bit/ansible-cobbler.git</span></code></pre></td></tr></table></div></figure>


<h3>Test</h3>

<p>The test will be done via <code>vagrant up</code>, while we met the problem: the cobbler version
in ansible playbooks are too old, thus the command <code>cobbler get-loaders</code> won&rsquo;t acts
well. we have to changing to the newest cobbler version which is available in</p>

<p><a href="http://cobbler.github.io/">http://cobbler.github.io/</a></p>

<h3>Manually Steps(Ubuntu)</h3>

<p>Install the newest cobbler via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget -qO - http://download.opensuse.org/repositories/home:/libertas-ict:/cobbler26/xUbuntu_14.04/Release.key | sudo apt-key add -
</span><span class='line'>$ sudo add-apt-repository "deb http://download.opensuse.org/repositories/home:/libertas-ict:/cobbler26/xUbuntu_14.04/ ./"
</span><span class='line'>$ sudo apt-get install -y cobbler 
</span><span class='line'>$ cobbler --version
</span><span class='line'>Cobbler 2.6.11
</span><span class='line'>  source: ?, ?
</span><span class='line'>  build time: Sat Jan 23 14:13:42 2016</span></code></pre></td></tr></table></div></figure>


<p>Change Password of the <code>cobbler</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Change the password for the 'cobbler' username:
</span><span class='line'>htdigest /etc/cobbler/users.digest "Cobbler" cobbler</span></code></pre></td></tr></table></div></figure>


<p>visit the url of <code>http://xxx.xxx.xxx.xx/cobbler_web</code> and you could access the management interface of cobbler.</p>

<h3>Import CentOS7.2</h3>

<p>Import the iso via following command</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo mount -t iso9660 -o loop ./CentOS-7-x86_64-Everything-1511.iso /mnt1
</span><span class='line'>$ sudo cobbler import --name=CentOS-7.2 --arch=x86_64 --path=/mnt1</span></code></pre></td></tr></table></div></figure>


<p>Examine the imported iso:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@cobbler-ubuntu:~# cobbler profile list
</span><span class='line'>   CentOS-7.2-x86_64
</span><span class='line'>root@cobbler-ubuntu:~# cobbler distro list
</span><span class='line'>   CentOS-7.2-x86_64</span></code></pre></td></tr></table></div></figure>


<p>Change the default password of root:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># openssl passwd -1
</span><span class='line'># vim /etc/cobbler/settings 
</span><span class='line'>- default_password_crypted: "$1$mF86/UHC$WvcIcX2t6crBz2onWxyac."
</span><span class='line'>+ default_password_crypted: "$awegwaegoguoweuouoeh/"
</span><span class='line'># cobbler sync
</span><span class='line'># service cobbler restart
</span><span class='line'># service cobblerd restart
</span></code></pre></td></tr></table></div></figure>


<h3>Todo</h3>

<p>How to automatically install the mate desktop via kickstart?</p>

<p>First find out all of the pkgs in group, then add them into the kickstart file?</p>

<h3>For Making Mate</h3>

<p>Steps are listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># curl http://mirrors.aliyun.com/repo/epel-7.repo&gt;/etc/yum.repos.d/epel-7.repo
</span><span class='line'># curl http://mirrors.aliyun.com/repo/Centos-7.repo&gt;CentOS-Base.repo
</span><span class='line'># yum groupinstall "X Window system"
</span><span class='line'># yum groupinstall "MATE Desktop"</span></code></pre></td></tr></table></div></figure>


<p>Remain the yum cache:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost ~]# cat /etc/yum.conf 
</span><span class='line'>[main]
</span><span class='line'>#cachedir=/var/cache/yum/$basearch/$releasever
</span><span class='line'>cachedir=/root/cache/$basearch/$releasever
</span><span class='line'>keepcache=1</span></code></pre></td></tr></table></div></figure>


<p>For setting mate as the default desktop envs:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># systemctl isolate graphical.target
</span><span class='line'># systemctl set-default graphical.target</span></code></pre></td></tr></table></div></figure>


<h3>Repo In Cobbler</h3>

<p>We could setup the cobbler&rsquo;s repository via following steps:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_05_22_48_11_536x324.jpg" alt="/images/2016_05_05_22_48_11_536x324.jpg" /></p>

<p>The configuration of this repo:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_05_22_48_58_718x444.jpg" alt="/images/2016_05_05_22_48_58_718x444.jpg" /></p>

<p>Now you repo&rsquo;s configuration file should be like following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@cobbler-ubuntu:/var/lib/cobbler/snippets# cat /srv/www/cobbler/repo_mirror/centos7_mate/config.repo 
</span><span class='line'>[centos7_mate]
</span><span class='line'>name=centos7_mate
</span><span class='line'>baseurl=http://${http_server}/cobbler/repo_mirror/centos7_mate
</span><span class='line'>enabled=1
</span><span class='line'>priority=99
</span><span class='line'>gpgcheck=0</span></code></pre></td></tr></table></div></figure>


<p>Copy the rpms into <code>/srv/www/cobbler/repo_mirror/centos7_mate/</code>, and then <code>createrepo</code> for generating the package informations.</p>

<p>Now edit the existing profile&rsquo;s repo configurations:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cobbler profile list
</span><span class='line'>   CentOS-7.2-x86_64
</span><span class='line'># cobbler profile edit --name=CentOS-7.2-x86_64 --repo='centos7_mate'</span></code></pre></td></tr></table></div></figure>


<p>Examine it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cobbler repo report --name=centos7_mate
</span><span class='line'>Name                           : centos7_mate
</span><span class='line'>Apt Components (apt only)      : []
</span><span class='line'>Apt Dist Names (apt only)      : []
</span><span class='line'>Arch                           : x86_64
</span><span class='line'>Breed                          : yum
</span><span class='line'>Comment                        : This Repo is for installing MATE Desktop
</span><span class='line'>Createrepo Flags               : &lt;&lt;inherit&gt;&gt;
</span><span class='line'>Environment Variables          : {}
</span><span class='line'>Keep Updated                   : False
</span><span class='line'>Mirror                         : 
</span><span class='line'>Mirror locally                 : True
</span><span class='line'>Owners                         : ['admin']
</span><span class='line'>Priority                       : 99
</span><span class='line'>External proxy URL             : 
</span><span class='line'>RPM List                       : []
</span><span class='line'>Yum Options                    : {}</span></code></pre></td></tr></table></div></figure>


<h3>Using the repo in kickstart</h3>

<p>First define the snippet:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@cobbler-ubuntu:/var/lib/cobbler/snippets# pwd
</span><span class='line'>/var/lib/cobbler/snippets
</span><span class='line'>root@cobbler-ubuntu:/var/lib/cobbler/snippets# cat mate
</span><span class='line'># Install mate
</span><span class='line'>mkdir -p /etc/yum.repos.d/back
</span><span class='line'>mv /etc/yum.repos.d/CentOS* /etc/yum.repos.d/back/
</span><span class='line'>yum install -y abattis-cantarell-fonts abrt abrt-addon-ccpp abrt-addon-kerneloops abrt-addon-pstoreoops abrt-addon-python abrt-addon-vmcore abrt-addon-xorg abrt-dbus abrt-desktop abrt-gui abrt-gui-libs abrt-java-connector abrt-libs abrt-python abrt-retrace-client accountsservice adwaita-cursor-theme adwaita-gtk2-theme adwaita-icon-theme alsa-plugins-pulseaudio alsa-utils atk atkmm atril atril-caja atril-libs at-spi2-atk at-spi2-core audit-libs-python augeas-libs avahi-autoipd avahi-glib avahi-libs bind-libs-lite bind-license brasero brasero-libs bzip2 ca-certificates cairo cairo-gobject cairomm caja caja-extensions caja-extensions-common caja-image-converter caja-open-terminal caja-schemas caja-sendto cdparanoia cdparanoia-libs cdrdao centos-indexhtml check checkpolicy cjkuni-uming-fonts clutter clutter-gst2 clutter-gtk cogl colord-libs compat-libcogl12 compat-libcogl-pango12 compat-libcolord1 coreutils cpp crda cronie cronie-anacron cryptsetup cups-libs cyrus-sasl-lib dbus-x11 dconf dconf-editor dejavu-fonts-common dejavu-sans-fonts dejavu-sans-mono-fonts dejavu-serif-fonts desktop-file-utils device-mapper device-mapper-event device-mapper-event-libs device-mapper-libs djvulibre-libs dleyna-connector-dbus dleyna-core dleyna-server dosfstools dracut dracut-config-rescue dracut-network dvd+rw-tools elfutils emacs-filesystem enchant engrampa eom exempi fftw-libs-double filezilla firefox firewall-config flac-libs fontconfig fontpackages-filesystem fortune-mod fros fuse fuse-libs gamin GConf2 gcr gd gdb gdisk gdk-pixbuf2 genisoimage geoclue2 ghostscript ghostscript-fonts giflib glibc glibc-common glibmm24 glx-utils gmp gnome-abrt gnome-desktop3 gnome-icon-theme gnome-icon-theme-extras gnome-icon-theme-legacy gnome-keyring gnome-keyring-pam gnome-online-accounts gnome-python2 gnome-python2-canvas gnome-themes-standard gnote gnu-free-fonts-common gnu-free-mono-fonts gnu-free-sans-fonts gnu-free-serif-fonts gnutls gom google-crosextra-caladea-fonts google-crosextra-carlito-fonts gparted gpm-libs graphite2 grilo grilo-plugins grub2 grub2-tools gsm gssdp gstreamer gstreamer1 gstreamer1-plugins-bad-free gstreamer1-plugins-base gstreamer1-plugins-good gstreamer-plugins-bad-free gstreamer-plugins-base gstreamer-plugins-good gstreamer-tools gtk2 gtk2-engines gtk2-immodule-xim gtk3 gtk3-immodule-xim gtkmm24 gtkmm30 gtk-murrine-engine gtksourceview2 gtkspell3 gucharmap gupnp gupnp-av gupnp-dlna gvfs gvfs-afc gvfs-archive gvfs-fuse gvfs-gphoto2 gvfs-mtp gvfs-smb harfbuzz harfbuzz-icu hicolor-icon-theme hunspell hunspell-en-US ibus ibus-chewing ibus-gtk2 ibus-gtk3 ibus-hangul ibus-kkc ibus-libpinyin ibus-libs ibus-m17n ibus-rawcode ibus-sayura ibus-setup ibus-table ibus-table-chinese icedax ilmbase ImageMagick initscripts iso-codes iw jasper-libs jbigkit-libs jomolhari-fonts json-glib kernel kernel-tools kernel-tools-libs kexec-tools khmeros-base-fonts khmeros-fonts-common kpartx krb5-libs lcms2 libao libarchive libart_lgpl libasyncns libatasmart libavc1394 libblkid libbluray libburn libcanberra libcanberra-gtk2 libcanberra-gtk3 libcdio libcdio-paranoia libcgroup libchewing libdmapsharing libdmx libdnet libdv libdvdnav libdvdread libepoxy liberation-fonts-common liberation-mono-fonts liberation-sans-fonts liberation-serif-fonts libevdev libevent libexif libfontenc libgdata libgee06 libglade2 libgnomecanvas libgnome-keyring libgphoto2 libgpod libgsf libgtop2 libgudev1 libgusb libgxps libhangul libICE libicu libiec61883 libieee1284 libimobiledevice libiptcdata libisofs libjpeg-turbo libkkc libkkc-common libkkc-data libldb libmatekbd libmatemixer libmateweather libmateweather-data libmbim libmediaart libmount libmpc libmpcdec libmspack libmtp libmx libnatpmp libnl libnm-gtk libnotify libntlm liboauth libofa libogg libosinfo libpeas libpinyin libpinyin-data libplist libpng libqmi libraw1394 libreport libreport-centos libreport-filesystem libreport-gtk libreport-plugin-mantisbt libreport-plugin-reportuploader libreport-plugin-rhtsupport libreport-plugin-ureport libreport-python libreport-web librsvg2 libsamplerate libsecret libsemanage-python libsexy libshout libsigc++20 libSM libsmbclient libsndfile libspectre libsrtp libssh2 libtalloc libtar libtdb libteam libtevent libthai libtheora libtiff libtomcrypt libtommath libtool-ltdl libudisks2 libusal libusb libusbx libuser-python libuuid libv4l libvisual libvorbis libvpx libwbclient libwebp libwmf-lite libwnck libwnck3 libwvstreams libX11 libX11-common libXau libxcb libXcomposite libXcursor libXdamage libXdmcp libXevie libXext libXfixes libXfont libXft libXi libXinerama libxkbfile libxklavier libxml2 libxml2-python libXmu libXpm libXrandr libXrender libXres libXScrnSaver libxshmfence libxslt libXt libXtst libXv libXvMC libXxf86dga libXxf86misc libXxf86vm lightdm lightdm-gobject lightdm-gtk lightdm-gtk-common lklug-fonts lockdev logrotate lohit-assamese-fonts lohit-bengali-fonts lohit-devanagari-fonts lohit-gujarati-fonts lohit-kannada-fonts lohit-malayalam-fonts lohit-marathi-fonts lohit-nepali-fonts lohit-oriya-fonts lohit-punjabi-fonts lohit-tamil-fonts lohit-telugu-fonts lrzsz lvm2 lvm2-libs lz4 m17n-contrib m17n-db m17n-lib madan-fonts marco mariadb-libs marisa mate-applets mate-backgrounds mate-calc mate-control-center mate-control-center-filesystem mate-desktop mate-desktop-libs mate-dictionary mate-disk-usage-analyzer mate-icon-theme mate-media mate-menus mate-menus-libs mate-menus-preferences-category-menu mate-netspeed mate-notification-daemon mate-panel mate-panel-libs mate-polkit mate-power-manager mate-screensaver mate-screenshot mate-search-tool mate-session-manager mate-settings-daemon mate-system-log mate-system-monitor mate-terminal mate-themes mate-user-guide mate-utils-common mathjax mathjax-ams-fonts mathjax-caligraphic-fonts mathjax-fraktur-fonts mathjax-main-fonts mathjax-math-fonts mathjax-sansserif-fonts mathjax-script-fonts mathjax-size1-fonts mathjax-size2-fonts mathjax-size3-fonts mathjax-size4-fonts mathjax-typewriter-fonts mathjax-winchrome-fonts mathjax-winie6-fonts mdadm media-player-info mesa-dri-drivers mesa-filesystem mesa-libEGL mesa-libgbm mesa-libGL mesa-libglapi mesa-libGLU mesa-libxatracker mesa-private-llvm mobile-broadband-provider-info ModemManager ModemManager-glib mozilla-filesystem mozo mpfr mtdev net-tools NetworkManager NetworkManager-adsl network-manager-applet NetworkManager-glib NetworkManager-libnm NetworkManager-openconnect NetworkManager-openvpn NetworkManager-pptp NetworkManager-team NetworkManager-tui NetworkManager-vpnc NetworkManager-vpnc-gnome nhn-nanum-fonts-common nhn-nanum-gothic-fonts nm-connection-editor nspr nss nss-softokn nss-softokn-freebl nss-sysinit nss-tools nss-util numactl-libs oddjob oddjob-mkhomedir opencc openconnect OpenEXR-libs openjpeg-libs openldap open-sans-fonts openssh openssh-clients openssh-server openssl openssl-libs open-vm-tools open-vm-tools-desktop openvpn opus orc overpass-fonts PackageKit-glib PackageKit-gstreamer-plugin paktype-naskh-basic-fonts pango pangomm paratype-pt-sans-fonts pcsc-lite-libs perl perl-Carp perl-constant perl-Encode perl-Exporter perl-File-Path perl-File-Temp perl-Filter perl-Getopt-Long perl-HTTP-Tiny perl-libs perl-macros perl-parent perl-PathTools perl-Pod-Escapes perl-podlators perl-Pod-Perldoc perl-Pod-Simple perl-Pod-Usage perl-Scalar-List-Utils perl-Socket perl-Storable perl-Text-ParseWords perl-threads perl-threads-shared perl-Time-HiRes perl-Time-Local pexpect pinentry-gtk pixman pkcs11-helper pluma pluma-data plymouth-graphics-libs plymouth-plugin-label plymouth-plugin-two-step plymouth-system-theme plymouth-theme-charge policycoreutils-python polkit polkit-gnome poppler poppler-data poppler-glib pptp procps-ng psmisc pulseaudio pulseaudio-libs pulseaudio-libs-glib2 pulseaudio-module-x11 pulseaudio-utils pycairo pygobject2 pygobject3 pygtk2 pygtk2-libglade pygtksourceview pyOpenSSL pytalloc python-augeas python-backports python-backports-ssl_match_hostname python-beaker python-chardet python-cups python-dmidecode python-inotify python-IPy python-kitchen python-mako python-markupsafe python-paste python-perf python-pwquality python-pyudev python-setuptools python-six python-tempita pyxdg qemu-guest-agent rarian rarian-compat rdma realmd recode redhat-menus rest rhythmbox rtkit samba-client-libs samba-common samba-common-libs samba-common-tools samba-libs sane-backends-libs satyr SDL seahorse selinux-policy selinux-policy-targeted setools-libs setroubleshoot setroubleshoot-plugins setroubleshoot-server sg3_utils-libs sil-abyssinica-fonts sil-nuosu-fonts sil-padauk-fonts simple-scan skkdic smc-fonts-common smc-meera-fonts sos sound-theme-freedesktop soundtouch speex spice-vdagent startup-notification stix-fonts stoken-libs sudo system-config-date system-config-date-docs system-config-language system-config-printer system-config-printer-libs system-config-users system-config-users-docs systemd systemd-libs systemd-python systemd-sysv taglib teamd telepathy-glib texlive-kpathsea-lib thai-scalable-fonts-common thai-scalable-waree-fonts totem totem-pl-parser tracker transmission-common transmission-gtk tuned tzdata ucs-miscfixed-fonts udisks2 unique upower urw-fonts usb_modeswitch usb_modeswitch-data usbmuxd usermode usermode-gtk util-linux vim-common vim-enhanced vim-filesystem vlgothic-fonts vorbis-tools vpnc vpnc-script vte wavpack web-assets-filesystem webkitgtk webkitgtk3 webrtc-audio-processing wireless-tools wodim wqy-microhei-fonts wqy-zenhei-fonts wvdial wxBase wxGTK xcb-util xchat xdg-user-dirs xdg-user-dirs-gtk xdg-utils xkeyboard-config xml-common xmlrpc-c xmlrpc-c-client xorg-x11-drivers xorg-x11-drv-ati xorg-x11-drv-dummy xorg-x11-drv-evdev xorg-x11-drv-fbdev xorg-x11-drv-intel xorg-x11-drv-nouveau xorg-x11-drv-qxl xorg-x11-drv-synaptics xorg-x11-drv-v4l xorg-x11-drv-vesa xorg-x11-drv-vmmouse xorg-x11-drv-vmware xorg-x11-drv-void xorg-x11-drv-wacom xorg-x11-font-utils xorg-x11-server-common xorg-x11-server-utils xorg-x11-server-Xorg xorg-x11-utils xorg-x11-xauth xorg-x11-xinit xorg-x11-xkb-utils xvattr yelp yelp-libs yelp-xsl yumex zenity
</span><span class='line'>systemctl isolate graphical.target
</span><span class='line'>systemctl set-default graphical.target</span></code></pre></td></tr></table></div></figure>


<p>Now involved this snippet in <code>ks_end</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pwd
</span><span class='line'>/var/lib/cobbler/kickstarts
</span><span class='line'># vim sample_end.ks
</span><span class='line'>    # Insert a key
</span><span class='line'>    $SNIPPET('publickey')
</span><span class='line'>    # Instal mate
</span><span class='line'>    $SNIPPET('mate')
</span><span class='line'>    # End final steps
</span><span class='line'>    %end</span></code></pre></td></tr></table></div></figure>


<p>Now run <code>cobbler sync</code> for syncing your configurations.</p>

<p>Next time you bootstrap a machine, it will automatically runs into MATE desktop.</p>

<p><img src="http://purplepalmdash.github.io/images/2016_05_05_22_56_57_672x489.jpg" alt="/images/2016_05_05_22_56_57_672x489.jpg" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[TipsOnOSExperiment]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/04/24/tipsonosexperiment/"/>
    <updated>2016-04-24T17:32:12+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/04/24/tipsonosexperiment</id>
    <content type="html"><![CDATA[<p>为了在家里验证一下DevStack的网络配置，组建了一个网络，涉及到的点比较多，以下是
具体记录。</p>

<h3>交换机配置</h3>

<p>前段时间从美国亚马逊买回来一个TP-LINK的千兆交换机一直没用起来，型号是TL-SG108E
，8口可网管交换机。但前面有写过文章可以用来参考:</p>

<p><a href="http://purplepalmdash.github.io/blog/2015/12/12/ba-wan-tl-sg108e/">http://purplepalmdash.github.io/blog/2015/12/12/ba-wan-tl-sg108e/</a></p>

<p>但这篇文章里讲的主要还是ovs后虚拟机的vlan，和最近要做的DevStack的FloatIP配置稍
微有点差异。</p>

<h3>网络规划</h3>

<p>家里已有网络192.168.177.0/24, 这个网络是可以访问Internet的。所以DevStack机器上
的eth0将连接到这个网段，并在其上分配floating IP.</p>

<p>另外我们需要创建一个VLAN隔离的private network，用于给DevStack里的虚拟机默认启
动后分配IP地址。将DevStack机器上的eth1连接到此网络。</p>

<h3>配置交换机</h3>

<p>TP-LINK的DEB-100网卡是比较皮实，奈何win10驱动需要找，随便找了个淘宝9.9包邮的
USB转10兆网卡连上SurfacePro，开始配置交换机。</p>

<p>步骤:  <br/>
打开桌面的<code>Easy Smart Configuration Utility</code>，开始自动发现局域网内的交换机，如
下图:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_04_24_17_58_49.jpg" alt="/images/2016_04_24_17_58_49.jpg" /></p>

<p>需要重新配置下USB有线网卡的IP地址才能连接上交换机:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_04_24_18_02_45.jpg" alt="/images/2016_04_24_18_02_45.jpg" /></p>

<p>双击发现的交换机，用<code>admin/admin</code>登录后的界面如下:</p>

<p><img src="http://purplepalmdash.github.io/iamges/2016_04_24_18_08_04.jpg" alt="/images/2016_04_24_18_08_04.jpg" /></p>

<p>以前我曾经把这个交换机配置成802.1Q VLAN, 这次基于端口来隔离，所以要配置成<code>Port
Based VLAN</code>, 配置完毕后的画面如下:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_04_24_18_20_36.jpg" alt="/images/2016_04_24_18_20_36.jpg" /></p>

<p>这种基于端口VLAN的验证方法很简单，将上网机和宽带路由器分别插在1～4和5～8口，即
可测试出VLAN被端口隔离。但这好像不是DevStack中需要设置的。</p>

<p>还是继续配置802.1Q VLAN. 值得注意的是，如果之前配置端口VLAN时将SurfacePro的连
接和交换机网段隔离了，那可能会连接不上，换回同一VLAN即可连接上。</p>

<p>配置vlan100如以下图所示:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_04_24_19_51_15.jpg" alt="/images/2016_04_24_19_51_15.jpg" /></p>

<h3>测试VLAN</h3>

<p>将两台PC连接在5~8口上，VLAN100。</p>

<p>PC1, ArchLinux, Systemd配置VLAN:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat enp0s25.100.network
</span><span class='line'>[Match]
</span><span class='line'>Name=enp0s25.100
</span><span class='line'>
</span><span class='line'>[Network]
</span><span class='line'>DNS=192.168.2.1
</span><span class='line'>Address=192.168.2.1/24
</span><span class='line'>$ cat enp0s25.100.netdev 
</span><span class='line'>[NetDev]
</span><span class='line'>Name=enp0s25.100
</span><span class='line'>Kind=vlan
</span><span class='line'>
</span><span class='line'>[VLAN]
</span><span class='line'>Id=100
</span><span class='line'>
</span><span class='line'>[Network]
</span><span class='line'>DNS=192.168.2.1
</span><span class='line'>Address=192.168.2.1/24
</span><span class='line'>Gateway=192.168.2.1
</span><span class='line'>$ pwd
</span><span class='line'>/etc/systemd/network</span></code></pre></td></tr></table></div></figure>


<p>重新启动PC1后，<code>192.168.2.1</code>将成为VLAN100口的地址。作为<code>192.168.2.1</code>,我们在这
个端口上启动dhcp服务及路由转发等服务。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S dhcp
</span><span class='line'>$ sudo systemctl enable dhcpd4.service</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>干掉冗余的默认dhcpd.conf文件，写一个最小的配置文件:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo vim /etc/dhcpd.conf.example 
</span><span class='line'>$ sudo vim /etc/dhcpd.conf         
</span><span class='line'>option domain-name-servers 180.76.76.76,223.5.5.5;
</span><span class='line'>option subnet-mask 255.255.255.0;
</span><span class='line'>option routers 192.168.2.1;
</span><span class='line'>subnet 192.168.2.0 netmask 255.255.255.0 {
</span><span class='line'>  range 192.168.2.150 192.168.2.250;
</span><span class='line'>
</span><span class='line'>  host macbookpro{
</span><span class='line'>   hardware ethernet 70:56:81:22:33:44;
</span><span class='line'>   fixed-address 192.168.2.199;
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>开启dhcpd服务:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo systemctl start dhcpd4.service</span></code></pre></td></tr></table></div></figure>


<p>PC2, 用openvswitch的vlan配置, libvirt的XML配置如下:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;interface type='bridge'&gt;
</span><span class='line'>  &lt;mac address='52:54:00:fd:03:e9'/&gt;
</span><span class='line'>  &lt;source bridge='ovsbr0'/&gt;
</span><span class='line'>  &lt;vlan trunk='yes'&gt;
</span><span class='line'>    &lt;tag id='100' nativeMode='untagged'/&gt;
</span><span class='line'>  &lt;/vlan&gt;
</span><span class='line'>  &lt;virtualport type='openvswitch'&gt;
</span><span class='line'>    &lt;parameters interfaceid='fb3e7f34-6fcd-41dc-8fed-c3ffe0d54b18'/&gt;
</span><span class='line'>  &lt;/virtualport&gt;</span></code></pre></td></tr></table></div></figure>


<p>测试，即启动PC2上的虚拟机，若虚拟机能获得IP地址，则说明VLAN配置成功。</p>

<h3>DevStack网络配置</h3>

<p>操作系统为Ubuntu14.04, 网卡为eth0(192.168.177.100)和eth1(vlan 100)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[在DevStack中使用Packer]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/04/24/zai-devstackzhong-shi-yong-packer/"/>
    <updated>2016-04-24T10:16:39+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/04/24/zai-devstackzhong-shi-yong-packer</id>
    <content type="html"><![CDATA[<h3>导入源镜像</h3>

<p>源镜像可以从ubuntu.com下载到，并使用以下命令导入:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget https://cloud-images.ubuntu.com/trusty/current/trusty-server-cloudimg-amd64-disk1.img
</span><span class='line'>$ glance image-create --name ubuntu-trusty --disk-format qcow2 \
</span><span class='line'>--container-format bare --file trusty-server-cloudimg-amd64-disk1.img</span></code></pre></td></tr></table></div></figure>


<h3>openstack.json文件</h3>

<p>github上有现成的，克隆到本地:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/Thingee/packer-devstack.git</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rsync the vault.centos.com]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/04/22/rsync-the-vault-dot-centos-dot-com/"/>
    <updated>2016-04-22T19:39:58+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/04/22/rsync-the-vault-dot-centos-dot-com</id>
    <content type="html"><![CDATA[<p>For I want to do some configuration workings on old distribution of CentOS, I have to
use lots of materials which from vault.centos.com, following are the steps for syncing
them.</p>

<p>First, rsync in <code>vault.centos.com</code> is closed, thus we have to choose
<code>http://archive.kernel.org/centos/</code>.</p>

<h3>Rsync Scripts</h3>

<p>Refers to:   <br/>
<a href="https://www.totalnetsolutions.net/2013/10/02/setting-up-a-corporate-yum-repository-mirror-for-bandwidth-and-staged-update-management/">https://www.totalnetsolutions.net/2013/10/02/setting-up-a-corporate-yum-repository-mirror-for-bandwidth-and-staged-update-management/</a></p>

<h3>Make Repository</h3>

<p><a href="https://wiki.centos.org/HowTos/CreateLocalMirror">https://wiki.centos.org/HowTos/CreateLocalMirror</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Switching to Win10]]></title>
    <link href="http://purplepalmdash.github.io/blog/2016/04/21/switching-to-win10/"/>
    <updated>2016-04-21T10:06:44+08:00</updated>
    <id>http://purplepalmdash.github.io/blog/2016/04/21/switching-to-win10</id>
    <content type="html"><![CDATA[<h3>Background</h3>

<p>Since the monitor in my company are so ba&hellip;&hellip;..d, I have to change my working
environment from PC to SurfacePro, thus I have some tools changes, following are the
records.</p>

<h3>Tool List</h3>

<p>Terminal: XShell4, Make sure you have change the screen-size issue.   <br/>
<a href="purplepalmdash.github.io/blog/2015/11/13/win10-tips-for-using-xshell/">purplepalmdash.github.io/blog/2015/11/13/win10-tips-for-using-xshell/</a></p>

<p>Screen-Shot:  <br/>
I use picPick for replacing the scrot, the scrot is so convenient thus I found many
tools for replacing it.</p>

<p>picPick Configuration: the main purpose is for selecting the rectangle and save it
automatically to the folder with the timestamp.</p>

<p>Auto-Syncing tool:   <br/>
using WinSCP&rsquo;s keep remote the latest status:</p>

<p><img src="http://purplepalmdash.github.io/images/2016_04_21_10_39_10.jpg" alt="/images/2016_04_21_10_39_10.jpg" /></p>

<p>OK, Now we could also using the same writing behavior just as under Linux Awesome
Desktop.</p>
]]></content>
  </entry>
  
</feed>
