<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Install SpaceWalk 2.2 Steps &middot; Dash</title>

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/poole.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde-a.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/custom-additions.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/highlight/googlecode.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124">
  <link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel="icon">

  
  
  
  

  <meta name="description" content="Get busy living, or get busy dying.">
  <meta name="keywords" content="unix,virtualization,embedded,linux">
  <link rel="author" href="http://plus.google.com/106572959364703833986">
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-42175003-1', 'auto');
      ga('send', 'pageview');
  </script>

</head>
<body class="theme-base-0c">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <img src="https://www.gravatar.com/avatar/49381c0004d32c0a4296b92dff0c0ae5?s=200" alt="gravatar">
      <h1><a href="http://purplepalmdash.github.io/">Get busy living, or get busy dying.</a></h1>
      <a href="http://purplepalmdash.github.io/"><p>Dash</p></a>
    </div>

    <ul class="sidebar-nav">
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/">First Page</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/post/">All Posts</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/linux/">Linux</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/embedded/">Embedded System</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/virtualization">Virtualization</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/purplepalmdash"><i class="fa fa-github-square fa-3x"></i></a>
      
      <a href="https://cn.linkedin.com/in/yang-feipeng-1b909319"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="https://plus.google.com/u/0/106572959364703833986"><i class="fa fa-google-plus-square fa-3x"></i></a>
      <a href="https://www.facebook.com/yang.feipeng"><i class="fa fa-facebook-square fa-3x"></i></a>
      <a href="https://twitter.com/dashwillfly"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      <a href="" type="application/rss+xml"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
    </ul>

    

  </div>
</div>


<div class="content container">
  <div class="post">
    <h1>Install SpaceWalk 2.2 Steps</h1>
    <span class="post-date">Aug 4, 2015  &middot; <a href="http://purplepalmdash.github.io/2015/08/04/install-spacewalk-2-dot-2-steps/#disqus_thread">Comments</a>
    
    <br/>
    
          <a class="a_cat" href="http://purplepalmdash.github.io/categories/virtualizaiton">Virtualizaiton</a>
      
      

    
    </span>
      <div id="_toc" class="toc">
        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#network-configuration">Network Configuration</a></li>
<li><a href="#packages-installation">Packages Installation</a></li>
<li><a href="#channel-package-upload">Channel Package Upload</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
      </div>
    

<h3 id="network-configuration">Network Configuration</h3>

<p>Make sure the following configuration in CentOS6:</p>

<pre><code># cat /etc/hosts
10.9.10.10      spacewalk
127.0.0.1       localhost
::1     localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters

# cat /etc/sysconfig/network
NETWORKING=yes
NETWORKING_IPV6=no
HOSTNAME=localhost.localdomain
# cat /etc/hostname
spacewalk
</code></pre>

<p>Examine the result via:</p>

<pre><code>[root@spacewalk ~]# hostname
spacewalk
[root@spacewalk ~]# hostname --fqdn
spacewalk
</code></pre>

<h3 id="packages-installation">Packages Installation</h3>

<p>First you should only have the following repo definition in the <code>/etc/yum.repos.d/</code>:</p>

<pre><code># wget -O /etc/yum.repos.d/CentOS-Base.repo \
http://mirrors.aliyun.com/repo/Centos-6.repo 
# wget -O /etc/yum.repos.d/epel.repo \ 
http://mirrors.aliyun.com/repo/epel-6.repo
# ls /etc/yum.repos.d/
CentOS-Base.repo  epel.repo
</code></pre>

<p>Install following package(For preparing the installation of the old SpaceWalk version):</p>

<pre><code># yum install -y jabberpy python-debian perl-Cache-Cache  jabberd python-hwdata net-snmp-perl perl-XML-LibXML perl-libxml-perl perl-Config-IniFiles perl-Net-IPv4Addr dojo perl-libxml-perl net-snmp-perl perl-Apache-Session perl-Apache-DBI  perl-Crypt-GeneratePassword perl-HTML-Table perl-XML-Generator perl-Net-SNMP perl-HTML-TableExtract perl-libapreq2
</code></pre>

<p>Now remove the epel.repo, add the following repo definition:</p>

<pre><code># rpm -Uvh http://yum.spacewalkproject.org/2.2/RHEL/6/x86_64/spacewalk-repo-2.2-1.el6.noarch.rpm
# vim /etc/yum.repos.d/jpackage.repo
[jpackage-generic]
name=JPackage generic
#baseurl=http://mirrors.dotsrc.org/pub/jpackage/5.0/generic/free/
mirrorlist=http://www.jpackage.org/mirrorlist.php?dist=generic&amp;type=free&amp;release=5.0
enabled=1
gpgcheck=1
gpgkey=http://www.jpackage.org/jpackage.asc
</code></pre>

<p>Install spacewalk via:</p>

<pre><code># yum install -y spacewalk-postgresql spacewalk-setup-postgresql spacecmd spacewalk-utils 
</code></pre>

<p>Use a pre-defined answer.txt for deployment:</p>

<pre><code># vim /root/answer.txt
admin-email = root@localhost
ssl-set-org = Spacewalk Org
ssl-set-org-unit = spacewalk
ssl-set-city = My City
ssl-set-state = My State
ssl-set-country = US
ssl-password = spacewalk
ssl-set-email = root@localhost
ssl-config-sslvhost = Y
db-backend=postgresql
db-name=spaceschema
db-user=spacewalk
db-password=spacewalk
db-host=localhost
db-port=5432
enable-tftp=N
# spacewalk-setup --disconnected --answer-file=/root/answer.txt
</code></pre>

<p>You may encounter following error,</p>

<pre><code>*** Progress: ##
Could not install database.
# cat /var/log/rhn/install_db.log 
Initializing database: [  OK  ]
Starting postgresql service: [  OK  ]
createdb: database creation failed: ERROR:  encoding UTF8 does not match locale en_GB
DETAIL:  The chosen LC_CTYPE setting requires encoding LATIN1.
</code></pre>

<p>Solve it via:</p>

<pre><code># sudo su postgres
bash-4.1$ psql
could not change directory to &quot;/root&quot;
psql (8.4.20)
Type &quot;help&quot; for help.

postgres=# UPDATE pg_database SET datallowconn = TRUE WHERE datname = 'template0';
UPDATE 1
postgres=# UPDATE pg_database SET datistemplate = FALSE WHERE datname = 'template1';
UPDATE 1
postgres=# drop database template1;
DROP DATABASE
postgres=# CREATE DATABASE template1 ENCODING = 'utf8' TEMPLATE = template0 LC_CTYPE ='en_US.utf8' LC_COLLATE = 'en_US.utf8';
CREATE DATABASE
postgres=# UPDATE pg_database SET datistemplate = TRUE WHERE datname = 'template1';
UPDATE 1
postgres=# UPDATE pg_database SET datallowconn = FALSE WHERE datname = 'template0';
UPDATE 1
postgres=# \q
bash-4.1$ exit
exit
</code></pre>

<p>Run <code>spacewalk-setup</code> again, this time you will pass the installation.<br />
Visit <code>http://YourIPAddress</code> for setting the login name and password:</p>

<p><img src="/images/2015_08_04_10_54_48_879x600.jpg" alt="/images/2015_08_04_10_54_48_879x600.jpg" /></p>

<p>Prepare the distro trees for CentOS7.</p>

<pre><code># mkdir /var/distro-trees/centos7_64 -p
# chmod 755 /var/
# chmod 755 /var/distro-trees/
# chmod 755 /var/distro-trees/centos7_64/
# cp -ar /mnt1/* /var/distro-trees/centos7_64/
</code></pre>

<p>Create Channel:</p>

<pre><code># /usr/bin/spacewalk-common-channels -v -u Username -p Password \ 
-a x86_64 -k unlimited  'centos7*'
</code></pre>

<p>Create Repository:</p>

<pre><code>#  spacecmd  -u Username -p Password -- distribution_create -n centos7 -p  /var/distro-trees/centos7_64/ -b centos7-x86_64 -t rhel_7
</code></pre>

<p>Now you could use the backend for creating the kickstart, via <code>System-&gt; KickStart-&gt; Profile</code></p>

<h3 id="channel-package-upload">Channel Package Upload</h3>

<p>Uploading packages to the channel could consume lots of time, CentOS7 DVD have more
than 8000 packages, thus takes around half a day for uploading.</p>

<pre><code># wget https://127.0.0.1/pub/RHN-ORG-TRUSTED-SSL-CERT -O \
/usr/share/rhn/RHN-ORG-TRUSTED-SSL-CERT --no-check-certificate 
# find . -name &quot;*rpm&quot; | xargs rhnpush --channel=centos7-x86_64 --server=http://localhost/APP -v --tolerant -u Username -p Passwd
</code></pre>

  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "dashsagittariussglory";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "dashsagittariussglory";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="http://purplepalmdash.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

