<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Virtualizaiton on Dash</title>
    <link>http://purplepalmdash.github.io/categories/virtualizaiton/</link>
    <description>Recent content in Virtualizaiton on Dash</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 04 Aug 2015 09:18:15 +0000</lastBuildDate>
    <atom:link href="http://purplepalmdash.github.io/categories/virtualizaiton/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Install SpaceWalk 2.2 Steps</title>
      <link>http://purplepalmdash.github.io/2015/08/04/install-spacewalk-2-dot-2-steps/</link>
      <pubDate>Tue, 04 Aug 2015 09:18:15 +0000</pubDate>
      
      <guid>http://purplepalmdash.github.io/2015/08/04/install-spacewalk-2-dot-2-steps/</guid>
      <description>

&lt;h3 id=&#34;network-configuration&#34;&gt;Network Configuration&lt;/h3&gt;

&lt;p&gt;Make sure the following configuration in CentOS6:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# cat /etc/hosts
10.9.10.10      spacewalk
127.0.0.1       localhost
::1     localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters

# cat /etc/sysconfig/network
NETWORKING=yes
NETWORKING_IPV6=no
HOSTNAME=localhost.localdomain
# cat /etc/hostname
spacewalk
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Examine the result via:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@spacewalk ~]# hostname
spacewalk
[root@spacewalk ~]# hostname --fqdn
spacewalk
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;packages-installation&#34;&gt;Packages Installation&lt;/h3&gt;

&lt;p&gt;First you should only have the following repo definition in the &lt;code&gt;/etc/yum.repos.d/&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# wget -O /etc/yum.repos.d/CentOS-Base.repo \
http://mirrors.aliyun.com/repo/Centos-6.repo 
# wget -O /etc/yum.repos.d/epel.repo \ 
http://mirrors.aliyun.com/repo/epel-6.repo
# ls /etc/yum.repos.d/
CentOS-Base.repo  epel.repo
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Install following package(For preparing the installation of the old SpaceWalk version):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# yum install -y jabberpy python-debian perl-Cache-Cache  jabberd python-hwdata net-snmp-perl perl-XML-LibXML perl-libxml-perl perl-Config-IniFiles perl-Net-IPv4Addr dojo perl-libxml-perl net-snmp-perl perl-Apache-Session perl-Apache-DBI  perl-Crypt-GeneratePassword perl-HTML-Table perl-XML-Generator perl-Net-SNMP perl-HTML-TableExtract perl-libapreq2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now remove the epel.repo, add the following repo definition:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# rpm -Uvh http://yum.spacewalkproject.org/2.2/RHEL/6/x86_64/spacewalk-repo-2.2-1.el6.noarch.rpm
# vim /etc/yum.repos.d/jpackage.repo
[jpackage-generic]
name=JPackage generic
#baseurl=http://mirrors.dotsrc.org/pub/jpackage/5.0/generic/free/
mirrorlist=http://www.jpackage.org/mirrorlist.php?dist=generic&amp;amp;type=free&amp;amp;release=5.0
enabled=1
gpgcheck=1
gpgkey=http://www.jpackage.org/jpackage.asc
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Install spacewalk via:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# yum install -y spacewalk-postgresql spacewalk-setup-postgresql spacecmd spacewalk-utils 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Use a pre-defined answer.txt for deployment:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# vim /root/answer.txt
admin-email = root@localhost
ssl-set-org = Spacewalk Org
ssl-set-org-unit = spacewalk
ssl-set-city = My City
ssl-set-state = My State
ssl-set-country = US
ssl-password = spacewalk
ssl-set-email = root@localhost
ssl-config-sslvhost = Y
db-backend=postgresql
db-name=spaceschema
db-user=spacewalk
db-password=spacewalk
db-host=localhost
db-port=5432
enable-tftp=N
# spacewalk-setup --disconnected --answer-file=/root/answer.txt
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You may encounter following error,&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;*** Progress: ##
Could not install database.
# cat /var/log/rhn/install_db.log 
Initializing database: [  OK  ]
Starting postgresql service: [  OK  ]
createdb: database creation failed: ERROR:  encoding UTF8 does not match locale en_GB
DETAIL:  The chosen LC_CTYPE setting requires encoding LATIN1.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Solve it via:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# sudo su postgres
bash-4.1$ psql
could not change directory to &amp;quot;/root&amp;quot;
psql (8.4.20)
Type &amp;quot;help&amp;quot; for help.

postgres=# UPDATE pg_database SET datallowconn = TRUE WHERE datname = &#39;template0&#39;;
UPDATE 1
postgres=# UPDATE pg_database SET datistemplate = FALSE WHERE datname = &#39;template1&#39;;
UPDATE 1
postgres=# drop database template1;
DROP DATABASE
postgres=# CREATE DATABASE template1 ENCODING = &#39;utf8&#39; TEMPLATE = template0 LC_CTYPE =&#39;en_US.utf8&#39; LC_COLLATE = &#39;en_US.utf8&#39;;
CREATE DATABASE
postgres=# UPDATE pg_database SET datistemplate = TRUE WHERE datname = &#39;template1&#39;;
UPDATE 1
postgres=# UPDATE pg_database SET datallowconn = FALSE WHERE datname = &#39;template0&#39;;
UPDATE 1
postgres=# \q
bash-4.1$ exit
exit
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Run &lt;code&gt;spacewalk-setup&lt;/code&gt; again, this time you will pass the installation.&lt;br /&gt;
Visit &lt;code&gt;http://YourIPAddress&lt;/code&gt; for setting the login name and password:&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://purplepalmdash.github.io/images/2015_08_04_10_54_48_879x600.jpg&#34; alt=&#34;/images/2015_08_04_10_54_48_879x600.jpg&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Prepare the distro trees for CentOS7.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# mkdir /var/distro-trees/centos7_64 -p
# chmod 755 /var/
# chmod 755 /var/distro-trees/
# chmod 755 /var/distro-trees/centos7_64/
# cp -ar /mnt1/* /var/distro-trees/centos7_64/
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Create Channel:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# /usr/bin/spacewalk-common-channels -v -u Username -p Password \ 
-a x86_64 -k unlimited  &#39;centos7*&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Create Repository:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#  spacecmd  -u Username -p Password -- distribution_create -n centos7 -p  /var/distro-trees/centos7_64/ -b centos7-x86_64 -t rhel_7
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now you could use the backend for creating the kickstart, via &lt;code&gt;System-&amp;gt; KickStart-&amp;gt; Profile&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&#34;channel-package-upload&#34;&gt;Channel Package Upload&lt;/h3&gt;

&lt;p&gt;Uploading packages to the channel could consume lots of time, CentOS7 DVD have more
than 8000 packages, thus takes around half a day for uploading.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# wget https://127.0.0.1/pub/RHN-ORG-TRUSTED-SSL-CERT -O \
/usr/share/rhn/RHN-ORG-TRUSTED-SSL-CERT --no-check-certificate 
# find . -name &amp;quot;*rpm&amp;quot; | xargs rhnpush --channel=centos7-x86_64 --server=http://localhost/APP -v --tolerant -u Username -p Passwd
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>