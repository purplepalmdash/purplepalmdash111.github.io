<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
	<meta name="generator" content="Hugo 0.17-DEV" />
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Dash &middot; Dash</title>

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/poole.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde-a.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/custom-additions.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/highlight/googlecode.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124">
  <link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel="icon">

  
  
  
  <link href="http://purplepalmdash.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Dash &middot; Dash" />

  <meta name="description" content="Get busy living, or get busy dying.">
  <meta name="keywords" content="unix,virtualization,embedded,linux">
  <link rel="author" href="http://plus.google.com/106572959364703833986">
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-42175003-1', 'auto');
      ga('send', 'pageview');
  </script>

</head>
<body class="theme-base-0c">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <img src="https://www.gravatar.com/avatar/49381c0004d32c0a4296b92dff0c0ae5?s=200" alt="gravatar">
      <h1><a href="http://purplepalmdash.github.io/">Get busy living, or get busy dying.</a></h1>
      <a href="http://purplepalmdash.github.io/"><p>Dash</p></a>
    </div>

    <ul class="sidebar-nav">
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/">First Page</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/post/">All Posts</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/linux/">Linux</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/embedded/">Embedded System</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/virtualization">Virtualization</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/purplepalmdash"><i class="fa fa-github-square fa-3x"></i></a>
      
      <a href="https://cn.linkedin.com/in/yang-feipeng-1b909319"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="https://plus.google.com/u/0/106572959364703833986"><i class="fa fa-google-plus-square fa-3x"></i></a>
      <a href="https://www.facebook.com/yang.feipeng"><i class="fa fa-facebook-square fa-3x"></i></a>
      <a href="https://twitter.com/dashwillfly"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      <a href="http://purplepalmdash.github.io/index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
    </ul>

    

  </div>
</div>


<div class="content container">
  <div class="posts">
    
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2014/12/19/create-vagrant-for-jd/">Create Vagrant For JD</a>
      </h1>
      <span class="post-date">Dec 19, 2014  &middot; <a href="http://purplepalmdash.github.io/2014/12/19/create-vagrant-for-jd/#disqus_thread">Comments</a>
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/web">web</a>
        
      </span>
      
      

<h3 id="purpose">Purpose</h3>

<p>For deploying the development environment in the Vagrant based environment, choose ubuntu 14.04.</p>

<h3 id="create">Create</h3>

<p>List the exising Vagrants:</p>

<pre><code>$ vagrant box list
panamax-coreos-box-494.4.0 (virtualbox, 0)

</code></pre>

<p>Now download the vbox file of 14.04 daily Cloud image i386 from <a href="www.vagrantbox.es">www.vagrantbox.es</a>:</p>

<pre><code>$ wget https://cloud-images.ubuntu.com/vagrant/trusty/current/trusty-server-cloudimg-i386-vagrant-disk1.box

</code></pre>

<p>Though this method could starts the vbox, but it&rsquo;s not clean, it will have problems in our deliveris.  So use the result from <a href="https://atlas.hashicorp.com/boxes/search">https://atlas.hashicorp.com/boxes/search</a></p>

<pre><code>$ vagrant init  ubuntu/trusty32
$ vagrant up

</code></pre>

<p>Current we use 32, because we may have windowsxp users, or 32-bit system users.</p>

<p>After installation, list all of the installed vboxes:</p>

<pre><code>$ vagrant box list
panamax-coreos-box-494.4.0 (virtualbox, 0)
ubuntu/trusty32            (virtualbox, 14.04)

</code></pre>

<h3 id="configuration">Configuration</h3>

<p>The Bootstrap.sh is listed as following:</p>

<pre><code>#!/usr/bin/env bash
sudo debconf-set-selections &lt;&lt;&lt; 'mysql-server-5.5 mysql-server/root_password password rootpass'
sudo debconf-set-selections &lt;&lt;&lt; 'mysql-server-5.5 mysql-server/root_password_again password rootpass'
apt-get update
apt-get install -y meld
apt-get install -y nginx mysql-server mysql-server-5.5
apt-get install -y nodejs libc-ares2 libv8-3.14.5
apt-get install -y fossil
apt-get install -y git
apt-get install -y php5 php5-fpm
apt-get install -y php5-mysql
apt-get install -y php-pear
apt-get install -y install-info
apt-get install -y php5-dev
apt-get install -y npm
npm install -g pdf.js

</code></pre>

<p>then write the Vagrantfile list like:</p>

<pre><code>Vagrant.configure(2) do |config|
  config.vm.box = &quot;ubuntu/trusty32&quot;
  config.vm.network &quot;private_network&quot;, ip: &quot;192.168.50.50&quot;
  config.proxy.http = &quot;http://1xx.x.xx.xxx:xxxx&quot;
  config.proxy.https = &quot;http://1xx.x.xx.xxx:xxxx&quot;
  config.proxy.no_proxy = &quot;localhost&quot;
  config.vm.provision :shell, path: &quot;bootstrap.sh&quot;
end

</code></pre>

<p>Now run <code>vagrant provision</code> then we could refresh the installation.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2014/12/13/dockerize-wordpress-on-digitaloceans-coreos/">Dockerize Wordpress On DigitalOcean&#39;s CoreOS</a>
      </h1>
      <span class="post-date">Dec 13, 2014  &middot; <a href="http://purplepalmdash.github.io/2014/12/13/dockerize-wordpress-on-digitaloceans-coreos/#disqus_thread">Comments</a>
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/web">web</a>
        
      </span>
      
      

<h3 id="wordpress">Wordpress</h3>

<p>Install it via:</p>

<pre><code>$ docker pull tutum/wordpress

</code></pre>

<p>Run it via:</p>

<pre><code>$ docker run -p 80:80 tutum/wordpress &amp;

</code></pre>

<p>Now configure the backend, and you could directly access <code>http://Your_IP_Address</code> for this wordpress website.</p>

<h3 id="import-database-and-static-files">Import Database And Static Files</h3>

<p>Since I have an old website, I want to import it in this container, following is the steps of how-to.<br />
The exising database runs on Debian 7, and its platform is arm-based, see if we could directly retrieve the wordpress and extract them into it.</p>

<h4 id="extract-the-mysql-datafile">Extract the MYSQL Datafile</h4>

<p>Use mysqldump for extracting the existing wordpress file</p>

<pre><code>$ mysqldump -u root -p[root-password] wordpress&gt;~/wordpress.mysql

</code></pre>

<p>Then copy the <code>wordpress.mysql</code> to the remote server.</p>

<h4 id="replacement">Replacement</h4>

<p>Be sure to use gedit for replacing the old <code>fxx***.iiiouge.biz:7777</code> to <code>1xx.xxx.xxx.xxx</code> then all of your links will be acts well.<br />
Then upload the /var/www/ directory to your server&rsquo;s corresponding directory, here ours is <code>/var/www/html</code>, eg. <code>/app</code></p>

<h4 id="import-the-mysql-datafile">Import the MYSQL Datafile</h4>

<p>Attached to running wordpress in DO via:</p>

<pre><code>$ docker ps
CONTAINER ID        IMAGE                    COMMAND                CREATED             STATUS              PORTS                          NAMES
cfddafcc96f5        tutum/wordpress:latest   &quot;/run.sh&quot;              25 hours ago        Up 25 hours         3306/tcp, 0.0.0.0:80-&gt;80/tcp   drunk_brown         
$ docker exec -it cfddafcc96f5 bash

</code></pre>

<p>This will give you a terminal for accessing the running container. Examine the wordpress running environments:<br />
The WP files are located at <code>/var/www/html</code>, the mysql file locates at <code>/var/lib/mysql/wordpress</code>, then how to import the old wordpress website is the things we want to solve.<br />
Install phpMyAdmin for importing the database:</p>

<pre><code>$ sudo apt-get install phpmyadmin apache-utils
$ sudo vim /etc/apache2/apache2.conf
Include /etc/phpmyadmin/apache.conf
$ sudo service apache2 restart
Include /etc/phpmyadmin/apache.conf
$ sudo service apache2 restart

</code></pre>

<p>Now you could directly access the phpMyAdmin page with username root and empty password, this is dangerous, but we just for demononstration, needn&rsquo;t care it.<br />
Use phpMyAdmin for importing the sql file which we extracted from the old wordpress.</p>

<h4 id="trouble-shooting">Trouble shooting</h4>

<p>When uploading the www file and replaced, the connection shows:</p>

<pre><code>数据库连接错误
您在wp-config.php文件中提供的数据库用户名和密码可能不正确，或者无法连接到localhost上的数据库服务器，这意味着您的主机数据库服务器已停止工作。

您确认您提供的用户名和密码正确么？
您确认您提供的主机名正确么？
您确认数据库服务器运行正常么？

</code></pre>

<p>This is because we provided the wrong password for the mysql, change it to the username <code>root</code> and nopassword.</p>

<p>Restart the apache2 server now your website acts good.</p>

<h4 id="hide-phpmyadmin-page-the-username-root-and-nopassword">Hide phpMyAdmin Page the username <code>root</code> and nopassword.</h4>

<pre><code>$ sudo nano /etc/phpmyadmin/apache.conf 
&lt;Directory /usr/share/phpmyadmin&gt;
        Options FollowSymLinks
        DirectoryIndex index.php
        AllowOverride All
        [...]

</code></pre>

<p>Add the htaccess method via:</p>

<pre><code>$ sudo nano /usr/share/phpmyadmin/.htaccess
AuthType Basic
AuthName &quot;Restricted Files&quot;
AuthUserFile /etc/apache2/.phpmyadmin.htpasswd
Require valid-user

</code></pre>

<p>Then set the password for root via:</p>

<pre><code>$ sudo htpasswd -c /etc/apache2/.phpmyadmin.htpasswd root

</code></pre>

<p>After doing this, restart the apache2 service, now your phpMyAdmin page is under the protection of the username and the password.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2014/12/12/recover-my-openwrt-configuration/">Recover My OpenWRT Configuration</a>
      </h1>
      <span class="post-date">Dec 12, 2014  &middot; <a href="http://purplepalmdash.github.io/2014/12/12/recover-my-openwrt-configuration/#disqus_thread">Comments</a>
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/openwrt">openwrt</a>
        
      </span>
      
      

<h3 id="background">Background</h3>

<p>I tried to use <code>192.168.1</code> network for debugging, but after I change back from <code>10.0.0.</code> to <code>192.168.1.</code> the router got no interface for luci and http. So following is the steps for recovering from the fail router.</p>

<h3 id="solution">Solution</h3>

<p>First I tried to recover the luci and uhttpd, but after a while I think maybe I could swith to a newer version.<br />
The newest version currently is &ldquo; &lsquo;Barrier Breaker&rsquo; &ldquo;, its version number is 14.07.<br />
My router is Mercury 4530R, which have the following configuration:</p>

<pre><code>CPU	Ram	Flash	Network	USB	Serial	JTag    
Atheros	128MiB	8MiB	4LAN + 2WIFI	Yes	Yes	?    

</code></pre>

<p>LUCI upgrade failed:<br />
<img src="/images/flasherror.jpg" alt="/images/flasherror.jpg" /></p>

<p>The reason:<br />
<img src="/images/flasherrorreason.jpg" alt="/images/flasherrorreason.jpg" /></p>

<p>Because in early 2012 Autumn, the official supporting for 4530R is not release, so we modified the machineID, to let 4530R to use TP-Link&rsquo;s patched images, this will display our system as for 4310, but not for 4530R.</p>

<h4 id="sysupgrade-in-cli">Sysupgrade in CLI</h4>

<p>First check the free memory:</p>

<pre><code>root@OpenWrt:~# free
             total         used         free       shared      buffers
Mem:        126788        26636       100152            0         1780
-/+ buffers:              24856       101932
Swap:            0            0            0

</code></pre>

<p>Download the sysupgrade file:</p>

<pre><code># cd /tmp
# wget http://downloads.openwrt.org/barrier_breaker/14.07/ar71xx/generic/openwrt-ar71xx-generic-mw4530r-v1-squashfs-sysupgrade.bin
# ls -l openwrt-ar71xx-generic-mw4530r-v1-squashfs-sysupgrade.bin 
-rw-r--r--    1 root     root       3342340 Jun 22 17:28 openwrt-ar71xx-generic-mw4530r-v1-squashfs-sysupgrade.bin

</code></pre>

<p>Problem when checking:</p>

<pre><code># sysupgrade -v openwrt-ar71xx-generic-mw4530r-v1-squashfs-sysupgrade.bin 
Invalid image, hardware ID mismatch, hw:43100001 image:45300001.
Image check 'platform_check_image' failed.

</code></pre>

<p>Ignore the Image check:</p>

<pre><code>root@OpenWrt:/tmp# sysupgrade -F openwrt-ar71xx-generic-mw4530r-v1-squashfs-sysupgrade.bin 
Invalid image, hardware ID mismatch, hw:43100001 image:45300001.
Image check 'platform_check_image' failed but --force given - will update anyway!
Saving config files...
Sending TERM to remaining processes ... uhttpd dnsmasq smbd nmbd ntpd hotplug2 syslogd klogd hotplug2 ubusd netifd 
Sending KILL to remaining processes ... uhttpd 
Switching to ramdisk...
Performing system upgrade...
Unlocking firmware ...

Writing from &lt;stdin&gt; to firmware ...     
Appending jffs2 data from /tmp/sysupgrade.tgz to firmware...TRX header not found
Error fixing up TRX header
    
Upgrade completed
Rebooting system...

</code></pre>

<p>After a while, your router is flashed to the new system.</p>

<h4 id="more-happily-play-with-flashdisk">More Happily Play with FlashDisk</h4>

<p>Cause 8M Flash is not enough for playing lots of things, I plug-in a 2G FlashDisk into the usb port as the external disk.</p>

<pre><code>$ ssh root@192.168.1.1
root@OpenWrt:~# export http_proxy=http://1xx.xx.xxx.xxx:2xxxx
root@OpenWrt:~# df -h
Filesystem                Size      Used Available Use% Mounted on
rootfs                    4.6M    292.0K      4.3M   6% /
/dev/root                 2.3M      2.3M         0 100% /rom
tmpfs                    61.7M    588.0K     61.1M   1% /tmp
/dev/mtdblock3            4.6M    292.0K      4.3M   6% /overlay
overlayfs:/overlay        4.6M    292.0K      4.3M   6% /
tmpfs                   512.0K         0    512.0K   0% /dev
root@OpenWrt:~# opkg update
......
root@OpenWrt:~# opkg install block-mount kmod-usb-storage fdisk kmod-fs-ext4 kmod-usb-storage-extras kmod-scsi-generic
......
root@OpenWrt:~# df -h
Filesystem                Size      Used Available Use% Mounted on
rootfs                    4.6M    836.0K      3.8M  18% /

</code></pre>

<p>Now format the flash-disk and plug it into the usb port. Reboot the router and now via <code>fdisk -l</code> you will see the plugged-in flashdisk:</p>

<pre><code>Device    Boot Start       End  Blocks  Id System
/dev/sda1       2048   3948543 1973248  83 Linux

</code></pre>

<h4 id="transfer-filesystem-to-external-disk">Transfer Filesystem to External Disk</h4>

<p>The steps is listed as:<br />
pivot overlay:</p>

<pre><code>root@OpenWrt:~# mkdir /mnt/sda1
root@OpenWrt:~# mount /dev/sda1 /mnt/sda1/
root@OpenWrt:~# tar -C /overlay -cvf - . | tar -C /mnt/sda1 -xf -
root@OpenWrt:~# ls /mnt/sda1/
etc         lib         lost+found  mnt         sbin        usr

</code></pre>

<p>pivot root:</p>

<pre><code>mkdir -p /tmp/cproot
mount --bind / /tmp/cproot
tar -C /tmp/cproot -cvf - . | tar -C /mnt/sda1 -xf -
umount /tmp/cproot

</code></pre>

<p>Configuration file:</p>

<pre><code>$ block detect
config 'mount'
        option  target  '/mnt/sda1'
        option  uuid    'f6857dac-a12a-49c9-b567-f05a61100bd7'
        option  enabled '0'

$ cat /etc/config/fstab
config global
        option anon_swap '0'
        option anon_mount '0'
        option auto_swap '1'
        option auto_mount '1'
        option delay_root '5'
        option check_fs '0'

config mount
        option target '/overlay'
        option  uuid    'f6857dac-a12a-49c9-b567-f05a61100bd7'
        option enabled '1'
        option fstype 'ext4'

</code></pre>

<p>Now reboot the router and you got a 2G based storage router:</p>

<pre><code>root@OpenWrt:~# df -h
Filesystem                Size      Used Available Use% Mounted on
rootfs                    1.8G     12.6M      1.7G   1% /

</code></pre>

<p>You could play happily in this router.<br />
<img src="/images/4530Rrouter.jpg" alt="/images/4530Rrouter.jpg" /></p>

<h3 id="further-optimization">Further Optimization</h3>

<p>Includes:<br />
1. Fixed ip address configurations.<br />
2. Port forwarding. Router-&gt; Port Forwarding.<br />
3. SSH Server Replacement, from dropbear to opensshd.</p>

<pre><code># opkg update
# opkg install openssh-server
# uci set dropbear.@dropbear[0].Port=2222
# uci commit dropbear
# /etc/init.d/dropbear restart
# /etc/init.d/sshd enable
# /etc/init.d/sshd start
# /etc/init.d/dropbear disable
# /etc/init.d/dropbear stop
# ssh-keygen
# opkg install openssh-client

</code></pre>

<p>4. Time sync.<br />
With the previous installed sshd, you could add yourself to remote server&rsquo;s trusted users. then add files of <code>time.sh</code> for syncing time.<br />
Refers to local link <code>/blog/2014/02/11/write-local-ntp-sync-server/</code><br />
5. Sharing the mouse between Yosemite and ArchLinux, change the configuration files.</p>

<p>Finally we got all of these done:</p>

<pre><code>root@OpenWrt:~/.ssh# uptime
 12:45:31 up 6 min,  load average: 0.22, 0.14, 0.06
root@OpenWrt:~/.ssh# date
Fri Dec 12 12:45:33 CST 2014
root@OpenWrt:~/.ssh# uname -a
Linux OpenWrt 3.10.49 #3 Wed Oct 1 14:00:51 CEST 2014 mips GNU/Linux

</code></pre>

<p>Enable ssh WAN access:</p>

<pre><code>uci add firewall rule
uci set firewall.@rule[-1].src=wan
uci set firewall.@rule[-1].target=ACCEPT
uci set firewall.@rule[-1].proto=tcp
uci set firewall.@rule[-1].dest_port=22
uci commit firewall
/etc/init.d/firewall restart

</code></pre>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2014/12/11/ba-wan-panamax/">把玩Panamax</a>
      </h1>
      <span class="post-date">Dec 11, 2014  &middot; <a href="http://purplepalmdash.github.io/2014/12/11/ba-wan-panamax/#disqus_thread">Comments</a>
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/virtualization">Virtualization</a>
        
      </span>
      
      

<h3 id="前提条件">前提条件</h3>

<p>在MAC上把玩Panamax前，需要安装Virtualbox, Vagrant, 而后, 用下列命令安装Panamax:</p>

<pre><code>$ brew install http://download.panamax.io/installer/brew/panamax.rb
$ panamax init

</code></pre>

<p>这将开始下载CoreOS镜像，需要等一段时间。</p>

<p>In fact the panamax could also be installed on ArchLinux rather than only in Ubuntu, simply run:</p>

<pre><code>$ curl http://download.panamax.io/installer/ubuntu.sh | bash

</code></pre>

<h3 id="trouble-shooting">Trouble Shooting</h3>

<h4 id="init-failed">Init failed</h4>

<pre><code>$ panamix init
A different VM with name panamax-vm has been created already. Please re-install or delete panamax-vm VM and try again.

</code></pre>

<p>Use following command for listing all of the virtualmachines:</p>

<pre><code>VBoxManage list vms

</code></pre>

<p>Didn&rsquo;t found the panamax related infos.<br />
Finally solve the problem via:</p>

<pre><code>[Trusty@~/.vagrant.d]$ pwd
/home/Trusty/.vagrant.d
[Trusty@~/.vagrant.d]$ mv plugins.json plugins.json.back
[Trusty@~/.vagrant.d]$ mv gems gems.back

</code></pre>

<h4 id="frozen-string">Frozen String</h4>

<p>The error code:</p>

<pre><code>/opt/vagrant/embedded/gems/gems/vagrant-1.7.0/lib/vagrant/util/subprocess.rb:28:in `encode!': can't modify frozen String (RuntimeError)

</code></pre>

<p>Is it because I upgraded to the latest vagrant?</p>

<p>I couldnot roll back to vagrant1.6, so I upgraded to the vagrant-git, its version is 1.7.1, from the yaourt repository, thus I could get the installation continue.</p>

<h3 id="opensuse-way">OpenSuse Way</h3>

<p>First remove the installed virtualbox:</p>

<pre><code>$ zypper remove virtualbox
$ zypper in libvncserver0 LibVNCServer-devel

</code></pre>

<p>Install the 4.3 version of virtualbox:</p>

<pre><code>$ wget http://download.opensuse.org/repositories/home:/Warhammer40k:/stuff/openSUSE_13.1/x86_64/VirtualBox-custom-4.3-4.3.20-1.1.x86_64.rpm
$ rpm -ivh VirtualBox-custom-4.3-4.3.20-1.1.x86_64.rpm

</code></pre>

<p>Now doing the same as we noticed above.<br />
But the <code>panamax init</code> got following error messages:</p>

<pre><code>==&gt; panamax-vm: Clearing any previously set network interfaces...
There was an error while executing `VBoxManage`, a CLI used by Vagrant
for controlling VirtualBox. The command and stderr is shown below.

Command: [&quot;hostonlyif&quot;, &quot;create&quot;]

Stderr: 0%...
Progress state: NS_ERROR_FAILURE
VBoxManage: error: Failed to create the host-only adapter
VBoxManage: error: VBoxNetAdpCtl: Error while adding new interface: failed to open /dev/vboxnetctl: No such file or directory
VBoxManage: error: Details: code NS_ERROR_FAILURE (0x80004005), component HostNetworkInterface, interface IHostNetworkInterface
VBoxManage: error: Context: &quot;int handleCreate(HandlerArg*, int, int*)&quot; at line 66 of file VBoxManageHostonly.cpp

</code></pre>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2014/12/10/re-write-weatherapp/">Re-Write WeatherAPP</a>
      </h1>
      <span class="post-date">Dec 10, 2014  &middot; <a href="http://purplepalmdash.github.io/2014/12/10/re-write-weatherapp/#disqus_thread">Comments</a>
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/web">web</a>
        
      </span>
      
      

<h3 id="background">Background</h3>

<h3 id="building-the-environment">Building the Environment</h3>

<p>First clone the Vagrant Repo from:</p>

<pre><code>$ pwd
/media/y/Vagrant/CoreOS
$ git clone https://github.com/coreos/coreos-vagrant.git
$ cd coreos-vagrant
$ cp config.rb.sample config.rb
$ cp user-data.sample user-data

</code></pre>

<h4 id="cluster-setting">Cluster Setting</h4>

<p>Edit the config.rb, for configurating the instance and the official CoreOS channel:</p>

<pre><code># Size of the CoreOS cluster created by Vagrant
$num_instances=3
# Official CoreOS channel from which updates should be downloaded
$update_channel='stable'

</code></pre>

<p>Now start the vagrant and view its status:</p>

<pre><code>$ vagrant up
$ vagrant status
Current machine states:

core-01                   running (virtualbox)
core-02                   running (virtualbox)
core-03                   running (virtualbox)
$ vagrant ssh core-1

</code></pre>

<p>After you login to the coreOS, you could view the status of this virtual machine. Each of the machine have 1 Core, 1G ram, 20G harddisk.</p>

<h3 id="single-machine">Single Machine</h3>

<p>Just comment the following lines of the config.rb:</p>

<pre><code># $num_instances=3

</code></pre>

<p>This will bring one instance of vagrant based CoreOS machine.</p>

<h3 id="nodejs">NodeJS</h3>

<p>I want to write my APPs using NodeJS, thus I want to setup the NodeJS dev environment on CoreOS based Docker. Following are the steps:<br />
First configure the proxy of docker:</p>

<pre><code>$ sudo mkdir /etc/systemd/system/docker.service.d
$ sudo vim http-proxy.conf
[Service]
Environment=&quot;HTTP_PROXY=http://proxy.example.com:8080&quot;
To apply the change, reload the unit and restart docker:
$ systemctl daemon-reload
$ systemctl restart docker

</code></pre>

<p>Now you could use docker for pulling back some container and run.</p>

<pre><code>$ docker search base
$ docker pull base
$ docker images
$ docker run base /bin/bash -c &quot;ls /&quot;
$ docker run base /bin/bash -c &quot;cat /etc/issue&quot;

</code></pre>

<p>Since the network is not good, I created the droplet on DigitalOcean, and installed CoreOS.</p>

<h3 id="dockerized">Dockerized</h3>

<p><a href="http://blogs.aws.amazon.com/application-management/post/Tx1ZLAHMVBEDCOC/Dockerizing-a-Python-Web-App">http://blogs.aws.amazon.com/application-management/post/Tx1ZLAHMVBEDCOC/Dockerizing-a-Python-Web-App</a><br />
Steps is listed as following:</p>

<pre><code>$ git clone git@github.com:awslabs/eb-py-flask-signup.git
$ cd eb-py-flask-signup
$ git checkout master
$ vim Dockerfile
FROM ubuntu:14.04

# Install Python Setuptools
RUN apt-get install -y python-setuptools

# Install pip
RUN easy_install pip

# Add and install Python modules
ADD requirements.txt /src/requirements.txt
RUN cd /src; pip install -r requirements.txt

# Bundle app source
ADD . /src

# Expose
EXPOSE  5000

# Run
CMD [&quot;python&quot;, &quot;/src/application.py&quot;]
$ docker build -t eb-py-sample .
$ docker run -d \
     -e APP_CONFIG=application.config.example \
     -e AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID \
     -e AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY \
     -p 8080:5000 \
     eb-py-sample

</code></pre>

<p>Then open <a href="http://localhost:8000">http://localhost:8000</a> to see your own app.</p>

      
    </div>
    
    
    
    <ul class="pagination">
        
        <li>
            <a href="/" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
        </li>
        
        <li
        >
        <a href="/page/62/" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
        </li>
        
        <li
        ><a href="/">1</a></li>
        
        <li
        ><a href="/page/2/">2</a></li>
        
        <li
        ><a href="/page/3/">3</a></li>
        
        <li
        ><a href="/page/4/">4</a></li>
        
        <li
        ><a href="/page/5/">5</a></li>
        
        <li
        ><a href="/page/6/">6</a></li>
        
        <li
        ><a href="/page/7/">7</a></li>
        
        <li
        ><a href="/page/8/">8</a></li>
        
        <li
        ><a href="/page/9/">9</a></li>
        
        <li
        ><a href="/page/10/">10</a></li>
        
        <li
        ><a href="/page/11/">11</a></li>
        
        <li
        ><a href="/page/12/">12</a></li>
        
        <li
        ><a href="/page/13/">13</a></li>
        
        <li
        ><a href="/page/14/">14</a></li>
        
        <li
        ><a href="/page/15/">15</a></li>
        
        <li
        ><a href="/page/16/">16</a></li>
        
        <li
        ><a href="/page/17/">17</a></li>
        
        <li
        ><a href="/page/18/">18</a></li>
        
        <li
        ><a href="/page/19/">19</a></li>
        
        <li
        ><a href="/page/20/">20</a></li>
        
        <li
        ><a href="/page/21/">21</a></li>
        
        <li
        ><a href="/page/22/">22</a></li>
        
        <li
        ><a href="/page/23/">23</a></li>
        
        <li
        ><a href="/page/24/">24</a></li>
        
        <li
        ><a href="/page/25/">25</a></li>
        
        <li
        ><a href="/page/26/">26</a></li>
        
        <li
        ><a href="/page/27/">27</a></li>
        
        <li
        ><a href="/page/28/">28</a></li>
        
        <li
        ><a href="/page/29/">29</a></li>
        
        <li
        ><a href="/page/30/">30</a></li>
        
        <li
        ><a href="/page/31/">31</a></li>
        
        <li
        ><a href="/page/32/">32</a></li>
        
        <li
        ><a href="/page/33/">33</a></li>
        
        <li
        ><a href="/page/34/">34</a></li>
        
        <li
        ><a href="/page/35/">35</a></li>
        
        <li
        ><a href="/page/36/">36</a></li>
        
        <li
        ><a href="/page/37/">37</a></li>
        
        <li
        ><a href="/page/38/">38</a></li>
        
        <li
        ><a href="/page/39/">39</a></li>
        
        <li
        ><a href="/page/40/">40</a></li>
        
        <li
        ><a href="/page/41/">41</a></li>
        
        <li
        ><a href="/page/42/">42</a></li>
        
        <li
        ><a href="/page/43/">43</a></li>
        
        <li
        ><a href="/page/44/">44</a></li>
        
        <li
        ><a href="/page/45/">45</a></li>
        
        <li
        ><a href="/page/46/">46</a></li>
        
        <li
        ><a href="/page/47/">47</a></li>
        
        <li
        ><a href="/page/48/">48</a></li>
        
        <li
        ><a href="/page/49/">49</a></li>
        
        <li
        ><a href="/page/50/">50</a></li>
        
        <li
        ><a href="/page/51/">51</a></li>
        
        <li
        ><a href="/page/52/">52</a></li>
        
        <li
        ><a href="/page/53/">53</a></li>
        
        <li
        ><a href="/page/54/">54</a></li>
        
        <li
        ><a href="/page/55/">55</a></li>
        
        <li
        ><a href="/page/56/">56</a></li>
        
        <li
        ><a href="/page/57/">57</a></li>
        
        <li
        ><a href="/page/58/">58</a></li>
        
        <li
        ><a href="/page/59/">59</a></li>
        
        <li
        ><a href="/page/60/">60</a></li>
        
        <li
        ><a href="/page/61/">61</a></li>
        
        <li
        ><a href="/page/62/">62</a></li>
        
        <li
        class="active"><a href="/page/63/">63</a></li>
        
        <li
        ><a href="/page/64/">64</a></li>
        
        <li
        ><a href="/page/65/">65</a></li>
        
        <li
        ><a href="/page/66/">66</a></li>
        
        <li
        ><a href="/page/67/">67</a></li>
        
        <li
        ><a href="/page/68/">68</a></li>
        
        <li
        ><a href="/page/69/">69</a></li>
        
        <li
        ><a href="/page/70/">70</a></li>
        
        <li
        ><a href="/page/71/">71</a></li>
        
        <li
        ><a href="/page/72/">72</a></li>
        
        <li
        ><a href="/page/73/">73</a></li>
        
        <li
        ><a href="/page/74/">74</a></li>
        
        <li
        ><a href="/page/75/">75</a></li>
        
        <li
        ><a href="/page/76/">76</a></li>
        
        <li
        ><a href="/page/77/">77</a></li>
        
        <li
        ><a href="/page/78/">78</a></li>
        
        <li
        ><a href="/page/79/">79</a></li>
        
        <li
        ><a href="/page/80/">80</a></li>
        
        <li
        ><a href="/page/81/">81</a></li>
        
        <li
        ><a href="/page/82/">82</a></li>
        
        <li
        ><a href="/page/83/">83</a></li>
        
        <li
        ><a href="/page/84/">84</a></li>
        
        <li
        ><a href="/page/85/">85</a></li>
        
        <li
        ><a href="/page/86/">86</a></li>
        
        <li
        ><a href="/page/87/">87</a></li>
        
        <li
        ><a href="/page/88/">88</a></li>
        
        <li
        ><a href="/page/89/">89</a></li>
        
        <li
        ><a href="/page/90/">90</a></li>
        
        <li
        ><a href="/page/91/">91</a></li>
        
        <li
        ><a href="/page/92/">92</a></li>
        
        <li
        ><a href="/page/93/">93</a></li>
        
        <li
        ><a href="/page/94/">94</a></li>
        
        <li
        ><a href="/page/95/">95</a></li>
        
        <li
        ><a href="/page/96/">96</a></li>
        
        <li
        ><a href="/page/97/">97</a></li>
        
        <li
        ><a href="/page/98/">98</a></li>
        
        <li
        ><a href="/page/99/">99</a></li>
        
        <li
        ><a href="/page/100/">100</a></li>
        
        <li
        ><a href="/page/101/">101</a></li>
        
        <li
        ><a href="/page/102/">102</a></li>
        
        <li
        ><a href="/page/103/">103</a></li>
        
        <li
        ><a href="/page/104/">104</a></li>
        
        <li
        ><a href="/page/105/">105</a></li>
        
        <li
        ><a href="/page/106/">106</a></li>
        
        <li
        ><a href="/page/107/">107</a></li>
        
        <li
        ><a href="/page/108/">108</a></li>
        
        <li
        ><a href="/page/109/">109</a></li>
        
        <li
        ><a href="/page/110/">110</a></li>
        
        <li
        ><a href="/page/111/">111</a></li>
        
        <li
        ><a href="/page/112/">112</a></li>
        
        <li
        ><a href="/page/113/">113</a></li>
        
        <li
        ><a href="/page/114/">114</a></li>
        
        <li
        ><a href="/page/115/">115</a></li>
        
        <li
        ><a href="/page/116/">116</a></li>
        
        <li
        ><a href="/page/117/">117</a></li>
        
        <li
        ><a href="/page/118/">118</a></li>
        
        <li
        ><a href="/page/119/">119</a></li>
        
        <li
        ><a href="/page/120/">120</a></li>
        
        <li
        ><a href="/page/121/">121</a></li>
        
        <li
        ><a href="/page/122/">122</a></li>
        
        <li
        ><a href="/page/123/">123</a></li>
        
        <li
        ><a href="/page/124/">124</a></li>
        
        <li
        ><a href="/page/125/">125</a></li>
        
        <li
        ><a href="/page/126/">126</a></li>
        
        <li
        ><a href="/page/127/">127</a></li>
        
        <li
        ><a href="/page/128/">128</a></li>
        
        <li
        ><a href="/page/129/">129</a></li>
        
        <li
        ><a href="/page/130/">130</a></li>
        
        <li
        ><a href="/page/131/">131</a></li>
        
        <li
        ><a href="/page/132/">132</a></li>
        
        <li
        ><a href="/page/133/">133</a></li>
        
        <li
        ><a href="/page/134/">134</a></li>
        
        <li
        ><a href="/page/135/">135</a></li>
        
        <li
        ><a href="/page/136/">136</a></li>
        
        <li
        >
        <a href="/page/64/" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
        </li>
        
        <li>
            <a href="/page/136/" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
        </li>
        
    </ul>
    
  </div>
</div>


<script type="text/javascript">
var disqus_shortname = "dashsagittariussglory";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>

<script src="http://purplepalmdash.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

