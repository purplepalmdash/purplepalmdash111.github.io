
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="有关电路 上一章讲的是12864的基础知识。这一章里来看12864和stm32板的连接和驱动的问题。 有关12864小LCD的连接，在PDF中我们可以找到如下的表项: 功能模块 占用模块 备注 12864小LCD
PC4,PB2,PB11,PB13,PB15
PC4:A0,同时也是 CH375 和 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/52">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//fonts.googleapis.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/28/guan-yu-stm32ban-shang-de-12864ye-jing-1/">关于STM32板上的12864液晶(2)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-28T10:13:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>10:13 am</span></time>
        
         | <a href="/blog/2013/11/28/guan-yu-stm32ban-shang-de-12864ye-jing-1/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>有关电路</h3>

<p>上一章讲的是12864的基础知识。这一章里来看12864和stm32板的连接和驱动的问题。</p>

<p>有关12864小LCD的连接，在PDF中我们可以找到如下的表项:</p>

<table>
<thead>
<tr>
<th>功能模块</th>
<th> 占用模块</th>
<th> 备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>12864小LCD</td>
<td>PC4,PB2,PB11,PB13,PB15</td>
<td>PC4:A0,同时也是 CH375 和 TFT 的 A0;<br>PB2:BOOT1,LCD 的 CS 脚;<br>PB11:28J60 和大小 LCD 的复位脚</td>
</tr>
</tbody>
</table>


<p>再结合电路图： <br/>
<img src="/images/stm32spi.jpg" alt="stm32spi.jpg" /></p>

<p>关于GPIO口的设置，我们可以看到有这样的定义：</p>

<figure class='code'><figcaption><span>stm32f10x_gpio.h</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="k">typedef</span> <span class="k">enum</span>
</span><span class='line'><span class="p">{</span> <span class="n">GPIO_Mode_AIN</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">,</span>
</span><span class='line'>  <span class="n">GPIO_Mode_IN_FLOATING</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
</span><span class='line'>  <span class="n">GPIO_Mode_IPD</span> <span class="o">=</span> <span class="mh">0x28</span><span class="p">,</span>
</span><span class='line'>  <span class="n">GPIO_Mode_IPU</span> <span class="o">=</span> <span class="mh">0x48</span><span class="p">,</span>
</span><span class='line'>  <span class="n">GPIO_Mode_Out_OD</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">,</span>
</span><span class='line'>  <span class="n">GPIO_Mode_Out_PP</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
</span><span class='line'>  <span class="n">GPIO_Mode_AF_OD</span> <span class="o">=</span> <span class="mh">0x1C</span><span class="p">,</span>
</span><span class='line'>  <span class="n">GPIO_Mode_AF_PP</span> <span class="o">=</span> <span class="mh">0x18</span>
</span><span class='line'><span class="p">}</span><span class="n">GPIOMode_TypeDef</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>而在stm32的Datasheet中有如下的配置模式：  <br/>
<img src="/images/stmgpiomode.jpg" alt="stmgpiomode.jpg" /></p>

<p>最低的8个bit和表中是一一对应的，其中通用输出/复用功能输出的mode1/mode0的值为00.   <br/>
因为PB15是MOSI2口， PB13是SCK2口，所以这两个管脚需要被设置为AF模式的。AF代表复用功能。PP代表push-pull.</p>

<figure class='code'><figcaption><span>LCDs.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/* PB15-MOSI2,PB13-SCK2*/</span>
</span><span class='line'><span class="cm">/* Why PB14 should be enabled? */</span>
</span><span class='line'><span class="n">GPIO_InitStructure</span><span class="p">.</span><span class="n">GPIO_Pin</span> <span class="o">=</span> <span class="n">GPIO_Pin_13</span> <span class="o">|</span><span class="n">GPIO_Pin_14</span> <span class="o">|</span> <span class="n">GPIO_Pin_15</span><span class="p">;</span>
</span><span class='line'><span class="n">GPIO_InitStructure</span><span class="p">.</span><span class="n">GPIO_Speed</span> <span class="o">=</span> <span class="n">GPIO_Speed_50MHz</span><span class="p">;</span>
</span><span class='line'><span class="n">GPIO_InitStructure</span><span class="p">.</span><span class="n">GPIO_Mode</span> <span class="o">=</span> <span class="n">GPIO_Mode_AF_PP</span><span class="p">;</span>
</span><span class='line'><span class="n">GPIO_Init</span><span class="p">(</span><span class="n">GPIOB</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">GPIO_InitStructure</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>PB11和PB2属于output口，所以直接设置为out口即可。   <br/>
有关SPI2口的配置， 在STM中的代码如下：</p>

<figure class='code'><figcaption><span>LCDs.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/* SPI2 configuration */</span>
</span><span class='line'>    <span class="n">SPI_Cmd</span><span class="p">(</span><span class="n">SPI2</span><span class="p">,</span> <span class="n">DISABLE</span><span class="p">);</span>                                                 <span class="c1">//必须先禁能,才能改变MODE</span>
</span><span class='line'><span class="n">SPI_InitStructure</span><span class="p">.</span><span class="n">SPI_Direction</span> <span class="o">=</span> <span class="n">SPI_Direction_2Lines_FullDuplex</span><span class="p">;</span>      <span class="c1">//两线全双工</span>
</span><span class='line'><span class="n">SPI_InitStructure</span><span class="p">.</span><span class="n">SPI_Mode</span> <span class="o">=</span> <span class="n">SPI_Mode_Master</span><span class="p">;</span>                           <span class="c1">//主</span>
</span><span class='line'><span class="n">SPI_InitStructure</span><span class="p">.</span><span class="n">SPI_DataSize</span> <span class="o">=</span> <span class="n">SPI_DataSize_8b</span><span class="p">;</span>                       <span class="c1">//8位</span>
</span><span class='line'><span class="n">SPI_InitStructure</span><span class="p">.</span><span class="n">SPI_CPOL</span> <span class="o">=</span> <span class="n">SPI_CPOL_High</span><span class="p">;</span>                             <span class="c1">//CPOL=1 时钟悬空高</span>
</span><span class='line'><span class="n">SPI_InitStructure</span><span class="p">.</span><span class="n">SPI_CPHA</span> <span class="o">=</span> <span class="n">SPI_CPHA_2Edge</span><span class="p">;</span>                            <span class="c1">//CPHA=1 数据捕获第2个</span>
</span><span class='line'><span class="n">SPI_InitStructure</span><span class="p">.</span><span class="n">SPI_NSS</span> <span class="o">=</span> <span class="n">SPI_NSS_Soft</span><span class="p">;</span>                               <span class="c1">//软件NSS</span>
</span><span class='line'><span class="n">SPI_InitStructure</span><span class="p">.</span><span class="n">SPI_BaudRatePrescaler</span> <span class="o">=</span> <span class="n">SPI_BaudRatePrescaler_2</span><span class="p">;</span>      <span class="c1">//2分频</span>
</span><span class='line'><span class="n">SPI_InitStructure</span><span class="p">.</span><span class="n">SPI_FirstBit</span> <span class="o">=</span> <span class="n">SPI_FirstBit_MSB</span><span class="p">;</span>                      <span class="c1">//高位在前</span>
</span><span class='line'><span class="n">SPI_InitStructure</span><span class="p">.</span><span class="n">SPI_CRCPolynomial</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>                               <span class="c1">//CRC7</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">SPI_Init</span><span class="p">(</span><span class="n">SPI2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">SPI_InitStructure</span><span class="p">);</span>
</span><span class='line'><span class="n">SPI_Cmd</span><span class="p">(</span><span class="n">SPI2</span><span class="p">,</span> <span class="n">ENABLE</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h3>有关SPI总线</h3>

<p>SPI接口是Motorola 首先提出的全双工三线同步串行外围接口，采用主从模式（Master Slave）架构；支持多slave模式应用，一般仅支持单Master。时钟由Master控制，在时钟移位脉冲下，数据按位传输，高位在前，低位在后（MSB first）；SPI接口有2根单向数据线，为全双工通信，目前应用中的数据速率可达几Mbps的水平。   <br/>
stm32中关于SPI传送字节的函数编写</p>

<figure class='code'><figcaption><span>LCDs.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="k">static</span> <span class="n">u8</span> <span class="nf">SPIByte</span><span class="p">(</span><span class="n">u8</span> <span class="n">byte</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="cm">/*等待发送寄存器空*/</span>
</span><span class='line'>  <span class="k">while</span><span class="p">((</span><span class="n">SPI2</span><span class="o">-&gt;</span><span class="n">SR</span> <span class="o">&amp;</span> <span class="n">SPI_I2S_FLAG_TXE</span><span class="p">)</span><span class="o">==</span><span class="n">RESET</span><span class="p">);</span>
</span><span class='line'>    <span class="cm">/*发送一个字节*/</span>
</span><span class='line'>  <span class="n">SPI2</span><span class="o">-&gt;</span><span class="n">DR</span> <span class="o">=</span> <span class="n">byte</span><span class="p">;</span>
</span><span class='line'>  <span class="cm">/* 等待接收寄存器有效*/</span>
</span><span class='line'>  <span class="k">while</span><span class="p">((</span><span class="n">SPI2</span><span class="o">-&gt;</span><span class="n">SR</span> <span class="o">&amp;</span> <span class="n">SPI_I2S_FLAG_RXNE</span><span class="p">)</span><span class="o">==</span><span class="n">RESET</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span><span class="p">(</span><span class="n">SPI2</span><span class="o">-&gt;</span><span class="n">DR</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>命令和数据是调用这个函数写入的，我们需要注意的是时序，在写入总线时需要先拉低/高A0线</p>

<figure class='code'><figcaption><span>LCDs.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="c1">//写命令</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">LcdCmd</span><span class="p">(</span><span class="n">u8</span> <span class="n">cmd</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">CSLCDS_L</span><span class="p">;</span>
</span><span class='line'>  <span class="n">A0_L</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//__nop();</span>
</span><span class='line'>  <span class="p">;</span>
</span><span class='line'>  <span class="n">SPIByte</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//__nop();</span>
</span><span class='line'>  <span class="p">;</span>
</span><span class='line'>  <span class="n">CSLCDS_H</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//写数据</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">LcdDat</span><span class="p">(</span><span class="n">u8</span> <span class="n">dat</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">CSLCDS_L</span><span class="p">;</span>
</span><span class='line'>  <span class="n">A0_H</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//__nop();</span>
</span><span class='line'>  <span class="p">;</span>
</span><span class='line'>  <span class="n">SPIByte</span><span class="p">(</span><span class="n">dat</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//__nop();</span>
</span><span class='line'>  <span class="p">;</span>
</span><span class='line'>  <span class="n">CSLCDS_H</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/27/guan-yu-stm32ban-shang-de-12864ye-jing/">关于STM32板上的12864液晶</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-27T19:26:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>7:26 pm</span></time>
        
         | <a href="/blog/2013/11/27/guan-yu-stm32ban-shang-de-12864ye-jing/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>板子是09年入手的，但是一直没时间好好玩，最近端起来觉得有必要好好研究一番。为了以后翻阅方便，全中文记下来。</p>

<h3>12864</h3>

<p>通常所说的12864LCD显示块是所说的点阵液晶显示模块，就是由128X64个液晶显示点组成的一个128列X64行的阵列，所以也就叫成了12864。每个显示点都对应着有一位二进制数，0表示灭，1表示亮。存储这些点阵信息的RAM被称为显示数据存储器。如果要显示某个图形或汉字就是将相应的点阵信息写入到对应的存储单元中。图形或汉字的点阵信息是由自己设计，这时候问题的关键是显示点在液晶屏上的位置与其在存储器中的地址之间的关系。  <br/>
显示点在64X64液晶屏上的位置由列号（line,0~63）与行号（line,0~63）确定。512X8 bits RAM中某个存储单元的地址由页地址（Xpage,0~7）和列地址（Yaddress,0~63）确定。每个存储单元存储8个液晶点的显示信息。也就是说，一个页的大小是8. 运算关系则是64x64=(64x8)x8=512x8.   <br/>
由于多数液晶显示模块的驱动电路是由一片行驱动器和两片列驱动器构成，所以12864液晶屏实际上是由左右两块独立的64X64液晶屏拼接而成，每半屏有一个512X8 bits显示数据RAM。左右半屏驱动电路及存储器分别由片选信号CS1和CS2选择。（少数厂商为了简化用户设计，在模块中增加译码电路，使得128X64液晶屏就是一个整屏，只需一个片选信号。）</p>

<p>如如果点亮12864的屏中（20，30）位置上的液晶点，因列地址30小于64，该点在左半屏第29列，所以CS1有效；行地址20除以8取整得2，取余得4，该点在RAM中页地址为2，在字节中的序号为4；所以将二进制数据00010000（也可能是00001000，高低顺序取决于制造商）写入Xpage=2，Yaddress=29的存储单元中即点亮（20，30）上的液晶点。</p>

<p>这是为了为了使液晶点位置信息与存储地址的对应关系更直观关，将64X64液晶屏从上至下8等分为8个显示块，每块包括8行X64列个点阵。每列中的8行点阵信息构成一个8bits二进制数，存储在一个存储单元中。（需要注意：二进制的高低有效位顺序与行号对应关系因不同商家而不同）存放一个显示块的RAM区称为存储页。即64X64液晶屏的点阵信息存储在8个存储页中，每页64个字节，每个字节存储一列(8行)点阵信息。因此存储单元地址包括列地址（Yaddress,0~63）和页地址（Xpage,0~7）。</p>

<p>以上就是对于12864点阵液晶显示器的原理介绍。</p>

<p>在DX32开发板上的液晶是怎么一回事呢？它的封装图如下：</p>

<p><img src="/images/128641.jpg" alt="128641.jpg" /></p>

<p>Datasheet有72页，乱七八糟的会讲一大堆。但是事实上我们只需要关注和软件有关的方面，拿一个很简单的开启/关闭LCD的例子来说，DataSheet里有这样的表格：</p>

<table>
<thead>
<tr>
<th>Command</th>
<th> A0 /RD /WR </th>
<th> D7 D6 D5 D4 D3 D2 D1 D0 </th>
<th> Function </th>
</tr>
</thead>
<tbody>
<tr>
<td>Display On/OFF</td>
<td> 0 1 0 </td>
<td> 1 0 1 0 1 1 1 1       </td>
<td> LCD Display ON</td>
</tr>
<tr>
<td>Display On/OFF</td>
<td> 0 1 0 </td>
<td> 1 0 1 0 1 1 1 0       </td>
<td> LCD Display OFF</td>
</tr>
</tbody>
</table>


<p>那么会有对应的代码:</p>

<figure class='code'><figcaption><span>lcd.c-lcd.c </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'>    <span class="cm">/**************************************************************</span>
</span><span class='line'><span class="cm"> **函数名:LcdOnOff</span>
</span><span class='line'><span class="cm"> **功能:开关LCD</span>
</span><span class='line'><span class="cm"> ***************************************************************/</span>
</span><span class='line'>  <span class="kt">void</span> <span class="nf">LcdOnOff</span><span class="p">(</span><span class="n">u8</span> <span class="n">onoff</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>       <span class="k">if</span><span class="p">(</span><span class="n">onoff</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>           <span class="n">LcdCmd</span><span class="p">(</span><span class="mh">0xaf</span><span class="p">);</span>       <span class="c1">//开显示</span>
</span><span class='line'>       <span class="k">else</span>
</span><span class='line'>           <span class="n">LcdCmd</span><span class="p">(</span><span class="mh">0xae</span><span class="p">);</span>             <span class="c1">//关显示</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>0xaf的二进制的值是1010 1111, 而0xae的值则是1010 1110， 这点在手册中容易引起混淆，因为它操蛋的把前面的一系列值都省略了，表格里的才是完整的应该发送的命令。</p>

<p>再拿一个例子来说，</p>

<figure class='code'><figcaption><span>lcd.c-lcd.c </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'>    <span class="cm">/**************************************************************</span>
</span><span class='line'><span class="cm"> **函数名:LcdInit</span>
</span><span class='line'><span class="cm"> **功能:初始化LCD,初始化后需要用LcdCmd(0xaf)命令打开显示</span>
</span><span class='line'><span class="cm"> ***************************************************************/</span>
</span><span class='line'>  <span class="k">const</span> <span class="n">u8</span> <span class="n">LCD_Tab</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>        <span class="cm">/*0x26改0x27可增加对比度*/</span>
</span><span class='line'>      <span class="mh">0xa2</span><span class="p">,</span><span class="mh">0xa0</span><span class="p">,</span><span class="mh">0xc8</span><span class="p">,</span><span class="mh">0xf8</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span><span class="mh">0x2f</span><span class="p">,</span><span class="mh">0x81</span><span class="p">,</span><span class="mh">0x05</span><span class="p">,</span><span class="mh">0xa4</span><span class="p">,</span><span class="mh">0xa6</span><span class="p">,</span><span class="mh">0xac</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xee</span><span class="p">,</span><span class="mh">0x40</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="kt">void</span> <span class="nf">LcdInit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">u16</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>      <span class="n">RSTLCDS_L</span><span class="p">;</span>
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">65530</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">);</span>
</span><span class='line'>      <span class="n">RSTLCDS_H</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>      <span class="cm">/* Why we have to write 15 times for the LCD_Tab? */</span>
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">15</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>          <span class="n">LcdCmd</span><span class="p">(</span><span class="n">LCD_Tab</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>      <span class="n">LcdCmd</span><span class="p">(</span><span class="mh">0xaf</span><span class="p">);</span>       <span class="c1">//开显示</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>在初始化LCD的时候我们需要依次写入命令，这里我们把命令做成一个数组，就是LCD_Tab数组， 那么命令的格式如下：  <br/>
0xa2  LCD bits set, 0 means normal displaying  <br/>
0xa0  ADC Select. Set the display RAM address SEG output corresponding, 0 means normal.   <br/>
0xc8  Common Output Set, means reverse direction.   <br/>
0xf8  Booster ratio.</p>

<p>所有这些在DataSheet中均有详细说明。   <br/>
总之，对于12864,我们只要把它看成是一个“黑盒子”，输入对应的值，盒子上就能显示出怎样的值，如此就可以得到我们要的结果。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/27/auto-convert-source-code-to-utf-8-compatiable/">Auto Convert Source Code to UTF-8 Compatiable</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-27T17:46:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>5:46 pm</span></time>
        
         | <a href="/blog/2013/11/27/auto-convert-source-code-to-utf-8-compatiable/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For those code files which contains gb2312 or gbk format, we can use following scripts for automatically convert them to UTF-8 conpatiable format files.</p>

<figure class='code'><figcaption><span>autochinese.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'><span class="nb">export </span><span class="nv">LANG</span><span class="o">=</span><span class="s2">&quot;zh_CN.utf8&quot;</span>
</span><span class='line'><span class="nb">export </span><span class="nv">LC_ALL</span><span class="o">=</span><span class="s2">&quot;zh_CN.utf8&quot;</span>
</span><span class='line'><span class="c">#for file in `find . -name &quot;*.h&quot;`</span>
</span><span class='line'><span class="k">for</span> file in <span class="sb">`</span>find . -name <span class="s2">&quot;*.c&quot;</span><span class="sb">`</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="nv">$file</span>
</span><span class='line'>  enca -L zh_CN -x UTF-8 <span class="nv">$file</span>
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/26/add-vlan-to-existing-machine/">Add Vlan to Existing Machine</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-26T13:51:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>1:51 pm</span></time>
        
         | <a href="/blog/2013/11/26/add-vlan-to-existing-machine/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>增加一个VLAN设备：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ip link add link eth0 name eth0.100 type vlan id 100
</span></code></pre></td></tr></table></div></figure>


<p>查看增加的VLAN设备详情：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ip -d link show eth0.100
</span></code></pre></td></tr></table></div></figure>


<p>增加一个IPV4地址：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ip addr add 192.168.100.1/24 brd 192.168.100.255 dev eth0.100
</span><span class='line'>$ ip link set dev eth0.100 up
</span></code></pre></td></tr></table></div></figure>


<p>关闭一个VLAN设备：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ip link set dev eth0.100 down
</span></code></pre></td></tr></table></div></figure>


<p>移除一个VLAN设备:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ip link delete eth0.100
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/25/how-to-setup-stm32-project-in-eclipse/">How to Setup STM32 Project in Eclipse</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-25T15:27:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>3:27 pm</span></time>
        
         | <a href="/blog/2013/11/25/how-to-setup-stm32-project-in-eclipse/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Preparation</h3>

<h4>STM Standard Peripheral Lib</h4>

<p>Download Link for STSW-STM32054STM32F10x standard peripheral library :    <br/>
<a href="http://www.st.com/web/catalog/tools/FM147/CL1794/SC961/SS1743/PF257890">http://www.st.com/web/catalog/tools/FM147/CL1794/SC961/SS1743/PF257890</a>  <br/>
Unsip the downloaded library and you will get several folders, the Libraries folder is the pure libs.</p>

<h4>Cross-Compiler for STM32</h4>

<p>Download the cross-compiler from CodeSourcery ARM EABI toolchain - Mentor Graphics:  <br/>
<a href="https://sourcery.mentor.com/sgpp/lite/arm/portal/subscription?@template=lite">https://sourcery.mentor.com/sgpp/lite/arm/portal/subscription?@template=lite</a>  <br/>
You have to choose EABI version. Download and install it, you will get &ldquo;arm-none-eabi-&rdquo; prefixed cross-compiler.</p>

<h4>Eclipse plugins</h4>

<p>Help-> Install New Software, Add the URL for gnuarm:   <br/>
<a href="http://gnuarmeclipse.sourceforge.net/updates">http://gnuarmeclipse.sourceforge.net/updates</a>   <br/>
Then Install CDT GNU Cross Development Tools , after install the plugin, you will asked to reboot, just reboot. Now your preparation is OK.</p>

<h3>Create a new project</h3>

<p> In Eclipse, Click File->New->C project, choose &ldquo;ARM Cross Target Applcation (End of life)&rdquo;, choose &ldquo;Empty Project&rdquo; &ldquo;ARM Linux GCC(Sourcery Lite Bare), give the Project name and click Next Button, then click Finish. you will see the newly created project in the Project Explorer.</p>

<p>   <img src="/images/eclipse1.jpg" alt="eclipse1.jpg" /></p>

<p>Copy the Library files into your own project, take &ldquo;stmExample&rdquo; project for example:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@DashArch STM32F10x_StdPeriph_Lib_V3.5.0]$ pwd
</span><span class='line'>/media/y/embedded/stm32/dev/lib/STM32F10x_StdPeriph_Lib_V3.5.0
</span><span class='line'>[Trusty@DashArch STM32F10x_StdPeriph_Lib_V3.5.0]$ cp -r  Libraries/ ~/workspace/stmExample/    
</span></code></pre></td></tr></table></div></figure>


<p>Your project should seem like this:</p>

<p>   <img src="/images/eclipse2.jpg" alt="eclipse2.jpg" /></p>

<p>Now you have to prepare your startup file, notice you have to use &ldquo;S&rdquo; suffixed file name, and you have to remove the remaining directory except the .S file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@DashArch startup]$ pwd
</span><span class='line'>/home/Trusty/workspace/stmExample/Libraries/CMSIS/CM3/DeviceSupport/ST/STM32F10x/startup
</span><span class='line'>[Trusty@DashArch startup]$ ls
</span><span class='line'>arm  gcc_ride7  iar  TrueSTUDIO
</span><span class='line'>[Trusty@DashArch startup]$ cp TrueSTUDIO/startup_stm32f10x_hd.s ./startup_stm32f10x_hd.S
</span><span class='line'>[Trusty@DashArch startup]$ ls
</span><span class='line'>arm  gcc_ride7  iar  startup_stm32f10x_hd.S  TrueSTUDIO
</span><span class='line'>[Trusty@DashArch startup]$ rm -rf TrueSTUDIO/ iar/ gcc_ride7/ arm/
</span><span class='line'>[Trusty@DashArch startup]$ ls
</span><span class='line'>startup_stm32f10x_hd.S
</span></code></pre></td></tr></table></div></figure>


<p>Create a directory named src to contains your own project files.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@DashArch stmExample]$ mkdir src
</span><span class='line'>[Trusty@DashArch stmExample]$ pwd
</span><span class='line'>/home/Trusty/workspace/stmExample
</span><span class='line'>[Trusty@DashArch stmExample]$ ls
</span><span class='line'>Libraries  src
</span></code></pre></td></tr></table></div></figure>


<p>Copy the project files into &ldquo;src&rdquo; directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@DashArch STM32F10x_StdPeriph_Template]$ ls
</span><span class='line'>EWARM  HiTOP  main.c  MDK-ARM  Release_Notes.html  RIDE  stm32f10x_conf.h  stm32f10x_it.c  stm32f10x_it.h  system_stm32f10x.c  TrueSTUDIO
</span><span class='line'>[Trusty@DashArch STM32F10x_StdPeriph_Template]$ cp stm32f10x_* ~/workspace/stmExample/src/
</span><span class='line'>[Trusty@DashArch STM32F10x_StdPeriph_Template]$ pwd
</span><span class='line'>/media/y/embedded/stm32/dev/lib/STM32F10x_StdPeriph_Lib_V3.5.0/Project/STM32F10x_StdPeriph_Template
</span><span class='line'>Copy the link script to root directory of your project:
</span><span class='line'>[Trusty@DashArch STM32100B-EVAL]$ pwd
</span><span class='line'>/media/y/embedded/stm32/dev/lib/STM32F10x_StdPeriph_Lib_V3.5.0/Project/STM32F10x_StdPeriph_Template/TrueSTUDIO/STM32100B-EVAL
</span><span class='line'>[Trusty@DashArch STM32100B-EVAL]$ cp stm32_flash.ld  ~/workspace/stmExample/
</span></code></pre></td></tr></table></div></figure>


<p>You have to modify the link script according to your own flash layout and memory layout, My CPU is STM32F103VC, which has 48K RAM and 256K Flash, so the configuration is listed as:</p>

<figure class='code'><figcaption><span>stm32_flash.ld</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>/*
</span><span class='line'>Linker subscript <span class="k">for</span> STM32F051 definitions with 64K Flash and 8K RAM
</span><span class='line'>Copyright RAISONANCE 2007
</span><span class='line'>!!! This file is automatically generated by RIDE !!!
</span><span class='line'>Do not modify it, as it will be erased at every link.
</span><span class='line'>You can use, copy and distribute this file freely, but without any warranty.
</span><span class='line'>*/
</span><span class='line'>
</span><span class='line'>/* Memory Spaces Definitions */
</span><span class='line'>
</span><span class='line'>ENTRY<span class="o">(</span>Reset_Handler<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>MEMORY
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  FLASH <span class="o">(</span>rx<span class="o">)</span> : <span class="nv">ORIGIN</span> <span class="o">=</span> 0x08000000, <span class="nv">LENGTH</span> <span class="o">=</span> 256K
</span><span class='line'>  RAM  <span class="o">(</span>xrw<span class="o">)</span> : <span class="nv">ORIGIN</span> <span class="o">=</span> 0x20000000, <span class="nv">LENGTH</span> <span class="o">=</span> 48K
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>/* highest address of the user mode stack */
</span><span class='line'><span class="nv">_estack</span> <span class="o">=</span> 0x2000c000<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>/*
</span><span class='line'>Common part of the linker scripts <span class="k">for</span> STR71x devices in FLASH mode
</span><span class='line'><span class="o">(</span>that is, the FLASH is seen at 0<span class="o">)</span>
</span><span class='line'>Copyright RAISONANCE 2005
</span><span class='line'>You can use, modify and distribute this file freely, but without any warranty.
</span><span class='line'>*/
</span><span class='line'>
</span><span class='line'>/* Sections Definitions */
</span><span class='line'>
</span><span class='line'>SECTIONS
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    /* <span class="k">for</span> Cortex devices, the beginning of the startup code is stored in the .isr_vector section, which goes to FLASH */
</span><span class='line'>    .isr_vector :
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>  . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span><span class="p">;</span>
</span><span class='line'>        KEEP<span class="o">(</span>*<span class="o">(</span>.isr_vector<span class="o">))</span>            /* Startup code */
</span><span class='line'>  . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span> &gt;FLASH
</span><span class='line'>
</span><span class='line'>    /* the program code is stored in the .text section, which goes to Flash */
</span><span class='line'>    .text :
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>      . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>        *<span class="o">(</span>.text<span class="o">)</span>                   /* normal code */
</span><span class='line'>        *<span class="o">(</span>.text.*<span class="o">)</span>                 /* -ffunction-sections code */
</span><span class='line'>        *<span class="o">(</span>.rodata<span class="o">)</span>                 /* <span class="nb">read</span>-only data <span class="o">(</span>constants<span class="o">)</span> */
</span><span class='line'>        *<span class="o">(</span>.rodata*<span class="o">)</span>                /* -fdata-sections <span class="nb">read </span>only data */
</span><span class='line'>        *<span class="o">(</span>.glue_7<span class="o">)</span>                 /* TBD - needed ? */
</span><span class='line'>        *<span class="o">(</span>.glue_7t<span class="o">)</span>                /* TBD - needed ? */
</span><span class='line'>
</span><span class='line'>  /* Necessary KEEP sections <span class="o">(</span>see http://sourceware.org/ml/newlib/2005/msg00255.html<span class="o">)</span> */
</span><span class='line'>  KEEP <span class="o">(</span>*<span class="o">(</span>.init<span class="o">))</span>
</span><span class='line'>  KEEP <span class="o">(</span>*<span class="o">(</span>.fini<span class="o">))</span>
</span><span class='line'>  
</span><span class='line'>      . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">_etext</span> <span class="o">=</span> .<span class="p">;</span>
</span><span class='line'>      /* This is used by the startup in order to initialize the .data section */
</span><span class='line'>        <span class="nv">_sidata</span> <span class="o">=</span> _etext<span class="p">;</span>
</span><span class='line'>    <span class="o">}</span> &gt;FLASH
</span><span class='line'>
</span><span class='line'>    /* This is the initialized data section
</span><span class='line'>    The program executes knowing that the data is in the RAM
</span><span class='line'>    but the loader puts the initial values in the FLASH <span class="o">(</span>inidata<span class="o">)</span>.
</span><span class='line'>    It is one task of the startup to copy the initial values from FLASH to RAM. */
</span><span class='line'>    .data  : AT <span class="o">(</span> _sidata <span class="o">)</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>      . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span><span class="p">;</span>
</span><span class='line'>        /* This is used by the startup in order to initialize the .data secion */
</span><span class='line'>        <span class="nv">_sdata</span> <span class="o">=</span> . <span class="p">;</span>
</span><span class='line'>        <span class="nv">_data</span> <span class="o">=</span> . <span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        *<span class="o">(</span>.data<span class="o">)</span>
</span><span class='line'>        *<span class="o">(</span>.data.*<span class="o">)</span>
</span><span class='line'>        *<span class="o">(</span>.RAMtext<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>      . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span><span class="p">;</span>
</span><span class='line'>      /* This is used by the startup in order to initialize the .data secion */
</span><span class='line'>          <span class="nv">_edata</span> <span class="o">=</span> . <span class="p">;</span>
</span><span class='line'>    <span class="o">}</span> &gt;RAM
</span><span class='line'>
</span><span class='line'>    /* This is the uninitialized data section */
</span><span class='line'>    .bss :
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>      . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span><span class="p">;</span>
</span><span class='line'>        /* This is used by the startup in order to initialize the .bss secion */
</span><span class='line'>        <span class="nv">_sbss</span> <span class="o">=</span> .<span class="p">;</span>
</span><span class='line'>        <span class="nv">_bss</span> <span class="o">=</span> .<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        *<span class="o">(</span>.bss<span class="o">)</span>
</span><span class='line'>        *<span class="o">(</span>.bss.*<span class="o">)</span> /* patched by elias - allows the use of -fdata-sections */
</span><span class='line'>        *<span class="o">(</span>COMMON<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>      . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span><span class="p">;</span>
</span><span class='line'>      /* This is used by the startup in order to initialize the .bss secion */
</span><span class='line'>       <span class="nv">_ebss</span> <span class="o">=</span> . <span class="p">;</span>
</span><span class='line'>    <span class="o">}</span> &gt;RAM
</span><span class='line'>
</span><span class='line'>    PROVIDE <span class="o">(</span> <span class="nv">end</span> <span class="o">=</span> _ebss <span class="o">)</span><span class="p">;</span>
</span><span class='line'>    PROVIDE <span class="o">(</span> <span class="nv">_end</span> <span class="o">=</span> _ebss <span class="o">)</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">__exidx_start</span> <span class="o">=</span> .<span class="p">;</span>
</span><span class='line'>    <span class="nv">__exidx_end</span> <span class="o">=</span> .<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    /* after that it<span class="err">&#39;</span>s only debugging information. */
</span><span class='line'>
</span><span class='line'>    /* remove the debugging information from the standard libraries */
</span><span class='line'>    /DISCARD/ :
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>     libc.a <span class="o">(</span> * <span class="o">)</span>
</span><span class='line'>     libm.a <span class="o">(</span> * <span class="o">)</span>
</span><span class='line'>     libgcc.a <span class="o">(</span> * <span class="o">)</span>
</span><span class='line'>     <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    /* Stabs debugging sections.  */
</span><span class='line'>    .stab          <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.stab<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .stabstr       <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.stabstr<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .stab.excl     <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.stab.excl<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .stab.exclstr  <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.stab.exclstr<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .stab.index    <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.stab.index<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .stab.indexstr <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.stab.indexstr<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .comment       <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.comment<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    /* DWARF debug sections.
</span><span class='line'>       Symbols in the DWARF debugging sections are relative to the beginning
</span><span class='line'>       of the section so we begin them at 0.  */
</span><span class='line'>    /* DWARF <span class="m">1</span> */
</span><span class='line'>    .debug          <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .line           <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.line<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    /* GNU DWARF <span class="m">1</span> extensions */
</span><span class='line'>    .debug_srcinfo  <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_srcinfo<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_sfnames  <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_sfnames<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    /* DWARF 1.1 and DWARF <span class="m">2</span> */
</span><span class='line'>    .debug_aranges  <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_aranges<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_pubnames <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_pubnames<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    /* DWARF <span class="m">2</span> */
</span><span class='line'>    .debug_info     <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_info .gnu.linkonce.wi.*<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_abbrev   <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_abbrev<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_line     <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_line<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_frame    <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_frame<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_str      <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_str<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_loc      <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_loc<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_macinfo  <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_macinfo<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    /* SGI/MIPS DWARF <span class="m">2</span> extensions */
</span><span class='line'>    .debug_weaknames <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_weaknames<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_funcnames <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_funcnames<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_typenames <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_typenames<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_varnames  <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_varnames<span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now create a sample main.c under the src directory and input your source code.</p>

<h3>Configure the project</h3>

<p>Right click your project, select Properties, C/C++ Build -> Settings, ARM Linux GCC Assembler(Sourcery Lite Bare)/Preprocessor, add a Defined symbols(-D), also you have to add this into ARM Linux GCC Compiler(Sourcery Lite Bare):</p>

<figure class='code'><figcaption><span>stm32_flash.ld</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>STM32F10X_HD
</span><span class='line'>USE_STDPERIPH_DRIVER
</span></code></pre></td></tr></table></div></figure>


<p>In ARM Linux GCC C Compiler(Sourcery Lite Bare)-> Directories, add Include paths(-i) add following:</p>

<p>   <img src="/images/eclipse3.jpg" alt="eclipse3.jpg" /></p>

<p>Specify the link script:   <br/>
ARM Linux GCC CLinker(Sourcery Lite Bare) -> General, Script file(-T)
    /home/Trusty/workspace/stm32archlinux/stm32_flash.ld</p>

<h3>Build and Debug</h3>

<p>Right click the project and click &ldquo;Build project&rdquo;, then you got your project compiling and linking, finally you got your Binary named stmExample.elf.   <br/>
Now we can use OpenOCD for writing the image into the flash and debugging it.</p>

<p>Run->Debug Configuration, you will see Zylin Embedded debug(Native) is available, right click and choose &ldquo;Create new&rdquo;, create a new debug item.   <br/>
Choose the Main:</p>

<p>   <img src="/images/eclipse4.jpg" alt="eclipse4.jpg" /></p>

<p>Choose the Debugger:</p>

<p>   <img src="/images/eclipse5.jpg" alt="eclipse5.jpg" /></p>

<p>Choose Commands:</p>

<p>   <img src="/images/eclipse6.jpg" alt="eclipse6.jpg" /></p>

<p>The configuration file is :</p>

<figure class='code'><figcaption><span>stm32_flash.ld</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>target remote localhost:3333
</span><span class='line'>monitor reset
</span><span class='line'>monitor halt
</span><span class='line'>monitor flash protect <span class="m">0</span> <span class="m">0</span> <span class="m">11</span> off
</span><span class='line'>monitor flash write_image erase /home/Trusty/workspace/stm32archlinux/Debug/stm32archlinux.hex <span class="m">0</span> ihex
</span><span class='line'>disconnect
</span><span class='line'>target remote localhost:3333
</span><span class='line'>monitor reset
</span><span class='line'>monitor halt
</span></code></pre></td></tr></table></div></figure>


<p>Open your own openocd, and then using eclipse to connect the gdb. Remember &ldquo;toggle breakpoint&rdquo; and you will get a hardware breakpoint. Enjoy the debugging.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/25/solution-on-joggler/">Solution on Joggler</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-25T09:30:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>9:30 am</span></time>
        
         | <a href="/blog/2013/11/25/solution-on-joggler/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Hardware</h3>

<p>Joggler   <br/>
Intel&reg; Atom&trade; CPU Z520   @ 1.33GHz  Dual Core  <br/>
MemTotal:         504480 kB   <br/>
Harddisk: 500G External USB.</p>

<h3>System and Software</h3>

<p>Download the Ubuntu Base/Server 12.04 LTS (Precise) (Joggler Image v1.4 - 09/04/2013) from the   <br/>
<a href="http://joggler.exotica.org.uk/ubuntu/">http://joggler.exotica.org.uk/ubuntu/</a>
From the ubuntu website we know 12.04 LTS will supported to 2017, I think that fits my needs.   <br/>
Unzip the download image:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gunzip ubuntu_base_12.04-v1.4-ext4.img.gz
</span><span class='line'>dd if=./ubuntu_base_12.04-v1.4-ext4.img of=/dev/sdc bs=1M
</span></code></pre></td></tr></table></div></figure>


<p>The use this external usb disk for booting up the joggler. After joggler has been booted up, install coresponding packages.</p>

<h3>Prevent Hard disk from hiberating</h3>

<p>Add following lines to crontab -e</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>*/4 * * * * fdisk -l /dev/uba&gt;/dev/null && echo abc&gt;/root/done.txt
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/22/openocd-configuration/">openOCD Configuration</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-22T20:37:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2013</span></span> <span class='time'>8:37 pm</span></time>
        
         | <a href="/blog/2013/11/22/openocd-configuration/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>OpenOCD Device Scan</h3>

<p>Install and view the OpenOCD:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pacman -S openocd
</span><span class='line'>[Trusty@XXXyyy debian_octopress]$ openocd -v
</span><span class='line'>Open On-Chip Debugger 0.7.0 (2013-11-02-01:53)
</span><span class='line'>Licensed under GNU GPL v2
</span><span class='line'>For bug reports, read
</span><span class='line'>  http://openocd.sourceforge.net/doc/doxygen/bugs.html
</span></code></pre></td></tr></table></div></figure>


<p>Insert your openJTAG debug board, and view its connection:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@XXXyyy debian_octopress]$ lsusb
</span><span class='line'>Bus 001 Device 016: ID 1457:5118 First International Computer, Inc. OpenMoko Neo1973 Debug board (V2+)
</span></code></pre></td></tr></table></div></figure>


<p>From the dmesg information:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[15767.673553] usb 1-1: new full-speed USB device number 11 using xhci_hcd
</span><span class='line'>[15767.695990] usb 1-1: Device not responding to set address.
</span><span class='line'>[15767.938262] usb 1-1: Device not responding to set address.
</span><span class='line'>[15768.140725] usb 1-1: device not accepting address 11, error -71
</span><span class='line'>[15768.421057] usb 1-1: new full-speed USB device number 13 using xhci_hcd
</span><span class='line'>[15769.015800] usbcore: registered new interface driver usbserial
</span><span class='line'>[15769.016012] usbcore: registered new interface driver usbserial_generic
</span><span class='line'>[15769.016075] usbserial: USB Serial support registered for generic
</span><span class='line'>[15769.020028] usbcore: registered new interface driver ftdi_sio
</span><span class='line'>[15769.020050] usbserial: USB Serial support registered for FTDI USB Serial Device
</span><span class='line'>[15769.020458] usb 1-1: Ignoring serial port reserved for JTAG
</span><span class='line'>[15769.020499] ftdi_sio 1-1:1.1: FTDI USB Serial Device converter detected
</span><span class='line'>[15769.020544] usb 1-1: Detected FT2232C
</span><span class='line'>[15769.020548] usb 1-1: Number of endpoints 2
</span><span class='line'>[15769.020550] usb 1-1: Endpoint 1 MaxPacketSize 64
</span><span class='line'>[15769.020553] usb 1-1: Endpoint 2 MaxPacketSize 64
</span><span class='line'>[15769.020555] usb 1-1: Setting MaxPacketSize 64
</span><span class='line'>[15769.026647] usb 1-1: FTDI USB Serial Device converter now attached to ttyUSB0
</span><span class='line'>[15975.012193] usb 1-1: USB disconnect, device number 13
</span><span class='line'>[15975.012449] ftdi_sio ttyUSB0: FTDI USB Serial Device converter now disconnected from ttyUSB0
</span><span class='line'>[15975.012465] ftdi_sio 1-1:1.1: device disconnected
</span><span class='line'>[15975.270658] usb 1-1: new full-speed USB device number 14 using xhci_hcd
</span><span class='line'>[15975.355869] usb 1-1: Ignoring serial port reserved for JTAG
</span><span class='line'>[15975.366867] ftdi_sio 1-1:1.1: FTDI USB Serial Device converter detected
</span><span class='line'>[15975.366902] usb 1-1: Detected FT2232C
</span><span class='line'>[15975.366904] usb 1-1: Number of endpoints 2
</span><span class='line'>[15975.366906] usb 1-1: Endpoint 1 MaxPacketSize 64
</span><span class='line'>[15975.366908] usb 1-1: Endpoint 2 MaxPacketSize 64
</span><span class='line'>[15975.366909] usb 1-1: Setting MaxPacketSize 64
</span><span class='line'>[15975.371933] usb 1-1: FTDI USB Serial Device converter now attached to ttyUSB0
</span><span class='line'>[16608.914153] usb 1-1: USB disconnect, device number 14
</span><span class='line'>[16608.914371] ftdi_sio ttyUSB0: FTDI USB Serial Device converter now disconnected from ttyUSB0
</span><span class='line'>[16608.914402] ftdi_sio 1-1:1.1: device disconnected
</span><span class='line'>[16609.394763] usb 1-1: new full-speed USB device number 15 using xhci_hcd
</span><span class='line'>[16609.395097] usb 1-1: Device not responding to set address.
</span><span class='line'>[16609.598734] usb 1-1: Device not responding to set address.
</span><span class='line'>[16609.801899] usb 1-1: device not accepting address 15, error -71
</span><span class='line'>[16609.962045] usb 1-1: new full-speed USB device number 16 using xhci_hcd
</span><span class='line'>[16609.962371] usb 1-1: Device not responding to set address.
</span><span class='line'>[16610.250376] usb 1-1: Ignoring serial port reserved for JTAG
</span><span class='line'>[16610.261380] ftdi_sio 1-1:1.1: FTDI USB Serial Device converter detected
</span><span class='line'>[16610.261428] usb 1-1: Detected FT2232C
</span><span class='line'>[16610.261431] usb 1-1: Number of endpoints 2
</span><span class='line'>[16610.261433] usb 1-1: Endpoint 1 MaxPacketSize 64
</span><span class='line'>[16610.261435] usb 1-1: Endpoint 2 MaxPacketSize 64
</span><span class='line'>[16610.261437] usb 1-1: Setting MaxPacketSize 64
</span><span class='line'>[16610.266397] usb 1-1: FTDI USB Serial Device converter now attached to ttyUSB0
</span></code></pre></td></tr></table></div></figure>


<p>From the above information we could know, Now we have a new Serial port named ttyUSB0, and also a FT2232C debug port. Currently we don&rsquo;t use Serial Port, FT2232 is all we want to configure.</p>

<h3>OpenOCD Configuration</h3>

<p>We have to make a cfg file for OpenOCD to use. There are some pre-defined configuration files for us to refer under the directory of &ldquo;/usr/share/openocd/scripts/&rdquo;, since we know the debug board information and we know exactly the development board info, we can easily write our own OpenOCD startup scripts. <br/>
Get the interface definition via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@XXXyyy interface]$ pwd
</span><span class='line'>/usr/share/openocd/scripts/interface
</span><span class='line'>[Trusty@XXXyyy interface]$ grep "1457" ./ -r
</span><span class='line'>./neodb.cfg:ft2232_vid_pid 0x1457 0x5118
</span><span class='line'>./ftdi/neodb.cfg:ftdi_vid_pid 0x1457 0x5118
</span></code></pre></td></tr></table></div></figure>


<p>So we directly copy the neodb.cfg to our openocd.cfg under our home directory. But the usb name of our OpenOCD is changed,</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ft2232_device_desc "USB&lt;=&gt;JTAG&RS232
</span></code></pre></td></tr></table></div></figure>


<p>The definition is taken from the output of &ldquo;lsusb -v -d 1457:5118&rdquo;</p>

<p>We also want to define the port for telnet and gdb connection</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#########daemon configuration####
</span><span class='line'>telnet_port 4444
</span><span class='line'>gdb_port 3333
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>The Target configuration is taken from the /usr/share/openocd/scripts/target/stm32f1x.cfg, which is the definition of the stm32f1x. Copy them directly to your own config file.</p>

<p>Finally your configuration file should be listed as:</p>

<figure class='code'><figcaption><span>openocd.cfg</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
</pre></td><td class='code'><pre><code class='linux-config'><span class='line'><span class="c1">#########daemon configuration####</span>
</span><span class='line'>telnet_port <span class="mi">4444</span>
</span><span class='line'>gdb_port <span class="mi">3333</span>
</span><span class='line'>
</span><span class='line'><span class="c1">########Interface Info###########</span>
</span><span class='line'><span class="c1">################################################</span>
</span><span class='line'><span class="c1"># Since our board takes the same vid_pid</span>
</span><span class='line'><span class="c1"># We directly use openmoko&#39;s definition.</span>
</span><span class='line'><span class="c1">################################################</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># Openmoko USB JTAG/RS232 adapter</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># http://wiki.openmoko.org/wiki/Debug_Board_v3</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'>interface ft2232
</span><span class='line'>ft2232_device_desc <span class="s2">&quot;USB&lt;=&gt;JTAG&amp;RS232&quot;</span>
</span><span class='line'>ft2232_layout jtagkey
</span><span class='line'>ft2232_vid_pid <span class="mi">0</span>x1457 <span class="mi">0</span>x5118
</span><span class='line'>
</span><span class='line'><span class="c1">########Board Info###########</span>
</span><span class='line'><span class="c1"># Adjust Work-area size (RAM size) according to MCU in use:</span>
</span><span class='line'><span class="c1">#STM32F103VC --&gt; 48KB</span>
</span><span class='line'><span class="c1">#STM32F103RB --&gt; 20KB</span>
</span><span class='line'><span class="c1">#set WORKAREASIZE 0x5000</span>
</span><span class='line'><span class="c1"># STM32F103RE --&gt; 64KB</span>
</span><span class='line'><span class="c1"># set WORKAREASIZE 0x10000</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># reset_config parameter (see OpenOCD manual):</span>
</span><span class='line'><span class="c1"># none --&gt; srst and trst of MCU not connected to JTAG device</span>
</span><span class='line'><span class="c1"># srst_only --&gt; only srst of MCU connected to JTAG device</span>
</span><span class='line'><span class="c1"># trst_only --&gt; only trst of MCU connected to JTAG device</span>
</span><span class='line'><span class="c1"># srst_and_trst --&gt; srst and trst of MCU connected to JTAG device</span>
</span><span class='line'><span class="c1"># default setting: &quot;reset_config none&quot; will produce a single reset via SYSRESETREQ (JTAG commands) at reset pin of MCU</span>
</span><span class='line'><span class="c1">#reset_config none</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">#script for stm32f1x family</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> { [info exists CHIPNAME] } {
</span><span class='line'>   set _CHIPNAME $CHIPNAME
</span><span class='line'>} else {
</span><span class='line'>   set _CHIPNAME stm32f1x
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'><span class="k">if</span> { [info exists ENDIAN] } {
</span><span class='line'>   set _ENDIAN $ENDIAN
</span><span class='line'>} else {
</span><span class='line'>   set _ENDIAN little
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'><span class="c1"># Work-area is a space in RAM used for flash programming</span>
</span><span class='line'><span class="c1"># By default use 16kB</span>
</span><span class='line'><span class="k">if</span> { [info exists WORKAREASIZE] } {
</span><span class='line'>   set _WORKAREASIZE $WORKAREASIZE
</span><span class='line'>} else {
</span><span class='line'>   set _WORKAREASIZE <span class="mi">0</span>x4000
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'><span class="c1"># JTAG speed should be &lt;= F_CPU/6. F_CPU after reset is 8MHz, so use F_JTAG = 1MHz</span>
</span><span class='line'>adapter_khz <span class="mi">1000</span>
</span><span class='line'>
</span><span class='line'>adapter_nsrst_delay <span class="mi">100</span>
</span><span class='line'>jtag_ntrst_delay <span class="mi">100</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#jtag scan chain</span>
</span><span class='line'><span class="k">if</span> { [info exists CPUTAPID] } {
</span><span class='line'>   set _CPUTAPID $CPUTAPID
</span><span class='line'>} else {
</span><span class='line'>  <span class="c1"># See STM Document RM0008</span>
</span><span class='line'>  <span class="c1"># Section 26.6.3</span>
</span><span class='line'>   set _CPUTAPID <span class="mi">0</span>x3ba00477
</span><span class='line'>}
</span><span class='line'>jtag newtap $_CHIPNAME cpu -irlen <span class="mi">4</span> -ircapture <span class="mi">0</span>x1 -irmask <span class="mi">0</span>xf -expected-id $_CPUTAPID
</span><span class='line'>
</span><span class='line'><span class="k">if</span> { [info exists BSTAPID] } {
</span><span class='line'>   <span class="c1"># FIXME this never gets used to override defaults...</span>
</span><span class='line'>   set _BSTAPID $BSTAPID
</span><span class='line'>} else {
</span><span class='line'>  <span class="c1"># See STM Document RM0008</span>
</span><span class='line'>  <span class="c1"># Section 29.6.2</span>
</span><span class='line'>  <span class="c1"># Low density devices, Rev A</span>
</span><span class='line'>  set _BSTAPID1 <span class="mi">0</span>x06412041
</span><span class='line'>  <span class="c1"># Medium density devices, Rev A</span>
</span><span class='line'>  set _BSTAPID2 <span class="mi">0</span>x06410041
</span><span class='line'>  <span class="c1"># Medium density devices, Rev B and Rev Z</span>
</span><span class='line'>  set _BSTAPID3 <span class="mi">0</span>x16410041
</span><span class='line'>  set _BSTAPID4 <span class="mi">0</span>x06420041
</span><span class='line'>  <span class="c1"># High density devices, Rev A</span>
</span><span class='line'>  set _BSTAPID5 <span class="mi">0</span>x06414041
</span><span class='line'>  <span class="c1"># Connectivity line devices, Rev A and Rev Z</span>
</span><span class='line'>  set _BSTAPID6 <span class="mi">0</span>x06418041
</span><span class='line'>  <span class="c1"># XL line devices, Rev A</span>
</span><span class='line'>  set _BSTAPID7 <span class="mi">0</span>x06430041
</span><span class='line'>  <span class="c1"># VL line devices, Rev A and Z In medium-density and high-density value line devices</span>
</span><span class='line'>  set _BSTAPID8 <span class="mi">0</span>x06420041
</span><span class='line'>  <span class="c1"># VL line devices, Rev A</span>
</span><span class='line'>  set _BSTAPID9 <span class="mi">0</span>x06428041
</span><span class='line'>
</span><span class='line'>}
</span><span class='line'>jtag newtap $_CHIPNAME bs -irlen <span class="mi">5</span> -expected-id $_BSTAPID1 \
</span><span class='line'>  -expected-id $_BSTAPID2 -expected-id $_BSTAPID3 \
</span><span class='line'>  -expected-id $_BSTAPID4 -expected-id $_BSTAPID5 \
</span><span class='line'>  -expected-id $_BSTAPID6 -expected-id $_BSTAPID7 \
</span><span class='line'>  -expected-id $_BSTAPID8 -expected-id $_BSTAPID9
</span><span class='line'>
</span><span class='line'>set _TARGETNAME $_CHIPNAME.cpu
</span><span class='line'>target create $_TARGETNAME cortex_m -endian $_ENDIAN -chain-position $_TARGETNAME
</span><span class='line'>
</span><span class='line'>$_TARGETNAME configure -work-area-phys <span class="mi">0</span>x20000000 -work-area-size $_WORKAREASIZE -work-area-backup <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># flash size will be probed</span>
</span><span class='line'>set _FLASHNAME $_CHIPNAME.flash
</span><span class='line'>flash bank $_FLASHNAME stm32f1x <span class="mi">0</span>x08000000 <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> $_TARGETNAME
</span><span class='line'>
</span><span class='line'><span class="c1"># if srst is not fitted use SYSRESETREQ to</span>
</span><span class='line'><span class="c1"># perform a soft reset</span>
</span><span class='line'>cortex_m reset_config sysresetreq
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>openocd.cfg</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='linux-config'><span class='line'>[root@XXXyyy target]# openocd -f /media/y/embedded/stm32/dev/openocd.cfg -f ./stm32f1x.cfg
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/22/conky-customization/">Conky Customization</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-22T15:08:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2013</span></span> <span class='time'>3:08 pm</span></time>
        
         | <a href="/blog/2013/11/22/conky-customization/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Add existing user to specified group</h3>

<p>The problem is : why I can&rsquo;t use hddtemp? This is because hddtemp need priviledge for accessing the disk related equipment.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@XXXyyy ~]$ whoami
</span><span class='line'>Trusty
</span><span class='line'>[Trusty@XXXyyy ~]$ groups
</span><span class='line'>root log kvm users vboxusers
</span><span class='line'>[Trusty@XXXyyy ~]$ su root
</span><span class='line'>Password: 
</span><span class='line'>[root@XXXyyy Trusty]# groups
</span><span class='line'>root bin daemon sys adm disk wheel log
</span></code></pre></td></tr></table></div></figure>


<p>But this didn&rsquo;t solve the problem, I have to add prividge in /etc/sudoes,</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># visudo
</span><span class='line'>Trusty ALL = NOPASSWD: /usr/bin/hddtemp
</span></code></pre></td></tr></table></div></figure>


<p>Therefore in the configuration file of conky I need to replace the hddtemp with &ldquo;sudo hddtemp&rdquo;, everything will be displayed.</p>

<h3>Now testing the Conky</h3>

<p>After you have installed conky, the first thing for you to do is to edit its configuration file, to decide what to display on your own widget, my configuration file is listed as following:</p>

<figure class='code'><figcaption><span>conkyrc.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>alignment top_right
</span><span class='line'>background yes
</span><span class='line'>border_width 1
</span><span class='line'>cpu_avg_samples 2
</span><span class='line'>default_color black
</span><span class='line'>default_outline_color blue
</span><span class='line'>default_shade_color blue
</span><span class='line'>draw_borders no
</span><span class='line'>draw_graph_borders yes
</span><span class='line'>draw_outline no
</span><span class='line'>draw_shades no
</span><span class='line'>use_xft yes
</span><span class='line'>xftfont AR PL KaitiM GB:size=12
</span><span class='line'>gap_x 5
</span><span class='line'>gap_y 30
</span><span class='line'>minimum_size 280 5
</span><span class='line'>net_avg_samples 2
</span><span class='line'>no_buffers yes
</span><span class='line'>out_to_console no
</span><span class='line'>out_to_stderr no
</span><span class='line'>extra_newline no
</span><span class='line'>own_window yes
</span><span class='line'>own_window_class Conky
</span><span class='line'>own_window_type override
</span><span class='line'>##设置conky的默认背景色
</span><span class='line'>##own_window_colour 573049
</span><span class='line'>##很重要，只有启用argb才能透明，但是如果窗口属性如果设置为override，可能无法生效
</span><span class='line'>#own_window_argb_visual yes
</span><span class='line'>##设置透明的alpha值0-255，0为透明，255不透明
</span><span class='line'>#own_window_argb_value 0
</span><span class='line'>##own_window_argb_visual true
</span><span class='line'>##own_window_argb_value 120
</span><span class='line'>own_window_transparent yes
</span><span class='line'>double_buffer yes
</span><span class='line'>stippled_borders 0
</span><span class='line'>update_interval 1
</span><span class='line'>uppercase no
</span><span class='line'>use_spacer none
</span><span class='line'>show_graph_scale no
</span><span class='line'>show_graph_range no
</span><span class='line'>
</span><span class='line'>TEXT
</span><span class='line'>#${color red}${font AR PL KaitiM GB:style=Blod:size=17}    ${time %Y.%m.%d %H:%M:%S}
</span><span class='line'>#${font AR PL KaitiM GB:style=Blod:size=12}
</span><span class='line'>#${font AR PL KaitiM GB:style=Blod:size=12}${scroll 16 $nodename - $sysname $kernel on $machine}
</span><span class='line'>#$hr
</span><span class='line'>#${font AR PL KaitiM GB:style=Blod:size=14}${color green}${exec cal}
</span><span class='line'>#$hr
</span><span class='line'>${font AR PL KaitiM GB:style=Blod:size=12}${color purple}Uptime:$color $uptime
</span><span class='line'>${color purple}Frequency (in MHz):$color $freq
</span><span class='line'>#${color purple}Frequency (in GHz):$color $freq_g
</span><span class='line'>${color purple}RAM: $color$mem/$memmax - $memperc% ${membar 4}
</span><span class='line'>${color purple}Swap: $color$swap/$swapmax - $swapperc% ${swapbar 4}
</span><span class='line'>${color purple}CPU1: $color${cpu cpu1}% ${cpubar 4}
</span><span class='line'>${color purple}CPU2: $color${cpu cpu2}% ${cpubar 4}
</span><span class='line'>${color purple}CPU3: $color${cpu cpu3}% ${cpubar 4}
</span><span class='line'>${color purple}CPU4: $color${cpu cpu4}% ${cpubar 4}
</span><span class='line'>${color purple}Processes: $color $processes  ${color red}Running:$color $running_processes
</span><span class='line'>$hr
</span><span class='line'>#${color red}Temp:
</span><span class='line'>${color purple}CPU1 Temp: ${color red}${exec sensors | grep &#39;Core 0&#39; | awk {&#39;print $3&#39;}}
</span><span class='line'>${color purple}CPU2 Temp: ${color red}${exec sensors | grep &#39;Core 1&#39; | awk {&#39;print $3&#39;}}
</span><span class='line'>${color purple}System Temp: ${color red}${exec sensors | grep &#39;temp1&#39; | tail -1 | awk {&#39;print $2&#39;}}
</span><span class='line'>${color purple}Hard Temp: ${color red}${exec sudo hddtemp /dev/sda -n -u=C}°C
</span><span class='line'>$hr
</span><span class='line'>#${color red}File systems:
</span><span class='line'>${color black}${exec df -h | grep /dev/sda3 | awk {&#39;print $3&#39;}} / $color${fs_used /}/${fs_size /} ${fs_bar 6 /}
</span><span class='line'>${exec df -h | grep /dev/sda2 | awk {&#39;print $3&#39;}} x $color${exec df -h | grep /dev/sda2 | awk {&#39;print $3&#39;}}/138GB ${fs_bar 6 /media/ubuntu}
</span><span class='line'>#${exec df -h | grep /dev/sda8 | cut -c40-43} /boot $color${fs_used /boot}/${fs_size /boot} ${fs_bar 6 /boot}
</span><span class='line'>$hr
</span><span class='line'>#${color red}Networking:
</span><span class='line'>#${color red}eth0:
</span><span class='line'>#Up:$color ${upspeed eth0} ${color red} - Down:$color ${downspeed eth0}
</span><span class='line'>${color red}br0:
</span><span class='line'>Up:$color ${upspeed br0} ${color red} - Down:$color ${downspeed eth0}
</span><span class='line'>#${color red}ppp0:
</span><span class='line'>#${color red}Up:$color ${upspeed ppp0} ${color red} - Down:$color ${downspeed ppp0}
</span><span class='line'>$hr
</span><span class='line'>${color red}Name              PID   CPU%   MEM%
</span><span class='line'>${color black} ${top name 1} ${top pid 1} ${top cpu 1} ${top mem 1}
</span><span class='line'>${color black} ${top name 2} ${top pid 2} ${top cpu 2} ${top mem 2}
</span><span class='line'>${color black} ${top name 3} ${top pid 3} ${top cpu 3} ${top mem 3}
</span><span class='line'>${color purple} ${top name 4} ${top pid 4} ${top cpu 4} ${top mem 4}
</span><span class='line'>${color purple} ${top name 5} ${top pid 5} ${top cpu 5} ${top mem 5}
</span></code></pre></td></tr></table></div></figure>


<p>In fact I didn&rsquo;t finished the Translucent, so I use the Transparent, a little bit ugly, but it&rsquo;s OK.</p>

<h3>Add it into awesome</h3>

<p>Simply add one line in your ~/.config/awesome/rc.lua could solve the problem:</p>

<figure class='code'><figcaption><span>conkyrc.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>awful.util.spawn(&quot;conky&quot;)
</span></code></pre></td></tr></table></div></figure>


<p>Now you can enjoy your Conky.</p>

<p><img src="/images/conky.jpg" alt="conky.jpg" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/21/setup-an-embedded-development-enviroment-for-stm32/">Setup an Embedded Development Enviroment for STM32</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-21T20:50:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>8:50 pm</span></time>
        
         | <a href="/blog/2013/11/21/setup-an-embedded-development-enviroment-for-stm32/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Download the toolchain</h3>

<p>We should download the toolchain from the ARM employee maintained website, the download address is located at: <a href="https://launchpad.net/gcc-arm-embedded">https://launchpad.net/gcc-arm-embedded</a>, use following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget https://launchpad.net/gcc-arm-embedded/4.7/4.7-2013-q3-update/+download/gcc-arm-none-eabi-4_7-2013q3-20130916-linux.tar.bz2
</span></code></pre></td></tr></table></div></figure>


<p>untar the downloaded package and then add it to your system path, my solution is directly add some alias into ~/.bashrc:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>### Add Cross_Compiler for eclipse based stm32
</span><span class='line'>#export PATH="/media/y/embedded/cortex/gcc-arm-none-eabi-4_7-2013q3/bin:$PATH"
</span><span class='line'>alias setstm='export PATH="/media/y/embedded/cortex/gcc-arm-none-eabi-4_7-2013q3/bin:$PATH"'
</span></code></pre></td></tr></table></div></figure>


<h3>Eclipse Configuration</h3>

<p>We have to install zylin for flashing the stm32 board. After installation, eclipse will be rebooted.</p>

<p><img src="/images/eclipseinstall.jpg" alt="images/eclipseinstall.jpg" /></p>

<h3>OpenOCD</h3>

<p>OpenOCD is a open-source hardware debugger.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>community/openocd 0.7.0-2
</span><span class='line'>    Debugging, in-system programming and boundary-scan testing for embedded target devices
</span><span class='line'>[root@XXXyyy capscr]# pacman -S openocd
</span></code></pre></td></tr></table></div></figure>


<h3>Template prepration</h3>

<p>Download the template from :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/JorgeAparicio/bareCortexM.git
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/21/two-tips-for-setting/">Two Tips for Setting</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-21T18:49:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>6:49 pm</span></time>
        
         | <a href="/blog/2013/11/21/two-tips-for-setting/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Disable the vim wraping</h3>

<p>There is a line in ~/.vimrc:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>autocmd FileType text setlocal textwidth=78
</span></code></pre></td></tr></table></div></figure>


<p>comment this line then everything goes OK.</p>

<h3>Change Awesome theme and change the titlebar width</h3>

<p>Download the 3rd party themes from <a href="https://github.com/Morley93/awesome-themes-3.5">https://github.com/Morley93/awesome-themes-3.5</a>, then copy them to your own theme location, normally under the &ldquo;/usr/share/awesome/themes/&rdquo;, Choose whatever you want, and edit the ~/.config/awesome/default.rc.lua:</p>

<figure class='code'><figcaption><span>rc.lua</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='lua'><span class='line'><span class="n">beautiful</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">/usr/share/awesome/themes/wabbit/theme.lua&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Save and exit then you got the new theme.  <br/>
How to change the title bar? <br/>
In /usr/share/awesome/themes/wabbit/theme.lua, edit the following lines:</p>

<figure class='code'><figcaption><span>theme.lua</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='lua'><span class='line'><span class="c1">--theme.font          = &quot;MonteCarlo medium 11&quot;</span>
</span><span class='line'><span class="n">theme</span><span class="p">.</span><span class="n">font</span>          <span class="o">=</span> <span class="s2">&quot;</span><span class="s">MonteCarlo medium 9&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>I think 9 is good for me, but change this to 11 or bigger will make old men happy.   <br/>
You can change this number into a very big or very small number, then some funny things will happen :)</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/53">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/51">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/03/11/tips-on-w5100/">Tips on W5100</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/10/pei-zhi-qemude-vdewang-luo/">配置Qemu的VDE网络</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/07/tips-on-v-usb-and-arduino-5/">Tips on V-USB and Arduino(5)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/07/tips-on-v-usb-and-arduino-4/">Tips on V-USB and Arduino(4)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/05/ba-wan-ebuddy-3/">把玩ebuddy(3)</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
