
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="Since our Great Fire Wall forbidden the google, thus all of the google related service becomes available in china, this leads to access to wordpress &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/12">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.useso.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/30/speed-up-the-wp-website-in-tianchao/">Speed-Up the WP Website in TianChao</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-30T23:09:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:09 pm</span></time>
        
         | <a href="/blog/2015/01/30/speed-up-the-wp-website-in-tianchao/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since our Great Fire Wall forbidden the google, thus all of the google related service becomes available in china, this leads to access to wordpress based website which uses google online fonts pretty slow. Following is how to speedup your website without too many changes:   <br/>
First go to your website&rsquo;s folder, find the files which calls <code>fonts.googleapis.com</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ grep -i "fonts.googleapis.com" ./ -r
</span><span class='line'>./wp-content/themes/twentytwelve/functions.php:       $font_url = add_query_arg( $query_args, "$protocol://fonts.googleapis.com/css" );
</span><span class='line'>./wp-content/themes/twentyfifteen/functions.php:      ), '//fonts.googleapis.com/css' );
</span><span class='line'>./wp-content/themes/twentyfourteen/functions.php:     $font_url = add_query_arg( 'family', urlencode( 'Lato:300,400,700,900,300italic,400italic,700italic' ), "//fonts.googleapis.com/css" );
</span><span class='line'>./wp-content/themes/tdpersona/functions.php:  wp_enqueue_style( 'tdpersona-googlefonts', '//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' );
</span><span class='line'>./wp-content/themes/twentythirteen/functions.php:     $fonts_url = add_query_arg( $query_args, "//fonts.googleapis.com/css" );
</span><span class='line'>./wp-includes/script-loader.php:      $open_sans_font_url = "//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,300,400,600&subset=$subsets";
</span><span class='line'>./wp-includes/js/tinymce/plugins/compat3x/css/dialog.css:@import url(//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,300,400,600&subset=latin-ext,latin);
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>Replace all of the <code>fonts.googleapis.com</code> with <code>fonts.useso.com</code>, this could be done via scripts. <br/>
After modification, your website will be much more faster than before.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/29/play-docker-4/">Play Docker(4)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-29T22:41:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:41 pm</span></time>
        
         | <a href="/blog/2015/01/29/play-docker-4/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Fig(Continue)</h3>

<p>Met some problems in last article, so this part will continue to work on Fig, the correct configuration files are listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls
</span><span class='line'>app.py  Dockerfile  fig.yml  requirements.txt
</span><span class='line'>$ cat Dockerfile 
</span><span class='line'>FROM python:2.7
</span><span class='line'>ADD . /code
</span><span class='line'>WORKDIR /code
</span><span class='line'>RUN pip install -r requirements.txt
</span><span class='line'>$ cat fig.yml 
</span><span class='line'>web:
</span><span class='line'>  build: .
</span><span class='line'>  command: python app.py
</span><span class='line'>  ports:
</span><span class='line'>   - "5000:5000"
</span><span class='line'>  volumes:
</span><span class='line'>   - .:/code
</span><span class='line'>  links:
</span><span class='line'>   - redis
</span><span class='line'>redis:
</span><span class='line'>  image: redis
</span><span class='line'>$ cat requirements.txt 
</span><span class='line'>flask
</span><span class='line'>redis
</span><span class='line'>$ cat app.py 
</span><span class='line'>from flask import Flask
</span><span class='line'>from redis import Redis
</span><span class='line'>import os
</span><span class='line'>app = Flask(__name__)
</span><span class='line'>redis = Redis(host='redis', port=6379)
</span><span class='line'>
</span><span class='line'>@app.route('/')
</span><span class='line'>def hello():
</span><span class='line'>    redis.incr('hits')
</span><span class='line'>    return 'Hello World! I have been seen %s times.' % redis.get('hits')
</span><span class='line'>
</span><span class='line'>if __name__ == "__main__":
</span><span class='line'>    app.run(host="0.0.0.0", debug=True)
</span></code></pre></td></tr></table></div></figure>


<p>via <code>fig up</code> you could quickly build this app and let it run.  <br/>
When it running, you could use <code>fig ps</code> for viewing the running instance:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo fig ps
</span><span class='line'>      Name             Command             State              Ports       
</span><span class='line'>-------------------------------------------------------------------------
</span><span class='line'>figtest_redis_1    /entrypoint.sh     Up                 6379/tcp         
</span><span class='line'>                   redis-server                                           
</span><span class='line'>figtest_web_1      python app.py      Up                 0.0.0.0:5000-&gt;50 
</span><span class='line'>                                                         00/tcp    
</span></code></pre></td></tr></table></div></figure>


<p>Use <code>sudo fig run web env</code> you could view all of the variables of the running instance web, or change web into redis then displaying the variables of redis.  <br/>
Use <code>sudo fig stop</code> to stop all of the running instance.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo fig stop
</span><span class='line'>Stopping figtest_web_1...
</span><span class='line'>Stopping figtest_redis_1...
</span></code></pre></td></tr></table></div></figure>


<p>Use <code>sudo fig run web env</code> for displaying all of the variables of running <code>web</code>.</p>

<h3>Create Django</h3>

<p>Configuration files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat Dockerfile 
</span><span class='line'>FROM python:2.7
</span><span class='line'>ENV PYTHONUNBUFFERED 1
</span><span class='line'>RUN mkdir /code
</span><span class='line'>WORKDIR /code
</span><span class='line'>ADD requirements.txt /code/
</span><span class='line'>RUN pip install -r requirements.txt
</span><span class='line'>ADD . /code/
</span><span class='line'>
</span><span class='line'>$ cat fig.yml 
</span><span class='line'>db:
</span><span class='line'>  image: postgres
</span><span class='line'>web:
</span><span class='line'>  build: .
</span><span class='line'>  command: python manage.py runserver 0.0.0.0:8000
</span><span class='line'>  volumes:
</span><span class='line'>    - .:/code
</span><span class='line'>  ports:
</span><span class='line'>    - "8000:8000"
</span><span class='line'>  links:
</span><span class='line'>    - db
</span><span class='line'>
</span><span class='line'>$ cat requirements.txt 
</span><span class='line'>Django
</span><span class='line'>psycopg2
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>Via <code>sudo  fig run web django-admin.py startproject figexample .</code>  <br/>
This means, first fig will create the image, then use this image for running <code>django-admin.py startproject figexample</code>,
Examine via different methods:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker ps
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS               NAMES
</span><span class='line'>1abcafc5bd59        postgres:9          "/docker-entrypoint.   4 minutes ago       Up 3 minutes        5432/tcp            django_db_1         
</span><span class='line'>741b0e375c73        postgres:9          "/docker-entrypoint.   4 minutes ago       Up 4 minutes        5432/tcp            Django_db_1         
</span><span class='line'>[Trusty@DashCentOS django]$ sudo fig ps
</span><span class='line'>   Name                  Command               State    Ports   
</span><span class='line'>---------------------------------------------------------------
</span><span class='line'>django_db_1   /docker-entrypoint.sh postgres   Up      5432/tcp 
</span></code></pre></td></tr></table></div></figure>


<p>Change the configuration file of the django project:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo vim figexample/settings.py
</span><span class='line'>
</span><span class='line'>DATABASES = {
</span><span class='line'>    'default': {
</span><span class='line'>        'ENGINE': 'django.db.backends.postgresql_psycopg2',
</span><span class='line'>        'NAME': 'postgres',
</span><span class='line'>        'USER': 'postgres',
</span><span class='line'>        'HOST': 'db',
</span><span class='line'>        'PORT': 5432,
</span><span class='line'>    }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Save the file and run <code>sudo fig up</code>, this time your django project connects to the right postgresql server.  <br/>
Examine the running containers:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo fig ps
</span><span class='line'>      Name             Command             State              Ports       
</span><span class='line'>-------------------------------------------------------------------------
</span><span class='line'>django_db_1        /docker-           Up                 5432/tcp         
</span><span class='line'>                   entrypoint.sh                                          
</span><span class='line'>                   postgres                                               
</span><span class='line'>django_web_1       python manage.py   Up                 0.0.0.0:8000-&gt;80 
</span><span class='line'>                   runserver ...                         00/tcp           
</span><span class='line'>$ sudo docker ps
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                    NAMES
</span><span class='line'>d3c3c8bb6d0e        django_web:latest   "python manage.py ru   4 minutes ago       Up 4 minutes        0.0.0.0:8000-&gt;8000/tcp   django_web_1        
</span><span class='line'>3f7b61fdd09e        postgres:9          "/docker-entrypoint.   4 minutes ago       Up 4 minutes        5432/tcp                 django_db_1        
</span></code></pre></td></tr></table></div></figure>


<h3>Run ASP</h3>

<p>Refers to:  <br/>
<a href="http://dockerone.com/article/164">http://dockerone.com/article/164</a>  <br/>
The steps are listed as:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/aspnet/Home.git
</span><span class='line'>$ cd Home/
</span><span class='line'>$ cd samples/HelloWeb/
</span><span class='line'>$ vim Dockerfile
</span><span class='line'>FROM microsoft/aspnet
</span><span class='line'>
</span><span class='line'>COPY . /app
</span><span class='line'>WORKDIR /app
</span><span class='line'>RUN ["kpm", "restore"]
</span><span class='line'>
</span><span class='line'>EXPOSE 5004
</span><span class='line'>ENTRYPOINT ["k", "kestrel"]
</span><span class='line'>$ sudo docker build -t myapp .
</span><span class='line'>$ sudo docker images
</span><span class='line'>REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
</span><span class='line'>myapp               latest              6c0d622049ea        2 hours ago         492 MB
</span><span class='line'>microsoft/aspnet    latest              1e67fe2f5a59        13 days ago         465.3 MB
</span><span class='line'>$ sudo docker run -t -d -p 80:5004 myapp
</span></code></pre></td></tr></table></div></figure>


<p>Open your browser and visit <code>http://xxx.xx.xx.xxx:80</code> and you could found the asp based app runs.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/29/build-specified-version-of-opencontrail/">Build Specified Version of OpenContrail</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-29T20:50:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:50 pm</span></time>
        
         | <a href="/blog/2015/01/29/build-specified-version-of-opencontrail/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since the default building of OpenContrail is master branch, while the installation deb file named like <code>contrail-install-packages_1.21-74~havana_all.deb</code>, this gap need to be filled via building.</p>

<h3>View Different Branches</h3>

<p>Repo hold all of the versions locally, simply view them via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pwd
</span><span class='line'>/root/Code/OpenContrail/.repo/manifests
</span><span class='line'># git branch -a | cut -d / -f 3
</span><span class='line'>* default
</span><span class='line'>master -&gt; origin
</span><span class='line'>R1.04
</span><span class='line'>R1.05
</span><span class='line'>R1.06
</span><span class='line'>R1.06c1
</span><span class='line'>R1.10
</span><span class='line'>R1.30
</span><span class='line'>R2.0
</span><span class='line'>R2.1
</span><span class='line'>gh-pages
</span><span class='line'>master
</span><span class='line'>opserver
</span><span class='line'>rajreddy_doc_update
</span><span class='line'>rajreddy_doc_update2
</span><span class='line'>rajreddy_webui_third
</span></code></pre></td></tr></table></div></figure>


<p>While these branches doesn&rsquo;t contains <code>1.21</code>, why?</p>

<h3>Specify Different Tag</h3>

<p>In git admined project, tag is frequently be used, thus we could fetch the code via specified tag.  <br/>
Repo need to run following command to enable all of the sub-project syncs to specified tag, following I use <code>v1.21</code> tag for syncing.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ repo forall -c 'git checkout v1.21`
</span><span class='line'>$ repo sync
</span><span class='line'>$ python third_party/fetch_package.py && scons && make -f packages.make
</span></code></pre></td></tr></table></div></figure>


<p>Need a long time for checking the generated packages.    <br/>
Problem:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dpkg-source: error: syntax error in contrail/debian/control at line 33: block
</span><span class='line'>lacks the 'Package' field
</span><span class='line'>dpkg-buildpackage: error: dpkg-source --before-build contrail gave error exit
</span><span class='line'>status 25
</span></code></pre></td></tr></table></div></figure>


<p>when running <code>make -f packages.make</code>, it will failed, just remove the line before <code>packages</code> it will be OK.</p>

<h3>Specify Different Branch</h3>

<p>Specify the branch of:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>repo init -b android-2.3_r1 ; repo sync
</span><span class='line'>repo init -b R2.20
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/29/build-contrial-source-code/">Build Contrial Source Code</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-29T01:44:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:44 am</span></time>
        
         | <a href="/blog/2015/01/29/build-contrial-source-code/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Reference</h3>

<p><a href="http://juniper.github.io/contrail-vnc/README.html">http://juniper.github.io/contrail-vnc/README.html</a></p>

<h3>Hardware &amp;&amp; Software</h3>

<p>Vitualized machine which have 1G memory and 1 core.   <br/>
Running 12.04:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat /etc/issue
</span><span class='line'>Ubuntu 12.04.3 LTS \n \l
</span></code></pre></td></tr></table></div></figure>


<h3>Packages</h3>

<p>You should install following packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo add-apt-repository ppa:opencontrail/ppa
</span><span class='line'>$ sudo vim /etc/apt/source.lists
</span><span class='line'>deb http://ppa.launchpad.net/opencontrail/ppa/ubuntu precise main
</span><span class='line'>deb-src http://ppa.launchpad.net/opencontrail/ppa/ubuntu precise main
</span><span class='line'>$ sudo apt-get install  -y scons git python-lxml wget gcc patch make unzip flex bison g++ libssl-dev autoconf automake libtool pkg-config vim python-dev python-setuptools libprotobuf-dev protobuf-compiler libsnmp-python libgettextpo0 libxml2-utils debhelper python-sphinx ruby-ronn libipfix python-all libpcap-dev module-assistant libtbb-dev libboost-dev liblog4cplus-dev libghc-curl-dev
</span><span class='line'>$ sudo apt-get install python-pip
</span><span class='line'>$ sudo pip install gevent bottle netaddr 
</span></code></pre></td></tr></table></div></figure>


<h3>Getting Source Code</h3>

<p>Use repo for getting the source code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo
</span><span class='line'>$ chmod a+x ~/bin/repo
</span><span class='line'>$ echo "export PATH=/usr/local/git/bin:$PATH"&gt;&gt;~/.bashrc
</span><span class='line'>$ source ~/.bashrc
</span></code></pre></td></tr></table></div></figure>


<p>Fetch the repository and sync it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir ~/Code/OpenContrail
</span><span class='line'>$ cd ~/Code/OpenContrail
</span><span class='line'>$ repo init -u git@github.com:Juniper/contrail-vnc
</span><span class='line'>$ repo sync
</span></code></pre></td></tr></table></div></figure>


<p>Some of the packages will be blocked by GFW, be sure you use proxy for downloading them.  <br/>
Fetch the third party packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ python third_party/fetch_packages.py
</span></code></pre></td></tr></table></div></figure>


<h3>Build the OpenContrail &amp; Pakages</h3>

<p>The build step is simply via <code>scons</code>, after a long wait, it will pass.   <br/>
Generate packages via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ make -f packages.make
</span></code></pre></td></tr></table></div></figure>


<p>The default configuration will make <code>all</code> of the components in packages.make, or you could seperately build single component.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/28/using-teamviewer/">Using Teamviewer</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-28T21:02:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:02 pm</span></time>
        
         | <a href="/blog/2015/01/28/using-teamviewer/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Installation</h3>

<h4>CentOS</h4>

<p>Download the corresponding rpm files, install it via <code>sudo yum install ******.rpm</code>, this will automatically install the dependencies and also install the teamviewer for your centos system.</p>

<h4>Ubuntu</h4>

<p>Only working for 14.04:   <br/>
First you have to add i686(i386) supporting:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ dpkg --add-architecture i386
</span><span class='line'>$ apt-get update
</span></code></pre></td></tr></table></div></figure>


<p>Then you have to downloaded the following packages rather than the offcial packages(x64 or i386):  <br/>
<a href="http://download.teamviewer.com/download/teamviewer_linux.deb">http://download.teamviewer.com/download/teamviewer_linux.deb</a>   <br/>
Install this <code>teamviewer_linux.deb</code>, and you got teamviewer running on your system.  <br/>
For 12.04, directly download the package from:  <br/>
<a href="http://download.teamviewer.com/download/teamviewer_linux_x64.deb">http://download.teamviewer.com/download/teamviewer_linux_x64.deb</a>  <br/>
Then install it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># dpkg -i teamviewer_linux_x64.deb
</span><span class='line'># apt-get install -f
</span></code></pre></td></tr></table></div></figure>


<p>Then teamviewer could be installed on your system.</p>

<h3>Connect Back</h3>

<p>First your server side will install the teamviewer and run is as the daemon mode.</p>

<h3>Tips</h3>

<p>Stop the teamviewerd via(On CentOS):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo teamviewer --daemon stop
</span></code></pre></td></tr></table></div></figure>


<p>While start it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo teamviewer --daemon start
</span></code></pre></td></tr></table></div></figure>


<p>Seems someone blocked the flow to this site&hellip;55555</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/28/play-docker-3/">Play Docker(3)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-28T03:53:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:53 am</span></time>
        
         | <a href="/blog/2015/01/28/play-docker-3/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Dockerfile</h3>

<p>Dockerfile is like Vagrantfile, for define the configuration of the docker container.  <br/>
The steps for creating the Dockerfile is listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir -p ~/Code
</span><span class='line'>$ cd ~/Code && vim Dockerfile 
</span><span class='line'>FROM ubuntu:13.04
</span><span class='line'>MAINTAINER examples@docker.com
</span><span class='line'>RUN echo "deb http://archive.ubuntu.com/ubuntu precise main universe" &gt; /etc/apt/sources.list
</span><span class='line'>RUN apt-get update
</span><span class='line'>RUN apt-get upgrade -y
</span><span class='line'>RUN apt-get install -y openssh-server nginx  supervisor
</span><span class='line'>RUN mkdir -p /var/run/sshd
</span><span class='line'>RUN mkdir -p /var/log/supervisor
</span><span class='line'>RUN echo "daemon off;"&gt;&gt;/etc/nginx/nginx.conf
</span><span class='line'>COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf
</span><span class='line'>EXPOSE 22 80
</span><span class='line'>CMD ["/usr/bin/supervisord"]
</span><span class='line'>$ vim supervisord.conf 
</span><span class='line'>[supervisord]
</span><span class='line'>nodaemon=true
</span><span class='line'>[program:sshd]
</span><span class='line'>command=/usr/sbin/sshd -D
</span><span class='line'>
</span><span class='line'>[program:nginx]
</span><span class='line'>command=/usr/sbin/nginx
</span><span class='line'>user=root
</span><span class='line'>autostart=true
</span></code></pre></td></tr></table></div></figure>


<p>Now build the target image with following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker build -t test/supervisord .
</span></code></pre></td></tr></table></div></figure>


<p>After build, we could use <code>sudo docker images</code> for examing the generated images. And use following command for start the sshd and nginx service:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -p 2222:22 -p 8080:80 -t -i test/supervisord
</span></code></pre></td></tr></table></div></figure>


<p>Now change the root password and you could directly <code>ssh root@127.0.0.1 -p 2222</code> or you could directly access <a href="http://1xx.xx.xx.xxx:8080">http://1xx.xx.xx.xxx:8080</a> for nginx webpages.</p>

<h3>Fig</h3>

<p>Fig is used for swiftly build up a container. You only need to add a fig.yml and specify some simple content, then it could easily assit you building up a container.  <br/>
Install fig via following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget https://github.com/docker/fig/releases/download/1.0.1/fig-`uname -s`-`uname -m`
</span><span class='line'>$ sudo mv fig-xxx-xxx /usr/bin/fig
</span><span class='line'>$ sudo chmod 777 /usr/bin/fig
</span></code></pre></td></tr></table></div></figure>


<p>Touch the definition files under a specified directory and then use fig for building the whole container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir ~/fig
</span><span class='line'>$ ls
</span><span class='line'>app.py  Dockerfile  fig.yml  requirements.txt
</span><span class='line'>$ cat Dockerfile 
</span><span class='line'>FROM python:2.7
</span><span class='line'>ADD . /code
</span><span class='line'>WORKDIR /code
</span><span class='line'>RUN pip install -r requirements.txt
</span><span class='line'>$ cat fig.yml 
</span><span class='line'>web:
</span><span class='line'>  build: .
</span><span class='line'>  command: python app.py
</span><span class='line'>  links:
</span><span class='line'>   - db
</span><span class='line'>  ports:
</span><span class='line'>   - "8000:8000"
</span><span class='line'>db:
</span><span class='line'>  image: redis
</span><span class='line'>$ cat requirements.txt 
</span><span class='line'>flask
</span><span class='line'>redis
</span><span class='line'>$ cat app.py 
</span><span class='line'>from flask import Flask
</span><span class='line'>from redis import Redis
</span><span class='line'>import os
</span><span class='line'>app = Flask(__name__)
</span><span class='line'>redis = Redis(host='redis', port=6379)
</span><span class='line'>
</span><span class='line'>@app.route('/')
</span><span class='line'>def hello():
</span><span class='line'>    redis.incr('hits')
</span><span class='line'>    return 'Hello World! I have been seen %s times.' % redis.get('hits')
</span><span class='line'>
</span><span class='line'>if __name__ == "__main__":
</span><span class='line'>    app.run(host="0.0.0.0", debug=True)
</span></code></pre></td></tr></table></div></figure>


<p>Now use <code>sudo fig up</code> then you could let this web service run.</p>

<p>Met some problems, will be do this at home.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/27/play-docker-2/">Play Docker(2)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-27T22:27:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:27 pm</span></time>
        
         | <a href="/blog/2015/01/27/play-docker-2/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Continue, but this time for further topics:</p>

<h3>Export/Import</h3>

<p>From <a href="https://registry.hub.docker.com/">https://registry.hub.docker.com/</a> to find more interesting images:  <br/>
Use opensuse:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker pull opensuse
</span><span class='line'>$ sudo docker images
</span><span class='line'>$ sudo docker images
</span><span class='line'>REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
</span><span class='line'>opensuse            latest              758c78b4040c        3 weeks ago         622.7 MB
</span><span class='line'>opensuse            13.2                758c78b4040c        3 weeks ago         622.7 MB
</span><span class='line'>opensuse            harlequin           758c78b4040c        3 weeks ago         622.7 MB
</span><span class='line'>$ sudo docker run -i -t opensuse /bin/bash
</span><span class='line'>:/ # yzpper in vim
</span></code></pre></td></tr></table></div></figure>


<p>After installed commit the changes and verify:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -i -t install_vim_suse /bin/bash
</span><span class='line'>:/ # which vim
</span><span class='line'>/usr/bin/vim
</span></code></pre></td></tr></table></div></figure>


<p>Now we export it to tar file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker ps
</span><span class='line'>$ sudo docker export 7b594d048b0b&gt;~/opensuse_vim.tar
</span><span class='line'>$ ls -l -h ~/opensuse_vim.tar
</span><span class='line'>-rw-r--r--  1 Trusty root 704M Jan 27 22:39 opensuse_vim.tar
</span></code></pre></td></tr></table></div></figure>


<p>Made changes after we exported the tar file.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo tar xvf opensuse_vim.tar
</span><span class='line'>$ sudo touch ./root/I_Want_You_See_This_File
</span><span class='line'>$ sudo rm -f opensuse_vim.tar
</span><span class='line'>$ sudo tar cvf opensuse_vim_modified.tar ./*
</span><span class='line'>$ ls -l -h *.tar
</span><span class='line'>-rw-r--r-- 1 root root 704M Jan 27 22:45 opensuse_vim_modified.tar
</span></code></pre></td></tr></table></div></figure>


<p>Import the tar file into the images:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo cat ./opensuse_vim_modified.tar | sudo docker import - Trusty/opensuse_vim_modified:v1.0
</span><span class='line'>c18f7e43c4197a2a1a614a1ee91c6d8f0e06a6d7593ca94354303e3760e389a7
</span><span class='line'>$ sudo docker images
</span><span class='line'>$ sudo docker images
</span><span class='line'>REPOSITORY                   TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
</span><span class='line'>Trusty/opensuse_vim_modified   v1.0                c18f7e43c419        47 seconds ago      724 MB
</span><span class='line'>$ sudo docker run -i -t Trusty/opensuse_vim_modified:v1.0 /bin/bash
</span><span class='line'>:/ # ls /root/
</span><span class='line'>I_Want_You_See_This_File  bin
</span></code></pre></td></tr></table></div></figure>


<p>Now we could see the modified files has been ported to our running containers.  <br/>
Even you could docker import from remote url:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$sudo docker import http://example.com/exampleimage.tgz example/imagerepo
</span></code></pre></td></tr></table></div></figure>


<h3>Networking</h3>

<h4>Run app inside the container</h4>

<p>First pull the images <code>training/webapp</code> back:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker pull training/webapp
</span><span class='line'>$ sudo docker images
</span><span class='line'>REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
</span><span class='line'>training/webapp     latest              31fa814ba25a        8 months ago        278.6 MB
</span></code></pre></td></tr></table></div></figure>


<p>Quickly enter the container and examine what&rsquo;s inside the pandora box:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -i -t training/webapp /bin/bash
</span><span class='line'>root@f19ca7c18763:/opt/webapp# cat /etc/issue
</span><span class='line'>Ubuntu 12.04.4 LTS \n \l
</span><span class='line'>
</span><span class='line'>root@f19ca7c18763:/opt/webapp# ls
</span><span class='line'>Procfile  app.py  requirements.txt  tests.py
</span><span class='line'>root@f19ca7c18763:/opt/webapp# cat app.py | more
</span><span class='line'>import os
</span><span class='line'>
</span><span class='line'>from flask import Flask
</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s a flask based webapp.  <br/>
Manually run the app.py and use another terminal for testing it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@f19ca7c18763:/opt/webapp# python app.py
</span><span class='line'> * Running on http://0.0.0.0:5000/
</span><span class='line'>$ sudo docker exec -it f19ca7c18763 /bin/bash
</span><span class='line'>root@f19ca7c18763:/opt/webapp# which curl
</span><span class='line'>/usr/bin/curl
</span><span class='line'>root@f19ca7c18763:/opt/webapp# curl http://127.0.0.1:5000
</span><span class='line'>Hello world!root@f19ca7c18763:/opt/webapp# 
</span></code></pre></td></tr></table></div></figure>


<p>When you use curl, you will see in the first terminal it will indicates the request has been solved.  <br/>
Or you could directly request the page in host machine, via: <code>curl http://172.17.0.21:5000</code>, the result will be the same.</p>

<h4>Expose to World</h4>

<p>Randomly let our container map to host&rsquo;s port via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -d -P --name web training/webapp python app.py
</span><span class='line'>8781cf98cc685ae37a9aa421a9d30f71c64f12fa8fc07b2e1d888f761089e528
</span><span class='line'>$ sudo docker ps -l
</span><span class='line'>CONTAINER ID        IMAGE                    COMMAND             CREATED             STATUS              PORTS                     NAMES
</span><span class='line'>8781cf98cc68        training/webapp:latest   "python app.py"     6 seconds ago       Up 5 seconds        0.0.0.0:49153-&gt;5000/tcp   web                 
</span></code></pre></td></tr></table></div></figure>


<p>Then on Internet, we could directly fetch the HelloWorld now.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>~% curl http://1xx.xxx.xx.xxx:49153
</span><span class='line'>Hello world!%          
</span></code></pre></td></tr></table></div></figure>


<p>Inspect the name of the running container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker inspect -f "" 8781cf98cc68
</span><span class='line'>2015-01-28T04:25:38.768661692Z
</span><span class='line'>$ sudo docker inspect -f "" 8781cf98cc68
</span><span class='line'>7307
</span><span class='line'>$ sudo docker inspect -f "" 8781cf98cc68
</span><span class='line'>/web
</span></code></pre></td></tr></table></div></figure>


<p>We got the name, then we could directly read the logs using this name:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker logs -f web
</span><span class='line'> * Running on http://0.0.0.0:5000/
</span><span class='line'>183.62.15.118 - - [28/Jan/2015 04:27:30] "GET / HTTP/1.1" 200 -
</span><span class='line'>183.62.15.118 - - [28/Jan/2015 06:00:18] "GET / HTTP/1.1" 200 -
</span><span class='line'>183.62.15.118 - - [28/Jan/2015 06:00:24] "GET / HTTP/1.1" 200 -
</span></code></pre></td></tr></table></div></figure>


<p>Using <code>-p</code> for specify the host port and container port mapping:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -d -p 5000:5000 --name web1 training/webapp python app.py
</span><span class='line'>2a0692015ba776f7daa957906470178df1fd8d26439422cd4528d2e253bf3331
</span><span class='line'>$ sudo docker ps
</span><span class='line'>CONTAINER ID        IMAGE                    COMMAND             CREATED             STATUS              PORTS                    NAMES
</span><span class='line'>2a0692015ba7        training/webapp:latest   "python app.py"     3 seconds ago       Up 3 seconds        0.0.0.0:5000-&gt;5000/tcp   web1 
</span></code></pre></td></tr></table></div></figure>


<p>The test could be curl the 5000 port of the remote machine, while the logs could be found using <code>-f web1</code>.  <br/>
Examine the port mapping using following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -d -P --name web3 training/webapp python app.py
</span><span class='line'>$ sudo docker port web3 5000
</span><span class='line'>0.0.0.0:49154
</span></code></pre></td></tr></table></div></figure>


<p><code>-p</code> could be added as multiple ports, like:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -d -p 5000:5000 -p 3000:80 training/webapp python app.py
</span></code></pre></td></tr></table></div></figure>


<h3>Docker Container Linking</h3>

<p>Pull back a new images and run it as daemon:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -d --name db training/postgres
</span><span class='line'>$ sudo docker images
</span><span class='line'>REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
</span><span class='line'>training/postgres   latest              258105bea10d        7 months ago        364.5 MB
</span><span class='line'>training/webapp     latest              31fa814ba25a        8 months ago        278.6 MB
</span><span class='line'>$ sudo docker ps 
</span><span class='line'>CONTAINER ID        IMAGE                      COMMAND                CREATED             STATUS              PORTS                     NAMES
</span><span class='line'>ff6603d47552        training/postgres:latest   "su postgres -c '/us   14 seconds ago      Up 14 seconds       5432/tcp                  db                  
</span><span class='line'>f94368f3d091        training/webapp:latest     "python app.py"        9 minutes ago       Up 9 minutes        0.0.0.0:49154-&gt;5000/tcp   web3                
</span></code></pre></td></tr></table></div></figure>


<p>Remove the existing web3 container, and create a new one which links to container <code>db</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker rm -f f94368f3d091
</span><span class='line'>f94368f3d091
</span><span class='line'>$ sudo docker run -d -P --name web4 --link db:db training/webapp python app.py
</span><span class='line'>0cf8f0adcb3d1728c61e33c0c9184213478a2a231ba525339a3049534f4ce4ef
</span><span class='line'>$ sudo docker ps
</span><span class='line'>CONTAINER ID        IMAGE                      COMMAND                CREATED             STATUS              PORTS                     NAMES
</span><span class='line'>0cf8f0adcb3d        training/webapp:latest     "python app.py"        4 seconds ago       Up 3 seconds        0.0.0.0:49155-&gt;5000/tcp   web4                
</span><span class='line'>ff6603d47552        training/postgres:latest   "su postgres -c '/us   2 minutes ago       Up 2 minutes        5432/tcp                  db  
</span></code></pre></td></tr></table></div></figure>


<p>Examine the link infos when entering the container itself:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker exec -i -t 0cf8f0adcb3d  /bin/bash
</span><span class='line'>root@0cf8f0adcb3d:/opt/webapp# env
</span><span class='line'>HOSTNAME=0cf8f0adcb3d
</span><span class='line'>DB_NAME=/web4/db
</span><span class='line'>DB_PORT_5432_TCP_ADDR=172.17.0.26
</span><span class='line'>DB_PORT=tcp://172.17.0.26:5432
</span><span class='line'>DB_PORT_5432_TCP=tcp://172.17.0.26:5432
</span><span class='line'>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
</span><span class='line'>PWD=/opt/webapp
</span><span class='line'>DB_PORT_5432_TCP_PORT=5432
</span><span class='line'>SHLVL=1
</span><span class='line'>HOME=/
</span><span class='line'>DB_PORT_5432_TCP_PROTO=tcp
</span><span class='line'>DB_ENV_PG_VERSION=9.3
</span><span class='line'>_=/usr/bin/env
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>Use <code>ip address show</code> to examine the ip address.  <br/>
Why they could be linked?  <br/>
Also when you enter the web machine, cat its /etc/hosts, will see the db named:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@0cf8f0adcb3d:/opt/webapp# cat /etc/hosts
</span><span class='line'>172.17.0.27   0cf8f0adcb3d
</span><span class='line'>127.0.0.1 localhost
</span><span class='line'>::1   localhost ip6-localhost ip6-loopback
</span><span class='line'>fe00::0   ip6-localnet
</span><span class='line'>ff00::0   ip6-mcastprefix
</span><span class='line'>ff02::1   ip6-allnodes
</span><span class='line'>ff02::2   ip6-allrouters
</span><span class='line'>172.17.0.26   db
</span></code></pre></td></tr></table></div></figure>


<h3>Advance Networking</h3>

<p>Secret of DNS/hostname/hosts:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@0cf8f0adcb3d:/opt/webapp# mount
</span><span class='line'>/dev/vda1 on /etc/resolv.conf type ext4 (rw,relatime,data=ordered)
</span><span class='line'>/dev/vda1 on /etc/hostname type ext4 (rw,relatime,data=ordered)
</span><span class='line'>/dev/vda1 on /etc/hosts type ext4 (rw,relatime,data=ordered)
</span></code></pre></td></tr></table></div></figure>


<p>Once the variables changes the container&rsquo;s corresponding name will also be changed.</p>

<h4>Iptables</h4>

<p>Container Visit WAN:  <br/>
Use sysctl&rsquo;s <code>ip_forward</code>, check it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /proc//sys/net/ipv4/ip_forward
</span><span class='line'>1
</span></code></pre></td></tr></table></div></figure>


<p>1 means that we could forward our traffic flow from WAN to</p>

<p>WAN visit Container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -d -p 5000:5000 --name web5 training/webapp python app.py
</span><span class='line'>$ sudo iptables -t nat -nL
</span><span class='line'>......
</span><span class='line'>Chain DOCKER (2 references)
</span><span class='line'>target     prot opt source               destination         
</span><span class='line'>DNAT       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:49155 to:172.17.0.27:5000
</span><span class='line'>DNAT       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:5000 to:172.17.0.28:5000
</span></code></pre></td></tr></table></div></figure>


<p>The last one is added via our run command.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/27/play-docker-1/">Play Docker(1)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-27T20:39:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:39 pm</span></time>
        
         | <a href="/blog/2015/01/27/play-docker-1/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For playing docker and prepare for my presentation, I wrote this series and try to record my tips on playing docker.</p>

<h3>Background</h3>

<p>I created a droplet on DigitalOcean.com, which is running CentOS 7, the memory is only 512M, with one core and 20G size disk, which means its caculation resource is pretty limited, so heavy tasks should be avoid, like building.  <br/>
Since the memory is only 512M, I allocated 1G swapfile to the machine.  <br/>
The usable disk is 17G now.</p>

<h3>Docker Installation</h3>

<p>Docker is already part of CentOS7, so install it directly via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo yum install -y docker
</span><span class='line'>$ which docker
</span><span class='line'>/usr/bin/docker
</span></code></pre></td></tr></table></div></figure>


<p>Start the service and make it default:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo service docker start
</span><span class='line'>Redirecting to /bin/systemctl start  docker.service
</span><span class='line'>$ sudo chkconfig docker on
</span><span class='line'>Note: Forwarding request to 'systemctl enable docker.service'.
</span><span class='line'>ln -s '/usr/lib/systemd/system/docker.service' '/etc/systemd/system/multi-user.target.wants/docker.service'
</span></code></pre></td></tr></table></div></figure>


<p>Now even if you restart the machine, the service would be automatically started together with system boot.</p>

<h3>First Instance</h3>

<p>Pull the debian back:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker pull debian
</span><span class='line'>Pulling repository debian
</span><span class='line'>c90d655b99b2: Download complete 
</span><span class='line'>511136ea3c5a: Download complete 
</span><span class='line'>30d39e59ffe2: Download complete 
</span><span class='line'>Status: Downloaded newer image for debian:latest
</span><span class='line'>$ sudo docker images
</span><span class='line'>REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
</span><span class='line'>debian              wheezy              c90d655b99b2        8 hours ago         85.12 MB
</span><span class='line'>debian              7                   c90d655b99b2        8 hours ago         85.12 MB
</span><span class='line'>debian              7.8                 c90d655b99b2        8 hours ago         85.12 MB
</span><span class='line'>debian              latest              c90d655b99b2        8 hours ago         85.12 MB
</span></code></pre></td></tr></table></div></figure>


<p>Install the <code>lsb_release</code>, then run different tags, all of them are the same:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -i -t debian:7.8 /bin/bash
</span><span class='line'>xxxxxxx # lsb_release -a 
</span><span class='line'>No LSB modules are available.
</span><span class='line'>Distributor ID:   Debian
</span><span class='line'>Description:  Debian GNU/Linux 7.8 (wheezy)
</span><span class='line'>Release:  7.8
</span><span class='line'>Codename: wheezy
</span></code></pre></td></tr></table></div></figure>


<h3>Destroy Container</h3>

<p>List all of the container via <code>sudo docker ps -a</code>, then destroy the container via <code>sudo docker rm xxxxxx</code> while xxxxxx is the container ID.  <br/>
Play magic, one line for remove all of the containers:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker rm `sudo docker ps -a -q`
</span><span class='line'>16d606046c24
</span><span class='line'>65ceffcf4a7b
</span><span class='line'>dfbc6d0fa051
</span><span class='line'>1dd18dbf8b9c
</span><span class='line'>66c931879c2c
</span><span class='line'>$ sudo docker ps -a
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span></code></pre></td></tr></table></div></figure>


<h3>Remove The Images</h3>

<p>One line for remove all of the ununsed images:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker images -q
</span><span class='line'>c90d655b99b2
</span><span class='line'>c90d655b99b2
</span><span class='line'>c90d655b99b2
</span><span class='line'>c90d655b99b2
</span><span class='line'>$ sudo docker rmi `sudo docker images -q`
</span><span class='line'>Untagged: debian:7
</span><span class='line'>Untagged: debian:7.8
</span><span class='line'>Untagged: debian:latest
</span><span class='line'>Untagged: debian:wheezy
</span><span class='line'>Deleted: c90d655b99b2ec5b7e94d38c87f92dce015c17a313caeaae0e980d9b9bed8444
</span><span class='line'>Deleted: 30d39e59ffe287f29a41a3f8bd70734afc8728329e3289945cbdc5bbf07cd980
</span><span class='line'>Deleted: 511136ea3c5a64f264b78b5433614aec563103b4d4702f3ba7d4d2698e22c158
</span><span class='line'>Error response from daemon: No such image: c90d655b99b2
</span><span class='line'>Error response from daemon: No such image: c90d655b99b2
</span><span class='line'>Error response from daemon: No such image: c90d655b99b2
</span><span class='line'>2015/01/27 21:14:01 Error: failed to remove one or more images
</span><span class='line'>$ sudo docker images
</span><span class='line'>REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
</span></code></pre></td></tr></table></div></figure>


<p>But it would be add a pipe like <code>sudo docker images -q | uniq</code></p>

<h3>Connect To Existing Running Container</h3>

<h4>Docker 1.3 Ways</h4>

<p>From Docker 1.3, we could use <code>docker exec -it</code> for attaching to running container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -i -t centos /bin/bash
</span><span class='line'>[root@1f9005d495c6 /]# 
</span><span class='line'>$ sudo docker ps
</span><span class='line'>[sudo] password for Trusty: 
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span><span class='line'>1f9005d495c6        centos:7            "/bin/bash"         8 minutes ago       Up 8 minutes                            sick_jones          
</span><span class='line'>$ sudo docker exec -it 1f9005d495c6 /bin/bash
</span><span class='line'>[root@1f9005d495c6 /]# 
</span></code></pre></td></tr></table></div></figure>


<p>But the Container&rsquo;s lifecycle is controlled by the first instance, <code>docker exec</code> only attached to, this means if you exit the container, all of the <code>docker exec</code> tty will be shutdown.</p>

<h4>Nsenter Ways</h4>

<p>First use <code>docker inspect</code> for get the PID.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker ps 
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span><span class='line'>8337ea52cfd1        centos:7            "/bin/bash"         4 seconds ago       Up 4 seconds                            pensive_blackwell   
</span><span class='line'>$ PID=$(sudo docker inspect --format  8337ea52cfd1)
</span><span class='line'>$ echo $PID
</span><span class='line'>3951
</span></code></pre></td></tr></table></div></figure>


<p>Use nsenter for enter the PID&rsquo;s namespace:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo nsenter --target $PID --mount --uts --ipc --net --pid
</span><span class='line'>[root@8337ea52cfd1 /]#
</span></code></pre></td></tr></table></div></figure>


<h4>Lazy Wrap of Nsenter Ways</h4>

<p>Just visit:   <br/>
<a href="https://github.com/jpetazzo/nsenter">https://github.com/jpetazzo/nsenter</a>, download the docker-enter, and place it in the right place:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker ps 
</span><span class='line'>[sudo] password for Trusty: 
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span><span class='line'>8337ea52cfd1        centos:7            "/bin/bash"         11 minutes ago      Up 11 minutes                           pensive_blackwell   
</span><span class='line'>$ sudo docker-enter pensive_blackwell ls -la
</span><span class='line'>...
</span><span class='line'>$ sudo docker-enter 8337ea52cfd1 /bin/bash
</span><span class='line'>[root@8337ea52cfd1 /]# 
</span></code></pre></td></tr></table></div></figure>


<h4>Docker Attach</h4>

<p>If you attach to the container, you must remember, better you use tmux holding the whole instance.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker ps
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span><span class='line'>057435c2f1cb        centos:7            "/bin/bash"         5 seconds ago       Up 4 seconds                            evil_kirch          
</span><span class='line'>$ sudo docker attach 057435c2f1cb
</span><span class='line'>[root@057435c2f1cb /]# ls
</span><span class='line'>bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  selinux  srv  sys  tmp  usr  var
</span></code></pre></td></tr></table></div></figure>


<p>Once you quit from the &ldquo;attached&rdquo; tty, the origin tty will also quit.</p>

<h3>More System Info</h3>

<p>Use <code>docker info</code> to get more detailed system infos:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker info
</span><span class='line'>Containers: 3
</span><span class='line'>Images: 3
</span><span class='line'>Storage Driver: devicemapper
</span><span class='line'> Pool Name: docker-253:1-397799-pool
</span><span class='line'> Pool Blocksize: 65.54 kB
</span><span class='line'> Data file: /var/lib/docker/devicemapper/devicemapper/data
</span><span class='line'> Metadata file: /var/lib/docker/devicemapper/devicemapper/metadata
</span><span class='line'> Data Space Used: 563.1 MB
</span><span class='line'> Data Space Total: 107.4 GB
</span><span class='line'> Metadata Space Used: 1.069 MB
</span><span class='line'> Metadata Space Total: 2.147 GB
</span><span class='line'> Library Version: 1.02.84-RHEL7 (2014-03-26)
</span><span class='line'>Execution Driver: native-0.2
</span><span class='line'>Kernel Version: 3.10.0-123.8.1.el7.x86_64
</span><span class='line'>Operating System: CentOS Linux 7 (Core)
</span><span class='line'>$ sudo docker images
</span><span class='line'>REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
</span><span class='line'>centos              7                   8efe422e6104        3 weeks ago         224 MB
</span><span class='line'>centos              centos7             8efe422e6104        3 weeks ago         224 MB
</span><span class='line'>centos              latest              8efe422e6104        3 weeks ago         224 MB
</span><span class='line'>$ sudo docker ps -a
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                       PORTS               NAMES
</span><span class='line'>057435c2f1cb        centos:7            "/bin/bash"         3 minutes ago       Exited (0) 54 seconds ago                        evil_kirch          
</span><span class='line'>8337ea52cfd1        centos:7            "/bin/bash"         21 minutes ago      Exited (127) 4 minutes ago                       pensive_blackwell   
</span><span class='line'>1f9005d495c6        centos:7            "/bin/bash"         34 minutes ago      Exited (0) 24 minutes ago                        sick_jones          
</span></code></pre></td></tr></table></div></figure>


<h3>Commit Changes</h3>

<p>Install the vim in the running container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -i -t centos /bin/bash
</span><span class='line'>[sudo] password for Trusty: 
</span><span class='line'>[root@ea29113ba0e1 /]# which vim
</span><span class='line'>/usr/bin/which: no vim in (/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin)
</span><span class='line'>[root@ea29113ba0e1 /]# yum install -y vim
</span></code></pre></td></tr></table></div></figure>


<p>In another container, commit the changes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker commit ea29113ba0e1 vim_installed
</span><span class='line'>54cebb627e37600e81a832616eb3253af5dd26d0d248b9a9251e23bc8c93567d
</span><span class='line'>$ sudo docker images
</span><span class='line'>REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
</span><span class='line'>vim_installed       latest              54cebb627e37        12 seconds ago      362.6 MB
</span><span class='line'>centos              latest              8efe422e6104        3 weeks ago         224 MB
</span><span class='line'>centos              7                   8efe422e6104        3 weeks ago         224 MB
</span><span class='line'>centos              centos7             8efe422e6104        3 weeks ago         224 MB
</span></code></pre></td></tr></table></div></figure>


<p>Next time if you want to use the vim installed images, simply run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -it vim_installed /bin/bash
</span><span class='line'>[root@4b76f0c7bc46 /]# which vim
</span><span class='line'>/usr/bin/vim
</span></code></pre></td></tr></table></div></figure>


<h3>Job Controlling</h3>

<p>Use environment variables for recording the running job:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ JOB=$(sudo docker run -d vim_installed /bin/sh -c "while true; do echo Hello World; sleep 1; done")
</span><span class='line'>$ echo $JOB
</span><span class='line'>5dcb0884d27077e84ef4fea7fc0b3e8151657e92e0c2d4d1e33f84483715dfb9
</span></code></pre></td></tr></table></div></figure>


<p>Examine the log from the app&rsquo;s output:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker logs $JOB
</span><span class='line'>$ sudo docker logs --follow $JOB
</span></code></pre></td></tr></table></div></figure>


<p>Add &ndash;follow will continue to view the log output.  <br/>
Stop the running container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker stop $JOB
</span><span class='line'>5dcb0884d27077e84ef4fea7fc0b3e8151657e92e0c2d4d1e33f84483715dfb9
</span></code></pre></td></tr></table></div></figure>


<p>Start the stopped container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker start $JOB
</span><span class='line'>5dcb0884d27077e84ef4fea7fc0b3e8151657e92e0c2d4d1e33f84483715dfb9
</span></code></pre></td></tr></table></div></figure>


<p>Or Restart:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker restart $JOB
</span></code></pre></td></tr></table></div></figure>


<p>Or kill:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker kill $JOB
</span></code></pre></td></tr></table></div></figure>


<p>Notice the kill exit code is -1:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker ps
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span><span class='line'>$ sudo docker ps -a
</span><span class='line'>CONTAINER ID        IMAGE                  COMMAND                CREATED             STATUS                        PORTS               NAMES
</span><span class='line'>5dcb0884d270        vim_installed:latest   "/bin/sh -c 'while t   9 minutes ago       Exited (-1) 8 seconds ago                         focused_pike 
</span></code></pre></td></tr></table></div></figure>


<p><code>sudo docker rm $JOB</code> will remove the job.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/26/using-new-do-system/">Using New DO System</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-26T23:05:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:05 pm</span></time>
        
         | <a href="/blog/2015/01/26/using-new-do-system/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since the coreOS met some critical errors, I have to re-construct the DO System using CentOS. So I destroyed the old CoreOS machine, runs CentOS.</p>

<h3>Configure</h3>

<h3>Install packages</h3>

<p>Update and install vim</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ yum update
</span><span class='line'>$ yum install vim
</span></code></pre></td></tr></table></div></figure>


<h4>Add Swap</h4>

<p>512M is not enough for playing, enlarge the swapfile.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># dd if=/dev/zero of=/swapfile bs=1M count=1024
</span><span class='line'># chmod 600 /swapfile
</span><span class='line'># mkswap /swapfile
</span><span class='line'>$ sudo vim /etc/systemd/system/swap.service
</span><span class='line'> [Unit]  
</span><span class='line'> Description=Turn on swap  
</span><span class='line'> [Service]  
</span><span class='line'> Type=oneshot  
</span><span class='line'> Environment="SWAPFILE=/swapfile"
</span><span class='line'> RemainAfterExit=true  
</span><span class='line'> ExecStartPre=/usr/sbin/losetup -f ${SWAPFILE}  
</span><span class='line'> ExecStart=/usr/bin/sh -c "/sbin/swapon $(/usr/sbin/losetup -j ${SWAPFILE} | /usr/bin/cut -d : -f 1)"  
</span><span class='line'> ExecStop=/usr/bin/sh -c "/sbin/swapoff $(/usr/sbin/losetup -j ${SWAPFILE} | /usr/bin/cut -d : -f 1)"  
</span><span class='line'> ExecStopPost=/usr/bin/sh -c "/usr/sbin/losetup -d $(/usr/sbin/losetup -j ${SWAPFILE} | /usr/bin/cut -d : -f 1)"  
</span><span class='line'> [Install]  
</span><span class='line'> WantedBy=multi-user.target 
</span><span class='line'>$ sudo  systemctl enable /etc/systemd/system/swap.service  
</span><span class='line'>$ sudo systemctl start swap  
</span></code></pre></td></tr></table></div></figure>


<p>Now the swapfile is 1000MB, enough for doing various operations.</p>

<h4>Add new user</h4>

<p>Add new user and changes its password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># useradd -m -g root -G root -s /bin/bash Trusty
</span><span class='line'># passwd Trusty
</span></code></pre></td></tr></table></div></figure>


<p>Change the sshd configuration, disable root login, and change the listening port.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vim /etc/ssh/sshd_config
</span><span class='line'>port changes, 
</span><span class='line'>PermitRootLogin no
</span></code></pre></td></tr></table></div></figure>


<p>Now reboot the system, you will got a safe DigitalOcean machine.</p>

<h3>Build OpenContrail</h3>

<p>The repo is the same as the above article, then we install other packages which needed for CengOS.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo yum install -y libtool kernel-devel 
</span><span class='line'>$ sudo yum install -y bzip2 boost-devel tbb-devel libcurl-devel libxml2-devel 
</span></code></pre></td></tr></table></div></figure>


<p>Install epel via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo yum install -y https://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-5.noarch.rpm
</span><span class='line'>$ sudo sed -i -e 's/enabled=1/enabled=0/' /etc/yum.repos.d/epel.repo 
</span></code></pre></td></tr></table></div></figure>


<p>Install following packages from epel:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo yum install -y --disablerepo="*" --enablerepo="epel" scons protobuf protobuf-devel protobuf-compiler 
</span><span class='line'>$  sudo yum install -y python-lxml patch unzip flex bison gcc-c++ openssl-devel make wget python-setuptools
</span></code></pre></td></tr></table></div></figure>


<p>So now you could run the whole compilation via <code>scons</code> under the ~/Code folder.   <br/>
tips: tmux&rsquo;s q will quit ctrl+b mode.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/26/using-do-for-building-opencontrail/">Using DO for Building OpenContrail</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-26T20:32:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:32 pm</span></time>
        
         | <a href="/blog/2015/01/26/using-do-for-building-opencontrail/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since the network environment is not good(In fact, very bad), because of the GFW, so I have to build the opencontrail packages in digitalOcean. Following is the tips and how-to.</p>

<h3>Preparation</h3>

<p>First we have to get the Latest Ubuntu images, and let it OK for building the OpenContrail:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker search ubuntu
</span><span class='line'>.....
</span><span class='line'>$ docker pull ubuntu
</span><span class='line'>$ docker run -i -t ubuntu /bin/bash
</span><span class='line'>root@4c74f2890dbe:/# apt-get update
</span></code></pre></td></tr></table></div></figure>


<p>Now we run into the ubuntu build environment. This is where we want to build the whole opencontrail deb file.  <br/>
Install curl and then install repo:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get install curl
</span><span class='line'># mkdir -p ~/bin
</span><span class='line'># curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo
</span><span class='line'># chmod 777 /root/bin/repo
</span><span class='line'># apt-get install vim
</span><span class='line'># vim ~/.bashrc
</span><span class='line'>export PATH=/root/bin:$PATH
</span><span class='line'># source ~/.bashrc
</span><span class='line'># which repo
</span><span class='line'>/root/bin/repo
</span></code></pre></td></tr></table></div></figure>


<p>Now repo became usable in our system.  <br/>
Install following packages(So many packages!!!) for preparing the building of the opencontrail:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get install -y scons git python-lxml wget gcc patch make unzip flex bison g++ libssl-dev autoconf automake libtool pkg-config vim python-dev python-setuptools libprotobuf-dev protobuf-compiler libsnmp-python libboost-dev libboost-chrono-dev libboost-date-time-dev libboost-filesystem-dev libboost-program-options-dev libboost-python-dev libboost-regex-dev libboost-system-dev libcurl4-openssl-dev google-mock libgoogle-perftools-dev liblog4cplus-dev libtbb-dev libhttp-parser-dev libxml2-dev libicu-dev
</span></code></pre></td></tr></table></div></figure>


<p>Use tmux for holding the building context:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get install tmux
</span><span class='line'># tmux new -s "BuildContrail"
</span></code></pre></td></tr></table></div></figure>


<h3>Clone The Code</h3>

<p>Create the directories and then configure the git&rsquo;s username and Email.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mkdir Code
</span><span class='line'># cd Code/
</span><span class='line'>#  git config --global user.email kkkttt@gmail.com
</span><span class='line'># git config --global user.name kkkttt
</span><span class='line'># ssh-keygen
</span></code></pre></td></tr></table></div></figure>


<p>Upload the generate <code>id_rsa.pub</code> to the github.com, then let your machine verified by github.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ssh -T git@github.com
</span><span class='line'>Hi kkkttt! You've successfully authenticated, but GitHub does not provide shell access.
</span></code></pre></td></tr></table></div></figure>


<p>Now you could use repo for syncing back the code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mkdir -p ~/Code
</span><span class='line'># cd ~/Code
</span><span class='line'># repo init -u git@github.com:Juniper/contrail-vnc
</span><span class='line'># repo sync 
</span></code></pre></td></tr></table></div></figure>


<h3>Third-Party</h3>

<p>There is little trick in syncing the 3rd party source code back, you have to manually create the folder and let it writable, then modify the source code of the python file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mkdir -p /tmp/cache/root/
</span><span class='line'># chmod -R /tmp/cache/root/
</span><span class='line'># vim third_party/*.py
</span><span class='line'>_PACKAGE_CACHE='/tmp/cache/' + os.environ['USER'] + '/third_party'
</span><span class='line'>_PACKAGE_CACHE='/tmp/cache/root/' + '/third_party'
</span></code></pre></td></tr></table></div></figure>


<p>Now use following command for syncing the 3rd party packages back:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># python third_party/fetch_packages.py
</span></code></pre></td></tr></table></div></figure>


<h3>Build</h3>

<p>Building is pretty easy, simply type <code>scons</code> then everything is automatically on-going.  <br/>
Troubles, if you don&rsquo;t specify USER, then the error will be raised, complains the os.environ[&lsquo;USER&rsquo;] got nothing, then scons will be halt.       <br/>
Solution:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># declare -x USER="root"
</span></code></pre></td></tr></table></div></figure>


<p>Then the build begin, and it will last for a long time.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/13">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/11">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/07/13/wh-worktips-11/">WH Worktips(11)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/12/wh-worktips-10/">WH Worktips(10)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/10/wh-worktips-9/">WH Worktips(9)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/09/wh-worktips-8/">WH Worktips(8)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/07/wh-worktips-7/">WH Worktips(7)</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
