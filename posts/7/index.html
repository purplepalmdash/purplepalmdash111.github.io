
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="Image Conversion Convert the vdi files into qcow2 file: 1
$ qemu-img convert -f vdi -O qcow2 Windows81.vdi Windows81.qcow2 Then continue to create &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/7">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//fonts.googleapis.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/16/spice-client/">Spice Client</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-11-16T21:20:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:20 pm</span></time>
        
         | <a href="/blog/2015/11/16/spice-client/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Image Conversion</h3>

<p>Convert the vdi files into qcow2 file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ qemu-img convert -f vdi -O qcow2 Windows81.vdi Windows81.qcow2</span></code></pre></td></tr></table></div></figure>


<p>Then continue to create the virtual machine via importing the img.</p>

<h3>Spice Client</h3>

<p>Using virtviewer for view the remote machine.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S virtviewer
</span><span class='line'>$ remote-viewer spice://localhost:5900</span></code></pre></td></tr></table></div></figure>


<p>Or you could view the desktop via <code>spicec</code>.</p>

<p>The listening port could be view via <code>netstat -anp | grep 5900</code>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/13/win10-tips-for-using-xshell/">Win10 Tips for Using Xshell</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-11-13T15:59:16+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:59 pm</span></time>
        
         | <a href="/blog/2015/11/13/win10-tips-for-using-xshell/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Won&rsquo;t change the size of the window when you disable the window size:</p>

<p><img src="/images/Xshell_1.jpg" alt="/images/Xshell_1.jpg" /></p>

<p>When using vim, the wrappered module should be disable, thus won&rsquo;t cause you
mis-editing the content of the file:</p>

<p><img src="/images/Xshell_2.jpg" alt="/images/Xshell_2.jpg" /></p>

<p>The configuration should be applied to each session.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/13/variety/">Variety</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-11-13T11:05:05+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:05 am</span></time>
        
         | <a href="/blog/2015/11/13/variety/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>参考</h3>

<p><a href="http://peterlevi.com/variety/how-to-install/">http://peterlevi.com/variety/how-to-install/</a></p>

<h3>安装</h3>

<p>Ubuntu上，从ppa安装:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo add-apt-repository ppa:peterlevi/ppa
</span><span class='line'>$ sudo apt-get update
</span><span class='line'>$ sudo apt-get install variety</span></code></pre></td></tr></table></div></figure>


<h3>配置</h3>

<p>安装完毕后，在终端下键入<code>variety</code>即可开始配置该软件，第一次会询问是否创建一个用于多终端
主机之间同步桌面壁纸的账户:</p>

<p><img src="/images/2015_11_13_11_10_35_755x507.jpg" alt="/images/2015_11_13_11_10_35_755x507.jpg" /></p>

<p>这一步是可选的，我们在这里先注册上. 需要注意的是，用翻墙后的浏览器完成注册.</p>

<p>一般情况下这里就能使用了，但是awesome桌面环境下需要增加一下这行:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /home/XXXXXXX/.config/variety/scripts/set_wallpaper
</span><span class='line'>### Finally we comes to awesome!  
</span><span class='line'>awsetbg "$WP" 2&gt; /dev/null</span></code></pre></td></tr></table></div></figure>


<p>Or: if you use newer version of awesome, awsetbg won&rsquo;t take effect, use feh instead:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>feh --bg-scale "$WP" 2&gt;/dev/null</span></code></pre></td></tr></table></div></figure>


<h3>进一步美化</h3>

<p>Awesome下就只能换换壁纸，本身终端也不支持透明度的配置，如果是gnome之类的桌面环境，可以
把terminal emulator的透明度打开，能获得很好的视觉效果。</p>

<p>默认的更新频率是5分钟更新一次，当然在配置界面下可以更改为更短/更长的时限。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/05/good-material/">Good Material</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-11-05T10:41:22+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:41 am</span></time>
        
         | <a href="/blog/2015/11/05/good-material/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Movie</h3>

<p>Sorted by director:  <br/>
<a href="http://pan.baidu.com/share/home?uk=72456331&amp;view=share#category/type=0">http://pan.baidu.com/share/home?uk=72456331&amp;view=share#category/type=0</a></p>

<h3>Good BookMark Of Zhihu</h3>

<p><a href="http://www.zhihu.com/collection/38938285?page=2">http://www.zhihu.com/collection/38938285?page=2</a></p>

<h3>Linux Wondering</h3>

<p><a href="http://i.linuxtoy.org/docs/guide/index.html">http://i.linuxtoy.org/docs/guide/index.html</a></p>

<h3>Oh My Zsh</h3>

<p><a href="https://github.com/robbyrussell/oh-my-zsh">https://github.com/robbyrussell/oh-my-zsh</a></p>

<p><a href="http://www.kafeitu.me/shell/2012/03/25/oh-my-zsh.html">http://www.kafeitu.me/shell/2012/03/25/oh-my-zsh.html</a></p>

<p><a href="https://github.com/robbyrussell/oh-my-zsh/wiki/themes">https://github.com/robbyrussell/oh-my-zsh/wiki/themes</a></p>

<p><a href="http://segmentfault.com/a/1190000002658335">http://segmentfault.com/a/1190000002658335</a></p>

<h3>Wondering In Guangzhou</h3>

<p><a href="http://www.zhihu.com/question/36159147">http://www.zhihu.com/question/36159147</a></p>

<h3>Impress.js</h3>

<p>Use this javascript for writing the PPT. <br/>
<a href="https://github.com/impress/impress.js">https://github.com/impress/impress.js</a></p>

<h3>Programming On Dialog</h3>

<p><a href="http://www.cyberciti.biz/tips/spice-up-your-unix-linux-shell-scripts.html">http://www.cyberciti.biz/tips/spice-up-your-unix-linux-shell-scripts.html</a></p>

<p><a href="https://techbase.kde.org/Development/Tutorials/Shell_Scripting_with_KDE_Dialogs">https://techbase.kde.org/Development/Tutorials/Shell_Scripting_with_KDE_Dialogs</a></p>

<h3>Remote Control Of Arduino</h3>

<p><a href="http://www.geek-workshop.com/thread-25230-1-1.html">http://www.geek-workshop.com/thread-25230-1-1.html</a></p>

<h3>Processing</h3>

<p><a href="http://open.sina.com.cn/course/id_300/lesson_4094/">http://open.sina.com.cn/course/id_300/lesson_4094/</a></p>

<h3>KVM Hardware</h3>

<p><a href="http://www.cnblogs.com/sammyliu/p/4548194.html">http://www.cnblogs.com/sammyliu/p/4548194.html</a></p>

<h3>OVS Howto</h3>

<p><a href="http://roan.logdown.com/posts/191801-set-openvswitch">http://roan.logdown.com/posts/191801-set-openvswitch</a> <br/>
<a href="http://openvswitch.org/support/config-cookbooks/vlan-configuration-cookbook/">http://openvswitch.org/support/config-cookbooks/vlan-configuration-cookbook/</a> <br/>
<a href="http://notes.yuwh.net/%E5%9C%A8centos7%E4%B8%8A%E9%85%8D%E7%BD%AEopen-vswitch%E5%92%8Cvxlan/">http://notes.yuwh.net/%E5%9C%A8centos7%E4%B8%8A%E9%85%8D%E7%BD%AEopen-vswitch%E5%92%8Cvxlan/</a></p>

<h3>Good Books</h3>

<p><a href="http://pan.baidu.com/share/home?uk=2704770694&amp;view=share#category/type=0">http://pan.baidu.com/share/home?uk=2704770694&amp;view=share#category/type=0</a></p>

<p><a href="http://www.hi-pda.com/forum/viewthread.php?tid=1774264&amp;extra=page%3D1">http://www.hi-pda.com/forum/viewthread.php?tid=1774264&amp;extra=page%3D1</a></p>

<h3>TOP 5 NEW python module</h3>

<p><a href="blog.rtwilson.com/my-top-5-new-python-modules-of-2015">blog.rtwilson.com/my-top-5-new-python-modules-of-2015</a></p>

<h3>NSX</h3>

<p><a href="http://182.92.228.21:8080/chat/ZhibOrDianb?videoNu=video2015_12_02&amp;userId=#rd&amp;sukey=7f8f3cb2e9b0da45ed3acfb7ec91e76ac7b569b3d3190e352be587f5c2a9299faa83829a51886d2e5093f49a8ea542db">http://182.92.228.21:8080/chat/ZhibOrDianb?videoNu=video2015_12_02&amp;userId=#rd&amp;sukey=7f8f3cb2e9b0da45ed3acfb7ec91e76ac7b569b3d3190e352be587f5c2a9299faa83829a51886d2e5093f49a8ea542db</a></p>

<p><a href="http://blog.remibergsma.com/2015/04/04/adding-a-kvm-cluster-with-nsx-networking-to-cloudstack/">http://blog.remibergsma.com/2015/04/04/adding-a-kvm-cluster-with-nsx-networking-to-cloudstack/</a></p>

<p><a href="http://dailyhypervisor.com/blog-posts/">http://dailyhypervisor.com/blog-posts/</a></p>

<h3>Improve VM Performance</h3>

<p><a href="http://download.techtarget.com.cn//guide/2014/11/improvevmperformance.pdf">http://download.techtarget.com.cn//guide/2014/11/improvevmperformance.pdf</a></p>

<h3>Top 10 Projects</h3>

<p><a href="https://linux.cn/article-6911-1.html?utm_source=weibo&amp;utm_medium=weibo">https://linux.cn/article-6911-1.html?utm_source=weibo&amp;utm_medium=weibo</a></p>

<h3>Using docker building images</h3>

<p><a href="https://github.com/ContainerTribe/diskimage-builder-dockerfile">https://github.com/ContainerTribe/diskimage-builder-dockerfile</a></p>

<h3>Things to be done</h3>

<ol>
<li>Mirgration from hard-disk to USB disk.</li>
<li>Hacking into the mouse.</li>
<li>bootstrap themes.
<a href="http://startbootstrap.com/template-categories/all/">http://startbootstrap.com/template-categories/all/</a></li>
</ol>


<h3>Around opengl</h3>

<p><a href="http://www.oschina.net/news/69978/linux-kernel-4-4-lts#0-tsina-1-39202-397232819ff9a47a7b7e80a40613cfe1">http://www.oschina.net/news/69978/linux-kernel-4-4-lts#0-tsina-1-39202-397232819ff9a47a7b7e80a40613cfe1</a></p>

<h3>Life Quality</h3>

<p><a href="https://www.zhihu.com/question/26522007">https://www.zhihu.com/question/26522007</a></p>

<h3>Necklace</h3>

<p><a href="http://search.smzdm.com/?c=faxian&amp;s=%E9%A1%B9%E9%93%BE+%E7%9B%B4%E9%82%AE&amp;p=2">http://search.smzdm.com/?c=faxian&amp;s=%E9%A1%B9%E9%93%BE+%E7%9B%B4%E9%82%AE&amp;p=2</a></p>

<h3>Game Dev 101</h3>

<p><a href="https://blog.openshift.com/game-development-101-with-openshift/">https://blog.openshift.com/game-development-101-with-openshift/</a></p>

<h3>Good Shop</h3>

<p><a href="http://i.biopatent.cn/">http://i.biopatent.cn/</a></p>

<h3>LED DIY</h3>

<p><a href="http://www.geek-workshop.com/thread-25319-1-1.html">http://www.geek-workshop.com/thread-25319-1-1.html</a></p>

<h3>python new book</h3>

<p>python爱好者  <br/>
新书推荐《data Wrangling with Python Tips and Tools to Make Your Life Easier》</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/05/frdm-kl02z-tips-1/">FRDM-KL02Z Tips(1)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-11-05T09:53:38+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:53 am</span></time>
        
         | <a href="/blog/2015/11/05/frdm-kl02z-tips-1/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Reference Material: <br/>
<a href="http://www.freescale.com/zh-Hans/products/arm-processors/kinetis-cortex-m/l-series/freedom-development-platform-for-the-kinetis-kl02-family:FRDM-KL02Z?tab=In-Depth_Tab">http://www.freescale.com/zh-Hans/products/arm-processors/kinetis-cortex-m/l-series/freedom-development-platform-for-the-kinetis-kl02-family:FRDM-KL02Z?tab=In-Depth_Tab</a></p>

<h3>Minicom</h3>

<p>115200/data-bit: 8/ no parity/stop bit 1.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/04/cloudstack-vrlian-jie-shu/">CloudStack VR连接数</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-11-04T10:56:12+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:56 am</span></time>
        
         | <a href="/blog/2015/11/04/cloudstack-vrlian-jie-shu/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>All-In-One VR性能测试</h2>

<h3>测试环境</h3>

<h4>硬件</h4>

<p><strong>CPU</strong>: Intel&reg; Core&trade; i7-3770 CPU @ 3.40GHz, 四核八线程。 <br/>
<strong>内存</strong>: 24 G。</p>

<h4>虚拟机网络</h4>

<p><strong>虚拟机网络</strong>: 新建网段为10.82.89.0/24, DHCP范围设置如下，NAT转发外网: <br/>
<img src="/images/2015_11_04_09_24_37_479x293.jpg" alt="/images/2015_11_04_09_24_37_479x293.jpg" /></p>

<h4>All-In-One 虚拟机</h4>

<p><strong>CPU</strong>: 6 Core, Copy Host CPU Configuration。     <br/>
<strong>内存</strong>: 8 G。
<strong>硬盘</strong>: 200 G。
<strong>系统</strong>: Ubuntu 14.04 x86_64。  <br/>
<strong>CloudStack版本</strong>: 4.5.2。</p>

<h4>CloudStack环境</h4>

<p><strong>Zone</strong>: Advance Zone(PerfZone)。 <br/>
<strong>IP</strong>: 取10.82.89.0/24中DHCP尚未使用的IP地址。    <br/>
<strong>测试机模板</strong>: ubuntu64perftest.qcow2(<a href="http://192.168.0.79/ubuntu64perftest.qcow2">http://192.168.0.79/ubuntu64perftest.qcow2</a>) <br/>
<strong>测试机套餐</strong>: 2 Core, 内存3G。</p>

<h4>拓扑图及说明</h4>

<p><img src="/images/allinone.jpeg" alt="/images/allinone.jpeg" /></p>

<p>IP地址说明:</p>

<p><strong>All-In-One</strong>:  10.82.89.89   <br/>
<strong>Test Server</strong>: CloudStack实例，NAT后的10.82.89.0/24地址  <br/>
<strong>VR</strong>: CloudStack自动分配的10.82.89.0/24地址  <br/>
<strong>KVM</strong>: All-In-One上运行的虚拟机，绑定8个IP地址, 10.82.89.11/10.82.89.254~10.82.89.247</p>

<h3>测试方法</h3>

<p>Test Server上运行一个可支持多用户长时间在线的服务端程序，并可统计同时在线人数，接受外部
客户端发来的服务请求。</p>

<p>Test Client上运行一个快速发起并保持连接的客户端程序，服务端地址指向Test Server, 服务端
口即Test Server上服务端程序监听的端口。</p>

<p>单个IP最多支持6万多个活动连接，为了提升单台机器能支持的同时在线人数，需要在Test Client
上同时绑定多个网卡，kvm最多支持8个网卡，60000*8=500000, 单台机可以发起并保持的连接数超
过50万。</p>

<p>Server端代码下载地址:  <br/>
<a href="https://gist.github.com/yongboy/5318930/raw/ccf8dc236da30fcf4f89567d567eaf295b363d47/server.c">https://gist.github.com/yongboy/5318930/raw/ccf8dc236da30fcf4f89567d567eaf295b363d47/server.c</a></p>

<p>Client端代码下载地址:</p>

<p><a href="https://gist.github.com/yongboy/5324779/raw/f29c964fcd67fefc3ce66e487a44298ced611cdc/client2.c">https://gist.github.com/yongboy/5324779/raw/f29c964fcd67fefc3ce66e487a44298ced611cdc/client2.c</a></p>

<h3>打开各节点限制</h3>

<p>在All-In-One机器/Test Server/Test Client上，均需要打开以下限制:</p>

<h4>最大文件句柄数</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim /etc/security/limits.conf
</span><span class='line'>
</span><span class='line'>* soft nofile 104857
</span><span class='line'>* hard nofile 104857</span></code></pre></td></tr></table></div></figure>


<h4>最大文件数限制</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim /etc/sysctl.conf
</span><span class='line'>fs.file-max=1048576
</span><span class='line'># sudo sysctl -p /etc/sysctl.conf</span></code></pre></td></tr></table></div></figure>


<p></p>

<h4>conntrack最大连接数</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim /etc/sysctl.conf
</span><span class='line'>net.netfilter.nf_conntrack_max = 6553500
</span><span class='line'># sysctl -p /etc/sysctl.conf</span></code></pre></td></tr></table></div></figure>


<h4>可用端口数</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim /etc/sysctl.conf
</span><span class='line'>    net.ipv4.ip_local_port_range= 1024 65535
</span><span class='line'># sysctl -p /etc/sysctl.conf</span></code></pre></td></tr></table></div></figure>


<p>更改完毕后，需要重新启动机器生效，为了使sysctl的配置每次都生效，可以考虑将命令加到启动
项中。</p>

<h3>测试过程</h3>

<h4>启动Server端：</h4>

<p>Server端启动后将监听服务器端的8000端口：</p>

<p><img src="/images/2015_11_04_10_25_54_816x191.jpg" alt="/images/2015_11_04_10_25_54_816x191.jpg" /></p>

<h4>启动Client端：</h4>

<p>单机多网卡</p>

<p>在All-In-One机器上，由下面的命令启动qemu实例,则可以得到8块网卡的虚拟机, 内存大小<code>-m
5120</code>可以调小，一般1024～2048就够:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo qemu-system-x86_64 -net nic,model=virtio,macaddr=52:54:00:12:34:56,vlan=1
</span><span class='line'>-net tap,vlan=1 -net nic,model=virtio,macaddr=52:54:00:12:34:57,vlan=2 -net
</span><span class='line'>tap,vlan=2 -net nic,model=virtio,macaddr=52:54:00:12:34:58,vlan=3 -net
</span><span class='line'>tap,vlan=3 -net nic,model=virtio,macaddr=52:54:00:12:34:59,vlan=4 -net
</span><span class='line'>tap,vlan=4 -net nic,model=virtio,macaddr=52:54:00:12:34:60,vlan=5 -net
</span><span class='line'>tap,vlan=5 -net nic,model=virtio,macaddr=52:54:00:12:34:61,vlan=6 -net
</span><span class='line'>tap,vlan=6 -net nic,model=virtio,macaddr=52:54:00:12:34:62,vlan=7 -net
</span><span class='line'>tap,vlan=7 -net nic,model=virtio,macaddr=52:54:00:12:34:63,vlan=8 -net
</span><span class='line'>tap,vlan=8 -hda ./ubuntu64perftest.qcow2 -m 5120 --enable-kvm</span></code></pre></td></tr></table></div></figure>


<p>启动虚拟机后, 在虚拟机里设置地址(默认只从eth0得到dhcp地址):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat ./ethernet.sh
</span><span class='line'>ifconfig eth1 up
</span><span class='line'>ifconfig eth1 192.168.1.254
</span><span class='line'>ifconfig eth2 up
</span><span class='line'>ifconfig eth2 192.168.1.253
</span><span class='line'>ifconfig eth3 up
</span><span class='line'>ifconfig eth3 192.168.1.252
</span><span class='line'>ifconfig eth4 up
</span><span class='line'>ifconfig eth4 192.168.1.251
</span><span class='line'>ifconfig eth5 up
</span><span class='line'>ifconfig eth5 192.168.1.250
</span><span class='line'>ifconfig eth6 up
</span><span class='line'>ifconfig eth6 192.168.1.249
</span><span class='line'>ifconfig eth7 up
</span><span class='line'>ifconfig eth7 192.168.1.248</span></code></pre></td></tr></table></div></figure>


<p>客户端中，发起海量连接的脚本:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> cat startbomb.sh 
</span><span class='line'>#!/bin/sh
</span><span class='line'>./client2 -h 192.168.1.109 -p 8000 -m 64000 -o
</span><span class='line'>192.168.1.16,192.168.1.254,192.168.1.253,192.168.1.252, 
</span><span class='line'>192.168.1.251,192.168.1.250,192.168.1.249,192.168.1.248</span></code></pre></td></tr></table></div></figure>


<p>调用<code>./startbomb.sh</code>即可开始对Server端发起大量在线连接</p>

<h3>测试截图</h3>

<p>这里记录一次完整的VR因为过多连接数造成内存耗尽自动重启的过程。</p>

<p>在CloudStack的实例上运行server端程序, 此时的输出如下:</p>

<p>VR的<code>top</code>输出:</p>

<p><img src="/images/2015_11_02_21_11_06_810x293.jpg" alt="/images/2015_11_02_21_11_06_810x293.jpg" /></p>

<p>Server输出:</p>

<p><img src="/images/2015_11_02_21_13_37_788x205.jpg" alt="/images/2015_11_02_21_13_37_788x205.jpg" /></p>

<p>客户端开始发包连接的过程中:</p>

<p>10W:</p>

<p><img src="/images/2015_11_02_21_15_11_794x589.jpg" alt="/images/2015_11_02_21_15_11_794x589.jpg" /></p>

<p>20W:</p>

<p><img src="/images/2015_11_02_21_15_53_841x563.jpg" alt="/images/2015_11_02_21_15_53_841x563.jpg" /></p>

<p>30W:</p>

<p><img src="/images/2015_11_02_21_16_35_902x622.jpg" alt="/images/2015_11_02_21_16_35_902x622.jpg" /></p>

<p>40W:</p>

<p><img src="/images/2015_11_02_21_17_19_869x654.jpg" alt="/images/2015_11_02_21_17_19_869x654.jpg" /></p>

<p>44W, VR轰挂:</p>

<p><img src="/images/2015_11_02_21_18_06_813x689.jpg" alt="/images/2015_11_02_21_18_06_813x689.jpg" /></p>

<p>此时查看VR的重启时间:</p>

<p><img src="/images/2015_11_02_21_18_56_665x149.jpg" alt="/images/2015_11_02_21_18_56_665x149.jpg" /></p>

<p>可以看到VR启动时间很短，这证明VR由于内存耗尽已经自动重启了。</p>

<h3>应对策略</h3>

<h4>暂时应对</h4>

<p>在VR上对每个进/出 虚拟路由器的IP作连接数限制，TCP/UDP都需要设置。ICMP暂时未作限定:</p>

<p>Iptables规则如下:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-A PREROUTING -i eth0 -p tcp  -m connlimit --connlimit-above 1000 --connlimit-mask 32 
</span><span class='line'>--connlimit-saddr -j DROP
</span><span class='line'>-A PREROUTING -i eth2 -p tcp  -m connlimit --connlimit-above 1000 --connlimit-mask 32
</span><span class='line'>--connlimit-saddr -j DROP
</span><span class='line'>-A PREROUTING -i eth0 -p udp  -m connlimit --connlimit-above 1000 --connlimit-mask 32
</span><span class='line'>--connlimit-saddr -j DROP
</span><span class='line'>-A PREROUTING -i eth2 -p udp  -m connlimit --connlimit-above 1000 --connlimit-mask 32
</span><span class='line'>--connlimit-saddr -j DROP</span></code></pre></td></tr></table></div></figure>


<p>添加完此规则后，Test Server最多可接受1000个同时在线连接。这时在Client端发起大量连接超过
1000的都会被VR的iptables规则链丢弃。</p>

<h4>潜在问题</h4>

<p>对于过多过快的攻击性连接，VR匹配iptables会造成VR CPU占用率过高。建议采用硬件防火墙来阻
挡这类
攻击。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/01/moving-cloudstack-from-vm-to-physical-node/">Moving CloudStack From VM to Physical Node</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-11-01T08:52:08+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>8:52 am</span></time>
        
         | <a href="/blog/2015/11/01/moving-cloudstack-from-vm-to-physical-node/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>AIM</h3>

<p>To move the All-In-One CloudStack environment from kvm VM based to physical
machine.</p>

<h3>Copy VM Disk</h3>

<h3>Based On Ubuntu15.04</h3>

<p>First get all of the deb file from
<code>http://cloudstack.apt-get.eu/ubuntu/dists/trusty/4.5/pool/</code></p>

<p>Then setup a local repository, edit its <code>/etc/apt/sources.list</code> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim /etc/apt/sources.list
</span><span class='line'>deb http://192.168.1.13/        cloudstackdeb/</span></code></pre></td></tr></table></div></figure>


<p>Problem, For we have setup the ovsbr0 on Ubuntu15.04, how to solve its
networking together with cloudstack?</p>

<h3>Newly installed CentOS7</h3>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/10/29/thinking-in-vr/">Thinking in VR</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-10-29T16:00:39+08:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>4:00 pm</span></time>
        
         | <a href="/blog/2015/10/29/thinking-in-vr/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Restriction of the connections.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>http://www.cnblogs.com/cmt/archive/2013/03/13/2957583.html
</span><span class='line'>http://bbs.m0n0china.org/viewthread.php?tid=16459
</span><span class='line'>http://my.oschina.net/u/1169079/blog/397705</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/10/29/use-autohotkey-together-with-synergy/">Use AutoHotKey Together With Synergy</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-10-29T09:07:18+08:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:07 am</span></time>
        
         | <a href="/blog/2015/10/29/use-autohotkey-together-with-synergy/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I am using Surface Pro as my second screen, my main screen runs Linux, whose
Copy/Paste could be done via mouse(mouse left key for selecting and copy to clipboard,
middle key for pasting). While the Windows doesn&rsquo;t have the same configuration for
Copy/Paste(You could only use Ctrl+c/Ctrl+v), which makes me feels so low-efficiency.
That&rsquo;s why I use AutoHotKey.</p>

<h3>Installation</h3>

<p>Download the AutoHotKey from  <br/>
<a href="http://www.autohotkey.com/">http://www.autohotkey.com/</a></p>

<p>Install it on Windows 8.1.</p>

<h3>Configuration</h3>

<p>Create a directory named <code>AutoHotKey</code> on <code>C:\</code>, then create a file named
<code>CopyPaste.ahk</code>, then right-click it and select <code>Edit Script</code>, fill in following
content, which is copied from
<a href="http://autohotkey.com/board/topic/44064-copy-on-select-implementation/">http://autohotkey.com/board/topic/44064-copy-on-select-implementation/</a>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mousedrag_treshold := 20 ; pixels
</span><span class='line'>middleclick_available := 15 ; seconds
</span><span class='line'>
</span><span class='line'>Hotkey mbutton, paste_selection
</span><span class='line'>Hotkey mbutton, off
</span><span class='line'>Hotkey rbutton, cancel_paste
</span><span class='line'>Hotkey rbutton, off
</span><span class='line'>    
</span><span class='line'>    
</span><span class='line'>#IfWinNotActive ahk_class ConsoleWindowClass
</span><span class='line'>~lButton::
</span><span class='line'>  MouseGetPos, mousedrag_x, mousedrag_y
</span><span class='line'>  keywait lbutton
</span><span class='line'>  mousegetpos, mousedrag_x2, mousedrag_y2
</span><span class='line'>  if (abs(mousedrag_x2 - mousedrag_x) &gt; mousedrag_treshold
</span><span class='line'>    or abs(mousedrag_y2 - mousedrag_y) &gt; mousedrag_treshold)
</span><span class='line'>  {
</span><span class='line'>    wingetclass class, A
</span><span class='line'>    if (class == "Emacs")
</span><span class='line'>      sendinput !w
</span><span class='line'>    else
</span><span class='line'>      sendinput ^c
</span><span class='line'>    settimer follow_mouse, 100
</span><span class='line'>    settimer cleanup, % middleclick_available * 1000
</span><span class='line'>    hotkey mbutton, on
</span><span class='line'>    hotkey rbutton, on
</span><span class='line'>  }
</span><span class='line'>  return
</span><span class='line'>#IfWinNotActive
</span><span class='line'>  
</span><span class='line'>  
</span><span class='line'>follow_mouse:
</span><span class='line'>  tooltip copy
</span><span class='line'>  return
</span><span class='line'>  
</span><span class='line'>paste_selection:
</span><span class='line'>  sendinput {lbutton}
</span><span class='line'>  WinGetClass class, A
</span><span class='line'>  if (class == "Emacs")
</span><span class='line'>    SendInput ^y
</span><span class='line'>  else
</span><span class='line'>    SendInput ^v
</span><span class='line'>  gosub cleanup
</span><span class='line'>  return
</span><span class='line'>  
</span><span class='line'>cancel_paste:
</span><span class='line'>  sendinput {rbutton}
</span><span class='line'>  gosub cleanup
</span><span class='line'>  return  
</span><span class='line'>  
</span><span class='line'>cleanup:
</span><span class='line'>  Hotkey mbutton, off
</span><span class='line'>  Hotkey rbutton, off
</span><span class='line'>  SetTimer cleanup, off
</span><span class='line'>  settimer follow_mouse, off
</span><span class='line'>  tooltip
</span><span class='line'>  Return
</span><span class='line'>  
</span><span class='line'>  
</span><span class='line'>;; clipx
</span><span class='line'>^mbutton::
</span><span class='line'>  sendinput ^+{insert}
</span><span class='line'>  return</span></code></pre></td></tr></table></div></figure>


<p>Now double click it, test its functionality. On Windows, using the real mouse, you will
find the activity are the same as in Linux/Unix X.</p>

<p>But failed integration with Synergy!</p>

<h3>True X-Mouse Gizmo</h3>

<p>Since the AutoHotKey failed with synergy, I have to swith to another method.</p>

<p>Download it from:</p>

<p><a href="http://fy.chalmers.se/~appro/nt/TXMouse/">http://fy.chalmers.se/~appro/nt/TXMouse/</a></p>

<p>Add it into the startup file in Windows 8.</p>

<p>Add the shortlink into <code>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp</code>
,then restart the computer, verify the modification.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/10/25/openstack-libertyan-zhuang-1/">OpenStack Liberty安装(1)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-10-25T12:05:58+08:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:05 pm</span></time>
        
         | <a href="/blog/2015/10/25/openstack-libertyan-zhuang-1/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>初始化准备</h3>

<p>用Packer.io制作Ubuntu14.04的qcow2文件镜像, 设定磁盘大小为100G, lvm分区.  <br/>
网络: 在virt-manager中制作一个网段为10.0.0.0/24的网段. 所有创建虚拟机的eth0均
加入到此网络中.   <br/>
<img src="/images/2015_10_25_12_22_24_504x487.jpg" alt="/images/2015_10_25_12_22_24_504x487.jpg" /></p>

<p>To be Continued.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/8">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/6">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/03/17/tips-on-5050rgb-2/">Tips on 5050RGB(2)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/16/vagrant-libvirt-playing/">Vagrant-libvirt Playing</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/15/ba-wan-ebuddy-4/">把玩ebuddy(4)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/15/shi-yong-squidhuan-cun-suo-you-rpm-slash-deban-zhuang-bao/">使用squid缓存所有rpm/deb安装包</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/13/yong-vagrantguan-li-libvirt/">用Vagrant管理libvirt</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
