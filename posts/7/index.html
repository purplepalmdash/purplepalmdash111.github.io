
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="数据源准备 数据源地址在: http://210.72.1.216:8080/gzaqi_new/RealTimeDate.html 但是这个地址取回数据比较困难。而在http://www.gzepb.gov.cn/
右侧的栏里可以通过点击，打开某个监测点当前的空气质量指数,例如海珠湖的数据位于 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/7">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//fonts.googleapis.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/15/yong-graphitecheng-xian-yan-zhou-kong-qi-zhi-liang/">用Graphite呈现广州空气质量</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-15T10:05:39+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:05 am</span></time>
        
         | <a href="/blog/2015/12/15/yong-graphitecheng-xian-yan-zhou-kong-qi-zhi-liang/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>数据源准备</h3>

<p>数据源地址在:   <br/>
<a href="http://210.72.1.216:8080/gzaqi_new/RealTimeDate.html">http://210.72.1.216:8080/gzaqi_new/RealTimeDate.html</a></p>

<p>但是这个地址取回数据比较困难。而在<a href="http://www.gzepb.gov.cn/">http://www.gzepb.gov.cn/</a>
右侧的栏里可以通过点击，打开某个监测点当前的空气质量指数,例如海珠湖的数据位于:</p>

<p><a href="http://210.72.1.216:8080/gzaqi_new/DataList2.html?EPNAME=%E6%B5%B7%E7%8F%A0%E6%B9%96">http://210.72.1.216:8080/gzaqi_new/DataList2.html?EPNAME=%E6%B5%B7%E7%8F%A0%E6%B9%96</a></p>

<h3>Beautiful Soup</h3>

<p>Beautiful Soup可以被理解为网页爬虫，用于爬取某个页面并取回所需信息。在Ubuntu/Debian系统
中，安装命令如下。同时为了使用对XML解析速度更快的lxml解析器，我们安装python-lxml:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install -y python-bs4
</span><span class='line'>$ sudo apt-get install -y python-lxml </span></code></pre></td></tr></table></div></figure>


<p></p>

<p>现在我们打开某个终端，开始用命令行交互的方式，取回海珠湖监测点的数据:</p>

<p>首先，引入所需的库：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># python
</span><span class='line'>Python 2.7.6 (default, Jun 22 2015, 17:58:13) 
</span><span class='line'>[GCC 4.8.2] on linux2
</span><span class='line'>Type "help", "copyright", "credits" or "license" for more information.
</span><span class='line'>&gt;&gt;&gt; from bs4 import BeautifulSoup
</span><span class='line'>&gt;&gt;&gt; import urllib2
</span><span class='line'>&gt;&gt;&gt; response = urllib2.urlopen('http://210.72.1.216:8080/gzaqi_new/DataList2.html?EPNAME=%E6%B5%B7%E7%8F%A0%E6%B9%96')
</span><span class='line'>&gt;&gt;&gt; print response.info()
</span><span class='line'>Content-Length: 10216
</span><span class='line'>Content-Type: text/html
</span><span class='line'>Last-Modified: Wed, 13 May 2015 08:12:28 GMT
</span><span class='line'>Accept-Ranges: bytes
</span><span class='line'>ETag: "b680828d548dd01:da2"
</span><span class='line'>Server: Microsoft-IIS/6.0
</span><span class='line'>X-Powered-By: ASP.NET
</span><span class='line'>Date: Tue, 15 Dec 2015 02:25:17 GMT
</span><span class='line'>Connection: close
</span><span class='line'>
</span><span class='line'>&gt;&gt;&gt; html = response.read()
</span><span class='line'>&gt;&gt;&gt; print "Get the length :", len(html)
</span><span class='line'>Get the length : 10216
</span><span class='line'>&gt;&gt;&gt; response.close()  # best practice to close the file</span></code></pre></td></tr></table></div></figure>


<p>上述的操作里调用urllib2取回了页面， html变量里包含了该网页的内容。接下来我们使用
BeautifulSoup来美化并从中取回我们想要的元素。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&gt;&gt;&gt; soup = BeautifulSoup(html, 'html.parser')    
</span><span class='line'>&gt;&gt;&gt; print soup.prettify()</span></code></pre></td></tr></table></div></figure>


<p>仔细检查后发现，用urllib2取回的网页中，html变量里未包含当前的数据值。通过阅读代码得知，
当前页面的值是浏览器在载入网页时执行javascript函数得到的。因而我们使用一个真实的浏览器
来实现页面的抓取。</p>

<p>Selenium是一套用于进行浏览器自动化测试的开源工具集，可进行Web应用的端到端测试
。Selenium主要包括两个工具：一是Selenium IDE，二是Selenium WebDriver（简称
WebDriver）. 安装命令如下:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pip install selenium</span></code></pre></td></tr></table></div></figure>


<p>使用selenium抓取该网页的代码如下:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&gt;&gt;&gt; from contextlib import closing
</span><span class='line'>&gt;&gt;&gt; from selenium.webdriver import Firefox
</span><span class='line'>&gt;&gt;&gt; from selenium.webdriver.support.ui import WebDriverWait
</span><span class='line'>&gt;&gt;&gt; url='http://210.72.1.216:8080/gzaqi_new/DataList2.html?EPNAME=%E6%B5%B7%E7%8F%A0%E6%B9%96'
</span><span class='line'>&gt;&gt;&gt; with closing(Firefox()) as browser:
</span><span class='line'>...   browser.get(url)
</span><span class='line'>...   page_source = browser.page_source
</span><span class='line'>... 
</span><span class='line'>&gt;&gt;&gt; print page_source
</span><span class='line'>&gt;&gt;&gt; soup = BeautifulSoup(page_source, 'html.parser')
</span><span class='line'>&gt;&gt;&gt; print soup</span></code></pre></td></tr></table></div></figure>


<p>现在我们可以看到，取回的<code>page_source</code>变量中已经包含有该时段的数据。接下来就是如何把数据
从其中提取出来的过程。</p>

<p>定位到含有数据的表格, 根据其层叠结构，获得tr的值:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&gt;&gt;&gt; table = soup.find('table', {'class': 'headTable'})
</span><span class='line'>&gt;&gt;&gt; for td in table.tbody.tr:
</span><span class='line'>...     print td
</span><span class='line'>... 
</span><span class='line'>&lt;td class="SO2_24H"&gt;7&lt;/td&gt;
</span><span class='line'>&lt;td class="NO2_24H"&gt;50&lt;/td&gt;
</span><span class='line'>&lt;td class="PM10_24H"&gt;29&lt;/td&gt;
</span><span class='line'>&lt;td class="CO_24H"&gt;31&lt;/td&gt;
</span><span class='line'>&lt;td class="O3_8H_24H"&gt;18&lt;/td&gt;
</span><span class='line'>&lt;td class="PM25_24H"&gt;25&lt;/td&gt;
</span><span class='line'>&lt;td class="AQI"&gt;50&lt;/td&gt;
</span><span class='line'>&lt;td class="Pollutants"&gt;—&lt;/td&gt;
</span><span class='line'>&lt;td class="jibie2"&gt;--&lt;/td&gt;
</span><span class='line'>&lt;td class="jibie2"&gt;一级&lt;/td&gt;
</span><span class='line'>&lt;td class="leibie"&gt;优                  &lt;/td&gt;
</span><span class='line'>&lt;td class="yanse"&gt;&lt;img alt="" src="Images/you.jpg"/&gt;&lt;/td&gt;</span></code></pre></td></tr></table></div></figure>


<p>更进一步得到值:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&gt;&gt;&gt; for td in table.tbody.tr:
</span><span class='line'>...     print td.contents[0]
</span><span class='line'>... 
</span><span class='line'>7
</span><span class='line'>50
</span><span class='line'>29
</span><span class='line'>31
</span><span class='line'>18
</span><span class='line'>25
</span><span class='line'>50
</span><span class='line'>—
</span><span class='line'>--
</span><span class='line'>一级
</span><span class='line'>优                  
</span><span class='line'>&lt;img alt="" src="Images/you.jpg"/&gt;</span></code></pre></td></tr></table></div></figure>


<p>对应的图片如下:</p>

<p><img src="/images/2015_12_15_12_06_23_943x201.jpg" alt="/images/2015_12_15_12_06_23_943x201.jpg" /></p>

<p>提取出来了数据，就可以做后续处理了。</p>

<h3>Graphite</h3>

<p>Graphite的搭建过程不提及。基于我们前面提取出的数据，只需要将其写入Graphite，就可以看
到数据的显示了。</p>

<p>具体的写入代码参考(需翻墙):</p>

<p><a href="http://coreygoldberg.blogspot.com/2012/04/python-getting-data-into-graphite-code.html">http://coreygoldberg.blogspot.com/2012/04/python-getting-data-into-graphite-code.html</a></p>

<p>按照博客中提供的例子，写入到Graphite后的数据在Graphite看起来是这样的:</p>

<p><img src="/images/2015_12_15_14_48_48_318x115.jpg" alt="/images/2015_12_15_14_48_48_318x115.jpg" /></p>

<p>而对应的数据格式则如下:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> sending message:
</span><span class='line'>     system.monitorserver.loadavg_1min 0.18 1450161396
</span><span class='line'>     system.monitorserver.loadavg_5min 0.25 1450161396
</span><span class='line'>     system.monitorserver.loadavg_15min 0.23 1450161396</span></code></pre></td></tr></table></div></figure>


<p>我们可以仿照这样的数据来组织自己的空气质量数据。</p>

<h3>数据来源再加工</h3>

<p>前面取回地址失败， 因为它只是返回空气日报的地址，我们需要的是实时情况，所以还是回到  <br/>
<a href="http://210.72.1.216:8080/gzaqi_new/RealTimeDate.html">http://210.72.1.216:8080/gzaqi_new/RealTimeDate.html</a></p>

<p>这里需要在selenium里模拟出鼠标快速点击所有链接的效果。</p>

<p>下面是一次完整的点击白云山按钮并获得PM2.5页面的过程:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@monitorserver:~/Code# python
</span><span class='line'>Python 2.7.6 (default, Jun 22 2015, 17:58:13) 
</span><span class='line'>[GCC 4.8.2] on linux2
</span><span class='line'>Type "help", "copyright", "credits" or "license" for more information.
</span><span class='line'>&gt;&gt;&gt; from contextlib import closing
</span><span class='line'>&gt;&gt;&gt; from selenium.webdriver import Firefox
</span><span class='line'>&gt;&gt;&gt; from selenium.webdriver.support.ui import WebDriverWait
</span><span class='line'>&gt;&gt;&gt; driver = Firefox()                                                 
</span><span class='line'>&gt;&gt;&gt; driver.get('http://210.72.1.216:8080/gzaqi_new/RealTimeDate.html')
</span><span class='line'>&gt;&gt;&gt; driver.refresh()
</span><span class='line'>&gt;&gt;&gt; baiyunmountain=driver.find_element_by_id("白云山")
</span><span class='line'>&gt;&gt;&gt; baiyunmountain.click()
</span><span class='line'>&gt;&gt;&gt; PM25=driver.find_element_by_id("PM25")
</span><span class='line'>&gt;&gt;&gt; type(PM25)
</span><span class='line'>&lt;class 'selenium.webdriver.remote.webelement.WebElement'&gt;
</span><span class='line'>&gt;&gt;&gt; PM25.click()</span></code></pre></td></tr></table></div></figure>


<p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/12/ba-wan-tl-sg108e/">把玩TL-SG108E</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-12T11:02:34+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:02 am</span></time>
        
         | <a href="/blog/2015/12/12/ba-wan-tl-sg108e/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前段时间黑色星期五在美国亚马逊败了个TP-LINK TL-SG108E, 直邮到手人民币200不到.
本意是拿来以后在家里跑虚拟机时,虚拟机可以在不同的VLAN里作用,譬如单独的存储/管
理网络等.</p>

<h3>配置</h3>

<p>更改IP地址, 随意指定原有局域网内的某IP地址给交换机即可. 随后所有的节点均可添加
在交换机上.</p>

<h3>VLAN</h3>

<p>VLAN可以实现的功能, 位于不同交换机上的机器可以位于同一局域网内.</p>

<p><img src="/images/2015_12_12_14_25_15_724x626.jpg" alt="/images/2015_12_12_14_25_15_724x626.jpg" /></p>

<p>默认在交换机上打开的VLAN是基于端口的VLAN(Port Based VLAN), 我们这里配置的是
802.1Q VLAN, 打开以后,基于端口的VLAN将自动被禁止.</p>

<p><img src="/images/2015_12_12_15_16_33_541x300.jpg" alt="/images/2015_12_12_15_16_33_541x300.jpg" /></p>

<p>默认的配置页面如下:</p>

<p><img src="/images/2015_12_12_15_17_52_927x570.jpg" alt="/images/2015_12_12_15_17_52_927x570.jpg" /></p>

<p>Tag 与 Untagged方式的差别:</p>

<p>端口接收数据时：  <br/>
  如果端口是tagged方式，当数据包本身不包含VLAN的话，输入的数据包就加上该缺省
vlan；如果数据包本身已经包含了VLAN，那么就不再添加。  <br/>
  如果是untagged方式，输入的数据包全部都要加上该缺省vlan。不管输入的数据包是否
已经有VLAN标记。</p>

<p>端口发送数据时：  <br/>
  如果端口是tagged方式，如果端口缺省VLAN等于发送的数据包所含的VLAN，那么就会将
VLAN标记从发送的数据包中去掉；如果不相等，则数据包将带着VLAN发送出去，实现VLAN
的透传。   <br/>
  如果是untagged方式，则不管端口缺省VLAN为多少，是否等于要输出的数据包的VLAN，
都会将VLAN ID从数据包中去掉。</p>

<p>配置了vlan 22和33, 分别在7口和8口上.</p>

<h3>OVS 后的VLAN TAG</h3>

<p>在7口上接入一台Ubuntu服务器,配置为open-vswitch桥接, 虚拟机通过以下配置, 制定
VLAN ID为22.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># virsh edit Gentoo
</span><span class='line'>    &lt;interface type='bridge'&gt;
</span><span class='line'>      &lt;mac address='52:54:00:fd:03:e9'/&gt;
</span><span class='line'>      &lt;source bridge='ovsbr0'/&gt;
</span><span class='line'>      &lt;vlan trunk='yes'&gt;
</span><span class='line'>        &lt;tag id='22' nativeMode='untagged'/&gt;
</span><span class='line'>      &lt;/vlan&gt;
</span><span class='line'>      &lt;virtualport type='openvswitch'&gt;
</span><span class='line'>        &lt;parameters interfaceid='fb3e7f34-6fcd-41dc-8fed-c3ffe0d54b18'/&gt;
</span><span class='line'>      &lt;/virtualport&gt;
</span><span class='line'>      &lt;model type='virtio'/&gt;
</span><span class='line'>      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;
</span><span class='line'>    &lt;/interface&gt;
</span><span class='line'># virsh start Gentoo</span></code></pre></td></tr></table></div></figure>


<p>这样启动后的虚拟机<code>Gentoo</code>就处于VLAN ID 22隔离的网络里. 手动配置其IP地址为
<code>10.48.58.2</code>.</p>

<h3>物理机上的VLAN</h3>

<p>这里附带了Ubuntu On Jogger的过程, Joggler XUbuntu下载地址在:  <br/>
<a href="http://jwills.co.uk/projects/joggler-xubuntu/download/">http://jwills.co.uk/projects/joggler-xubuntu/download/</a></p>

<p>操作指令在:  <br/>
<a href="http://jwills.co.uk/projects/joggler-xubuntu/instructions/">http://jwills.co.uk/projects/joggler-xubuntu/instructions/</a></p>

<p>默认用户名/密码都是joggler.</p>

<p>我们需要在joggler上配置一个vlan, 和另一台机器上vlan后的虚拟机通信.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install -y vlan
</span><span class='line'>$ sudo modprobe 8021q
</span><span class='line'>$ sudo vconfig add eth0 22
</span><span class='line'>$ sudo ifconfig eth0.22 10.47.58.3/24 up
</span><span class='line'>$ sudo su -c 'echo "8021q"&gt;&gt;/etc/modules'
</span><span class='line'>$ cat /etc/module
</span><span class='line'>8021q
</span><span class='line'>$ sudo vim /etc/network/interface
</span><span class='line'>....
</span><span class='line'>auto eth0
</span><span class='line'>iface eth0 inet dhcp
</span><span class='line'>
</span><span class='line'>auto eth0.22
</span><span class='line'>iface eth0.22 inet static
</span><span class='line'>    address 10.47.58.3
</span><span class='line'>    netmask 255.255.255.0
</span><span class='line'>    vlan-raw-device eth0</span></code></pre></td></tr></table></div></figure>


<p>这样,重启以后, eth0.22会启动, 就可以通过VLAN 22 ping <code>10.47.58.2</code>了.</p>

<h3>换口</h3>

<p>把joggler从7口换到6口, 可以看到eth0还是可以通的,但是eth0.22则无法通信. 这是因
为我们只在7口和8口上添加了VLAN 22标记的缘故.换回7口,一切正常.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/10/openvswitch-on-ubuntu14-dot-04/">OpenVswitch on Ubuntu14.04</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-10T15:33:24+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:33 pm</span></time>
        
         | <a href="/blog/2015/12/10/openvswitch-on-ubuntu14-dot-04/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Installation</h3>

<p>Install openvswitch via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get update
</span><span class='line'># apt-get install -y openvswitch-common openvswitch-switch</span></code></pre></td></tr></table></div></figure>


<p>List the installed module via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># lsmod | grep open
</span><span class='line'>openvswitch            66901  0 
</span><span class='line'>gre                    13808  1 openvswitch
</span><span class='line'>vxlan                  37619  1 openvswitch
</span><span class='line'>libcrc32c              12644  1 openvswitch
</span><span class='line'># ovs-vsctl --version
</span><span class='line'>ovs-vsctl (Open vSwitch) 2.0.2
</span><span class='line'>Compiled May 13 2015 18:49:53</span></code></pre></td></tr></table></div></figure>


<h3>Configuration</h3>

<p>Edit the configuration of the networking:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo vim /etc/network/interfaces
</span><span class='line'>###########################################
</span><span class='line'>## By using openVswitch, we enabled the following
</span><span class='line'>###########################################
</span><span class='line'>auto ovsbr0
</span><span class='line'>iface ovsbr0 inet static
</span><span class='line'>address 192.168.1.xx
</span><span class='line'>netmask 255.255.0.0
</span><span class='line'>gateway 192.168.1.xx
</span><span class='line'>dns-nameservers 223.5.5.5 180.76.76.76</span></code></pre></td></tr></table></div></figure>


<p>Now configure the ovs-switched bridge:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ovs-vsctl add-br ovsbr0
</span><span class='line'># ovs-vsctl list-br
</span><span class='line'>ovsbr0
</span><span class='line'># ovs-vsctl add-port ovsbr0 eth0 && reboot</span></code></pre></td></tr></table></div></figure>


<p>Now restart the computer you will get the ovs-bridged network running.</p>

<h3>Bridged With VLAN</h3>

<p>Add/Remove port of the ovs-bridged:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ovs-vsctl add-port ovsbr0 tap0 tag=22
</span><span class='line'># ovs-vsctl show
</span><span class='line'>901c2b29-0764-4370-8d06-168b18339236
</span><span class='line'>    Bridge "ovsbr0"
</span><span class='line'>        Port "eth0"
</span><span class='line'>            Interface "eth0"
</span><span class='line'>        Port "tap0"
</span><span class='line'>            tag: 22
</span><span class='line'>            Interface "tap0"
</span><span class='line'>        Port "ovsbr0"
</span><span class='line'>            Interface "ovsbr0"
</span><span class='line'>                type: internal
</span><span class='line'>    ovs_version: "2.0.2"
</span><span class='line'># ovs-vsctl del-port ovsbr0 tap0</span></code></pre></td></tr></table></div></figure>


<p>If you want to remove the tag, then:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ovs-vsctl set port vnet0 tag=100
</span><span class='line'>ovs-vsctl remove port vnet0 tag 100</span></code></pre></td></tr></table></div></figure>


<h3>VLAN / OpenVswitch/ virt-manager</h3>

<p>Dumpxml will displayed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;interface type='bridge'&gt;
</span><span class='line'>  &lt;mac address='52:54:00:0e:6b:d1'/&gt;
</span><span class='line'>  &lt;source bridge='ovsbr0'/&gt;
</span><span class='line'>  &lt;vlan trunk='yes'&gt;
</span><span class='line'>    &lt;tag id='22' nativeMode='untagged'/&gt;
</span><span class='line'>  &lt;/vlan&gt;
</span><span class='line'>  &lt;virtualport type='openvswitch'&gt;
</span><span class='line'>    &lt;parameters interfaceid='d5b7b981-8998-44c0-9344-0ade6b69ec1f'/&gt;
</span><span class='line'>  &lt;/virtualport&gt;
</span><span class='line'>  &lt;target dev='vnet0'/&gt;
</span><span class='line'>  &lt;model type='virtio'/&gt;
</span><span class='line'>  &lt;alias name='net0'/&gt;
</span><span class='line'>  &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;
</span><span class='line'>&lt;/interface&gt;
</span><span class='line'>&lt;interface type='bridge'&gt;
</span><span class='line'>  &lt;mac address='52:54:00:3c:c9:24'/&gt;
</span><span class='line'>  &lt;source bridge='ovsbr0'/&gt;
</span><span class='line'>  &lt;vlan trunk='yes'&gt;
</span><span class='line'>    &lt;tag id='100' nativeMode='untagged'/&gt;
</span><span class='line'>  &lt;/vlan&gt;
</span><span class='line'>  &lt;virtualport type='openvswitch'&gt;
</span><span class='line'>    &lt;parameters interfaceid='06898d54-c0da-48c6-8b01-3307e70b995a'/&gt;
</span><span class='line'>  &lt;/virtualport&gt;
</span><span class='line'>  &lt;target dev='vnet1'/&gt;
</span><span class='line'>  &lt;model type='virtio'/&gt;
</span><span class='line'>  &lt;alias name='net1'/&gt;
</span><span class='line'>  &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/&gt;
</span><span class='line'>&lt;/interface&gt;
</span><span class='line'>&lt;interface type='bridge'&gt;
</span><span class='line'>  &lt;mac address='52:54:00:7b:e7:b0'/&gt;
</span><span class='line'>  &lt;source bridge='ovsbr0'/&gt;
</span><span class='line'>  &lt;virtualport type='openvswitch'&gt;
</span><span class='line'>    &lt;parameters interfaceid='303c1f65-23ff-4017-93ba-f196ca1d05fb'/&gt;
</span><span class='line'>  &lt;/virtualport&gt;
</span><span class='line'>  &lt;target dev='vnet2'/&gt;
</span><span class='line'>  &lt;model type='virtio'/&gt;
</span><span class='line'>  &lt;alias name='net2'/&gt;
</span><span class='line'>  &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/&gt;
</span><span class='line'>&lt;/interface&gt;</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/08/tessera-how-to/">Tessera How-to</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-08T10:26:48+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:26 am</span></time>
        
         | <a href="/blog/2015/12/08/tessera-how-to/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Installation</h3>

<p>Installation steps are listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get install -y python-virtualenv
</span><span class='line'># git clone git@github.com:urbanairship/tessera.git
</span><span class='line'># cd tessera
</span><span class='line'># virtualenv .
</span><span class='line'># . bin/activate
</span><span class='line'># cd tessera-server/
</span><span class='line'># pip install -r requirements.txt
</span><span class='line'># pip install -r dev-requirements.txt
</span><span class='line'># cd ../tessera-frontend
</span><span class='line'># apt-get install -y npm
</span><span class='line'># npm install -g grunt-cli
</span><span class='line'># npm install
</span><span class='line'># ln -s /usr/bin/nodejs /usr/bin/node
</span><span class='line'># grunt
</span><span class='line'># which inv
</span><span class='line'>/root/Code/second/tessera/bin/inv</span></code></pre></td></tr></table></div></figure>


<h3>Start</h3>

<p>Start the service via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cd /root/Code/second/tessera/tessera-server/
</span><span class='line'># inv db.init
</span><span class='line'># inv run &
</span><span class='line'># inv json.import 'demo/*'</span></code></pre></td></tr></table></div></figure>


<p>Open the browser and visit <code>http://localhost:5000</code>, you could see the tessera&rsquo;s web
front.</p>

<p><img src="/images/2015_12_08_11_42_52_998x527.jpg" alt="/images/2015_12_08_11_42_52_998x527.jpg" /></p>

<h3>Import Graphite Data</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(tessera)root@monitorserver:~/Code/second/tessera/tessera-server# vim tessera/config.py 
</span><span class='line'>root@monitorserver:~/Code/second/tessera# cat tessera-server/tessera/config.py
</span><span class='line'>GRAPHITE_URL               = 'http://192.168.10.192'
</span><span class='line'># inv graphite.import</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Now you could see the imported graphite data.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/07/rundeck-tips/">Rundeck Tips</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-07T11:58:55+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:58 am</span></time>
        
         | <a href="/blog/2015/12/07/rundeck-tips/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Installation</h3>

<p>Install the rundeck under CentOS 7:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># rpm -Uvh http://repo.rundeck.org/latest.rpm
</span><span class='line'># yum install rundeck</span></code></pre></td></tr></table></div></figure>


<h3>Configuration</h3>

<p>Configure some properties:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim /etc/rundeck/framework.properties
</span><span class='line'>framework.server.name = 192.168.0.79
</span><span class='line'>framework.server.hostname = 192.168.0.79
</span><span class='line'>framework.server.port = 4440
</span><span class='line'>framework.server.url = http://192.168.0.79:4440
</span><span class='line'># vim /etc/rundeck/rundeck-config.properties
</span><span class='line'>grails.serverURL=http://192.168.0.79:4440 </span></code></pre></td></tr></table></div></figure>


<p>Start the service:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># service rundeckd start
</span><span class='line'>Starting rundeckd (via systemctl):                         [  OK  ]</span></code></pre></td></tr></table></div></figure>


<p>You could check the status via <code># systemctl status rundeckd</code>.</p>

<p>Now visit the server via <a href="http://192.168.0.79:4440,">http://192.168.0.79:4440,</a> username/password are all <code>admin</code>, you should see following image:</p>

<p><img src="/images/2015_12_07_12_11_49_956x398.jpg" alt="/images/2015_12_07_12_11_49_956x398.jpg" /></p>

<p>Hint for creating project:</p>

<p><img src="/images/2015_12_07_12_13_56_694x389.jpg" alt="/images/2015_12_07_12_13_56_694x389.jpg" /></p>

<h3>Run</h3>

<p>Run command locally for creating an command based job.</p>

<p>In case of sudo requires a tty for executing the command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># visudo
</span><span class='line'>+ # Defaults    requiretty
</span><span class='line'>+ rundeck ALL=(ALL)   NOPASSWD: ALL </span></code></pre></td></tr></table></div></figure>


<p></p>

<h3>Reference</h3>

<p><a href="http://www.tuicool.com/articles/zuI3ua">http://www.tuicool.com/articles/zuI3ua</a></p>

<p><a href="http://www.oschina.net/p/rundeck">http://www.oschina.net/p/rundeck</a></p>

<p><a href="http://gunner.me/archives/488">http://gunner.me/archives/488</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/05/bluetooth-nap-how-to/">Bluetooth NAP How-To</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-05T20:03:41+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:03 pm</span></time>
        
         | <a href="/blog/2015/12/05/bluetooth-nap-how-to/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Notice</h3>

<p>Notice, this way is only for Bluez-5!!!!</p>

<p>Refers to:  <br/>
<a href="https://wiki.gentoo.org/wiki/Bluetooth_Network_Aggregation_Point">https://wiki.gentoo.org/wiki/Bluetooth_Network_Aggregation_Point</a> <br/>
<a href="https://wiki.gentoo.org/wiki/Bluetooth">https://wiki.gentoo.org/wiki/Bluetooth</a>   <br/>
<a href="http://blog.fraggod.net/2015/03/28/bluetooth-pan-network-setup-with-bluez-5x.html">http://blog.fraggod.net/2015/03/28/bluetooth-pan-network-setup-with-bluez-5x.html</a></p>

<p>Bluez-4 could be much more easier via <code>pand</code>. For example, in ubuntu you could
setup the bluetooth PAN via:</p>

<p><a href="http://blog.sumostyle.net/2009/11/ubuntu-tethering-via-bluetooth-pan/">http://blog.sumostyle.net/2009/11/ubuntu-tethering-via-bluetooth-pan/</a></p>

<h3>RF-KILL</h3>

<p>Use rfkill for unblock the soft-blocked bluetooth adapter:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@xxxx dash]# rfkill list bluetooth
</span><span class='line'>2: hp-bluetooth: Bluetooth
</span><span class='line'>        Soft blocked: yes
</span><span class='line'>        Hard blocked: no
</span><span class='line'>5: hci1: Bluetooth
</span><span class='line'>        Soft blocked: yes
</span><span class='line'>        Hard blocked: no
</span><span class='line'>[root@xxxx dash]# rfkill unblock bluetooth
</span><span class='line'>
</span><span class='line'># rfkill list bluetooth
</span><span class='line'>2: hp-bluetooth: Bluetooth
</span><span class='line'>        Soft blocked: no
</span><span class='line'>        Hard blocked: no
</span><span class='line'>5: hci1: Bluetooth
</span><span class='line'>        Soft blocked: no
</span><span class='line'>        Hard blocked: no</span></code></pre></td></tr></table></div></figure>


<h3>bluetoothctl</h3>

<p>Use bluetoothctl for configurating the bluetooth adapter:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@xxxx ]# bluetoothctl 
</span><span class='line'>[NEW] Controller 40:2C:xx:xx:xx:xx xxxx #2 [default]
</span><span class='line'>[bluetooth]# power on
</span><span class='line'>Changing power on succeeded
</span><span class='line'>[bluetooth]# discoverable on
</span><span class='line'>Changing discoverable on succeeded
</span><span class='line'>[bluetooth]# agent on
</span><span class='line'>Agent registered
</span><span class='line'>[bluetooth]# scan on</span></code></pre></td></tr></table></div></figure>


<h3>PAN</h3>

<p>Refers to:  <br/>
<a href="http://blog.fraggod.net/2015/03/28/bluetooth-pan-network-setup-with-bluez-5x.html">http://blog.fraggod.net/2015/03/28/bluetooth-pan-network-setup-with-bluez-5x.html</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>--- machine-1
</span><span class='line'>% bluetoothctl
</span><span class='line'>[NEW] Controller 00:02:72:XX:XX:XX malediction [default]
</span><span class='line'>[bluetooth]# power on
</span><span class='line'>Changing power on succeeded
</span><span class='line'>[CHG] Controller 00:02:72:XX:XX:XX Powered: yes
</span><span class='line'>[bluetooth]# discoverable on
</span><span class='line'>Changing discoverable on succeeded
</span><span class='line'>[CHG] Controller 00:02:72:XX:XX:XX Discoverable: yes
</span><span class='line'>[bluetooth]# agent on
</span><span class='line'>...
</span><span class='line'>
</span><span class='line'>--- machine-2 (snipped)
</span><span class='line'>% bluetoothctl
</span><span class='line'>[NEW] Controller 00:02:72:YY:YY:YY rpbox [default]
</span><span class='line'>[bluetooth]# power on
</span><span class='line'>[bluetooth]# scan on
</span><span class='line'>[bluetooth]# agent on
</span><span class='line'>[bluetooth]# pair 00:02:72:XX:XX:XX
</span><span class='line'>[bluetooth]# trust 00:02:72:XX:XX:XX</span></code></pre></td></tr></table></div></figure>


<p>Then Download the script from:</p>

<p><a href="https://github.com/mk-fg/fgtk/blob/master/bt-pan">https://github.com/mk-fg/fgtk/blob/master/bt-pan</a></p>

<p>This <code>bt-pan</code> will setup both the server and the client.</p>

<p>In Server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ bt-pan --debug server $br</span></code></pre></td></tr></table></div></figure>


<p>While the <code>$br</code> could be setup via following command(Take Gentoo for example):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim /etc/conf.d/net
</span><span class='line'>
</span><span class='line'>...
</span><span class='line'># Comment out this line, and add the following lines:
</span><span class='line'>#config_eth0="dhcp"
</span><span class='line'>config_eth0="null"
</span><span class='line'>bridge_br1="eth0"
</span><span class='line'>config_br1="dhcp"
</span><span class='line'># Next two lines, to make two values work (keep setfd before stp):
</span><span class='line'>brctl_br1="setfd 1
</span><span class='line'>stp on"
</span><span class='line'>...
</span><span class='line'># ln -s net.lo /etc/init.d/net.br1
</span><span class='line'># rc-service net.eth0 stop && rc-service net.br1 start
</span><span class='line'># rc-update add net.br1 default </span></code></pre></td></tr></table></div></figure>


<p>In the Client side, do following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ bt-pan client 00:02:72:XX:XX:XX</span></code></pre></td></tr></table></div></figure>


<p>Now check the both client and server, you will find <code>bnep0</code> interface has been
created, you could see it via <code>ifconfig bnep0</code>.</p>

<p>Assign the same IP network range address to the client side, as in the br1
side in server. After that you could ping each other via bluetooth!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/04/on-bluetooth-pan/">On Bluetooth PAN</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-04T10:51:10+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:51 am</span></time>
        
         | <a href="/blog/2015/12/04/on-bluetooth-pan/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>AIM</h3>

<p>For sharing the internet connection from working PC to Surface Pro.</p>

<h3>Setup And Configuration</h3>

<h4>SurfacePro</h4>

<p>Install bluez/bluez-libs/bluez-utils:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S bluez bluez-utils bluez-libs</span></code></pre></td></tr></table></div></figure>


<p>Modprobe the bnep kernel module:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@surfacepro ~]# modprobe bnep
</span><span class='line'>[root@surfacepro ~]# lsmod | grep bnep
</span><span class='line'>bnep                   20480  0
</span><span class='line'>bluetooth             450560  6 bnep,btbcm,btrtl,btusb,btintel
</span><span class='line'>[root@surfacepro ~]# modprobe btusb</span></code></pre></td></tr></table></div></figure>


<p>Start the bluetooth.service via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo systemctl start bluetooth.service</span></code></pre></td></tr></table></div></figure>


<p><code>bluetoothctl</code> will give access for configurating bluetooth equipment, following steps
shows how to connect to a bluetooth keyboard:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@surfacepro ~]# bluetoothctl 
</span><span class='line'>[NEW] Controller xx:xx:xx:xx:xx:xx surfacepro [default]
</span><span class='line'>[bluetooth]#
</span><span class='line'>[bluetooth]# agent KeyboardOnly 
</span><span class='line'>Agent registered
</span><span class='line'>[bluetooth]# default-agent      
</span><span class='line'>Default agent request successful
</span><span class='line'>[bluetooth]# power on
</span><span class='line'>[CHG] Controller xx:xx:xx:xx:xx:xx Class: 0x00011c
</span><span class='line'>Changing power on succeeded
</span><span class='line'>[CHG] Controller xx:XX:XX:XX:XX:XX Powered: yes
</span><span class='line'>[bluetooth]# scan on
</span><span class='line'>Discovery started
</span><span class='line'>[bluetooth]# pair D0:13:1E:11:F5:45
</span><span class='line'>Attempting to pair with D0:13:1E:11:F5:45
</span><span class='line'>[bluetooth]# connect D0:13:1E:11:F5:45</span></code></pre></td></tr></table></div></figure>


<p>Now try to connect to the keyboard, yes you could use keyboard for typing.</p>

<h4>PAN</h4>

<p>Network Aggregation Point - NAP</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/03/customize-surfacepro-kernel/">Customize SurfacePro Kernel</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-03T17:44:32+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>5:44 pm</span></time>
        
         | <a href="/blog/2015/12/03/customize-surfacepro-kernel/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Preparation</h3>

<p>Get the kernel and patch file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>To be Written</span></code></pre></td></tr></table></div></figure>


<h3>Build</h3>

<p>Prepare for compiliation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ make mrproper</span></code></pre></td></tr></table></div></figure>


<p>Get the current running configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ zcat /proc/config.gz &gt; .config
</span><span class='line'>$ make menuconfig
</span><span class='line'>$ make -j3
</span><span class='line'>$ make modules_install</span></code></pre></td></tr></table></div></figure>


<p>Install Kernel, you newly generated kernel will be named as
<code>vmlinuz-4.1.13-surfacepro3</code>(Though surfacepro, surfacepro3 will remains its name) :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo cp -v arch/x86/boot/bzImage /boot/vmlinuz-4.1.13-surfacepro3</span></code></pre></td></tr></table></div></figure>


<p>Generate the initial RAM disk:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo mkinitcpio -k 4.1.13-surfacepro3 -c /etc/mkinitcpio.conf -g  \ 
</span><span class='line'>/boot/initramfs-4.1.13-surfacepro3.img</span></code></pre></td></tr></table></div></figure>


<p>Copy System.map, it contains a list of kernel symbols.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo cp System.map /boot/System.map-4.1.13-surfacepro3
</span><span class='line'>$ sudo ln -sf /boot/System.map-4.1.13-surfacepro3 /boot/System.map</span></code></pre></td></tr></table></div></figure>


<p>Install the grub&rsquo;s configuration into grub.cfg:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo vim /etc/default/grub
</span><span class='line'>Edit with the name specified
</span><span class='line'>$ sudo grub-mkconfig -o /boot/grub/grub.cfg</span></code></pre></td></tr></table></div></figure>


<p>But still this modification didn&rsquo;t solve surfacepro&rsquo;s wireless problem. finally I have
to fall back to using yaourt&rsquo;s surfac pro kernel.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/25/awesomes-battery-indicator/">Awesome's Battery Indicator</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-11-25T12:18:29+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:18 pm</span></time>
        
         | <a href="/blog/2015/11/25/awesomes-battery-indicator/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Background</h3>

<p>I installed ArchLinux+Awesome On my SurfacePro, while the charger of Surface Pro is not
so tight to the pad. Thus I have to use a battery indicator in Awesome.</p>

<h3>Software</h3>

<p>Refers to:</p>

<p><a href="http://www.everythingisvoid.com/uncategorized/simple-battery-status-indicator-awesome-window-manager">http://www.everythingisvoid.com/uncategorized/simple-battery-status-indicator-awesome-window-manager</a></p>

<p>Install steps on ArchLinux:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S luarocks5.1 gobject-introspection acpi
</span><span class='line'>$ sudo luarocks-5.1 install battery_status</span></code></pre></td></tr></table></div></figure>


<p>You could manually run <code>show_battery_status</code> or add it into your own rc.lua file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim ~/.config/awesome/rc.lua
</span><span class='line'>----.....................
</span><span class='line'>autorunApps =
</span><span class='line'>{
</span><span class='line'>--.........
</span><span class='line'>"synergyc 192.168.0.119",
</span><span class='line'>"sudo echo 1240&gt;/sys/class/backlight/intel_backlight/brightness", 
</span><span class='line'>"fcitx",
</span><span class='line'>"show_battery_status", 
</span><span class='line'>----.....................</span></code></pre></td></tr></table></div></figure>


<p>Now restart the awesome you could see the battery indicator.</p>

<h3>Add Charging Indicator</h3>

<p>First download the source code from github:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/svarogg/battery_status</span></code></pre></td></tr></table></div></figure>


<p>Debug with luarocks loader:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rocks-5.1   lua5.1 -lluarocks.loader
</span><span class='line'>Lua 5.1.5  Copyright (C) 1994-2012 Lua.org, PUC-Rio
</span><span class='line'>&gt; require("rex_posix")
</span><span class='line'>&gt; rex = require("rex_posix")
</span><span class='line'>&gt; battery_rex = rex.new([[([^,]{1,3})%]])
</span><span class='line'>&gt; rex=require("rex_posix")
</span><span class='line'>&gt; battery_rex=rex.new([[([^,]{1,3})%]])
</span><span class='line'>&gt; acpi=io.popen('acpi 2&gt;&1')
</span><span class='line'>&gt; acpi_res = acpi:read("*line")
</span><span class='line'>&gt; acpi:close()
</span><span class='line'>&gt; print (acpi_res)
</span><span class='line'>Battery 0: Full, 100%
</span><span class='line'>&gt; percentage=battery_rex:match(acpi_res)
</span><span class='line'>&gt; print (percentage)
</span><span class='line'>100
</span><span class='line'>&gt; print(type(percentage))
</span><span class='line'>string
</span><span class='line'>&gt; print(type(tonumber(percentage)))
</span><span class='line'>number
</span><span class='line'>&gt; adapter = io.popen('acpi -a 2&gt;&1')
</span><span class='line'>&gt; adapter_res = adapter:read("*line")
</span><span class='line'>&gt; adapter:close()
</span><span class='line'>&gt; print(adapter_res)
</span><span class='line'>Adapter 0: on-line
</span><span class='line'>&gt; charge_rex = rex.new([[(on|off)]])
</span><span class='line'>&gt; print(charge_rex:match(adapter_res))
</span><span class='line'>on</span></code></pre></td></tr></table></div></figure>


<p>We get the status of the charge, then update the corresponding icon to the systray.</p>

<p>The modified repository could be fetched from:</p>

<p><a href="https://github.com/purplepalmdash/Awesome-Battery-Indicator">https://github.com/purplepalmdash/Awesome-Battery-Indicator</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/18/tips-on-archlinux-on-ssd-for-surfacepro/">Tips on ArchLinux on SSD for SurfacePro</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-11-18T16:59:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>4:59 pm</span></time>
        
         | <a href="/blog/2015/11/18/tips-on-archlinux-on-ssd-for-surfacepro/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Hardware</h3>

<p>Surface Pro, KingShare 128G SSD(USB).</p>

<p>Picture will be updated after successfully installed.</p>

<h3>Virtualbox Way</h3>

<p>Make a vmdk file which actually points to the USB Disk:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo VBoxManage internalcommands createrawvmdk -filename ./rawusb1.vmdk -rawdisk \ 
</span><span class='line'>/dev/disk/by-id/usb-KINGSHAR_KS-CUTS25W_123456789010-0:0
</span><span class='line'>$ sudo chown -R YourName rawusb1.vmdk</span></code></pre></td></tr></table></div></figure>


<p>Now using this rawdisk for starting the VirtualBox based machine.</p>

<p><img src="/images/2015_11_18_17_10_46_645x529.jpg" alt="/images/2015_11_18_17_10_46_645x529.jpg" /></p>

<h3>Installation</h3>

<p>The system installation is refers to following links:</p>

<p><a href="https://wiki.archlinux.org/index.php/Microsoft_Surface_Pro_3">https://wiki.archlinux.org/index.php/Microsoft_Surface_Pro_3</a></p>

<p><a href="https://wiki.archlinux.org/index.php/Installing_Arch_Linux_on_a_USB_key">https://wiki.archlinux.org/index.php/Installing_Arch_Linux_on_a_USB_key</a></p>

<h3>Updated Configuration</h3>

<p>Finally I installed the surface pro by using a usb dongle which burned the archlinux
installation iso, put it into the surface pro and startup the machine pressing power
key and volume down key, it will goes into the installtion steps.</p>

<p>Install the system on the SSD, the main steps are available at:</p>

<p><a href="http://purplepalmdash.github.io/blog/2014/06/16/archlinux-on-surface-pro/">http://purplepalmdash.github.io/blog/2014/06/16/archlinux-on-surface-pro/</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@archiso ~ # mount /dev/sdb2 /mnt
</span><span class='line'>root@archiso ~ # mount /dev/sdb1 /mnt/boot/EFI 
</span><span class='line'>root@archiso ~ # arch-chroot /mnt /bin/bash
</span><span class='line'>[root@archiso /]# grub-install --target=x86_64-efi --efi-directory=/boot/EFI \ 
</span><span class='line'>--bootloader-id=arch_grub --recheck
</span><span class='line'>[root@archiso /]# grub-mkconfig -o /boot/grub/grub.cfg</span></code></pre></td></tr></table></div></figure>


<p>Because I frequently change the installtion media(I have SSD and Harddisk), so
everytime I change the installtion media, I have to run above steps again.</p>

<h3>Kernel Configuration</h3>

<p>Install the kernel from yaourt, you could get the surfacepro3 compatiable linux kernel,
install it on surface pro will also be OK:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ yaourt surfacepro
</span><span class='line'>1 aur/linux-surfacepro3 4.3-1 [installed] (5)
</span><span class='line'>    The Linux-surfacepro3 kernel and modules
</span><span class='line'>2 aur/linux-surfacepro3-docs 4.3-1 (5)
</span><span class='line'>    Kernel hackers manual - HTML documentation that comes with the Linux-surfacepro3
</span><span class='line'>kernel
</span><span class='line'>3 aur/linux-surfacepro3-headers 4.3-1 (5)
</span><span class='line'>    Header files and scripts for building modules for Linux-surfacepro3 kernel</span></code></pre></td></tr></table></div></figure>


<p>After installation, you have to manually generate the grub items:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo grub-mkconfig -o /boot/grub/grub.cfg</span></code></pre></td></tr></table></div></figure>


<p>Now reboot the surface pro, you could view the kernel has been upgraded to our newly
installed version:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>➜  ~  uname -a
</span><span class='line'>Linux surfacepro 4.3.0-1-surfacepro3 #1 SMP PREEMPT Fri Nov 20 05:47:41 CST 2015 x86_64
</span><span class='line'>GNU/Linux</span></code></pre></td></tr></table></div></figure>


<p>With the new version of kernel, you won&rsquo;t face too much problems, my problem is when
using the official kernel, my wifi will get stucked, sometimes the machine will be
dead.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/8">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/6">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/04/05/extend-vagrants-disk/">Extend Vagrant's Disk</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/04/01/nodemcu-and-1602i2c-1/">NodeMCU and 1602I2C(1)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/31/nodemcu-and-1602i2c/">NodeMCU and 1602I2C</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/29/tips-on-shrinking-vhd-file/">Tips on Shrinking VHD File</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/29/monitoring-xenserver/">Monitoring XenServer</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
