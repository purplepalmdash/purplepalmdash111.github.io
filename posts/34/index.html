
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="Background I have BeagleBone Black and RaspberryPi, both of them are cute board. Previous I use BBB for home server, which holds my own Weather APP &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/34">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//fonts.googleapis.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/10/13/switch-from-bbb-to-raspberrypi/">Switch From BBB to RaspberryPI</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-10-13T20:27:00+08:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:27 pm</span></time>
        
         | <a href="/blog/2014/10/13/switch-from-bbb-to-raspberrypi/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Background</h3>

<p>I have BeagleBone Black and RaspberryPi, both of them are cute board. Previous I use BBB for home server, which holds my own Weather APP website, also serves as a sshd server, dynamic dns server, etc. While Rpi serves like a File server and download server.       <br/>
Now I want to use BBB for developing some funny things, that means I will transfer all of the functionalities which runs in BBB to Rpi. Following steps will record what I have done.   <br/>
Before start, update all of the software in Rpi(it runs archLinux):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -Syu --noconfirm
</span></code></pre></td></tr></table></div></figure>


<h3>sshd</h3>

<p>Previously the sshd on BeagleBone listens on port 3333, now I have to change it back to 22,</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/[root@alarmpi ~]# cat /etc/ssh/sshd_config
</span><span class='line'>
</span><span class='line'>#Port 3333
</span><span class='line'>Port 22
</span></code></pre></td></tr></table></div></figure>


<p>Restart the service via <code>systemctl restart sshd</code>, then you could directly ssh to <code>10.0.0.230</code>.</p>

<h3>DDns</h3>

<p>Previous the BBB acts as the Ddns client, thus hold a no-ip.biz based domain name.   <br/>
On BBB, because it runs the Debian7.1, so the no-ip2 configuraiton is :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:/etc# ps -ef | grep noip | grep -v grep
</span><span class='line'>nobody    3184     1  0 Oct07 ?        00:00:01 /usr/local/bin/noip2 -c /usr/local/etc/no-ip2.conf
</span></code></pre></td></tr></table></div></figure>


<p>While the configuration file is located at:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:/etc# cat /etc/rc.local
</span><span class='line'># By default this script does nothing.
</span><span class='line'># But we will call noip in this scirpt
</span><span class='line'>/usr/local/bin/noip2 -c /usr/local/etc/no-ip2.conf &
</span></code></pre></td></tr></table></div></figure>


<p>So first we should comment this line. Then activate the Rpi&rsquo;s no-ip2.</p>

<p>The Rpi&rsquo;s configuraiton is using systemd. <br/>
The corresponding configuration file is located at:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@alarmpi system]# pwd
</span><span class='line'>/usr/lib/systemd/system
</span><span class='line'>[root@alarmpi system]# cat noip2.service 
</span><span class='line'>[Unit]
</span><span class='line'>Description=No-IP Dynamic DNS Update Client
</span><span class='line'>After=network.target
</span><span class='line'>
</span><span class='line'>[Service]
</span><span class='line'>Type=forking
</span><span class='line'>ExecStart=/usr/bin/noip2 -c /etc/no-ip2.conf
</span><span class='line'>
</span><span class='line'>[Install]
</span><span class='line'>WantedBy=multi-user.target
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>Simply disable it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo systemctl disable noip2.service
</span></code></pre></td></tr></table></div></figure>


<h3>ssh with nopasswd</h3>

<p>Make sure all of the configuration is the same in <code>.ssh/authorized_keys</code> <br/>
Then you could change the port in router, change the default 22 port from BBB to Rpi.</p>

<p>Reboot the router, and BBB &amp; Rpi.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/24/convert-different-format-in-python/">Convert Different Format in Python</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-24T19:08:00+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>7:08 pm</span></time>
        
         | <a href="/blog/2014/09/24/convert-different-format-in-python/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The following commands is for directly convert ascii, numbers in python:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ python2
</span><span class='line'>&gt;&gt;&gt; str(unichr(97))
</span><span class='line'>'a'
</span><span class='line'>&gt;&gt;&gt; str(unichr(0x68))
</span><span class='line'>'h'
</span><span class='line'>&gt;&gt;&gt; str(unichr(0x5a))
</span><span class='line'>'Z'
</span><span class='line'>&gt;&gt;&gt; bin(0x2711)
</span><span class='line'>'0b10011100010001'
</span><span class='line'>&gt;&gt;&gt; 0x2711
</span><span class='line'>10001
</span><span class='line'>&gt;&gt;&gt; hex(1127)
</span><span class='line'>'0x467'
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/17/big-little-endian/">Big-Little Endian</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-17T11:49:00+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:49 am</span></time>
        
         | <a href="/blog/2014/09/17/big-little-endian/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>An elegant way for juding big-endian or little-endian of processor:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>eCCM2-root-root&gt; python -c "import sys;sys.exit(0 if sys.byteorder=='big' else 1)"
</span><span class='line'>eCCM2-root-root&gt; echo $?
</span><span class='line'>0
</span><span class='line'>[Trusty@~]$ python -c "import sys;sys.exit(0 if sys.byteorder=='big' else 1)"
</span><span class='line'>[Trusty@~]$ echo $?
</span><span class='line'>1
</span></code></pre></td></tr></table></div></figure>


<p>So we could see powerpc is the big-endian, while PC is little-endian.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/03/compare-pkg-content/">Compare Pkg Content</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-03T19:13:00+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>7:13 pm</span></time>
        
         | <a href="/blog/2014/09/03/compare-pkg-content/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Use dpkg for reading the content and compare with the official ones:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> dpkg -c ../../xxxxx_name.deb | awk '{print $3 $6}' | sort -n
</span></code></pre></td></tr></table></div></figure>


<p>Scripts for listing all of the content in the directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>for i in `ls *.deb`
</span><span class='line'>do
</span><span class='line'>    echo $i
</span><span class='line'>    dpkg -c $i
</span><span class='line'>done
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/03/opensuse-vlan-configuration-modification/">OpenSuse Vlan Configuration Modification</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-03T17:26:00+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>5:26 pm</span></time>
        
         | <a href="/blog/2014/09/03/opensuse-vlan-configuration-modification/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The command is listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>linux:/etc/udev # cd rules.d/
</span><span class='line'>linux:/etc/udev/rules.d # ls
</span><span class='line'>10-network.rules  55-libsane.rules  56-sane-backends-autoconfig.rules  70-kpartx.rules  70-persistent-net.rules  99-iwlwifi-led.rules
</span><span class='line'>linux:/etc/udev/rules.d # cat 70-persistent-net.rules
</span><span class='line'>SUBSYSTEM=="net", ATTR{address}=="00:xx:xx:xx:xx", NAME="eth1", DRIVERS=="?*"
</span><span class='line'>linux:/etc/udev/rules.d # cat /usr/lib/systemd/system/vlan.service
</span><span class='line'>[Unit]
</span><span class='line'>Description=Add Vlan Configure 
</span><span class='line'>Type=idle
</span><span class='line'>
</span><span class='line'>[Service]
</span><span class='line'>ExecStart=/usr/bin/vconfig.sh
</span><span class='line'>
</span><span class='line'>[Install]
</span><span class='line'>WantedBy=multi-user.target
</span></code></pre></td></tr></table></div></figure>


<p>Change persistent name from enp0s25 to eth1 and let it possible to add vlan on this interface.</p>

<p>And start the vlan configuration at the very last of the systemd working.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/01/lxc-on-opensuse/">LXC on OpenSuse</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-01T09:58:00+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2014</span></span> <span class='time'>9:58 am</span></time>
        
         | <a href="/blog/2014/09/01/lxc-on-opensuse/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>LXC 相关操作</h3>

<p>列出本机已有的容器：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># lxc-ls
</span><span class='line'>xxxxxyyySimulator1  xxxxxyyySimulator2
</span></code></pre></td></tr></table></div></figure>


<p>开启虚拟机：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># lxc-start -n xxxxxyyySimulator1
</span></code></pre></td></tr></table></div></figure>


<p>本机开启终端连接到开启后的虚拟机：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># lxc-console --name xxxxxyyySimulator1
</span><span class='line'>
</span><span class='line'>Type &lt;Ctrl+a q&gt; to exit the console, &lt;Ctrl+a Ctrl+a&gt; to enter Ctrl+a itself
</span><span class='line'>
</span><span class='line'>Welcome to openSUSE 12.3 "Dartmouth" - Kernel 3.11.10-21-default (tty1).
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>xxxxxyyySimulator1 login: root
</span><span class='line'>Password: 
</span><span class='line'>Last login: Fri Aug 29 15:40:54 from xxx.xxx.xx.59
</span><span class='line'>Have a lot of fun...
</span><span class='line'>xxxxxyyySimulator1:~ # 
</span></code></pre></td></tr></table></div></figure>


<p>用户名和密码都是"root". ctrl+a后按q即可退出该终端。</p>

<p>销毁容器:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lxc-destroy -n XXXXXXXXXX
</span></code></pre></td></tr></table></div></figure>


<p>克隆容器:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bash /usr/bin/lxc-clone -o xxxxxyyySimulator1 -n xxxxxyyySimulator2
</span></code></pre></td></tr></table></div></figure>


<p>其中-o 是源容器， -n 后接的是目的容器名，目的容器会自动创建。</p>

<h3>LXC 容器修改</h3>

<p>比如，网络配置在下列文件里：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat /var/lib/lxc/xxxxxyyySimulator2/config | more
</span><span class='line'># Template used to create this container: /usr/share/lxc/templates/lxc-opensuse
</span><span class='line'># Template script checksum (SHA-1): xxxxxxxxxxxxxxxxxxxxxxxxxxxx
</span><span class='line'>
</span><span class='line'>#lxc.network.type = empty
</span><span class='line'>lxc.network.type = veth
</span><span class='line'>lxc.network.flags = up
</span><span class='line'>lxc.network.link = br0
</span><span class='line'>lxc.network.name = eth0
</span><span class='line'>lxc.network.ipv4 = xxx.xxx.xx.67/24
</span><span class='line'>lxc.network.ipv4.gateway = xxx.xxx.xx.1
</span></code></pre></td></tr></table></div></figure>


<p>network.ipv4代表其IP地址，而Gateway则代表其默认路由。</p>

<p>虚拟机位置：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>linux:/var/lib/lxc # du -hs *
</span><span class='line'>483M  xxxxxyyySimulator1
</span><span class='line'>483M  xxxxxyyySimulator2
</span><span class='line'>linux:/var/lib/lxc # pwd
</span><span class='line'>/var/lib/lxc
</span></code></pre></td></tr></table></div></figure>


<p>克隆后的虚拟机也在同一目录下。</p>

<p>启动后的虚拟机，都可以被视为真实的物理机，可以通过ssh直接连上去操作。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/27/lxc-computer-in-lab/">LXC Computer</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-27T13:32:00+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:32 pm</span></time>
        
         | <a href="/blog/2014/08/27/lxc-computer-in-lab/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Network Configuration</h3>

<p>Add the rules in udevd:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>linux-:~ # cd /etc/udev/rules.d/
</span><span class='line'>linux-:/etc/udev/rules.d # cat 10-network.rules
</span><span class='line'>SUBSYSTEM=="net", ACTION=="add", ATTR{address}=="00:22:22:22:22", NAME="eth1"
</span><span class='line'>SUBSYSTEM=="net", ACTION=="add", ATTR{address}=="00:22:22:22:22", NAME="eth0"
</span><span class='line'>SUBSYSTEM=="net", ACTION=="add", ATTR{address}=="00:22:22:22:22", NAME="eth2"
</span><span class='line'>SUBSYSTEM=="net", ACTION=="add", ATTR{address}=="00:22:22:22:22", NAME="eth3"
</span></code></pre></td></tr></table></div></figure>


<p>Add following network configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>linux-:/etc/sysconfig # cd network/
</span><span class='line'>linux-:/etc/sysconfig/network # cat ifcfg-eth0
</span><span class='line'># Loopback (lo) configuration
</span><span class='line'>IPADDR=1xx.xx.xx.xxx
</span><span class='line'>NETMASK=255.255.255.0
</span><span class='line'>BROADCAST=1xx.xx.xx.xxx
</span><span class='line'>STARTMODE=auto
</span><span class='line'>USERCONTROL=yes
</span><span class='line'>FIREWALL=no
</span></code></pre></td></tr></table></div></figure>


<p>Default Gateway Setup:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>linux-:~ # cat /etc/sysconfig/network/ifroute-br0
</span><span class='line'># Destination     Dummy/Gateway     Netmask            Device
</span><span class='line'>#
</span><span class='line'>default       xxx.xxx.xx.1        255.255.255.255 br0
</span></code></pre></td></tr></table></div></figure>


<p>Restart computer then you got the fixed ip address in eth0.  <br/>
Add the default route so we could get outside.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vim routes
</span><span class='line'>xxx.xxx.xx.1 -eth0 
</span><span class='line'>or manually: 
</span><span class='line'>route add default gw xxx.xxx.xx.1 eth0
</span></code></pre></td></tr></table></div></figure>


<p>Bridge Networking Configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>linux-:/etc/sysconfig/network # cat ifcfg-br0
</span><span class='line'>STARTMODE='auto'
</span><span class='line'>BOOTPROTO='static'
</span><span class='line'>DNS1=xxx.xxx.xx.1
</span><span class='line'>GATEWAY=xxx.xxx.xx.1
</span><span class='line'>IPADDR=xxx.xxx.xx.59
</span><span class='line'>NETMASK=255.255.255.0
</span><span class='line'>ONBOOT=yes
</span><span class='line'>USERCONTROL='no'
</span><span class='line'>BRIDGE='yes'
</span><span class='line'>BRIDGE_PORTS='eth0'
</span><span class='line'>BRIDGE_AGEINGTIME='20'
</span><span class='line'>BRIDGE_FORWARDDELAY='0'
</span><span class='line'>BRIDGE_HELLOTIME='2'
</span><span class='line'>BRIDGE_MAXAGE='20'
</span><span class='line'>BRIDGE_PATHCOSTS='3'
</span><span class='line'>BRIDGE_STP='on'
</span><span class='line'>linux-:/etc/sysconfig/network # cat ifcfg-eth0
</span><span class='line'>BOOTPROTO='static'
</span><span class='line'>STARTMODE='ifplugd'
</span><span class='line'>IFPLUGD_PRIORITY='1'
</span><span class='line'>NAME = '1000 mBIT ETHERNET'
</span><span class='line'>USERCTL=no
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>The route should changed to:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>route add default gw xxx.xxx.xx.1 br0
</span></code></pre></td></tr></table></div></figure>


<h3>LXC Install</h3>

<p>Enable the free ways:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh -C -L 127.0.0.1:9001:1xx.xxx.2xx:2xxxx root@1xx.xx.1xx.xxx
</span></code></pre></td></tr></table></div></figure>


<p>Use zypper to install the container.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>zypper search lxc
</span><span class='line'># zypper install lxc lxc-devel yast2-lxc libvirt-daemon-lxc libvirt-daemon-driver-lxc
</span><span class='line'># lxc-checkconfig 
</span><span class='line'># ls /usr/share/lxc/templates/
</span></code></pre></td></tr></table></div></figure>


<p>Yes we have the opensuse specified configuraton.</p>

<p>Create The first Container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lxc-create -n ixxxxxSimulator1 -t /usr/share/lxc/templates/lxc-opensuse
</span></code></pre></td></tr></table></div></figure>


<p>List the installed Container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>linux-:~ # lxc-ls
</span><span class='line'>xxxxhxxSimulator1
</span></code></pre></td></tr></table></div></figure>


<p>Username and password are <code>root</code>.</p>

<p>Start the lxc machine via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lxc-start -n xxxxxSimulator1
</span></code></pre></td></tr></table></div></figure>


<h3>LXC Configuration</h3>

<p>No Network, Add it!  <br/>
First we remove the desktop kernel. and use the default kernel</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># uname -a
</span><span class='line'>Linux XXXXSimulator1 3.11.6-4-desktop 
</span><span class='line'># zypper in kernel-default
</span><span class='line'># zypper rm kernel-desktop
</span><span class='line'># uname -a
</span><span class='line'>Linux linux- 3.11.10-21-default
</span></code></pre></td></tr></table></div></figure>


<p>Enable the xfce4 for the default vnc server desktop:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>zypper in -t pattern xfce
</span></code></pre></td></tr></table></div></figure>


<p>Change the default lxc configuraiton of network:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /var/lib/lxc/XXXXSimulator1/config
</span><span class='line'>lxc.network.type = veth
</span><span class='line'>lxc.network.flags = up
</span><span class='line'>lxc.network.link = br0
</span><span class='line'>lxc.network.name = eth0
</span></code></pre></td></tr></table></div></figure>


<p>Now if you start the lxc container, the network eth0 will be automatically started.</p>

<h3>LXC Expand</h3>

<p>Duplicate LXC Machine.   <br/>
This is strange when we directly call lxc-clone will cause failed silently:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> # lxc-clone -o XXXXSimulator1 -n XXXXSimulator2
</span><span class='line'>linux-:~ # echo $?
</span><span class='line'>1
</span></code></pre></td></tr></table></div></figure>


<p>Then we use this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># bash /usr/bin/lxc-clone -o XXXXSimulator1 -n XXXXSimulator2
</span><span class='line'>Tweaking configuration
</span><span class='line'>Copying rootfs...
</span><span class='line'>Updating rootfs...
</span><span class='line'>'XXXXSimulator2' created
</span><span class='line'>linux-:~ # lxc-ls
</span><span class='line'>XXXXSimulator1  XXXXSimulator2
</span></code></pre></td></tr></table></div></figure>


<p>Change the XXXXSimulator2&rsquo;s configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /var/lib/lxc/XXXXSimulator2/config
</span><span class='line'>lxc.network.ipv4 = xxx.xxx.xx.67
</span></code></pre></td></tr></table></div></figure>


<p>Now start the two LXC via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># lxc-start  -n XXXXSimulator2
</span><span class='line'># lxc-start  -n XXXXSimulator1
</span><span class='line'>[Trusty@Linux01 ~]$ ping -c 1 xxx.xxx.xx.66
</span><span class='line'>PING xxx.xxx.xx.66 (xxx.xxx.xx.66) 56(84) bytes of data.
</span><span class='line'>64 bytes from xxx.xxx.xx.66: icmp_seq=1 ttl=64 time=1.50 ms
</span><span class='line'>
</span><span class='line'>--- xxx.xxx.xx.66 ping statistics ---
</span><span class='line'>1 packets transmitted, 1 received, 0% packet loss, time 1ms
</span><span class='line'>rtt min/avg/max/mdev = 1.506/1.506/1.506/0.000 ms
</span><span class='line'>[Trusty@Linux01 ~]$ ping -c 1 xxx.xxx.xx.67
</span><span class='line'>PING xxx.xxx.xx.67 (xxx.xxx.xx.67) 56(84) bytes of data.
</span><span class='line'>64 bytes from xxx.xxx.xx.67: icmp_seq=1 ttl=64 time=1.56 ms
</span><span class='line'>
</span><span class='line'>--- xxx.xxx.xx.67 ping statistics ---
</span><span class='line'>1 packets transmitted, 1 received, 0% packet loss, time 1ms
</span><span class='line'>rtt min/avg/max/mdev = 1.567/1.567/1.567/0.000 ms
</span></code></pre></td></tr></table></div></figure>


<p>Later we could configure the LXC, to let the container start at bootup, Or control its behavior.</p>

<h3>LXC Computer Configuration</h3>

<p>The IP address and Default Gateway Configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lxc.network.type = veth
</span><span class='line'>lxc.network.flags = up
</span><span class='line'>lxc.network.link = br0
</span><span class='line'>lxc.network.name = eth0
</span><span class='line'>lxc.network.ipv4 = xxx.xxx.xx.59/24
</span><span class='line'>lxc.network.ipv4.gateway = xxx.xxx.xx.1
</span></code></pre></td></tr></table></div></figure>


<p>Then start the LXC Container, you will see the ip address/netmask already configured.</p>

<h3>LXC Destroy</h3>

<p>Destroyed the unused Container2:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>linux-:~ # lxc-ls
</span><span class='line'>XXXXSimulator1  XXXXSimulator2
</span><span class='line'>linux-:~ # lxc-destroy -n XXXXSimulator2
</span><span class='line'>linux-:~ # lxc-ls
</span><span class='line'>XXXXSimulator1
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/13/puppet-on-archlinux-2/">Puppet on ArchLinux(2)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-13T16:24:00+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:24 pm</span></time>
        
         | <a href="/blog/2014/08/13/puppet-on-archlinux-2/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Add Arch</h3>

<p>step1, add the hosts into /etc/hosts:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Puppet 
</span><span class='line'>10.0.0.88 puppet
</span><span class='line'>10.0.0.89 client
</span></code></pre></td></tr></table></div></figure>


<p>step2, edit the /etc/puppet/puppet.conf:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[agent]
</span><span class='line'>    # add server
</span><span class='line'>    [agent]
</span><span class='line'>    server = puppet
</span></code></pre></td></tr></table></div></figure>


<p>Restart the puppet.service:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>systemctl restart puppet.service
</span><span class='line'>systemctl enable puppet.service
</span></code></pre></td></tr></table></div></figure>


<p>step3, in 10.0.0.88(server), add the ssl certification of archlinux:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@Ubuntu88:/home/Trusty# !44
</span><span class='line'>puppet cert --list
</span><span class='line'>Warning: Setting templatedir is deprecated. See http://links.puppetlabs.com/env-settings-deprecations
</span><span class='line'>   (at /usr/lib/ruby/vendor_ruby/puppet/settings.rb:1095:in `block in issue_deprecations')
</span><span class='line'>  "XXXyyy.lan" (SHA256) 8XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</span><span class='line'>root@Ubuntu88:/home/Trusty# puppet cert --sign XXXyyy.lan
</span><span class='line'>Warning: Setting templatedir is deprecated. See http://links.puppetlabs.com/env-settings-deprecations
</span><span class='line'>   (at /usr/lib/ruby/vendor_ruby/puppet/settings.rb:1095:in `block in issue_deprecations')
</span><span class='line'>Notice: Signed certificate request for XXXyyy.lan
</span><span class='line'>Notice: Removing file Puppet::SSL::CertificateRequest XXXyyy.lan at '/var/lib/puppet/ssl/ca/requests/XXXyyy.lan.pem'
</span></code></pre></td></tr></table></div></figure>


<p>Now check the /tmp, we will see our test file in last chapter.</p>

<p>For test pupose, we will disable archLinux&rsquo;s puppet via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@TrustyArch tmp]# systemctl stop puppet.service
</span><span class='line'>[root@TrustyArch tmp]# systemctl disable puppet.service
</span><span class='line'>Removed symlink /etc/systemd/system/multi-user.target.wants/puppet.service.
</span></code></pre></td></tr></table></div></figure>


<h3>Install package</h3>

<p>Add following lines into 10.0.0.88, /etc/puppet/manifests/site.pp:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package {
</span><span class='line'>    'xplot':
</span><span class='line'>        ensure =&gt; installed
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Then restart the puppetmaster, in 10.0.0.89, the package xplot will be installed.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/13/virtualbox-modprobe-problem/">Virtualbox Modprobe Problem</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-13T15:19:00+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>3:19 pm</span></time>
        
         | <a href="/blog/2014/08/13/virtualbox-modprobe-problem/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>After upgrading the Linux Kernel, my virtualbox cannot automatically load the kernel modules for virtualbox. Following is the steps for finding out the problems and solving them.</p>

<h3>Locating Problem</h3>

<p>I could manually modprobe the virtualbox driver, but failed to load at boot, so I first check the status of the systemd&rsquo;s output.  <br/>
Checking the systemd&rsquo;s modules load service status:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># systemctl status systemd-modules-load.service
</span><span class='line'>● systemd-modules-load.service - Load Kernel Modules
</span><span class='line'>   Loaded: loaded (/usr/lib/systemd/system/systemd-modules-load.service; static)
</span><span class='line'>   Active: failed (Result: exit-code) since Wed 2014-08-13 13:32:34 CST; 1h 24min ago
</span><span class='line'>     Docs: man:systemd-modules-load.service(8)
</span><span class='line'>           man:modules-load.d(5)
</span><span class='line'>  Process: 142 ExecStart=/usr/lib/systemd/systemd-modules-load (code=exited, status=1/FAILURE)
</span><span class='line'> Main PID: 142 (code=exited, status=1/FAILURE)
</span><span class='line'>
</span><span class='line'>Aug 13 13:32:34 XXXyyy systemd[1]: systemd-modules-load.service: main process exited, code=exited, status=1/FAILURE
</span><span class='line'>Aug 13 13:32:34 XXXyyy systemd[1]: Failed to start Load Kernel Modules.
</span><span class='line'>Aug 13 13:32:34 XXXyyy systemd[1]: Unit systemd-modules-load.service entered failed state.
</span><span class='line'>Warning: Journal has been rotated since unit was started. Log output is incomplete or unavailable.
</span></code></pre></td></tr></table></div></figure>


<p>Manually reload this service and check the status:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@XXXyyy Trusty]# systemctl restart systemd-modules-load
</span><span class='line'>Job for systemd-modules-load.service failed. See 'systemctl status systemd-modules-load.service' and 'journalctl -xn' for details.
</span><span class='line'>[root@XXXyyy Trusty]# systemctl status systemd-modules-load
</span><span class='line'>● systemd-modules-load.service - Load Kernel Modules
</span><span class='line'>   Loaded: loaded (/usr/lib/systemd/system/systemd-modules-load.service; static)
</span><span class='line'>   Active: failed (Result: exit-code) since Wed 2014-08-13 14:59:31 CST; 13s ago
</span><span class='line'>     Docs: man:systemd-modules-load.service(8)
</span><span class='line'>           man:modules-load.d(5)
</span><span class='line'>  Process: 21364 ExecStart=/usr/lib/systemd/systemd-modules-load (code=exited, status=1/FAILURE)
</span><span class='line'> Main PID: 21364 (code=exited, status=1/FAILURE)
</span><span class='line'>
</span><span class='line'>Aug 13 14:59:31 XXXyyy systemd[1]: systemd-modules-load.service: main process exited, code=exited, status=1/FAILURE
</span><span class='line'>Aug 13 14:59:31 XXXyyy systemd[1]: Failed to start Load Kernel Modules.
</span><span class='line'>Aug 13 14:59:31 XXXyyy systemd[1]: Unit systemd-modules-load.service entered failed state.
</span></code></pre></td></tr></table></div></figure>


<p>Use journalctl to view the PID&rsquo;s logs:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@XXXyyy Trusty]# journalctl -b _PID=21364
</span><span class='line'>-- Logs begin at Thu 2014-07-31 16:07:13 CST, end at Wed 2014-08-13 15:00:02 CST. --
</span><span class='line'>Aug 13 14:59:31 XXXyyy systemd-modules-load[21364]: Failed to find module 'vboxdrv vboxnetflt vboxnetadp'
</span><span class='line'>[root@XXXyyy Trusty]# systemctl status dkms.service 
</span><span class='line'>● dkms.service - Dynamic Kernel Modules System
</span><span class='line'>   Loaded: loaded (/usr/lib/systemd/system/dkms.service; disabled)
</span><span class='line'>   Active: inactive (dead)
</span></code></pre></td></tr></table></div></figure>


<p>So the problem is quite clear: Failed to find module, and dkms service is not enabled.</p>

<h3>Solving Problem</h3>

<p>First enable the dkms.service via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># systemctl enable dkms.service
</span><span class='line'>Created symlink from /etc/systemd/system/multi-user.target.wants/dkms.service to /usr/lib/systemd/system/dkms.service.
</span></code></pre></td></tr></table></div></figure>


<p>Install vboxhost-hook, this will add the hook to compile the virtualbox host modules:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># yaourt -S vboxhost-hook
</span></code></pre></td></tr></table></div></figure>


<p>Add vboxhost into the /etc/mkinitcpio.conf:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>HOOKS="base udev autodetect modconf block filesystems keyboard fsck vboxhost"
</span></code></pre></td></tr></table></div></figure>


<p>Now recompile the initramfs via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkinitcpio -p linux
</span></code></pre></td></tr></table></div></figure>


<p>dkms should also be installed:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pacman -S linux-headers virtualbox-host-dkms viftualbox-guest-dkms
</span><span class='line'>dkms install vboxhost/4.3.14
</span><span class='line'>dkms install vboxguest/4.3.14
</span></code></pre></td></tr></table></div></figure>


<p>Finally I found the reason:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat /etc/modules-load.d/virtualbox.conf
</span><span class='line'># Load virtualbox related modules at startup
</span><span class='line'>vboxdrv
</span><span class='line'>vboxnetflt
</span><span class='line'>vboxnetadp
</span></code></pre></td></tr></table></div></figure>


<p>But previously I let them in one line!!!!!!!!!!!!!OMG&hellip;&hellip;.  <br/>
Reboot and examine the result via <code>lsmod | grep vbox</code>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/11/puppet-on-archlinux/">Puppet on ArchLinux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-11T17:22:00+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:22 pm</span></time>
        
         | <a href="/blog/2014/08/11/puppet-on-archlinux/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Installation</h3>

<p>Install via;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo pacman -S puppet
</span></code></pre></td></tr></table></div></figure>


<p>Configurate this machine into server mode.</p>

<h3>Install new Virtual Machine</h3>

<p>Install a new ubuntu14.04 using qemu, and install puppet in it.   <br/>
Generate the configuration file for mirror.list of Ubuntu.</p>

<p>Finally use the vdi file in the Ubuntu.</p>

<p>Install puppet in Ubuntu14.04:  <br/>
<a href="http://linuxconfig.org/puppet-installation-on-linux-ubuntu-14-04-trusty-tahr">http://linuxconfig.org/puppet-installation-on-linux-ubuntu-14-04-trusty-tahr</a></p>

<p>Make Ubuntu use a fixed IP.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat  /etc/network/interface
</span><span class='line'># s file describes the network interfaces available on your system
</span><span class='line'># and how to activate them. For more information, see interfaces(5).
</span><span class='line'>
</span><span class='line'># The loopback network interface
</span><span class='line'>auto lo
</span><span class='line'>iface lo inet loopback
</span><span class='line'>auto eth0
</span><span class='line'>  iface eth0 inet static
</span><span class='line'>  address 10.0.0.88
</span><span class='line'>  netmask 255.255.255.0
</span><span class='line'>  gateway 10.0.0.1
</span></code></pre></td></tr></table></div></figure>


<p>And Copy the virtual disk, and change the UUID of the disk:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ VBoxManage internalcommands sethduuid ./Ubuntu.vdi 
</span><span class='line'>UUID changed to: d1xxxxxxxxxxxxxxxxxxxxxxxxxx
</span></code></pre></td></tr></table></div></figure>


<p>Be sure to change the ip address to 10.0.0.89.</p>

<p>Now we have 2 machines.</p>

<p>No password enter for ssh login:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat ~/.ssh/id_rsa.pub| ssh Trusty@10.0.0.88 'cat&gt;&gt;~/.ssh/authorized_keys'
</span><span class='line'>$ cat ~/.ssh/id_rsa.pub| ssh Trusty@10.0.0.89 'cat&gt;&gt;~/.ssh/authorized_keys'
</span></code></pre></td></tr></table></div></figure>


<h3>Server and Client</h3>

<p>Install Server side in 10.0.0.88:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install puppetmaster
</span></code></pre></td></tr></table></div></figure>


<p>In 10.0.0.88, edit /etc/hosts:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>10.0.0.89    client
</span></code></pre></td></tr></table></div></figure>


<p>While in 10.0.0.89, edit /etc/hosts:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>10.0.0.88    puppet
</span></code></pre></td></tr></table></div></figure>


<p>In client(10.0.0.89), start the service of puppet:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo service puppet start
</span><span class='line'> * Starting puppet agent                                                                                
</span><span class='line'>puppet not configured to start, please edit /etc/default/puppet to enable
</span><span class='line'>                                                                                                 [ OK ]
</span></code></pre></td></tr></table></div></figure>


<p>In server(10.0.0.88), start the service of puppet master:  <br/>
Add following lines in to /etc/puppet/puppet.conf:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dns_alt_names = puppet, master.local, puppet.terokarvinen.com
</span></code></pre></td></tr></table></div></figure>


<p>Then remove all of the generated ssl :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rm -rf /var/lib/puppet/ssl
</span></code></pre></td></tr></table></div></figure>


<p>Now restart the puppetmaster via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># service puppetmaster restart 
</span></code></pre></td></tr></table></div></figure>


<p>Change the hostname of 10.0.0.88 to Ubuntu88, 10.0.0.89 to Ubuntu89, and then restart the computer.  <br/>
Now change the Ubuntu88&rsquo;s configuration
Add following lines in 10.0.0.88(Server):
In /etc/puppet/puppet.conf, [master] heading:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dns_alt_names = puppet, master.local, puppet.terokarvinen.com
</span></code></pre></td></tr></table></div></figure>


<p>On 10.0.0.89(Client), change the following line in /etc/default/puppet:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>START=yes
</span></code></pre></td></tr></table></div></figure>


<p>Then in /etc/puppet/puppet.conf,  add following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[agent]
</span><span class='line'>server = puppet
</span></code></pre></td></tr></table></div></figure>


<p>Restart the puppet service.</p>

<p>Now on server, use following command to list the cert and add signed cert.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Trusty@Ubuntu88:~$ sudo puppet cert --list
</span><span class='line'>sudo: unable to resolve host Ubuntu88
</span><span class='line'>Warning: Setting templatedir is deprecated. See http://links.puppetlabs.com/env-settings-deprecations
</span><span class='line'>   (at /usr/lib/ruby/vendor_ruby/puppet/settings.rb:1095:in `block in issue_deprecations')
</span><span class='line'>  "ubuntu89" (SHA256) xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</span><span class='line'>Trusty@Ubuntu88:~$ sudo puppet cert --sign ubuntu89
</span><span class='line'>sudo: unable to resolve host Ubuntu88
</span><span class='line'>Warning: Setting templatedir is deprecated. See http://links.puppetlabs.com/env-settings-deprecations
</span><span class='line'>   (at /usr/lib/ruby/vendor_ruby/puppet/settings.rb:1095:in `block in issue_deprecations')
</span><span class='line'>Notice: Signed certificate request for ubuntu89
</span><span class='line'>Notice: Removing file Puppet::SSL::CertificateRequest ubuntu89 at '/var/lib/puppet/ssl/ca/requests/ubuntu89.pem'
</span></code></pre></td></tr></table></div></figure>


<h3>Create the Site Manifest and a Module</h3>

<p>Go to /etc/puppet, run following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Trusty@Ubuntu88:/etc/puppet$ sudo mkdir -p manifests/ modules/helloworld/manifests
</span></code></pre></td></tr></table></div></figure>


<p>Edit following file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Trusty@Ubuntu88:/etc/puppet$ cat manifests/site.pp 
</span><span class='line'>include helloworld
</span></code></pre></td></tr></table></div></figure>


<p>Create the file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Trusty@Ubuntu88:/etc/puppet$ sudo cat modules/helloworld/manifests/init.pp
</span><span class='line'>class helloworld {
</span><span class='line'>        file { '/tmp/helloFromMaster':
</span><span class='line'>                content =&gt; "See you at http://terokarvinen.com/tag/puppet\n"
</span><span class='line'>        }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>And Now in client, restart the puppet service:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Trusty@Ubuntu89:~$ sudo service puppet restart
</span><span class='line'>sudo: unable to resolve host Ubuntu89
</span><span class='line'>[sudo] password for Trusty: 
</span><span class='line'>no talloc stackframe at ../source3/param/loadparm.c:4864, leaking memory
</span><span class='line'> * Restarting puppet agent                                               [ OK ] 
</span><span class='line'>Trusty@Ubuntu89:~$ cat /tmp/helloFromMaster 
</span><span class='line'>See you at http://terokarvinen.com/tag/puppet
</span></code></pre></td></tr></table></div></figure>


<p>Now the basic configuration is OK.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/35">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/33">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/03/01/e-buddyxiao-xi-ti-xing-fu-wu-she-ji-si-lu-1/">E-buddy消息提醒服务设计思路(1)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/01/ba-wan-e-buddy/">把玩e-Buddy</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/02/29/tips-on-v-usb-and-arduino-3-others/">Tips on V-USB and Arduino(3)--Others</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/02/26/tips-on-v-usb-and-arduino-2/">Tips on V-USB and Arduino(2)--用v-usb控制LED</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/02/26/tips-on-v-usb-and-arduino-1/">Tips on V-USB and Arduino(1)- USB Keyboard</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
