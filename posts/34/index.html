
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="View picture exiv2 info via exiv2 command: 1
2
exiv2 slide-img-1.jpg
Image size : 897 x 350 So we must cut out a 897 x 350 picture for displaying as &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/34">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.useso.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/15/customize-first-page-of-colorway-theme/">Customize First Page of Colorway Theme</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-15T19:07:00+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>7:07 pm</span></time>
        
         | <a href="/blog/2014/04/15/customize-first-page-of-colorway-theme/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>View picture exiv2 info via exiv2 command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>exiv2 slide-img-1.jpg
</span><span class='line'>Image size      : 897 x 350
</span></code></pre></td></tr></table></div></figure>


<p>So we must cut out a 897 x 350 picture for displaying as slide show.</p>

<p>Now find out some pictures from internet, and download it to local.</p>

<p>Use convert to fit the image?  No, it&rsquo;s not exact, I use gimp</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/15/miragate-wordpress-from-development-machine-to-server/">Miragate Wordpress From Development Machine to Server</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-15T10:57:00+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:57 am</span></time>
        
         | <a href="/blog/2014/04/15/miragate-wordpress-from-development-machine-to-server/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>First Log on to the development machine, view the configuration file of the Wordpress:</p>

<figure class='code'><figcaption><span>wp-config.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1">// ** MySQL settings - You can get this info from your web host ** //</span>
</span><span class='line'><span class="sd">/** The name of the database for WordPress */</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s1">&#39;DB_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;wordpress&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/** MySQL database username */</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s1">&#39;DB_USER&#39;</span><span class="p">,</span> <span class="s1">&#39;wordpressuser&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/** MySQL database password */</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s1">&#39;DB_PASSWORD&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/** MySQL hostname */</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s1">&#39;DB_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Dump out the database:  <br/>
    mysqldump &ndash;user=wordpressuser -p wordpress >wordpress.sql
Copy the dev database into the server&rsquo;s directory, then view the configure of the server&rsquo;s wordpress configuration.</p>

<figure class='code'><figcaption><span>server-wp-config.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1">// ** MySQL settings - You can get this info from your web host ** //</span>
</span><span class='line'><span class="sd">/** The name of the database for WordPress */</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s1">&#39;DB_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;wordpress&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/** MySQL database username */</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s1">&#39;DB_USER&#39;</span><span class="p">,</span> <span class="s1">&#39;wordpressuser&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/** MySQL database password */</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s1">&#39;DB_PASSWORD&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/** MySQL hostname */</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s1">&#39;DB_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>They are the same, then begin dump into server&rsquo;s:</p>

<figure class='code'><figcaption><span>server-wp-config.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">mysqldump</span> <span class="o">--</span><span class="nx">user</span><span class="o">=</span><span class="nx">wordpressuser</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">wordpress</span> <span class="o">&lt;</span> <span class="o">./</span><span class="nx">wordpress</span><span class="o">.</span><span class="nx">sql</span>
</span></code></pre></td></tr></table></div></figure>


<p>Using plugins for database migration,
plugins, search: wp migrate db
Install the same theme, called &ldquo;BlackBird&rdquo;</p>

<p>Database drop first:</p>

<figure class='code'><figcaption><span>server-wp-config.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">mysqladmin</span> <span class="o">-</span><span class="nx">uroot</span> <span class="o">-</span><span class="nx">pxxxxxxx</span>  <span class="nx">drop</span> <span class="nx">wordpress</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then import the new database via:</p>

<p>via phpmyadmin:
Install phpmyadmin:</p>

<p>failed</p>

<p>Copy the directory from dev machine to server machine, unzip it and replace the /srv/http/wordpress.</p>

<figure class='code'><figcaption><span>server-wp-config.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">sudo</span> <span class="nx">pacman</span> <span class="o">-</span><span class="nx">S</span> <span class="nx">phpmyadmin</span> <span class="nx">php</span><span class="o">-</span><span class="nx">mcrypt</span>
</span></code></pre></td></tr></table></div></figure>


<p>To be continued.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/14/install-wordpress-on-archlinux/">Install Wordpress on ArchLinux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-14T21:53:00+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>9:53 pm</span></time>
        
         | <a href="/blog/2014/04/14/install-wordpress-on-archlinux/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>First install wordpress manually:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /srv/http
</span><span class='line'>wget https://wordpress.org/latest.tar.gz
</span><span class='line'>tar xzvf latest.tar.gz
</span><span class='line'>chown -R http wordpress
</span><span class='line'>chgrp -R http wordpress
</span></code></pre></td></tr></table></div></figure>


<p>Now add a configuration file on wordpress:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@/etc/httpd/conf/extra]$ pwd 
</span><span class='line'>/etc/httpd/conf/extra
</span><span class='line'>[Trusty@/etc/httpd/conf/extra]$ cat httpd-wordpress.conf
</span><span class='line'>Alias / "/srv/http/wordpress/"
</span><span class='line'>&lt;Directory "/srv/http/wordpress/"&gt;
</span><span class='line'>  AllowOverride All
</span><span class='line'>  Options FollowSymlinks
</span><span class='line'>  Order allow,deny
</span><span class='line'>  Allow from all
</span><span class='line'>  php_admin_value open_basedir "/srv/:/tmp/:/srv/http/wordpress/:/usr/share/webapps/:/etc/webapps:$"
</span><span class='line'>&lt;/Directory&gt;
</span></code></pre></td></tr></table></div></figure>


<p>In /etc/httpd/conf/httpd.conf file, add:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Include wordpress configuration
</span><span class='line'>Include conf/extra/httpd-wordpress.conf
</span></code></pre></td></tr></table></div></figure>


<p>Create the Wordpress Database and User</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql -u root -p
</span><span class='line'>CREATE DATABASE wordpress;
</span><span class='line'>CREATE USER wordpressuser@localhost;
</span><span class='line'>SET PASSWORD FOR wordpressuser@localhost= PASSWORD("password");
</span><span class='line'>GRANT ALL PRIVILEGES ON wordpress.* TO wordpressuser@localhost IDENTIFIED BY 'password';
</span><span class='line'>FLUSH PRIVILEGES;
</span><span class='line'>exit
</span></code></pre></td></tr></table></div></figure>


<p>Configure the configuration file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cp ~/wordpress/wp-config-sample.php ~/wordpress/wp-config.php
</span><span class='line'>sudo nano ~/wordpress/wp-config.php
</span><span class='line'>// ** MySQL settings - You can get this info from your web host ** //
</span><span class='line'>/** The name of the database for WordPress */
</span><span class='line'>define('DB_NAME', 'wordpress');
</span><span class='line'>
</span><span class='line'>/** MySQL database username */
</span><span class='line'>define('DB_USER', 'wordpressuser');
</span><span class='line'>
</span><span class='line'>/** MySQL database password */
</span><span class='line'>define('DB_PASSWORD', 'password');    
</span></code></pre></td></tr></table></div></figure>


<p>Configure the php.ini:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo nano /etc/php/php.ini
</span><span class='line'>extension=mysql.so
</span><span class='line'>sudo systemctl restart httpd
</span></code></pre></td></tr></table></div></figure>


<p>Then visit the url of <a href="http://localhost/,">http://localhost/,</a> install the wordpress and begin to customize.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/14/switch-to-zsh/">Switch to ZSH</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-14T14:35:00+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>2:35 pm</span></time>
        
         | <a href="/blog/2014/04/14/switch-to-zsh/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Installation</h3>

<p>In ArchLinux, install zsh via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pacman -S zsh zsh-doc
</span></code></pre></td></tr></table></div></figure>


<p>Duplicate the .bashrc to .zshrc</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cp ~/.bashrc ~/.zshrc
</span></code></pre></td></tr></table></div></figure>


<p>But notice, when using zsh, we should use following command under zshh:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake new_post["Switch To ZSH"] 
</span><span class='line'>to 
</span><span class='line'>rake new_post\["Switch To ZSH"\]
</span></code></pre></td></tr></table></div></figure>


<p>Or, we can use noglob in zsh specified file .zshrc</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>alias rake='noglob rake'
</span></code></pre></td></tr></table></div></figure>


<h3>Setting</h3>

<p>More settings on .zshrc:</p>

<figure class='code'><figcaption><span>zshrc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># Use prompt -l you will see all of the prompt. </span>
</span><span class='line'>autoload -U promptinit
</span><span class='line'>promptinit
</span><span class='line'><span class="nb">alias </span><span class="nv">rake</span><span class="o">=</span><span class="s1">&#39;noglob rake&#39;</span>
</span><span class='line'><span class="c"># Customized PS1, with color. </span>
</span><span class='line'><span class="nb">export </span><span class="nv">PS1</span><span class="o">=</span><span class="s2">&quot;[%n@%~]$ &quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Terminal Title</h3>

<p>Terminal Title Setting, add following lines into ~/.zshrc:</p>

<figure class='code'><figcaption><span>zsh.rc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="k">case</span> <span class="nv">$TERM</span> in
</span><span class='line'>  <span class="o">(</span>*xterm* <span class="p">|</span> rxvt<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c"># Write some info to terminal title.</span>
</span><span class='line'>    <span class="c"># This is seen when the shell prompts for input.</span>
</span><span class='line'>    <span class="k">function</span> precmd <span class="o">{</span>
</span><span class='line'>      print -Pn <span class="s2">&quot;\e]0;zsh%L %(1j,%j job%(2j|s|); ,)%~\a&quot;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="c"># Write command and args to terminal title.</span>
</span><span class='line'>    <span class="c"># This is seen while the shell waits for a command to complete.</span>
</span><span class='line'>    <span class="k">function</span> preexec <span class="o">{</span>
</span><span class='line'>      <span class="nb">printf</span> <span class="s2">&quot;\033]0;%s\a&quot;</span> <span class="s2">&quot;$1&quot;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">;;</span>
</span><span class='line'><span class="k">esac</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Enable History</h3>

<p>Add the definition of history</p>

<figure class='code'><figcaption><span>zsh.rc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># History File Definition</span>
</span><span class='line'><span class="nv">HISTFILE</span><span class="o">=</span>~/.histfile
</span><span class='line'><span class="nv">HISTSIZE</span><span class="o">=</span>1000
</span><span class='line'><span class="nv">SAVEHIST</span><span class="o">=</span>1000
</span><span class='line'><span class="c"># Share history between terminal</span>
</span><span class='line'>setopt inc_append_history
</span><span class='line'>setopt share_history
</span></code></pre></td></tr></table></div></figure>


<h3>Chinese Encoding</h3>

<p>Add following definition to the .zshrc:</p>

<figure class='code'><figcaption><span>zsh.rc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">export </span><span class="nv">LC_ALL</span><span class="o">=</span>en_US.UTF-8
</span><span class='line'><span class="nb">export </span><span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8
</span></code></pre></td></tr></table></div></figure>


<p>And in the terminal simulator, select the encoding:</p>

<figure class='code'><figcaption><span>zsh.rc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>Edit-&gt;Preference: Advanced-&gt;Encoding-&gt;Default Encoding<span class="o">(</span>UTF-8<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/09/command-and-conquer-2/">Command and Conquer 2</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-09T08:44:23+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:44 am</span></time>
        
         | <a href="/blog/2014/04/09/command-and-conquer-2/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Position</h3>

<p>From FullCircle issue 24, to issue 55</p>

<h3>C&amp;C 11</h3>

<p>This chapter tells you how to automatical your tasks using crontab.  <br/>
Useful commands</p>

<figure class='code'><figcaption><span>cron.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>find /var/logs/ -name <span class="s2">&quot;*.log&quot;</span> <span class="p">|</span> <span class="k">while</span> <span class="nb">read </span>line<span class="p">;</span> <span class="k">do</span> cat <span class="s2">&quot;${line}&quot;</span><span class="p">;</span> <span class="k">done</span>
</span><span class='line'>sudo crontab -e root
</span></code></pre></td></tr></table></div></figure>


<p>crontab format:   <br/>
<minute><hour><day><month><day of week><command>  <br/>
Example:   <br/>
<em>/5 * * * * command     Every 5 minutes  <br/>
00 18 * * sun command   Every Sunday at 6   <br/>
* </em>/2 * * * command     Every 2 hours  <br/>
Further reading:  <br/>
Python version of script for those interested:   <br/>
<a href="http://lswest.pastebin.com/m5b536464">http://lswest.pastebin.com/m5b536464</a>  <br/>
Bash script tutorial:  <br/>
<a href="http://www.linux.org/docs/ldp/howto/Bash-Prog-Intro-HOWTO.html">http://www.linux.org/docs/ldp/howto/Bash-Prog-Intro-HOWTO.html</a>  <br/>
Cron tutorial:   <br/>
<a href="http://www.clickmojo.com/code/cron-tutorial.html">http://www.clickmojo.com/code/cron-tutorial.html</a></p>

<h3>C&amp;C 12</h3>

<p>This Chapter tells you how to use different shell, and its history, functions.</p>

<h3>C&amp;C 13</h3>

<p>This chapter tell you how to listen music using MOC(Music On Console), and use IRC under terminal(irssi), later I will install them and try.</p>

<h3>C&amp;C 14</h3>

<p>This chapter introduce how to change you prompt,(export PS1), some useful tools, for example:  <br/>
&ldquo;watch vmstat&rdquo; will display the vmstat every 2 seconds.   <br/>
Tiling window manager, awesome, DWM, Xmodnad, ratpoison, ion, etc.   <br/>
Live-Office?</p>

<h3>C&amp;C 15</h3>

<p>This chapter take ping for example and show you how to use man and help.</p>

<h3>C&amp;C 16</h3>

<p>This chapter shows how to detect and bind keys.  <br/>
xev for X, showkey for terminal, for detecting keys.  <br/>
.Xmodmap for key definition,    keycode 153 = XF86MonBrightnessDown  <br/>
/usr/include/X11/keysymdef.h contains all of the list of the symbols, extra function keys in /usr/include/X11/XKeySymDB  <br/>
Further Reading: <a href="http://people.freedesktop.org/~hughsient/quirk/quirk-keymap-index.html">http://people.freedesktop.org/~hughsient/quirk/quirk-keymap-index.html</a></p>

<h3>C&amp;C 17</h3>

<p>This chapter shows disk usage skills.</p>

<h3>C&amp;C 18</h3>

<p>This chapter introduce harddisk and S.M.A.R.T</p>

<h3>C&amp;C 19</h3>

<p>This chapter introduct screen, remember use ctlr+a /d for detaching the session.</p>

<h3>C&amp;C 20</h3>

<p>This chapter continue introducing screen, for sharing session:  <br/>
ctrl + a :multiuser on ctrl+a :acladd <ruser>  <br/>
Other user connect via screen -x $USER/<screenID/name>  <br/>
Other different commands.</p>

<h3>C&amp;C 21</h3>

<p>Introducing Tmux for remote usage.Also byobu is introduced.</p>

<h3>C&amp;C 22</h3>

<p>Switch to ZSH, need to re-read after back.</p>

<h3>C&amp;C 23</h3>

<p>Colorscheme, need to re-read after back.</p>

<h3>C&amp;C 24</h3>

<p>Talks on how to set ssh proxy.</p>

<h3>C&amp;C 25</h3>

<p>gstm of GUI program which did ssh port forwarding.   <br/>
diff usage</p>

<h3>C&amp;C 26</h3>

<p>wget and curl, use it according to your own habit.</p>

<h3>C&amp;C 27</h3>

<p>Network Configuration.</p>

<h3>C&amp;C 28</h3>

<p>fdisk, find, etc.</p>

<h3>C&amp;C 29</h3>

<p>Classic Command List.</p>

<h3>C&amp;C 30</h3>

<p>Language for System.</p>

<h3>C&amp;C 31</h3>

<p>conky skills, let conky display how many updates available.</p>

<h3>C&amp;C 32</h3>

<p>Conky skills, his conky could display the listening music and album picture.But how about the pandora?</p>

<h3>C&amp;C 33</h3>

<p>Conky skills, to-do and the zenity for creating the diaglog.</p>

<h3>C&amp;C 34</h3>

<p>zenity configuration, MPD daemon.</p>

<h3>C&amp;C 35</h3>

<p>Asia Language support, in fact we are much more professionaler than the author :)</p>

<h3>C&amp;C 36</h3>

<p>Use of graphicmagic, which derived from imagik from 2002, try it later.</p>

<h3>C&amp;C 37</h3>

<p>Latex Introduction.</p>

<h3>C&amp;C 38</h3>

<p>Issue 51, damaged.</p>

<h3>C&amp;C 40</h3>

<p>Latex continued.</p>

<h3>C&amp;C 41</h3>

<p>/etc/motd(Message Of The Day)</p>

<h3>C&amp;C 42</h3>

<p>vim/gvim, notice some command, and author&rsquo;s vimrc file.</p>

<h3>C&amp;C 43</h3>

<p>Advance usage of vi/vim , TBD</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/08/command-and-conquer-1/">Command and Conquer 1</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-08T17:19:22+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:19 pm</span></time>
        
         | <a href="/blog/2014/04/08/command-and-conquer-1/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Position:</h3>

<p>From FullCircle 13, Ended at FullCircle 23.</p>

<h3>C&amp;C 1</h3>

<p>Try to run following command:</p>

<figure class='code'><figcaption><span>run.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>man man
</span><span class='line'>man -k PDF
</span><span class='line'>man apropos
</span><span class='line'>apropos PDF
</span><span class='line'>man --help
</span></code></pre></td></tr></table></div></figure>


<p>Fastly get help from manual, for example, following command will let you dive into regex:</p>

<figure class='code'><figcaption><span>run.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>man -k regex
</span><span class='line'>re_comp <span class="o">(</span>3<span class="o">)</span>          - BSD regex functions
</span><span class='line'>re_exec <span class="o">(</span>3<span class="o">)</span>          - BSD regex functions
</span><span class='line'>regcomp <span class="o">(</span>3<span class="o">)</span>          - POSIX regex functions
</span><span class='line'>regerror <span class="o">(</span>3<span class="o">)</span>         - POSIX regex functions
</span><span class='line'>regex <span class="o">(</span>3<span class="o">)</span>            - POSIX regex functions
</span><span class='line'>regex <span class="o">(</span>7<span class="o">)</span>            - POSIX.2 regular expressions
</span><span class='line'>regexec <span class="o">(</span>3<span class="o">)</span>          - POSIX regex functions
</span><span class='line'>regfree <span class="o">(</span>3<span class="o">)</span>          - POSIX regex functions
</span></code></pre></td></tr></table></div></figure>


<p>`</p>

<h3>C&amp;C 2</h3>

<p>This part describe how to come and go into the directory.</p>

<h3>C&amp;C 3</h3>

<p>This part describe how to copy and move the file.</p>

<h3>C&amp;C 4</h3>

<p>This part introduce the nano and vim. Remember one: :e in vim means edit another file.</p>

<h3>C&amp;C 5</h3>

<p>This part introduce aptitude, Notice the comment of the aptitude search result:  <br/>
1. p, No trace of the package exists on the system.  <br/>
2. c, The package is deleted, but its configuration file is still on the system.  <br/>
3. i, The package is installed.   <br/>
4. v, The package is virtual.  <br/>
And one command: sudo aptitude safe-upgrade.</p>

<h3>C&amp;C 6</h3>

<p>This part shows how to find something in your system.  <br/>
1. grep, &ldquo;grep -n&rdquo;(print line number),  &ldquo;grep -ir&rdquo;(recursively and ignore case).  <br/>
2. <em>, difference of &ldquo;echo </em>&rdquo; and &ldquo;echo &lsquo;*&rsquo;&rdquo;.  <br/>
3. xargs,</p>

<figure class='code'><figcaption><span>run.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>find recipes -type f -name <span class="s1">&#39;*-cake.txt&#39;</span> <span class="p">|</span> xargs -I % cp % old-recipes/
</span><span class='line'>find recipes -type f -name <span class="s1">&#39;*-cake.txt&#39;</span>
</span><span class='line'>recipes/a-cake.txt
</span><span class='line'>recipes/b-cake.txt
</span><span class='line'>recipes/c-cake.txt
</span><span class='line'>cp recipes/a-cake.txt old-recipes/
</span><span class='line'>cp recipes/b-cake.txt old-recipes/
</span><span class='line'>cp recipes/c-cake.txt old-recipes/
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>updatedb and locate.

<h3>C&amp;C 7</h3>

The author talks lots on why you should not fear terminal.

<h3>C&amp;C 8</h3></li>
<li>cut way:</li>
</ol>


<figure class='code'><figcaption><span>cut.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>Trusty@HN:~/code/purec/FC/C8<span class="nv">$ </span>cat /etc/issue
</span><span class='line'>Ubuntu 13.04 <span class="se">\n</span> <span class="se">\l</span>
</span><span class='line'>
</span><span class='line'>Trusty@HN:~/code/purec/FC/C8<span class="nv">$ </span>cat /etc/issue<span class="p">|</span>head -n 1
</span><span class='line'>Ubuntu 13.04 <span class="se">\n</span> <span class="se">\l</span>
</span><span class='line'>Trusty@HN:~/code/purec/FC/C8<span class="nv">$ </span>cat /etc/issue<span class="p">|</span>head -n 1<span class="p">|</span>cut --delimiter<span class="o">=</span><span class="s2">&quot; &quot;</span> -f 1,2
</span><span class='line'>Ubuntu 13.04
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>sed way:</li>
</ol>


<figure class='code'><figcaption><span>sed.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>Trusty@HN:~/code/purec/FC/C8<span class="nv">$ </span>cat /etc/issue <span class="p">|</span> sed <span class="s1">&#39;{s/\\n//}&#39;</span>
</span><span class='line'>Ubuntu 13.04  <span class="se">\l</span>
</span><span class='line'>
</span><span class='line'>Trusty@HN:~/code/purec/FC/C8<span class="nv">$ </span>cat /etc/issue <span class="p">|</span> sed <span class="s1">&#39;{s/\\n//; s/\\l//;}&#39;</span>
</span><span class='line'>Ubuntu 13.04
</span><span class='line'>
</span><span class='line'>Trusty@HN:~/code/purec/FC/C8<span class="nv">$ </span>cat /etc/issue <span class="p">|</span> sed <span class="s1">&#39;{s/\\n//; s/\\l//;/^$/d}&#39;</span>
</span><span class='line'>Ubuntu 13.04
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>awk way:</li>
</ol>


<figure class='code'><figcaption><span>awk.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>Trusty@HN:~/code/purec/FC/C8<span class="nv">$ </span>cat /etc/issue <span class="p">|</span> awk <span class="s1">&#39;/\\n/ {print $1,$2}&#39;</span>
</span><span class='line'>Ubuntu 13.04
</span></code></pre></td></tr></table></div></figure>


<p>First find any line which have &lsquo;\n&rsquo; in it, then print this line&rsquo;s $1 and $2.  <br/>
4. Further reading  <br/>
<a href="http://fullcirclemagazine.org/issue-21-shell-script/">http://fullcirclemagazine.org/issue-21-shell-script/</a>  <br/>
Sed -<a href="http://www.grymoire.com/Unix/Sed.html">http://www.grymoire.com/Unix/Sed.html</a>  <br/>
awk -<a href="http://www.linuxjournal.com/article/8913">http://www.linuxjournal.com/article/8913</a> or <a href="http://www.linuxfocus.org/English/September1999/article103.html">http://www.linuxfocus.org/English/September1999/article103.html</a>  <br/>
cut -<a href="http://learnlinux.tsf.org.za/courses/build/shell-scripting/ch03s04.html">http://learnlinux.tsf.org.za/courses/build/shell-scripting/ch03s04.html</a></p>

<h3>C&amp;C 9</h3>

<p>This part introduced the ffmpeg and imagick.   <br/>
Since the internet is not OK, I cannot install the package, try them later.</p>

<h3>C&amp;C 10</h3>

<p>This part is very useful, it shows some system administration tools.  <br/>
1. bootchart, install via &ldquo;sudo apt-get install bootchart&rdquo;, then in /var/log/bootchart/ you will see the correct image.  <br/>
2. sudo lshw will list all of the hw info, sudo lshw -C Network will list all of the infos on networking.   <br/>
3. Further reading: <a href="http://www.troubleshooters.com/tpromag/200007/200007.htm">http://www.troubleshooters.com/tpromag/200007/200007.htm</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/08/programming-in-c-of-fc-tutorial-6/">Programming in C of FC Tutorial 6</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-08T16:50:56+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:50 pm</span></time>
        
         | <a href="/blog/2014/04/08/programming-in-c-of-fc-tutorial-6/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Full Circle C 8</h3>

<h4>Limitation</h4>

<p>Fibonacci sequence: normally this program limited by the limitation of unsigned long long</p>

<figure class='code'><figcaption><span>Fibonacci.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">fibo_type</span><span class="p">;</span>
</span><span class='line'><span class="cp">#define FIBO_FORMAT &quot;%10llu&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">printFibo</span><span class="p">(</span><span class="n">fibo_type</span> <span class="n">num</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="n">FIBO_FORMAT</span><span class="p">,</span> <span class="n">num</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="n">fibo_type</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%4d: &quot;</span><span class="p">,</span> <span class="o">++</span><span class="n">num</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printFibo</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%4d: &quot;</span><span class="p">,</span><span class="o">++</span><span class="n">num</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printFibo</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">c</span><span class="o">=</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'>        <span class="k">while</span><span class="p">(</span><span class="n">c</span><span class="o">&gt;=</span><span class="n">b</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%4d: &quot;</span><span class="p">,</span><span class="o">++</span><span class="n">num</span><span class="p">);</span>
</span><span class='line'>                <span class="n">printFibo</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'>                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>                <span class="n">a</span><span class="o">=</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'>                <span class="n">b</span><span class="o">=</span><span class="n">c</span><span class="p">;</span>
</span><span class='line'>                <span class="n">c</span><span class="o">=</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Stopped after %d digits</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">num</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printFibo</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This program will exit when c reach the limitation of definition of unsigned long long</p>

<h4>Using GMP</h4>

<p>Using gmp to re-write this program:</p>

<figure class='code'><figcaption><span>Fibonacci2.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;gmp.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">mpz_t</span> <span class="n">f_1</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">mpz_t</span> <span class="n">f_2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">mpz_init</span><span class="p">(</span><span class="n">f_1</span><span class="p">);</span>
</span><span class='line'>        <span class="n">mpz_init</span><span class="p">(</span><span class="n">f_2</span><span class="p">);</span>
</span><span class='line'>        <span class="n">mpz_set_ui</span><span class="p">(</span><span class="n">f_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="n">mpz_set_ui</span><span class="p">(</span><span class="n">f_1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%10d: 0</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">++</span><span class="n">num</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="n">mpz_add</span><span class="p">(</span><span class="n">f_1</span><span class="p">,</span> <span class="n">f_2</span><span class="p">,</span> <span class="n">f_1</span><span class="p">);</span>
</span><span class='line'>                <span class="n">mpz_swap</span><span class="p">(</span><span class="n">f_1</span><span class="p">,</span> <span class="n">f_2</span><span class="p">);</span>
</span><span class='line'>                <span class="kt">char</span> <span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="n">mpz_get_str</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">f_2</span><span class="p">);</span>
</span><span class='line'>                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%10d: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">++</span><span class="n">num</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</span><span class='line'>                <span class="n">free</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
</span><span class='line'>                <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">mpz_clear</span><span class="p">(</span><span class="n">f_1</span><span class="p">);</span>
</span><span class='line'>        <span class="n">mpz_clear</span><span class="p">(</span><span class="n">f_2</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Compile it via:</p>

<figure class='code'><figcaption><span>run.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gcc -o Fibonacci2 Fibonacci2.c -lgmp
</span></code></pre></td></tr></table></div></figure>


<p>This won&rsquo;t have limitation currently, but you have to finish the execises, when you get internet connection.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/08/programming-in-c-of-fc-tutorial-5/">Programming in C of FC Tutorial 5</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-08T16:17:22+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:17 pm</span></time>
        
         | <a href="/blog/2014/04/08/programming-in-c-of-fc-tutorial-5/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Full Circle C 7</h3>

<h4>Example</h4>

<p>Following is the origin ifstat.c, this program will list the net-interface payloads, and it will print out the net interface statistics every 2 seconds, but notice this program have several bugs:</p>

<figure class='code'><figcaption><span>ifstat.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">ull</span><span class="p">;</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">parseDevFile</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">iface</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">bRx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">pRx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">bTx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">pTx</span><span class="p">);</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">dumpInterfaceUsage</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">iface</span><span class="p">);</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">parseDevFile</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">iface</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">bRx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">pRx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">bTx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">pTx</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">FILE</span> <span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">char</span> <span class="o">*</span> <span class="n">line</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;/proc/net/dev&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">fp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">while</span><span class="p">(</span><span class="n">getline</span><span class="p">(</span><span class="o">&amp;</span><span class="n">line</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="n">strstr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">iface</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                        <span class="n">sscanf</span><span class="p">(</span><span class="n">strstr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;:&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;%llu%llu%*u%*u%*u%*u%*u%*u%llu%llu&quot;</span><span class="p">,</span> <span class="n">bRx</span><span class="p">,</span> <span class="n">pRx</span><span class="p">,</span> <span class="n">bTx</span><span class="p">,</span> <span class="n">pTx</span><span class="p">);</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
</span><span class='line'>        <span class="n">free</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">dumpInterfaceUsage</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">iface</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="n">ull</span> <span class="n">ifaceBRxOld</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ifaceBTxOld</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ifacePRxOld</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ifacePTxOld</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="n">ull</span> <span class="n">ifaceBRxNew</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ifaceBTxNew</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ifacePRxNew</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ifacePTxNew</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="k">const</span> <span class="kt">int</span> <span class="n">SLEEP_TIME</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">parseDevFile</span><span class="p">(</span><span class="n">iface</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifaceBRxOld</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifacePRxOld</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifaceBTxOld</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifacePTxOld</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'>        <span class="n">sleep</span><span class="p">(</span><span class="n">SLEEP_TIME</span><span class="p">);</span>
</span><span class='line'>        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="n">parseDevFile</span><span class="p">(</span><span class="n">iface</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifaceBRxNew</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifacePRxNew</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifaceBTxNew</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifacePTxNew</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'>                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s In: %8.2f kbytes/s  %5llu P/s Out: %8.2f kbytes/s %5llu P/s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">iface</span><span class="p">,</span>
</span><span class='line'>                                <span class="p">(</span><span class="n">ifaceBRxNew</span> <span class="o">-</span> <span class="n">ifaceBRxOld</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">SLEEP_TIME</span> <span class="o">*</span><span class="mf">1024.0</span><span class="p">),</span>
</span><span class='line'>                                <span class="p">(</span><span class="n">ifacePRxNew</span> <span class="o">-</span> <span class="n">ifacePRxOld</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">SLEEP_TIME</span><span class="p">),</span>
</span><span class='line'>                                <span class="p">(</span><span class="n">ifaceBTxNew</span> <span class="o">-</span> <span class="n">ifaceBTxOld</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">SLEEP_TIME</span> <span class="o">*</span><span class="mf">1024.0</span><span class="p">),</span>
</span><span class='line'>                                <span class="p">(</span><span class="n">ifacePTxNew</span> <span class="o">-</span> <span class="n">ifacePTxOld</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">SLEEP_TIME</span><span class="p">));</span>
</span><span class='line'>                <span class="n">ifaceBRxOld</span> <span class="o">=</span> <span class="n">ifaceBRxNew</span><span class="p">;</span>
</span><span class='line'>                <span class="n">ifaceBTxOld</span> <span class="o">=</span> <span class="n">ifaceBTxNew</span><span class="p">;</span>
</span><span class='line'>                <span class="n">ifacePRxOld</span> <span class="o">=</span> <span class="n">ifacePRxNew</span><span class="p">;</span>
</span><span class='line'>                <span class="n">ifacePTxOld</span> <span class="o">=</span> <span class="n">ifacePTxNew</span><span class="p">;</span>
</span><span class='line'>                <span class="n">sleep</span><span class="p">(</span><span class="n">SLEEP_TIME</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage: %s interfacename</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class='line'>                <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">dumpInterfaceUsage</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running result:</p>

<figure class='code'><figcaption><span>run.sh </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># ./ifstat eth0</span>
</span><span class='line'>eth0 In:     0.24 kbytes/s      <span class="m">2</span> P/s Out:     0.25 kbytes/s     <span class="m">1</span> P/s
</span><span class='line'>eth0 In:     0.32 kbytes/s      <span class="m">4</span> P/s Out:     0.97 kbytes/s     <span class="m">3</span> P/s
</span><span class='line'>eth0 In:     1.29 kbytes/s     <span class="m">13</span> P/s Out:     5.06 kbytes/s    <span class="m">13</span> P/s
</span><span class='line'>eth0 In:     0.06 kbytes/s      <span class="m">1</span> P/s Out:     0.08 kbytes/s     <span class="m">0</span> P/s
</span></code></pre></td></tr></table></div></figure>


<h4>Bugs</h4>

<p>Ok, now let&rsquo;s see its bug:</p>

<figure class='code'><figcaption><span>run.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#enable the unlimited:</span>
</span><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># ulimit -c unlimited</span>
</span><span class='line'><span class="c">#Get the core file: </span>
</span><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># ./ifstat b</span>
</span><span class='line'>Segmentation fault <span class="o">(</span>core dumped<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Debugging</h4>

<figure class='code'><figcaption><span>run.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># ls -l -h core*</span>
</span><span class='line'>-rw------- <span class="m">1</span> root root 272K Oct <span class="m">14</span> 06:53 core.3961
</span><span class='line'><span class="c">#Use gdb for anlysing the corefile:    </span>
</span><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># gdb ifstat core.3961</span>
</span><span class='line'>GNU gdb Fedora <span class="o">(</span>6.8-27.el5<span class="o">)</span>
</span><span class='line'>Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2008</span> Free Software Foundation, Inc.
</span><span class='line'>License GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
</span><span class='line'>This is free software: you are free to change and redistribute it.
</span><span class='line'>There is NO WARRANTY, to the extent permitted by law.  Type <span class="s2">&quot;show copying&quot;</span>
</span><span class='line'>and <span class="s2">&quot;show warranty&quot;</span> <span class="k">for</span> details.
</span><span class='line'>This GDB was configured as <span class="s2">&quot;i386-redhat-linux-gnu&quot;</span>...
</span><span class='line'>
</span><span class='line'>warning: Can<span class="s1">&#39;t read pathname for load map: Input/output error.</span>
</span><span class='line'><span class="s1">Reading symbols from /lib/libc.so.6...done.</span>
</span><span class='line'><span class="s1">Loaded symbols for /lib/libc.so.6</span>
</span><span class='line'><span class="s1">Reading symbols from /lib/ld-linux.so.2...done.</span>
</span><span class='line'><span class="s1">Loaded symbols for /lib/ld-linux.so.2</span>
</span><span class='line'><span class="s1">Core was generated by `./ifstat b&#39;</span>.
</span><span class='line'>Program terminated with signal 11, Segmentation fault.
</span><span class='line'><span class="o">[</span>New process 3961<span class="o">]</span>
</span><span class='line'><span class="c">#0  0x00b6f957 in rawmemchr () from /lib/libc.so.6</span>
</span></code></pre></td></tr></table></div></figure>


<p>Seems the corefile is useless, this because the error is not derived from our own code, but rather from the library. Run gdb for anlysing the ./ifstat b</p>

<figure class='code'><figcaption><span>run.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># gdb ./ifstat</span>
</span><span class='line'>GNU gdb Fedora <span class="o">(</span>6.8-27.el5<span class="o">)</span>
</span><span class='line'>Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2008</span> Free Software Foundation, Inc.
</span><span class='line'>License GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
</span><span class='line'>This is free software: you are free to change and redistribute it.
</span><span class='line'>There is NO WARRANTY, to the extent permitted by law.  Type <span class="s2">&quot;show copying&quot;</span>
</span><span class='line'>and <span class="s2">&quot;show warranty&quot;</span> <span class="k">for</span> details.
</span><span class='line'>This GDB was configured as <span class="s2">&quot;i386-redhat-linux-gnu&quot;</span>...
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> run b
</span><span class='line'>Starting program: /root/code/C7/ifstat b
</span><span class='line'>
</span><span class='line'>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'>0x00b6f957 in rawmemchr <span class="o">()</span> from /lib/libc.so.6
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> <span class="nb">break </span>parseDevFile
</span><span class='line'>Breakpoint <span class="m">1</span> at 0x804854a: file ifstat.c, line 10.
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> run b
</span><span class='line'>The program being debugged has been started already.
</span><span class='line'>Start it from the beginning? <span class="o">(</span>y or n<span class="o">)</span> y
</span><span class='line'>Starting program: /root/code/C7/ifstat b
</span><span class='line'>
</span><span class='line'>Breakpoint 1, parseDevFile <span class="o">(</span><span class="nv">iface</span><span class="o">=</span>0xbfe52b5e <span class="s2">&quot;b&quot;</span>, <span class="nv">bRx</span><span class="o">=</span>0xbfe50f80, <span class="nv">pRx</span><span class="o">=</span>0xbfe50f70, <span class="nv">bTx</span><span class="o">=</span>0xbfe50f78, <span class="nv">pTx</span><span class="o">=</span>0xbfe50f68<span class="o">)</span> at ifstat.c:10
</span><span class='line'><span class="m">10</span>              FILE * <span class="nv">fp</span> <span class="o">=</span> NULL<span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">11</span>              char * <span class="nv">line</span> <span class="o">=</span> NULL<span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">12</span>              unsigned int <span class="nv">len</span> <span class="o">=</span> 0<span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">13</span>              <span class="nv">fp</span> <span class="o">=</span> fopen<span class="o">(</span><span class="s2">&quot;/proc/net/dev&quot;</span>, <span class="s2">&quot;r&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> print fp
</span><span class='line'><span class="nv">$1</span> <span class="o">=</span> <span class="o">(</span>FILE *<span class="o">)</span> 0x0
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">14</span>              <span class="k">if</span><span class="o">(</span><span class="nv">fp</span> <span class="o">==</span> NULL<span class="o">)</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> display line
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x0
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9730170 <span class="s2">&quot;Inter-|   Receive&quot;</span>, <span class="s1">&#39; &#39;</span> &lt;repeats <span class="m">48</span> <span class="nb">times</span>&gt;, <span class="s2">&quot;|  Transmit\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9730170 <span class="s2">&quot;Inter-|   Receive&quot;</span>, <span class="s1">&#39; &#39;</span> &lt;repeats <span class="m">48</span> <span class="nb">times</span>&gt;, <span class="s2">&quot;|  Transmit\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9730170 <span class="s2">&quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">22</span>                              sscanf<span class="o">(</span>strstr<span class="o">(</span>line, <span class="s2">&quot;:&quot;</span><span class="o">)</span>+1, <span class="s2">&quot;%llu%llu%*u%*u%*u%*u%*u%*u%llu%llu&quot;</span>, bRx, pRx, bTx, pTx<span class="o">)</span><span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9730170 <span class="s2">&quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'>0x00b6f957 in rawmemchr <span class="o">()</span> from /lib/libc.so.6
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We found another bug, also we can see ./ifstat dba</p>

<figure class='code'><figcaption><span>run.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># gdb ./ifstat</span>
</span><span class='line'>GNU gdb Fedora <span class="o">(</span>6.8-27.el5<span class="o">)</span>
</span><span class='line'>Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2008</span> Free Software Foundation, Inc.
</span><span class='line'>License GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
</span><span class='line'>This is free software: you are free to change and redistribute it.
</span><span class='line'>There is NO WARRANTY, to the extent permitted by law.  Type <span class="s2">&quot;show copying&quot;</span>
</span><span class='line'>and <span class="s2">&quot;show warranty&quot;</span> <span class="k">for</span> details.
</span><span class='line'>This GDB was configured as <span class="s2">&quot;i386-redhat-linux-gnu&quot;</span>...
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> run dba
</span><span class='line'>Starting program: /root/code/C7/ifstat dba
</span><span class='line'>dba In:     0.00 kbytes/s      <span class="m">0</span> P/s Out:     0.00 kbytes/s     <span class="m">0</span> P/s
</span><span class='line'>dba In:     0.00 kbytes/s      <span class="m">0</span> P/s Out:     0.00 kbytes/s     <span class="m">0</span> P/s
</span><span class='line'>
</span><span class='line'>Program received signal SIGINT, Interrupt.
</span><span class='line'>0x00ef3402 in __kernel_vsyscall <span class="o">()</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> <span class="nb">break </span>parseDevFile
</span><span class='line'>Breakpoint <span class="m">1</span> at 0x804854a: file ifstat.c, line 10.
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> run dba
</span><span class='line'>The program being debugged has been started already.
</span><span class='line'>Start it from the beginning? <span class="o">(</span>y or n<span class="o">)</span> y
</span><span class='line'>Starting program: /root/code/C7/ifstat dba
</span><span class='line'>
</span><span class='line'>Breakpoint 1, parseDevFile <span class="o">(</span><span class="nv">iface</span><span class="o">=</span>0xbf81bb5c <span class="s2">&quot;dba&quot;</span>, <span class="nv">bRx</span><span class="o">=</span>0xbf81ad40, <span class="nv">pRx</span><span class="o">=</span>0xbf81ad30, <span class="nv">bTx</span><span class="o">=</span>0xbf81ad38, <span class="nv">pTx</span><span class="o">=</span>0xbf81ad28<span class="o">)</span> at ifstat.c:10
</span><span class='line'><span class="m">10</span>              FILE * <span class="nv">fp</span> <span class="o">=</span> NULL<span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">11</span>              char * <span class="nv">line</span> <span class="o">=</span> NULL<span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">12</span>              unsigned int <span class="nv">len</span> <span class="o">=</span> 0<span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">13</span>              <span class="nv">fp</span> <span class="o">=</span> fopen<span class="o">(</span><span class="s2">&quot;/proc/net/dev&quot;</span>, <span class="s2">&quot;r&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">14</span>              <span class="k">if</span><span class="o">(</span><span class="nv">fp</span> <span class="o">==</span> NULL<span class="o">)</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> display line
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x0
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;Inter-|   Receive&quot;</span>, <span class="s1">&#39; &#39;</span> &lt;repeats <span class="m">48</span> <span class="nb">times</span>&gt;, <span class="s2">&quot;|  Transmit\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;Inter-|   Receive&quot;</span>, <span class="s1">&#39; &#39;</span> &lt;repeats <span class="m">48</span> <span class="nb">times</span>&gt;, <span class="s2">&quot;|  Transmit\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;    lo: 4684910    2267    0    0    0     0          0         0  4684910    2267    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;    lo: 4684910    2267    0    0    0     0          0         0  4684910    2267    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  eth0: 5135043   75928    0    0    0     0          0         0 15204045  129941    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  eth0: 5135043   75928    0    0    0     0          0         0 15204045  129941    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">25</span>              fclose<span class="o">(</span>fp<span class="o">)</span><span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">26</span>              free<span class="o">(</span>line<span class="o">)</span><span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">27</span>              <span class="k">return</span> 0<span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">28</span>      <span class="o">}</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'>dumpInterfaceUsage <span class="o">(</span><span class="nv">iface</span><span class="o">=</span>0xbf81bb5c <span class="s2">&quot;dba&quot;</span><span class="o">)</span> at ifstat.c:36
</span><span class='line'><span class="m">36</span>              sleep<span class="o">(</span>SLEEP_TIME<span class="o">)</span><span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">39</span>                      <span class="k">if</span><span class="o">(</span>parseDevFile<span class="o">(</span>iface, <span class="p">&amp;</span>ifaceBRxNew, <span class="p">&amp;</span>ifacePRxNew, <span class="p">&amp;</span>ifaceBTxNew, <span class="p">&amp;</span>ifacePTxNew<span class="o">)</span> <span class="o">==</span> -1<span class="o">)</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Breakpoint 1, parseDevFile <span class="o">(</span><span class="nv">iface</span><span class="o">=</span>0xbf81bb5c <span class="s2">&quot;dba&quot;</span>, <span class="nv">bRx</span><span class="o">=</span>0xbf81ad20, <span class="nv">pRx</span><span class="o">=</span>0xbf81ad10, <span class="nv">bTx</span><span class="o">=</span>0xbf81ad18, <span class="nv">pTx</span><span class="o">=</span>0xbf81ad08<span class="o">)</span> at ifstat.c:10
</span><span class='line'><span class="m">10</span>              FILE * <span class="nv">fp</span> <span class="o">=</span> NULL<span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0xaf5ca0 <span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">11</span>              char * <span class="nv">line</span> <span class="o">=</span> NULL<span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0xaf5ca0 <span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">12</span>              unsigned int <span class="nv">len</span> <span class="o">=</span> 0<span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x0
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">13</span>              <span class="nv">fp</span> <span class="o">=</span> fopen<span class="o">(</span><span class="s2">&quot;/proc/net/dev&quot;</span>, <span class="s2">&quot;r&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x0
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">14</span>              <span class="k">if</span><span class="o">(</span><span class="nv">fp</span> <span class="o">==</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x0
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x0
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;Inter-|   Receive&quot;</span>, <span class="s1">&#39; &#39;</span> &lt;repeats <span class="m">48</span> <span class="nb">times</span>&gt;, <span class="s2">&quot;|  Transmit\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;Inter-|   Receive&quot;</span>, <span class="s1">&#39; &#39;</span> &lt;repeats <span class="m">48</span> <span class="nb">times</span>&gt;, <span class="s2">&quot;|  Transmit\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;    lo: 4684910    2267    0    0    0     0          0         0  4684910    2267    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;    lo: 4684910    2267    0    0    0     0          0         0  4684910    2267    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  eth0: 5141021   76010    0    0    0     0          0         0 15217535  130042    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  eth0: 5141021   76010    0    0    0     0          0         0 15217535  130042    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">25</span>              fclose<span class="o">(</span>fp<span class="o">)</span><span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">26</span>              free<span class="o">(</span>line<span class="o">)</span><span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">27</span>              <span class="k">return</span> 0<span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">28</span>      <span class="o">}</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'>dumpInterfaceUsage <span class="o">(</span><span class="nv">iface</span><span class="o">=</span>0xbf81bb5c <span class="s2">&quot;dba&quot;</span><span class="o">)</span> at ifstat.c:40
</span><span class='line'><span class="m">40</span>                      <span class="nb">printf</span><span class="o">(</span><span class="s2">&quot;%s In: %8.2f kbytes/s  %5llu P/s Out: %8.2f kbytes/s %5llu P/s\n&quot;</span>, iface,
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'>dba In:     0.00 kbytes/s      <span class="m">0</span> P/s Out:     0.00 kbytes/s     <span class="m">0</span> P/s
</span></code></pre></td></tr></table></div></figure>


<h4>Conclusion:</h4>

<p>And now we can get the reason, the ./ifstat b is because we reached the line2 of the /proc/net/dev, it has b for &ldquo;bytes&rdquo;.  <br/>
./ifstat dba always print 0 because we don&rsquo;t have this equipment at all !</p>

<h4>Correcting</h4>

<p>So the corrected code is listed as following:</p>

<figure class='code'><figcaption><span>ifstat_upgrade.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">int</span> <span class="nf">parseDevFile</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">iface</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">bRx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">pRx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">bTx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">pTx</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">FILE</span> <span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">char</span> <span class="o">*</span> <span class="n">line</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">short</span> <span class="kt">int</span> <span class="n">exists</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;/proc/net/dev&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">fp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">while</span><span class="p">(</span><span class="n">getline</span><span class="p">(</span><span class="o">&amp;</span><span class="n">line</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="n">strstr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">iface</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                        <span class="k">if</span><span class="p">(</span><span class="n">strstr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;:&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>                        <span class="p">{</span>
</span><span class='line'>                                <span class="n">sscanf</span><span class="p">(</span><span class="n">strstr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;:&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;%llu%llu%*u%*u%*u%*u%*u%*u%llu%llu&quot;</span><span class="p">,</span> <span class="n">bRx</span><span class="p">,</span> <span class="n">pRx</span><span class="p">,</span> <span class="n">bTx</span><span class="p">,</span> <span class="n">pTx</span><span class="p">);</span>
</span><span class='line'>                                <span class="n">exists</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>                        <span class="p">}</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
</span><span class='line'>        <span class="n">free</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span> <span class="n">exists</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Your device %s is not in the file /proc/net/dev!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">iface</span><span class="p">);</span>
</span><span class='line'>                <span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now run it and the result is listed as:</p>

<figure class='code'><figcaption><span>run.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># ./ifstat_upgrade b</span>
</span><span class='line'>Your device b is not in the file /proc/net/dev!
</span><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># ./ifstat_upgrade bba</span>
</span><span class='line'>Your device bba is not in the file /proc/net/dev!
</span><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># ./ifstat_upgrade eth0</span>
</span><span class='line'>eth0 In:     0.03 kbytes/s      <span class="m">0</span> P/s Out:     0.00 kbytes/s     <span class="m">0</span> P/s
</span><span class='line'>eth0 In:     0.03 kbytes/s      <span class="m">0</span> P/s Out:     0.08 kbytes/s     <span class="m">0</span> P/s
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/08/programming-in-c-of-fc-tutorial-4/">Programming in C of FC Tutorial 4</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-08T16:01:06+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:01 pm</span></time>
        
         | <a href="/blog/2014/04/08/programming-in-c-of-fc-tutorial-4/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Full Circle C 6</h3>

<h4>Using valgrid for memory check</h4>

<p>See <a href="www.valgrind.org">www.valgrind.org</a> for more information for using the valgrind available tools.   <br/>
memcheck is the main topic in this chapter.   <br/>
this tool override libc calls that deal with handling memory. And it will do some bookkeeping. is all memory given back to the system, and is all the allocated memory still reachable?</p>

<figure class='code'><figcaption><span>leak.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">leak</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;malloc(10) points to: %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ptr</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="n">leak</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;malloc(15) in main: %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ptr</span><span class="p">);</span>
</span><span class='line'>        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){}</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The result shows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>valgrind --leak-check<span class="o">=</span>full --show-reachable<span class="o">=</span>yes ./memleak
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> Memcheck, a memory error detector.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> Copyright <span class="o">(</span>C<span class="o">)</span> 2002-2006, and GNU GPL<span class="s1">&#39;d, by Julian Seward et al.</span>
</span><span class='line'><span class="s1">==2144== Using LibVEX rev 1658, a library for dynamic binary translation.</span>
</span><span class='line'><span class="s1">==2144== Copyright (C) 2004-2006, and GNU GPL&#39;</span>d, by OpenWorks LLP.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> Using valgrind-3.2.1, a dynamic binary instrumentation framework.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> Copyright <span class="o">(</span>C<span class="o">)</span> 2000-2006, and GNU GPL<span class="err">&#39;</span>d, by Julian Seward et al.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> For more details, rerun with: -v
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022028
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022068
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40220a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40220e8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022128
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022168
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40221a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40221e8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022228
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022268
</span><span class='line'>malloc<span class="o">(</span>15<span class="o">)</span> in main: <span class="nv">0x40222a8</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> ERROR SUMMARY: <span class="m">0</span> errors from <span class="m">0</span> contexts <span class="o">(</span>suppressed: <span class="m">12</span> from 1<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> malloc/free: in use at <span class="nb">exit</span>: <span class="m">115</span> bytes in <span class="m">11</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> malloc/free: <span class="m">11</span> allocs, <span class="m">0</span> frees, <span class="m">115</span> bytes allocated.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> For counts of detected errors, rerun with: -v
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> searching <span class="k">for</span> pointers to <span class="m">11</span> not-freed blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> checked 46,792 bytes.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> <span class="m">15</span> bytes in <span class="m">1</span> blocks are still reachable in loss record <span class="m">1</span> of <span class="nv">2</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>    at 0x40053C0: malloc <span class="o">(</span>vg_replace_malloc.c:149<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>    by 0x8048419: main <span class="o">(</span>leak.c:17<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> <span class="m">100</span> bytes in <span class="m">10</span> blocks are definitely lost in loss record <span class="m">2</span> of <span class="nv">2</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>    at 0x40053C0: malloc <span class="o">(</span>vg_replace_malloc.c:149<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>    by 0x80483C5: leak <span class="o">(</span>leak.c:6<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>    by 0x8048403: main <span class="o">(</span>leak.c:15<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> LEAK SUMMARY:
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>    definitely lost: <span class="m">100</span> bytes in <span class="m">10</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>      possibly lost: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>    still reachable: <span class="m">15</span> bytes in <span class="m">1</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>         suppressed: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span></code></pre></td></tr></table></div></figure>


<p>If we change the code into following, this means valgrid won&rsquo;t interpret the output, so this will let the tracked memory add 10</p>

<figure class='code'><figcaption><span>leak1.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">leak</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;malloc(10) points to: %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ptr</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="n">leak</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;malloc(15) in main: %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ptr</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">//while(1){}</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Compile and verify:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gcc -Wall -g leak1.c -o memleak1
</span><span class='line'>View the valgrind result:
</span><span class='line'>valgrind --leak-check<span class="o">=</span>full --show-reachable<span class="o">=</span>yes ./memleak1
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> Memcheck, a memory error detector.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> Copyright <span class="o">(</span>C<span class="o">)</span> 2002-2006, and GNU GPL<span class="s1">&#39;d, by Julian Seward et al.</span>
</span><span class='line'><span class="s1">==2190== Using LibVEX rev 1658, a library for dynamic binary translation.</span>
</span><span class='line'><span class="s1">==2190== Copyright (C) 2004-2006, and GNU GPL&#39;</span>d, by OpenWorks LLP.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> Using valgrind-3.2.1, a dynamic binary instrumentation framework.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> Copyright <span class="o">(</span>C<span class="o">)</span> 2000-2006, and GNU GPL<span class="err">&#39;</span>d, by Julian Seward et al.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> For more details, rerun with: -v
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022028
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022068
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40220a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40220e8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022128
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022168
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40221a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40221e8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022228
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022268
</span><span class='line'>malloc<span class="o">(</span>15<span class="o">)</span> in main: <span class="nv">0x40222a8</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> ERROR SUMMARY: <span class="m">0</span> errors from <span class="m">0</span> contexts <span class="o">(</span>suppressed: <span class="m">12</span> from 1<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> malloc/free: in use at <span class="nb">exit</span>: <span class="m">115</span> bytes in <span class="m">11</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> malloc/free: <span class="m">11</span> allocs, <span class="m">0</span> frees, <span class="m">115</span> bytes allocated.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> For counts of detected errors, rerun with: -v
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> searching <span class="k">for</span> pointers to <span class="m">11</span> not-freed blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> checked 46,796 bytes.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> <span class="m">15</span> bytes in <span class="m">1</span> blocks are definitely lost in loss record <span class="m">1</span> of <span class="nv">2</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>    at 0x40053C0: malloc <span class="o">(</span>vg_replace_malloc.c:149<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>    by 0x8048419: main <span class="o">(</span>leak1.c:17<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> <span class="m">100</span> bytes in <span class="m">10</span> blocks are definitely lost in loss record <span class="m">2</span> of <span class="nv">2</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>    at 0x40053C0: malloc <span class="o">(</span>vg_replace_malloc.c:149<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>    by 0x80483C5: leak <span class="o">(</span>leak1.c:6<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>    by 0x8048403: main <span class="o">(</span>leak1.c:15<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> LEAK SUMMARY:
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>    definitely lost: <span class="m">115</span> bytes in <span class="m">11</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>      possibly lost: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>    still reachable: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>         suppressed: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span></code></pre></td></tr></table></div></figure>


<h4>exercise 1:</h4>

<p>vmstat is a tool which report system usage statistics, use strace to figure out which /proc/file(s) it uses to generate its output</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>execve<span class="o">(</span><span class="s2">&quot;/usr/bin/vmstat&quot;</span>, <span class="o">[</span><span class="s2">&quot;vmstat&quot;</span><span class="o">]</span>, <span class="o">[</span>/* <span class="m">29</span> vars */<span class="o">])</span> <span class="o">=</span> 0
</span><span class='line'>brk<span class="o">(</span>0<span class="o">)</span>                                  <span class="o">=</span> 0x96b7000
</span><span class='line'>access<span class="o">(</span><span class="s2">&quot;/etc/ld.so.preload&quot;</span>, R_OK<span class="o">)</span>      <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
</span><span class='line'>open<span class="o">(</span><span class="s2">&quot;/etc/ld.so.cache&quot;</span>, O_RDONLY<span class="o">)</span>      <span class="o">=</span> 3
</span><span class='line'>fstat64<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0644, <span class="nv">st_size</span><span class="o">=</span>95416, ...<span class="o">})</span> <span class="o">=</span> 0
</span><span class='line'>mmap2<span class="o">(</span>NULL, 95416, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0xb7f80000
</span><span class='line'>close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> 0
</span><span class='line'>open<span class="o">(</span><span class="s2">&quot;/lib/libproc-3.2.7.so&quot;</span>, O_RDONLY<span class="o">)</span> <span class="o">=</span> 3
</span><span class='line'><span class="nb">read</span><span class="o">(</span>3, <span class="s2">&quot;\177ELF\1\1\1\0\0\0\0\0\0\0\0\0\3\0\3\0\1\0\0\0\320c\304\0004\0\0\0&quot;</span>..., 512<span class="o">)</span> <span class="o">=</span> 512
</span><span class='line'>fstat64<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0755, <span class="nv">st_size</span><span class="o">=</span>54212, ...<span class="o">})</span> <span class="o">=</span> 0
</span><span class='line'>mmap2<span class="o">(</span>NULL, 4096, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0xb7f7f000
</span><span class='line'>mmap2<span class="o">(</span>0xc44000, 133592, PROT_READ<span class="p">|</span>PROT_EXEC, MAP_PRIVATE<span class="p">|</span>MAP_DENYWRITE, 3, 0<span class="o">)</span> <span class="o">=</span> 0xc44000
</span><span class='line'>mmap2<span class="o">(</span>0xc51000, 4096, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0xc<span class="o">)</span> <span class="o">=</span> 0xc51000
</span><span class='line'>mmap2<span class="o">(</span>0xc52000, 76248, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0xc52000
</span><span class='line'>close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> 0
</span><span class='line'>open<span class="o">(</span><span class="s2">&quot;/lib/libc.so.6&quot;</span>, O_RDONLY<span class="o">)</span>        <span class="o">=</span> 3
</span><span class='line'><span class="nb">read</span><span class="o">(</span>3, <span class="s2">&quot;\177ELF\1\1\1\0\0\0\0\0\0\0\0\0\3\0\3\0\1\0\0\0\320?\261\0004\0\0\0&quot;</span>..., 512<span class="o">)</span> <span class="o">=</span> 512
</span><span class='line'>fstat64<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0755, <span class="nv">st_size</span><span class="o">=</span>1606808, ...<span class="o">})</span> <span class="o">=</span> 0
</span><span class='line'>mmap2<span class="o">(</span>0xafe000, 1324452, PROT_READ<span class="p">|</span>PROT_EXEC, MAP_PRIVATE<span class="p">|</span>MAP_DENYWRITE, 3, 0<span class="o">)</span> <span class="o">=</span> 0xafe000
</span><span class='line'>mmap2<span class="o">(</span>0xc3c000, 12288, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0x13e<span class="o">)</span> <span class="o">=</span> 0xc3c000
</span><span class='line'>mmap2<span class="o">(</span>0xc3f000, 9636, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0xc3f000
</span><span class='line'>close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> 0
</span><span class='line'>mmap2<span class="o">(</span>NULL, 4096, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0xb7f7e000
</span><span class='line'>set_thread_area<span class="o">({</span>entry_number:-1 -&gt; 6, base_addr:0xb7f7e6c0, limit:1048575, seg_32bit:1, contents:0, read_exec_only:0, limit_in_pages:1, seg_not_present:0, useable:1<span class="o">})</span> <span class="o">=</span> 0
</span><span class='line'>mprotect<span class="o">(</span>0xc3c000, 8192, PROT_READ<span class="o">)</span>     <span class="o">=</span> 0
</span><span class='line'>mprotect<span class="o">(</span>0xaf5000, 4096, PROT_READ<span class="o">)</span>     <span class="o">=</span> 0
</span><span class='line'>munmap<span class="o">(</span>0xb7f80000, 95416<span class="o">)</span>               <span class="o">=</span> 0
</span><span class='line'>uname<span class="o">({</span><span class="nv">sys</span><span class="o">=</span><span class="s2">&quot;Linux&quot;</span>, <span class="nv">node</span><span class="o">=</span><span class="s2">&quot;localhost.localdomain&quot;</span>, ...<span class="o">})</span> <span class="o">=</span> 0
</span><span class='line'>brk<span class="o">(</span>0<span class="o">)</span>                                  <span class="o">=</span> 0x96b7000
</span><span class='line'>brk<span class="o">(</span>0x96d8000<span class="o">)</span>                          <span class="o">=</span> 0x96d8000
</span><span class='line'>open<span class="o">(</span><span class="s2">&quot;/proc/stat&quot;</span>, O_RDONLY<span class="o">)</span>            <span class="o">=</span> 3
</span><span class='line'>fstat64<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0444, <span class="nv">st_size</span><span class="o">=</span>0, ...<span class="o">})</span> <span class="o">=</span> 0
</span><span class='line'>mmap2<span class="o">(</span>NULL, 4096, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0xb7f97000
</span><span class='line'><span class="nb">read</span><span class="o">(</span>3, <span class="s2">&quot;cpu  14886 15300 97152 608490 41&quot;</span>..., 4096<span class="o">)</span> <span class="o">=</span> 693
</span><span class='line'><span class="nb">read</span><span class="o">(</span>3, <span class="s2">&quot;&quot;</span>, 4096<span class="o">)</span>                       <span class="o">=</span> 0
</span><span class='line'>close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> 0
</span><span class='line'>munmap<span class="o">(</span>0xb7f97000, 4096<span class="o">)</span>                <span class="o">=</span> 0
</span><span class='line'>ioctl<span class="o">(</span>1, TIOCGWINSZ, <span class="o">{</span><span class="nv">ws_row</span><span class="o">=</span>36, <span class="nv">ws_col</span><span class="o">=</span>115, <span class="nv">ws_xpixel</span><span class="o">=</span>0, <span class="nv">ws_ypixel</span><span class="o">=</span>0<span class="o">})</span> <span class="o">=</span> 0
</span><span class='line'>fstat64<span class="o">(</span>1, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFCHR<span class="p">|</span>0620, <span class="nv">st_rdev</span><span class="o">=</span>makedev<span class="o">(</span>136, 4<span class="o">)</span>, ...<span class="o">})</span> <span class="o">=</span> 0
</span><span class='line'>mmap2<span class="o">(</span>NULL, 4096, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0xb7f97000
</span><span class='line'>write<span class="o">(</span>1, <span class="s2">&quot;procs -----------memory---------&quot;</span>..., 82procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu------
</span><span class='line'><span class="o">)</span> <span class="o">=</span> 82
</span><span class='line'>write<span class="o">(</span>1, <span class="s2">&quot; r  b   swpd   free   buff  cach&quot;</span>..., <span class="m">81</span> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
</span><span class='line'><span class="o">)</span> <span class="o">=</span> 81
</span><span class='line'>open<span class="o">(</span><span class="s2">&quot;/proc/meminfo&quot;</span>, O_RDONLY<span class="o">)</span>         <span class="o">=</span> 3
</span><span class='line'>lseek<span class="o">(</span>3, 0, SEEK_SET<span class="o">)</span>                   <span class="o">=</span> 0
</span><span class='line'><span class="nb">read</span><span class="o">(</span>3, <span class="s2">&quot;MemTotal:       897068 kB\nMemFre&quot;</span>..., 1023<span class="o">)</span> <span class="o">=</span> 771
</span><span class='line'>open<span class="o">(</span><span class="s2">&quot;/proc/stat&quot;</span>, O_RDONLY<span class="o">)</span>            <span class="o">=</span> 4
</span><span class='line'><span class="nb">read</span><span class="o">(</span>4, <span class="s2">&quot;cpu  14886 15300 97153 608490 41&quot;</span>..., 65535<span class="o">)</span> <span class="o">=</span> 693
</span><span class='line'>open<span class="o">(</span><span class="s2">&quot;/proc/vmstat&quot;</span>, O_RDONLY<span class="o">)</span>          <span class="o">=</span> 5
</span><span class='line'>lseek<span class="o">(</span>5, 0, SEEK_SET<span class="o">)</span>                   <span class="o">=</span> 0
</span><span class='line'><span class="nb">read</span><span class="o">(</span>5, <span class="s2">&quot;nr_anon_pages 29682\nnr_mapped 13&quot;</span>..., 1023<span class="o">)</span> <span class="o">=</span> 803
</span><span class='line'>write<span class="o">(</span>1, <span class="s2">&quot; 0  0    120  16980  32852 67407&quot;</span>..., <span class="m">81</span> <span class="m">0</span>  <span class="m">0</span>    <span class="m">120</span>  <span class="m">16980</span>  <span class="m">32852</span> <span class="m">674076</span>    <span class="m">0</span>    <span class="m">0</span>   <span class="m">228</span>   <span class="m">223</span> <span class="m">1040</span>  <span class="m">432</span>  <span class="m">4</span> <span class="m">13</span> <span class="m">78</span>  <span class="m">5</span>  0
</span><span class='line'><span class="o">)</span> <span class="o">=</span> 81
</span><span class='line'>exit_group<span class="o">(</span>0<span class="o">)</span>                           <span class="o">=</span> ?
</span></code></pre></td></tr></table></div></figure>


<p>From the above output, we can see, it access /proc/stat and /proc/vmstat for output message.</p>

<h4>exercise 2</h4>

<p>Repeat the ltrace /strace example on wget with ivalid URL, TBD</p>

<h4>exercise 3</h4>

<p>Does valgrind automatically trace child process?</p>

<figure class='code'><figcaption><span>fork.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* For using fork() */</span>
</span><span class='line'><span class="cp">#include &lt;sys/types.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* Using errono */</span>
</span><span class='line'><span class="cp">#include &lt;errno.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">leak</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;malloc(10) points to: %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ptr</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">pid_t</span> <span class="n">child</span><span class="p">;</span>
</span><span class='line'>        <span class="cm">/* Parent do leak() */</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="n">leak</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/* Now fork a child process */</span>
</span><span class='line'>        <span class="k">if</span><span class="p">((</span><span class="n">child</span> <span class="o">=</span> <span class="n">fork</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;fork of child failed: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">strerror</span><span class="p">(</span><span class="n">errno</span><span class="p">));</span>
</span><span class='line'>                <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">child</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Now its in child process</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>                <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1">// parent will exit immediately !</span>
</span><span class='line'>                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Parent will exit!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>                <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>                <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Only Child comes here</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Only child comes here!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="n">leak</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We use following command for tracing the output:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>root@localhost code<span class="o">]</span><span class="c"># valgrind --leak-check=full --show-reachable=yes ./memleak_fork</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> Memcheck, a memory error detector.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> Copyright <span class="o">(</span>C<span class="o">)</span> 2002-2006, and GNU GPL<span class="s1">&#39;d, by Julian Seward et al.</span>
</span><span class='line'><span class="s1">==2561== Using LibVEX rev 1658, a library for dynamic binary translation.</span>
</span><span class='line'><span class="s1">==2561== Copyright (C) 2004-2006, and GNU GPL&#39;</span>d, by OpenWorks LLP.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> Using valgrind-3.2.1, a dynamic binary instrumentation framework.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> Copyright <span class="o">(</span>C<span class="o">)</span> 2000-2006, and GNU GPL<span class="err">&#39;</span>d, by Julian Seward et al.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> For more details, rerun with: -v
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022028
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022068
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40220a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40220e8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022128
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022168
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40221a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40221e8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022228
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022268
</span><span class='line'>Now its in child process
</span><span class='line'>Parent will <span class="nb">exit</span>!
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> ERROR SUMMARY: <span class="m">0</span> errors from <span class="m">0</span> contexts <span class="o">(</span>suppressed: <span class="m">12</span> from 1<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> malloc/free: in use at <span class="nb">exit</span>: <span class="m">100</span> bytes in <span class="m">10</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> malloc/free: <span class="m">10</span> allocs, <span class="m">0</span> frees, <span class="m">100</span> bytes allocated.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> For counts of detected errors, rerun with: -v
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> searching <span class="k">for</span> pointers to <span class="m">10</span> not-freed blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> checked 46,796 bytes.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> <span class="m">100</span> bytes in <span class="m">10</span> blocks are definitely lost in loss record <span class="m">1</span> of <span class="nv">1</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>    at 0x40053C0: malloc <span class="o">(</span>vg_replace_malloc.c:149<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>    by 0x8048515: leak <span class="o">(</span>fork.c:15<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>    by 0x8048553: main <span class="o">(</span>fork.c:26<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> LEAK SUMMARY:
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>    definitely lost: <span class="m">100</span> bytes in <span class="m">10</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>      possibly lost: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>    still reachable: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>         suppressed: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span><span class='line'><span class="o">[</span>root@localhost code<span class="o">]</span><span class="c"># Only child comes here!</span>
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40222a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40222e8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022328
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022368
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40223a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40223e8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022428
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022468
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40224a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: <span class="nv">0x40224e8</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span> ERROR SUMMARY: <span class="m">0</span> errors from <span class="m">0</span> contexts <span class="o">(</span>suppressed: <span class="m">12</span> from 1<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span> malloc/free: in use at <span class="nb">exit</span>: <span class="m">200</span> bytes in <span class="m">20</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span> malloc/free: <span class="m">20</span> allocs, <span class="m">0</span> frees, <span class="m">200</span> bytes allocated.
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span> For counts of detected errors, rerun with: -v
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span> searching <span class="k">for</span> pointers to <span class="m">20</span> not-freed blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span> checked 46,796 bytes.
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span> <span class="m">200</span> bytes in <span class="m">20</span> blocks are definitely lost in loss record <span class="m">1</span> of <span class="nv">1</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>    at 0x40053C0: malloc <span class="o">(</span>vg_replace_malloc.c:149<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>    by 0x8048515: leak <span class="o">(</span>fork.c:15<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>    by 0x8048553: main <span class="o">(</span>fork.c:26<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span> LEAK SUMMARY:
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>    definitely lost: <span class="m">200</span> bytes in <span class="m">20</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>      possibly lost: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>    still reachable: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>         suppressed: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span></code></pre></td></tr></table></div></figure>


<p>From the above output, we can see valgrid also tracked the child process&rsquo;s memory usage.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/08/programming-in-c-of-fc-tutorial-3/">Programming in C of FC Tutorial 3</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-08T09:41:55+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>9:41 am</span></time>
        
         | <a href="/blog/2014/04/08/programming-in-c-of-fc-tutorial-3/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Full Circle C 5</h3>

<h4>Callback</h4>

<p>Use Call Back function for implementing a calculator:</p>

<figure class='code'><figcaption><span>CB_Calculator.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">minus</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">multiply</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">divide</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">mathFun</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">operator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'>  <span class="n">mathFun</span> <span class="n">f</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">operator</span> <span class="n">functs</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;-&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">minus</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;+&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">add</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;*&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">multiply</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;/&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">divide</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">i</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter a:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter b:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter the operator:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="n">functs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">c</span><span class="o">==</span><span class="n">c</span><span class="p">)</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>              <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Result:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">functs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">));</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Unkown operator:%c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Exercise 1</h4>

<p>Modify the application to operate on floating point numbers instead of integers.</p>

<figure class='code'><figcaption><span>cal_float.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">float</span>  <span class="nf">minus</span><span class="p">(</span><span class="kt">float</span> <span class="n">a</span><span class="p">,</span> <span class="kt">float</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">float</span> <span class="nf">add</span><span class="p">(</span><span class="kt">float</span> <span class="n">a</span><span class="p">,</span> <span class="kt">float</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">float</span> <span class="nf">multiply</span><span class="p">(</span><span class="kt">float</span> <span class="n">a</span><span class="p">,</span> <span class="kt">float</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">float</span> <span class="nf">divide</span><span class="p">(</span><span class="kt">float</span> <span class="n">a</span><span class="p">,</span> <span class="kt">float</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="nf">float</span> <span class="p">(</span><span class="o">*</span><span class="n">mathFun</span><span class="p">)(</span><span class="kt">float</span><span class="p">,</span> <span class="kt">float</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">operator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'>  <span class="n">mathFun</span> <span class="n">f</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">operator</span> <span class="n">functs</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;-&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">minus</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;+&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">add</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;*&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">multiply</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;/&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">divide</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">float</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter a:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%f&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter b:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%f&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter the operator:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="n">functs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">c</span><span class="o">==</span><span class="n">c</span><span class="p">)</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>              <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Result:%f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">functs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">));</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Unkown operator:%c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Exercise 2</h4>

<p>Extend the calculator with the possibility for the user to enter &lsquo;q&rsquo; for quit</p>

<figure class='code'><figcaption><span>qforquit.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">minus</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">multiply</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">divide</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">mathFun</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">operator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'>  <span class="n">mathFun</span> <span class="n">f</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">operator</span> <span class="n">functs</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;-&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">minus</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;+&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">add</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;*&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">multiply</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;/&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">divide</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">q</span><span class="p">;</span>
</span><span class='line'>  <span class="k">do</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">i</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter a:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter b:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter the operator:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="n">functs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">c</span><span class="o">==</span><span class="n">c</span><span class="p">)</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>              <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Result:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">functs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">));</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Unkown operator:%c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter q for quit! Others for continue</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">q</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">q</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="n">q</span> <span class="o">!=</span> <span class="sc">&#39;q&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Exercise 4</h4>

<p>Modify the application that, instead of entering characters, the user is able to enter 5 plus 6 or 6 minus 5. In order to do this, you will need to adapt the structure to hold a string as the operator, and, instead of reading a character, you will need to read a string. Extra credit if you manage to do this without buffer overrun issues (see man getline) and memory leaks.</p>

<figure class='code'><figcaption><span>human.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">minus</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">multiply</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">divide</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">mathFun</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">operator</span>
</span><span class='line'><span class="p">{</span>  <span class="kt">char</span> <span class="n">c</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
</span><span class='line'>  <span class="n">mathFun</span> <span class="n">f</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">operator</span> <span class="n">functs</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span><span class='line'>  <span class="n">strcpy</span><span class="p">(</span><span class="n">functs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;minus&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">minus</span><span class="p">;</span>
</span><span class='line'>  <span class="n">strcpy</span><span class="p">(</span><span class="n">functs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;add&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">add</span><span class="p">;</span>
</span><span class='line'>  <span class="n">strcpy</span><span class="p">(</span><span class="n">functs</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;mul&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">multiply</span><span class="p">;</span>
</span><span class='line'>  <span class="n">strcpy</span><span class="p">(</span><span class="n">functs</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;div&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">divide</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">i</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">char</span> <span class="n">c</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter a:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter b:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter the operator:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">functs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Result is :%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">functs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">));</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Unkown operator:%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/35">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/33">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/10/08/dockerize-markdown-written-cv/">Dockerize Markdown Written CV</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/22/sharing-mouse-slash-keyboard-among-3-nodes/">Sharing Mouse/Keyboard Among 3 Nodes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/10/trouble-shooting-on-chromeoss-crouton-updating/">Trouble-Shooting on ChromeOS's Crouton Updating</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/31/tips-on-remove-maas-dhcp/">Tips on Remove Maas-dhcp</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/30/tips-for-ssd-installation/">Tips for SSD Installation</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
