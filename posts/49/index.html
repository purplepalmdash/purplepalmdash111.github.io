
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="The WD20EARS (and other sizes include 1.0 and 1.5 TB driver in the series) will attempt to park the read heads once every 8 seconds FOR THE LIFE OF &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/49">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//fonts.googleapis.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/12/western-digits-green-disk-on-ubuntu/">Western Digital Green Disk on Ubuntu</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-12T18:55:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>6:55 pm</span></time>
        
         | <a href="/blog/2013/12/12/western-digits-green-disk-on-ubuntu/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The WD20EARS (and other sizes include 1.0 and 1.5 TB driver in the series) will attempt to park the read heads once every 8 seconds FOR THE LIFE OF THE HDD which is just horrible! To see if you are affected use the smartctl command (part of smartmontools). If the last column changes rapidly, this section applies to your drive.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># smartctl /dev/sdb -a | grep Load_Cycle
</span><span class='line'>193 Load_Cycle_Count        0x0032   001   001   000    Old_age   Always       -       597115 
</span></code></pre></td></tr></table></div></figure>


<p>We have to disable this feature. Add lines to /etc/rc.local</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>hdparam -S 242 /dev/sda
</span><span class='line'>exit 0
</span></code></pre></td></tr></table></div></figure>


<p>The effect for upper comand is listed as:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># hdparm -S 242 /dev/sda
</span><span class='line'>/dev/sda:
</span><span class='line'> setting standby to 242 (1 hours)
</span></code></pre></td></tr></table></div></figure>


<p>By default the disk will standby when 1 hours reached, that will avoid our disk from broken.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/12/kali-linux-in-qemu/">KALI Linux in Qemu</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-12T17:32:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>5:32 pm</span></time>
        
         | <a href="/blog/2013/12/12/kali-linux-in-qemu/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Download the iso from kali website<a href="http://www.kali.org/downloads/">http://www.kali.org/downloads/</a>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget http://cdimage.kali.org/kali-images/kali-1.0.5/kali-linux-1.0.5-i386.iso
</span></code></pre></td></tr></table></div></figure>


<p>Create qemu img file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ qemu-img create -f qcow2 kali.qcow2 30G
</span><span class='line'>Formatting 'kali.qcow2', fmt=qcow2 size=32212254720 encryption=off cluster_size=65536 lazy_refcounts=off 
</span><span class='line'>Run installation. Here we use the run-qemu script which has been generated before under the same directory:
</span><span class='line'>[Trusty@DashArch kali]$ ./run-qemu -hda ./kali.qcow2 -boot d -cdrom /media/nfs/iso/kali-linux-1.0.5-i386.iso  -m 1024 -enable-kvm -usb
</span></code></pre></td></tr></table></div></figure>


<p>Choose &ldquo;Graphic Install&rdquo; because currently we are not familiar with this brand new distribution.   <br/>
Command for startup the sytem is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@DashArch kali]$ ./run-qemu -hda ./kali.qcow2 -boot d -cdrom /media/nfs/iso/kali-linux-1.0.5-i386.iso  -m 1024 -enable-kvm -usb
</span></code></pre></td></tr></table></div></figure>


<p>After installation finished, run &ldquo;sudo apt-get update&rdquo; and &ldquo;sudo apt-get upgrade&rdquo; to update your system to the newest version.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/12/ntp-in-lan-based-on-openwrt/">NTP in LAN Based on OPENWRT</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-12T14:13:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>2:13 pm</span></time>
        
         | <a href="/blog/2013/12/12/ntp-in-lan-based-on-openwrt/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Package Installation</h3>

<p>Disable the system default ntp server and install ntpd, this ntpd is the real ntpd package, not busybox-ntpd</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>opkg update
</span><span class='line'>opkg install ntpd
</span><span class='line'>/etc/init.d/sysntpd disable
</span><span class='line'>/etc/init.d/ntpd enable
</span><span class='line'>/etc/init.d/ntpd start
</span><span class='line'>netstat -l | grep ntp
</span></code></pre></td></tr></table></div></figure>


<p>The client installation, on debian:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>apt-get install ntp
</span></code></pre></td></tr></table></div></figure>


<h3>Server Configuration</h3>

<p>Comment all of the possible reference server, use local time source.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@OpenWrt:~# cat /etc/ntp.conf 
</span><span class='line'># use a random selection of 4 public stratum 2 servers
</span><span class='line'># see http://twiki.ntp.org/bin/view/Servers/NTPPoolServers
</span><span class='line'>
</span><span class='line'>restrict default nomodify notrap noquery
</span><span class='line'>#restrict default noquery
</span><span class='line'>
</span><span class='line'>#restrict 127.0.0.1
</span><span class='line'>restrict 10.0.0.0 mask 255.255.255.0 nomodify notrap
</span><span class='line'>
</span><span class='line'>server 127.127.1.0    # LOCAL CLOCK
</span><span class='line'>fudge 127.127.1.0 stratum 0
</span><span class='line'>
</span><span class='line'>driftfile  /var/lib/ntp/ntp.drift
</span></code></pre></td></tr></table></div></figure>


<p>Then restart the service. Your ntp server is available.</p>

<h3>Client Configuration</h3>

<p>Enable saned to enable ntp client on beaglebone:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># error message
</span><span class='line'>[....] Starting NTP server: ntpdsaned disabled; edit /etc/default/saned
</span><span class='line'>vim /etc/default/saned 
</span><span class='line'># Set to yes to start saned
</span><span class='line'>RUN=yes
</span></code></pre></td></tr></table></div></figure>


<p>Then we have to enable the ntp client&rsquo;s configuration:   <br/>
For Client manually synchornize</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~# ntpdate 10.0.0.1
</span><span class='line'> 1 Jan 05:18:55 ntpdate[2243]: the NTP socket is in use, exiting
</span><span class='line'>root@arm:~# ps -ef | grep ntp
</span><span class='line'>ntp       1805     1  0 04:30 ?        00:00:00 /usr/sbin/ntpd -p /var/run/ntpd.pid -g -u 107:112
</span><span class='line'>root      2245  2127  0 05:19 pts/0    00:00:00 grep ntp
</span><span class='line'>root@arm:~# kill 1805
</span><span class='line'>root@arm:~# date
</span><span class='line'>Sat Jan  1 05:19:05 UTC 2000
</span><span class='line'>root@arm:~# ntpdate 10.0.0.1
</span><span class='line'>12 Dec 07:38:44 ntpdate[2247]: step time server 10.0.0.1 offset 440129967.397166 sec
</span><span class='line'>root@arm:~# date
</span><span class='line'>Thu Dec 12 07:38:46 UTC 2013
</span></code></pre></td></tr></table></div></figure>


<p>The client configuration for ntp, remove all of the possible server, use LAN server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>server 10.0.0.1
</span></code></pre></td></tr></table></div></figure>


<p>tzselect will set the timezone of the equipment. The result is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>TZ='Asia/Shanghai'; export TZ
</span></code></pre></td></tr></table></div></figure>


<p>Add it into the ~/.profile, then your time will be adjusted to Shanghai Time.</p>

<h3>Update time via http</h3>

<p>Since I located in UMT+8, I will use following commands for sync the time</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>date $(wget -O - "http://www.timeapi.org/utc/in+eight+hours" 2&gt;/dev/null | sed s/[-T:+]/\ /g | awk '{print $2,$3,$4,$5,".",$6}' | tr -d " " )
</span></code></pre></td></tr></table></div></figure>


<p>Then add it to crontab</p>

<figure class='code'><figcaption><span>time.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>root@OpenWrt:~# cat /bin/time.sh
</span><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'><span class="c">#echo $http_proxy</span>
</span><span class='line'><span class="c">#echo $https_proxy</span>
</span><span class='line'>date <span class="k">$(</span>wget -O - <span class="s2">&quot;http://www.timeapi.org/utc/in+eight+hours&quot;</span> 2&gt;/dev/null <span class="p">|</span> sed s/<span class="o">[</span>-T:+<span class="o">]</span>/<span class="se">\ </span>/g <span class="p">|</span> awk <span class="s1">&#39;{print $2,$3,$4,$5,&quot;.&quot;,$6}&#39;</span> <span class="p">|</span> tr -d <span class="s2">&quot; &quot;</span> <span class="k">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The crontab -e should like following:</p>

<figure class='code'><figcaption><span>time.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>* */3 * * * /bin/time.sh
</span></code></pre></td></tr></table></div></figure>


<p>This means every 3 hours the script will be called for synchronizing the time.   <br/>
Now we can enjoy the precise time from the internet and make it availale for the service on LAN.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/11/bbblackbian-yi-jiao-ben-jie-xi/">BBBlack编译脚本解析</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-11T19:14:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>7:14 pm</span></time>
        
         | <a href="/blog/2013/12/11/bbblackbian-yi-jiao-ben-jie-xi/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Preparation</h3>

<p>Download the &ldquo;linux-dev&rdquo; repository from github:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://github.com/RobertCNelson/linux-dev.git
</span></code></pre></td></tr></table></div></figure>


<p>View the downloaded packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@XXXyyy mykernel]$ du -hs linux-dev/
</span><span class='line'>19M   linux-dev/
</span><span class='line'>[Trusty@XXXyyy linux-dev]$ ls
</span><span class='line'>build_deb.sh  build_kernel.sh  build_mainline.sh  LICENSE  patches  patch.sh  README  repo_maintenance  scripts  system.sh.sample  tools  version.sh
</span></code></pre></td></tr></table></div></figure>


<p>Switch to the 3.12 Branch:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git checkout origin/am33x-v3.12 -b tmp
</span><span class='line'>[Trusty@XXXyyy linux-dev]$ ls
</span><span class='line'>build_deb.sh  build_kernel.sh  LICENSE  patches  patch.sh  README  repo_maintenance  scripts  system.sh.sample  tools  version.sh
</span></code></pre></td></tr></table></div></figure>


<h3>Walk by lines</h3>

<p>Since we call ./build_kernel.sh will initialize the building, we will first see what&rsquo;s in this file  <br/>
a. Create the deploy directory, Line 23-Line 25</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">DIR</span><span class="o">=</span><span class="nv">$PWD</span>
</span><span class='line'>mkdir -p <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/deploy/
</span></code></pre></td></tr></table></div></figure>


<p>Then the code goes to line 189, since all of the code between 25-189 are functions.</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>/bin/sh -e <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/tools/host_det.sh <span class="o">||</span> <span class="o">{</span> <span class="nb">exit </span><span class="m">1</span> <span class="p">;</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This line will call tools/host_det.sh to detect the host, the result is listed:</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>Trusty@XXXyyy linux-dev<span class="o">]</span><span class="nv">$ </span>tools/host_det.sh
</span><span class='line'>which: no lsb_release in <span class="o">(</span>/home/Trusty/.rvm/gems/ruby-1.9.3-p448/bin:/home/Trusty/.rvm/gems/ruby-1.9.3-p448@global/bin:/home/Trusty/.rvm/rubies/ruby-1.9.3-p448/bin:/home/Trusty/.rvm/bin:/media/y/embedded/cortex/gcc-arm-none-eabi-4_7-2013q3/bin:/home/Trusty/perl5/bin:/opt/cross/bin:/media/y/u-boot/4.3.2/bin/:/usr/local/sbin:/usr/local/bin:/usr/bin:/opt/android-sdk/platform-tools:/opt/android-sdk/tools:/usr/bin/site_perl:/usr/bin/core_perl<span class="o">)</span>
</span><span class='line'>+ Detected build host <span class="o">[]</span>
</span><span class='line'>+ host: <span class="o">[</span>x86_64<span class="o">]</span>
</span><span class='line'>+ git HEAD commit: <span class="o">[</span>858e7dbdedcb5d85d0e3b84323c5a6bfe6bd3b5e<span class="o">]</span>
</span><span class='line'>In host_det.sh, the code lines between 6~381 are all functions, till line 381.
</span><span class='line'><span class="k">if</span> <span class="o">[</span> <span class="k">$(</span>which lsb_release<span class="k">)</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
</span><span class='line'>         info <span class="s2">&quot;Detected build host [`lsb_release -sd`]&quot;</span>
</span><span class='line'>Following is the lsb_relase result, lsb_release is the linux standard base base package, which will provide enough infomations of the installed linux system.
</span><span class='line'><span class="nv">$ </span>lsb_release
</span><span class='line'>LSB Version:  :core-3.1-ia32:core-3.1-noarch:graphics-3.1-ia32:graphics-3.1-noarch
</span><span class='line'><span class="o">[</span>Tomcat@MisteryPlace:  <span class="o">[]</span> /opt/home/Tomcat<span class="o">]</span>                                                                                        <span class="nv">$ </span>lsb_release -sd
</span><span class='line'><span class="s2">&quot;Scientific Linux SL release 5.5 (Boron)&quot;</span>
</span><span class='line'><span class="o">[</span>Tomcat@MisteryPlace:  <span class="o">[]</span> /opt/home/Tomcat<span class="o">]</span>                                                                                        <span class="nv">$ </span>uname -m
</span><span class='line'>i686
</span></code></pre></td></tr></table></div></figure>


<p>Testing the host and the git head commit</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>info <span class="s2">&quot;host: [`uname -m`]&quot;</span>
</span><span class='line'>info <span class="s2">&quot;git HEAD commit: [`git rev-parse HEAD`]&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This script is for testing the known hosts which runs redhat/debian/suse, and verify if you have installed all of the package need to support kernel build.</p>

<p>Copy the system.sh.sample to current directory</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="k">if</span> <span class="o">[</span> ! -f <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/system.sh <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
</span><span class='line'>  cp <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/system.sh.sample <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/system.sh
</span></code></pre></td></tr></table></div></figure>


<p>Next lines from 199 to 218 is to detect if the branches.list and branch.expired exists, if exists then some testing will be done.</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="k">if</span> <span class="o">[</span> -f <span class="s2">&quot;${DIR}/branches.list&quot;</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;-----------------------------&quot;</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;Please checkout one of the active branches:&quot;</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;-----------------------------&quot;</span>
</span><span class='line'>  cat <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/branches.list <span class="p">|</span> grep -v INACTIVE
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;-----------------------------&quot;</span>
</span><span class='line'>  <span class="nb">exit</span>
</span><span class='line'><span class="k">fi</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then go to line 220 and 221, unset 2 system variable</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">unset </span>CC
</span><span class='line'><span class="nb">unset </span>LINUX_GIT
</span></code></pre></td></tr></table></div></figure>


<p>Then run system.sh</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>. <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/system.sh
</span></code></pre></td></tr></table></div></figure>


<p>Then we will prepare the gcc.</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>/bin/sh -e <span class="s2">&quot;${DIR}/scripts/gcc.sh&quot;</span> <span class="o">||</span> <span class="o">{</span> <span class="nb">exit </span><span class="m">1</span> <span class="p">;</span> <span class="o">}</span>
</span><span class='line'>Switching to scripts/gcc.sh, the following lines will <span class="nb">set </span>the system variables, which will be used to choose the suitable linaro toolchain.
</span><span class='line'>. <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/system.sh
</span><span class='line'>
</span><span class='line'><span class="c">#For:</span>
</span><span class='line'><span class="c">#linaro_toolchain</span>
</span><span class='line'>. <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/version.sh
</span><span class='line'>Test the CC existence, <span class="k">if</span> not <span class="k">then</span> start building:
</span><span class='line'><span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;x${CC}&quot;</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">&quot;x${ARCH}&quot;</span> !<span class="o">=</span> <span class="s2">&quot;xarmv7l&quot;</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
</span><span class='line'>  gcc_linaro_toolchain
</span><span class='line'><span class="k">fi</span>
</span></code></pre></td></tr></table></div></figure>


<p>The code are funny, because echo x${CC} is actually x , so the gcc_linaro_toolchain will surely be called.</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="k">${</span><span class="nv">linaro_toolchain</span><span class="k">}</span>
</span><span class='line'>cortex_gcc_4_8
</span></code></pre></td></tr></table></div></figure>


<p>The variable {linaro_toolchain} is set via . version.sh, then the corresponding code lines will be called</p>

<figure class='code'><figcaption><span>gcc.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>   cortex_gcc_4_8<span class="o">)</span>
</span><span class='line'>      <span class="c">#https://launchpad.net/linaro-toolchain-binaries/+download</span>
</span><span class='line'>      <span class="c">#https://launchpad.net/linaro-toolchain-binaries/trunk/2013.10/+download/gcc-linaro-arm-linux-gnueabihf-4.8-2013.10_linux.tar.xz</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">gcc_version</span><span class="o">=</span><span class="s2">&quot;4.8&quot;</span>
</span><span class='line'>      <span class="nv">release</span><span class="o">=</span><span class="s2">&quot;2013.10&quot;</span>
</span><span class='line'>      <span class="nv">toolchain_name</span><span class="o">=</span><span class="s2">&quot;gcc-linaro-arm-linux-gnueabihf&quot;</span>
</span><span class='line'>      <span class="nv">site</span><span class="o">=</span><span class="s2">&quot;https://launchpad.net/linaro-toolchain-binaries&quot;</span>
</span><span class='line'>      <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;trunk/${release}&quot;</span>
</span><span class='line'>      <span class="nv">directory</span><span class="o">=</span><span class="s2">&quot;${toolchain_name}-${gcc_version}-${release}_linux&quot;</span>
</span><span class='line'>      <span class="nv">filename</span><span class="o">=</span><span class="s2">&quot;${directory}.tar.xz&quot;</span>
</span><span class='line'>      <span class="nv">datestamp</span><span class="o">=</span><span class="s2">&quot;${release}-${toolchain_name}&quot;</span>
</span><span class='line'>      <span class="nv">untar</span><span class="o">=</span><span class="s2">&quot;tar -xJf&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">binary</span><span class="o">=</span><span class="s2">&quot;bin/arm-linux-gnueabihf-&quot;</span>
</span><span class='line'>      <span class="p">;;</span>
</span><span class='line'>  *<span class="o">)</span>
</span><span class='line'>      <span class="nb">echo</span> <span class="s2">&quot;bug: maintainer forgot to set:&quot;</span>
</span><span class='line'>      <span class="nb">echo</span> <span class="s2">&quot;linaro_toolchain=\&quot;xzy\&quot; in version.sh&quot;</span>
</span><span class='line'>      <span class="nb">exit </span>1
</span><span class='line'>      <span class="p">;;</span>
</span></code></pre></td></tr></table></div></figure>


<p>
dl_gcc_generic will be called. download the corresponding packages from the linaro website.</p>

<p>After set the cross-compiler, we can get the kernel using git.sh, the git.sh is listed in scripts/git.sh</p>

<figure class='code'><figcaption><span>gcc.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>/bin/sh -e <span class="s2">&quot;${DIR}/scripts/git.sh&quot;</span> <span class="o">||</span> <span class="o">{</span> <span class="nb">exit </span><span class="m">1</span> <span class="p">;</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In git.sh, detect the user&rsquo;s email and user&rsquo;s name:</p>

<figure class='code'><figcaption><span>git.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">unset </span>git_config_user_email
</span><span class='line'><span class="nv">git_config_user_email</span><span class="o">=</span><span class="k">$(</span>git config --get user.email <span class="o">||</span> <span class="nb">true</span><span class="k">)</span>
</span><span class='line'>
</span><span class='line'><span class="nb">unset </span>git_config_user_name
</span><span class='line'><span class="nv">git_config_user_name</span><span class="o">=</span><span class="k">$(</span>git config --get user.name <span class="o">||</span> <span class="nb">true</span><span class="k">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then set using http or git, call git_kernel to git clone the corresponding resources from github.  <br/>
git_kernel will call check_and_or_clone() to get the source code from the github.</p>

<figure class='code'><figcaption><span>git.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git clone <span class="k">${</span><span class="nv">torvalds_linux</span><span class="k">}</span> <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/ignore/linux-src
</span></code></pre></td></tr></table></div></figure>


<p>and set the LINUX_GIT variable to</p>

<figure class='code'><figcaption><span>git.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">LINUX_GIT</span><span class="o">=</span><span class="s2">&quot;${DIR}/ignore/linux-src&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The downloaded packages are so large, that it occupies 1.4G disk space.</p>

<figure class='code'><figcaption><span>git.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>Trusty@XXXyyy ignore<span class="o">]</span><span class="nv">$ </span>du -hs *
</span><span class='line'>1.4G  linux-src
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/11/debian-on-nfs/">Debian on NFS</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-11T17:25:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>5:25 pm</span></time>
        
         | <a href="/blog/2013/12/11/debian-on-nfs/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Install some packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ apt-get install usbutils alsa-base
</span></code></pre></td></tr></table></div></figure>


<p>Use lsusb to view the installed usb equipments:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Bus 001 Device 006: ID 0e5c:6441 Bitland Information Technology Co., Ltd C-Media Sound Device
</span></code></pre></td></tr></table></div></figure>


<p>Install modules to the filesystem, since our newly-installed filesytem doesn&rsquo;t contains the necessary modules:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pwd
</span><span class='line'>/media/x/bbBlack/38/linux-dev/deploy
</span></code></pre></td></tr></table></div></figure>


<p>Copy the firmware tar package and modules tar package to the nfs root directory</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ tar xzvf 3.8.13-bone30-modules.tar.gz  -C ./
</span><span class='line'>$ tar xzvf ./3.8.13-bone30-firmware.tar.gz -C  ./lib/firmware/
</span></code></pre></td></tr></table></div></figure>


<p>Reboot and Use aplay to view the installed sound card:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:/# aplay -l
</span><span class='line'>**** List of PLAYBACK Hardware Devices ****
</span><span class='line'>card 0: Black [TI BeagleBone Black], device 0: HDMI nxp-hdmi-hifi-0 []
</span><span class='line'>  Subdevices: 1/1
</span><span class='line'>  Subdevice #0: subdevice #0
</span><span class='line'>card 1: U0xe5c0x6441 [USB Device 0xe5c:0x6441], device 0: USB Audio [USB Audio]
</span><span class='line'>  Subdevices: 0/1
</span><span class='line'>  Subdevice #0: subdevice #0
</span></code></pre></td></tr></table></div></figure>


<p>Edit a new asound.conf, which will enable the system to use the usb audio as the default sound card:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:/# cat /etc/asound.conf
</span><span class='line'>pcm.!default { 
</span><span class='line'>type hw 
</span><span class='line'>card 1
</span><span class='line'>#device 0 
</span><span class='line'>}
</span><span class='line'>ctl.!default { 
</span><span class='line'>type hw 
</span><span class='line'>card  1
</span><span class='line'>#device 0 
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Now you can use the mplayer to enjoy the sound from the console.      <br/>
If you want to grant the right to the ordinary user, Just use acl:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> setfacl -m u:debian:rw /dev/snd/*
</span></code></pre></td></tr></table></div></figure>


<p>Now the user &ldquo;debian&rdquo; could also listen the music from the console.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/11/nfs-of-beaglebone/">NFS of Beaglebone</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-11T09:32:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>9:32 am</span></time>
        
         | <a href="/blog/2013/12/11/nfs-of-beaglebone/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Serial Preparation</h3>

<p>The serial port image is as following:
<img src="/images/serial1.jpg" alt="serial1.jpg" /></p>

<p><img src="/images/serial2.jpg" alt="serial2.jpg" /></p>

<h3>Failure information</h3>

<p>The bootup failure information is listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Running uenvcmd ...
</span><span class='line'>reading zImage
</span><span class='line'>3345240 bytes read in 383 ms (8.3 MiB/s)
</span><span class='line'>reading /dtbs/am335x-boneblack.dtb
</span><span class='line'>24884 bytes read in 10 ms (2.4 MiB/s)
</span><span class='line'>
</span><span class='line'>Starting kernel ...
</span><span class='line'>
</span><span class='line'>Uncompressing Linux... done, booting the kernel.
</span><span class='line'>
</span><span class='line'>Error: unrecognized/unsupported machine ID (r1 = 0x00000e05).
</span><span class='line'>
</span><span class='line'>Available machine support:
</span><span class='line'>
</span><span class='line'>ID (hex)        NAME
</span><span class='line'>ffffffff        Generic OMAP4 (Flattened Device Tree)
</span><span class='line'>ffffffff        Generic AM33XX (Flattened Device Tree)
</span><span class='line'>ffffffff        Generic OMAP3-GP (Flattened Device Tree)
</span><span class='line'>ffffffff        Generic OMAP3 (Flattened Device Tree)
</span><span class='line'>0000060a        OMAP3 Beagle Board
</span><span class='line'>00000a9d        IGEP OMAP3 module
</span><span class='line'>00000928        IGEP v2 board
</span><span class='line'>00000ae7        OMAP4 Panda board
</span><span class='line'>
</span><span class='line'>Please check your kernel config and/or bootloader.
</span></code></pre></td></tr></table></div></figure>


<p>This is because the configuration file of the uEnv.txt is not right, the right one should be listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kernel_file=zImage
</span><span class='line'>initrd_file=uInitrd
</span><span class='line'>serverip=10.0.0.11
</span><span class='line'>ipaddr=10.0.0.122
</span><span class='line'>rootpath=/media/debianroot
</span><span class='line'>console=ttyO0,115200n8
</span><span class='line'>
</span><span class='line'>loadzimage=load mmc ${mmcdev}:${mmcpart} ${loadaddr} ${kernel_file}
</span><span class='line'>loadinitrd=load mmc ${mmcdev}:${mmcpart} 0x81000000 ${initrd_file}; setenv initrd_size ${filesize}
</span><span class='line'>loadfdt=load mmc ${mmcdev}:${mmcpart} ${fdtaddr} /dtbs/${fdtfile}
</span><span class='line'>
</span><span class='line'>netargs=setenv bootargs console=${console} ${optargs} root=/dev/nfs nfsroot=${serverip}:${rootpath},vers=3 rw ip=${ipaddr}
</span><span class='line'>#mmcargs=setenv bootargs console=${console} root=${mmcroot} rootfstype=${mmcrootfstype} ${optargs}
</span><span class='line'>
</span><span class='line'>#mmc uenvcmd
</span><span class='line'>#uenvcmd=run loadzimage; run loadfdt; run mmcargs; bootz ${loadaddr} - ${fdtaddr}
</span><span class='line'>
</span><span class='line'>#just zImage
</span><span class='line'>boot_ftd=run loadzimage; run loadfdt
</span><span class='line'>uenvcmd=run boot_ftd; run netargs; bootz ${loadaddr} - ${fdtaddr}
</span></code></pre></td></tr></table></div></figure>


<p>And remember to modify some files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~# cat /etc/network/interfaces
</span><span class='line'># interfaces(5) file used by ifup(8) and ifdown(8)
</span><span class='line'>auto lo
</span><span class='line'>iface lo inet loopback
</span><span class='line'>
</span><span class='line'>auto eth0
</span><span class='line'>iface eth0 inet static
</span><span class='line'>address 10.0.0.122
</span><span class='line'>netmask 255.255.255.0
</span><span class='line'>gateway 10.0.0.1
</span></code></pre></td></tr></table></div></figure>


<p>Add following lines in /etc/inittab:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>T0:23:respawn:/sbin/getty -L ttyO0 115200 vt102
</span></code></pre></td></tr></table></div></figure>


<p>Next time when you boot up the beaglebone, it will use the NFS files.</p>

<p>Tips: when your ownership of su is not right, you will meet"set uid failed" The solution is by Changing the ownership of the su used file;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chmod 4755 /bin/su
</span></code></pre></td></tr></table></div></figure>


<h3>NFS Server items</h3>

<p>/etc/exports file items:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/media/debianroot 10.0.0.1/24(rw,sync,no_subtree_check,no_root_squash) 10.0.0.11(rw,sync,no_subtree_check,no_root_squash)
</span></code></pre></td></tr></table></div></figure>


<p>Restart the nfs server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/etc/init.d/nfs-kernel-server
</span><span class='line'>#or
</span><span class='line'>service nfs-kernel-server restart
</span></code></pre></td></tr></table></div></figure>


<p>tar files into your directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tar xvfp /media/nfs/beaglebone/debian-7.1-bare-armhf-2013-08-25/armhf-rootfs-debian-wheezy.tar  -C /media/debianroot/
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/10/beaglebone-boot-from-nfs/">BeagleBone Boot From NFS</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-10T09:10:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>9:10 am</span></time>
        
         | <a href="/blog/2013/12/10/beaglebone-boot-from-nfs/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Building Preparation</h3>

<p>Create a new directory for stroing all of the items related to beaglebone.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /media/nfs/
</span><span class='line'>mkdir beaglebone
</span><span class='line'>cd beaglebone/
</span></code></pre></td></tr></table></div></figure>


<p>Download the cross-compiler from linaro toolchain binary website. And add it to the environment variables.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget -c https://launchpad.net/linaro-toolchain-binaries/trunk/2013.10/+download/gcc-linaro-arm-linux-gnueabihf-4.8-2013.10_linux.tar.xz
</span><span class='line'>tar xJf gcc-linaro-arm-linux-gnueabihf-4.8-2013.10_linux.tar.xz
</span><span class='line'>export CC=`pwd`/gcc-linaro-arm-linux-gnueabihf-4.8-2013.10_linux/bin/arm-linux-gnueabihf-
</span><span class='line'># Test the cross-compiler
</span><span class='line'>${CC}gcc --version
</span></code></pre></td></tr></table></div></figure>


<p>Checkout the U-boot:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://git.denx.de/u-boot.git
</span><span class='line'>cd u-boot/
</span><span class='line'>git checkout v2013.10 -b tmp
</span></code></pre></td></tr></table></div></figure>


<p>Patching U-boot:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget https://raw.github.com/eewiki/u-boot-patches/master/v2013.10/0001-am335x_evm-uEnv.txt-bootz-n-fixes.patch
</span><span class='line'>patch -p1 &lt; 0001-am335x_evm-uEnv.txt-bootz-n-fixes.patch
</span></code></pre></td></tr></table></div></figure>


<p>Configure and compile the U-boot:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>make ARCH=arm CROSS_COMPILE=${CC} distclean
</span><span class='line'>make ARCH=arm CROSS_COMPILE=${CC} am335x_evm_config
</span><span class='line'>make ARCH=arm CROSS_COMPILE=${CC}
</span></code></pre></td></tr></table></div></figure>


<p>Checkout the kernel:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://github.com/RobertCNelson/linux-dev.git
</span><span class='line'>cd linux-dev
</span><span class='line'>git checkout origin/am33x-v3.12 -b tmp
</span></code></pre></td></tr></table></div></figure>


<p>Now we got our kernel and U-boot available. The next step is to build a filesystem:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget -c https://rcn-ee.net/deb/minfs/raring/ubuntu-13.04-minimal-armhf-2013-08-25.tar.xz
</span></code></pre></td></tr></table></div></figure>


<p>Prepare the mmc card.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export DISK=/dev/mmcblk0
</span><span class='line'>[Trusty@XXXyyy beaglebone]$ sudo dd if=/dev/zero of=${DISK} bs=1M count=16
</span><span class='line'>16+0 records in
</span><span class='line'>16+0 records out
</span><span class='line'>16777216 bytes (17 MB) copied, 4.84877 s, 3.5 MB/s 
</span></code></pre></td></tr></table></div></figure>


<p>Use sfdisk for creating the partition layout.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo sfdisk --in-order --Linux --unit M ${DISK} &lt;&lt;-__EOF__
</span><span class='line'>1,48,0xE,*
</span><span class='line'>,,,-
</span><span class='line'>__EOF__
</span></code></pre></td></tr></table></div></figure>


<p>Format Partitions:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo mkfs.vfat -F 16 ${DISK}p1 -n boot
</span><span class='line'>sudo mkfs.ext4 ${DISK}p2 -L rootfs
</span></code></pre></td></tr></table></div></figure>


<p>Install Bootloader to the 1st partition of mmc card.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@XXXyyy beaglebone]$ sudo mkdir -p /media/boot/
</span><span class='line'>[Trusty@XXXyyy beaglebone]$ sudo mkdir -p /media/rootfs/
</span><span class='line'>[Trusty@XXXyyy beaglebone]$ sudo mount ${DISK}p1 /media/boot/
</span><span class='line'>[Trusty@XXXyyy beaglebone]$ sudo mount ${DISK}p2 /media/rootfs/
</span><span class='line'>[Trusty@XXXyyy beaglebone]$ sudo cp -v ./u-boot/MLO /media/boot/
</span><span class='line'>‘./u-boot/MLO’ -&gt; ‘/media/boot/MLO’
</span><span class='line'>[Trusty@XXXyyy beaglebone]$ sudo cp -v ./u-boot/u-boot.img /media/boot/
</span><span class='line'>‘./u-boot/u-boot.img’ -&gt; ‘/media/boot/u-boot.img’
</span><span class='line'>
</span><span class='line'>[Trusty@XXXyyy linux-dev]$ vim uEnv.txt
</span><span class='line'>[Trusty@XXXyyy linux-dev]$ sudo cp -v ./uEnv.txt /media/boot/
</span><span class='line'>‘./uEnv.txt’ -&gt; ‘/media/boot/uEnv.txt’
</span></code></pre></td></tr></table></div></figure>


<p>Copy Kernel:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@XXXyyy beaglebone]$ sudo cp -v ./linux-dev/deploy/3.12.4-bone9.zImage /media/boot/zImage
</span><span class='line'>‘./linux-dev/deploy/3.12.4-bone9.zImage’ -&gt; ‘/media/boot/zImage’
</span></code></pre></td></tr></table></div></figure>


<p>Copy Root File System:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo tar xfvp ./ubuntu-13.04-minimal-armhf-2013-08-25/armhf-rootfs-ubuntu-raring.tar -C /media/rootfs/
</span><span class='line'>Installation of kernel and configuration of the filesystem.
</span><span class='line'>sudo cp -v ./linux-dev/deploy/3.12.4-bone9.zImage /media/boot/zImage
</span><span class='line'>sudo mkdir -p /media/boot/dtbs/
</span><span class='line'>sudo tar xfov ./linux-dev/deploy/3.12.4-bone9-dtbs.tar.gz -C /media/boot/dtbs/
</span><span class='line'>sudo tar xfv ./linux-dev/deploy/3.12.4-bone9-firmware.tar.gz  -C /media/rootfs/lib/firmware/
</span><span class='line'>sudo tar xfv ./linux-dev/deploy/3.12.4-bone9-modules.tar.gz -C /media/rootfs/
</span><span class='line'>sudo vim /media/rootfs/etc/fstab
</span><span class='line'>sudo vim /media/rootfs/etc/network/interfaces 
</span><span class='line'>sudo vim /media/rootfs/etc/udev/rules.d/70-persistent-net.rules
</span><span class='line'>sudo vim /media/rootfs/etc/inittab
</span><span class='line'>sudo vim /media/rootfs/etc/init/serial.conf
</span><span class='line'>sudo umount /media/rootfs/
</span><span class='line'>sudo umount /media/boot/
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/09/listening-pandora-under-linux/">Listening Pandora Under Linux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-09T19:01:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>7:01 pm</span></time>
        
         | <a href="/blog/2013/12/09/listening-pandora-under-linux/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>An script named &ldquo;piandbar&rdquo; could let you listen to pandora music in CLI:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ yaourt -S pianobar
</span></code></pre></td></tr></table></div></figure>


<p>Or in ubuntu:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ apt-get install pianobar
</span></code></pre></td></tr></table></div></figure>


<p>The default configuration file could be found under ~/.config/pianobar:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat ~/.config/pianobar/config 
</span><span class='line'>user = xxx@xxx.com
</span><span class='line'>password = xxxxxx
</span><span class='line'>tls_fingerprint =
</span></code></pre></td></tr></table></div></figure>


<p>The most cool functionality is it could automatically &ldquo;remember&rdquo; all of the played songs.  <br/>
man pianobar could get more items, for example key-binding, etc. enjoy the music under CLI.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/09/enable-audio-in-beaglebone-black/">Enable Audio in BeagleBone Black</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-09T16:10:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>4:10 pm</span></time>
        
         | <a href="/blog/2013/12/09/enable-audio-in-beaglebone-black/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The usb sound card which I want to enable is a legend hub.</p>

<p><img src="/images/legendsoundcard.jpg" alt="legendsoundcard" /></p>

<h3>Package Installation</h3>

<p>Install necessary packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get update &&  sudo apt-get upgrade
</span><span class='line'>$ sudo apt-get install vim mplayer alsa-base 
</span></code></pre></td></tr></table></div></figure>


<h3>Hardware Configuration</h3>

<p>View the sound card information:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~# lsusb
</span><span class='line'>Bus 001 Device 029: ID 0424:2507 Standard Microsystems Corp. 
</span><span class='line'>Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</span><span class='line'>Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</span><span class='line'>Bus 001 Device 030: ID 0e5c:6441 Bitland Information Technology Co., Ltd C-Media Sound Device
</span><span class='line'>Bus 001 Device 113: ID 0e5c:6119 Bitland Information Technology Co., Ltd remote receive and control device
</span></code></pre></td></tr></table></div></figure>


<p>C-Media is the sound card, we gonna configure this card.   <br/>
list all of the loaded modules which contains the sound:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~# lsmod | grep snd
</span><span class='line'>snd_usb_audio         111095  0 
</span><span class='line'>snd_hwdep               5925  1 snd_usb_audio
</span><span class='line'>snd_usbmidi_lib        17765  1 snd_usb_audio
</span><span class='line'>snd_rawmidi            21065  1 snd_usbmidi_lib
</span><span class='line'>snd_seq_device          6582  1 snd_rawmidi
</span></code></pre></td></tr></table></div></figure>


<p>List all of the loaded sound modules and there order:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~# cat /proc/asound/cards   
</span><span class='line'> 0 [Black          ]: TI_BeagleBone_B - TI BeagleBone Black
</span><span class='line'>                      TI BeagleBone Black
</span><span class='line'> 1 [U0xe5c0x6441   ]: USB-Audio - USB Device 0xe5c:0x6441
</span><span class='line'>                      USB Device 0xe5c:0x6441 at usb-musb-hdrc.1.auto-1.1, full speed
</span></code></pre></td></tr></table></div></figure>


<h3>Sound Configure</h3>

<p>See how many cards could be viewed via system:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~# aplay -l
</span><span class='line'>**** List of PLAYBACK Hardware Devices ****
</span><span class='line'>card 0: Black [TI BeagleBone Black], device 0: HDMI nxp-hdmi-hifi-0 []
</span><span class='line'>  Subdevices: 1/1
</span><span class='line'>  Subdevice #0: subdevice #0
</span><span class='line'>card 1: U0xe5c0x6441 [USB Device 0xe5c:0x6441], device 0: USB Audio [USB Audio]
</span><span class='line'>  Subdevices: 0/1
</span><span class='line'>  Subdevice #0: subdevice #0
</span></code></pre></td></tr></table></div></figure>


<p>Then Configure the usb sound card to be the default(System Wide).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~# cat /etc/asound.conf 
</span><span class='line'>pcm.!default { 
</span><span class='line'>type hw 
</span><span class='line'>card 1
</span><span class='line'>#device 0 
</span><span class='line'>}
</span><span class='line'>ctl.!default { 
</span><span class='line'>type hw 
</span><span class='line'>card  1
</span><span class='line'>#device 0 
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Now you can listen to the music via usb card.  <br/>
For saving the current alsa configuration information:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo chmod -R 777 /var/lib/alsa/
</span><span class='line'>$ alsactl store
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/08/raspberrypi-gpio-programming-on-archlinux/">raspberryPI GPIO Programming on ArchLinux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-08T15:26:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>3:26 pm</span></time>
        
         | <a href="/blog/2013/12/08/raspberrypi-gpio-programming-on-archlinux/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Python Preparation</h3>

<p>Install python</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pacman -S python
</span></code></pre></td></tr></table></div></figure>


<p>Install pip</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pacman -S python-pip
</span></code></pre></td></tr></table></div></figure>


<p>Install virtualenv, before install virtualenv, be sure to update your time. 1970&rsquo;s time will get ssl error.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ date -s "8 Dec 2013 16:09:40"
</span><span class='line'>$ pip install --upgrade virtualenv virtualenvwrapper
</span></code></pre></td></tr></table></div></figure>


<p>Prepare virtualenv:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@alarmpi ~]# mkdir ~/pyv
</span><span class='line'>[root@alarmpi ~]# vim ~/.virtualenvrc
</span><span class='line'>export WORKON_HOME="/root/pyv"
</span><span class='line'>export PROJECT_HOME="/root/pyv"
</span><span class='line'>source /usr/bin/virtualenvwrapper.sh 
</span><span class='line'>[root@alarmpi ~]# source ~/.virtualenvrc
</span></code></pre></td></tr></table></div></figure>


<p>Now your virtualenv is OK. Make a virtualenv for python2.7</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkvirtualenv --python=/usr/bin/python2.7 v27
</span><span class='line'>cdvirtualenv
</span></code></pre></td></tr></table></div></figure>


<p>Add environment variables into your ~/.bashrc</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export WORKON_HOME=$HOME/pyv
</span><span class='line'>export PIP_VIRTUALENV_BASE=$WORKON_HOME
</span><span class='line'>source /usr/bin/virtualenvwrapper.sh
</span></code></pre></td></tr></table></div></figure>


<p>Next time if you want to enter virtualenv, simply type:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ workon v27
</span></code></pre></td></tr></table></div></figure>


<p>Install rpi.gpio</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pip install rpi.gpio
</span></code></pre></td></tr></table></div></figure>


<h3>Use rpi.gpio on raspberryPI</h3>

<p>TBD. I don&rsquo;t know why but my raspberyPI can&rsquo;t work properly on 1602 LCD. So I begin to test GPIO</p>

<h3>Use WiringPi for programming</h3>

<p>Preparation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pacman -S git gcc make
</span></code></pre></td></tr></table></div></figure>


<p>Download the packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone git://git.drogon.net/wiringPi
</span><span class='line'>$ cd wiringPi
</span><span class='line'>$ git pull origin
</span><span class='line'>$ ./build
</span></code></pre></td></tr></table></div></figure>


<p>Testing the WiringPi:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@alarmpi gpio]# ./gpio readall
</span><span class='line'>+----------+-Rev1-+------+--------+------+-------+
</span><span class='line'>| wiringPi | GPIO | Phys | Name   | Mode | Value |
</span><span class='line'>+----------+------+------+--------+------+-------+
</span><span class='line'>|      0   |  17  |  11  | GPIO 0 | OUT  | High  |
</span><span class='line'>|      1   |  18  |  12  | GPIO 1 | IN   | Low   |
</span><span class='line'>|      2   |  21  |  13  | GPIO 2 | IN   | Low   |
</span><span class='line'>|      3   |  22  |  15  | GPIO 3 | IN   | Low   |
</span><span class='line'>|      4   |  23  |  16  | GPIO 4 | IN   | Low   |
</span><span class='line'>|      5   |  24  |  18  | GPIO 5 | IN   | Low   |
</span><span class='line'>|      6   |  25  |  22  | GPIO 6 | IN   | Low   |
</span><span class='line'>|      7   |   4  |   7  | GPIO 7 | IN   | Low   |
</span><span class='line'>|      8   |   0  |   3  | SDA    | ALT0 | High  |
</span><span class='line'>|      9   |   1  |   5  | SCL    | ALT0 | High  |
</span><span class='line'>|     10   |   8  |  24  | CE0    | ALT0 | High  |
</span><span class='line'>|     11   |   7  |  26  | CE1    | ALT0 | High  |
</span><span class='line'>|     12   |  10  |  19  | MOSI   | ALT0 | Low   |
</span><span class='line'>|     13   |   9  |  21  | MISO   | ALT0 | Low   |
</span><span class='line'>|     14   |  11  |  23  | SCLK   | ALT0 | Low   |
</span><span class='line'>|     15   |  14  |   8  | TxD    | ALT0 | High  |
</span><span class='line'>|     16   |  15  |  10  | RxD    | ALT0 | High  |
</span><span class='line'>+----------+------+------+--------+------+-------+
</span></code></pre></td></tr></table></div></figure>


<p>Simply testing a LED tutorial:  <br/>
Wiring image:  <br/>
<img src="/images/ledgpio.jpg" alt="sourceledgpio.jpg" /></p>

<p>Then Writing following script:</p>

<figure class='code'><figcaption><span>autoshining.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>/root/wiringPi/gpio/gpio mode <span class="m">0</span> out
</span><span class='line'><span class="k">while</span> <span class="nb">true </span><span class="k">then</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'>  /root/wiringPi/gpio/gpio write <span class="m">0</span> 1
</span><span class='line'>  sleep 1
</span><span class='line'>  /root/wiringPi/gpio/gpio write <span class="m">0</span> 0
</span><span class='line'>  sleep 1
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now you will get a shining LED.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/50">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/48">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/03/02/conntrack-tools-usage/">Conntrack-tools Usage</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/01/e-buddyxiao-xi-ti-xing-fu-wu-she-ji-si-lu-1/">E-buddy消息提醒服务设计思路(1)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/01/ba-wan-e-buddy/">把玩e-Buddy</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/02/29/tips-on-v-usb-and-arduino-3-others/">Tips on V-USB and Arduino(3)--Others</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/02/26/tips-on-v-usb-and-arduino-2/">Tips on V-USB and Arduino(2)--用v-usb控制LED</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
