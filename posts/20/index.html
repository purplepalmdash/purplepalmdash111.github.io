
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="目的 最近在研究解耦OpenStack，以及OpenStack的各种网络模型，下面是一个最简单的用于搭建OpenStack Juno的过程。 硬件及网络准备 物理服务器 物理服务器: i5-4460/32G 内存，128G SSD+3T IDE，事实上这个教程跑完你也用不到这么强悍的配置， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/20">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//fonts.googleapis.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/24/san-jie-dian-da-jian-openstack-juno/">三节点搭建OpenStack Juno(1)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-24T14:36:34+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:36 pm</span></time>
        
         | <a href="/blog/2015/05/24/san-jie-dian-da-jian-openstack-juno/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>目的</h3>

<p>最近在研究解耦OpenStack，以及OpenStack的各种网络模型，下面是一个最简单的用于搭建OpenStack Juno的过程。</p>

<h3>硬件及网络准备</h3>

<h4>物理服务器</h4>

<p>物理服务器:  i5-4460/32G 内存，128G SSD+3T IDE，事实上这个教程跑完你也用不到这么强悍的配置，理论上在8G的物理机器上就可以运行完本文。  <br/>
物理服务器操作系统: Ubuntu14.04</p>

<h4>虚拟机：</h4>

<p>虚拟机1, Controller: 1 processor, 2 GB memory, and 5 GB storage.  <br/>
虚拟机2, Network: 1 processor, 512 MB memory, and 5 GB storage.  <br/>
虚拟机3, Compute: 1 processor, 2 GB memory, and 10 GB storage.</p>

<h4>网络规划</h4>

<p>Management: 10.55.55.0/24, 只用于管理的网络，公网无法访问。简单来说，这个网络用于OpenStack各个组件之间的相互通信。      <br/>
Tunnel: 10.66.66.0/24, 用于计算节点和网络节点之间的通信。这个隧道使得虚拟机的实例可以和相互通信。  <br/>
External: 192.168.1.0/24, 用于虚拟机实例的Internet访问。 <br/>
当然我们可以添加额外的存储网络，这里为了简单起见我们不使用cinder服务，使用单纯的虚拟机镜像即可。</p>

<h4>节点网络名规划</h4>

<p>Controller节点:    controller.openstack.local, 10.55.55.2(管理网络), N/A, N/A.  <br/>
Network节点:    Network.openstack.local, 10.55.55.3(管理网络), 10.66.66.3(隧道网络), 192.168.1.3(Internet公网).
Compute节点:    Compute.openstack.local, 10.55.55.4(管理网络), 10.66.66.4(隧道网络).</p>

<p>一个参考的例图如下:  <br/>
<img src="/images/2015_05_24_14_50_37_629x551.jpg" alt="/images/2015_05_24_14_50_37_629x551.jpg" /></p>

<p>按照上述的描述我们创建三台虚拟机，并进行初始化配置。</p>

<h3>虚拟机初始化配置</h3>

<p>下面罗列的代码是我在本机上的创建过程，仅供参考:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pwd
</span><span class='line'>/media/repo/Image/3NodeOpenStack
</span><span class='line'>$ qemu-img create -f qcow2 -b /media/repo/Image/UbuntuBase.qcow2 OpenStackController.qcow2
</span><span class='line'>Formatting 'OpenStackController.qcow2', fmt=qcow2 size=107374182400 backing_file='/media/repo/Image/UbuntuBase.qcow2' encryption=off cluster_size=65536 lazy_refcounts=off 
</span><span class='line'>$ qemu-img create -f qcow2 -b /media/repo/Image/UbuntuBase.qcow2 OpenStackNetwork.qcow2
</span><span class='line'>Formatting 'OpenStackNetwork.qcow2', fmt=qcow2 size=107374182400 backing_file='/media/repo/Image/UbuntuBase.qcow2' encryption=off cluster_size=65536 lazy_refcounts=off 
</span><span class='line'>$ qemu-img create -f qcow2 -b /media/repo/Image/UbuntuBase.qcow2 OpenStackCompute.qcow2
</span><span class='line'>Formatting 'OpenStackCompute.qcow2', fmt=qcow2 size=107374182400 backing_file='/media/repo/Image/UbuntuBase.qcow2' encryption=off cluster_size=65536 lazy_refcounts=off 
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>创建虚拟机的时候， OpenStackCompute节点需要把CPU的参数带下去，如下图所示:  <br/>
<img src="/images/2015_05_24_15_00_07_517x483.jpg" alt="/images/2015_05_24_15_00_07_517x483.jpg" /></p>

<p>各个节点的network定义文件如下:</p>

<p>控制节点:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># The loopback network interface
</span><span class='line'>auto lo
</span><span class='line'>iface lo inet loopback
</span><span class='line'>
</span><span class='line'># The primary network interface
</span><span class='line'>auto eth0
</span><span class='line'>iface eth0 inet static
</span><span class='line'>address 10.55.55.2
</span><span class='line'>netmask 255.255.255.0
</span><span class='line'>gateway 10.55.55.1
</span><span class='line'>dns-nameservers 114.114.114.114</span></code></pre></td></tr></table></div></figure>


<p>网络节点:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># The loopback network interface
</span><span class='line'>auto lo
</span><span class='line'>iface lo inet loopback
</span><span class='line'>
</span><span class='line'># The primary network interface
</span><span class='line'>auto eth0
</span><span class='line'>iface eth0 inet static
</span><span class='line'>address 10.55.55.3
</span><span class='line'>netmask 255.255.255.0
</span><span class='line'>gateway 10.55.55.1
</span><span class='line'>dns-nameservers 114.114.114.114
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>auto eth1
</span><span class='line'>iface eth1 inet static
</span><span class='line'>address 10.66.66.3
</span><span class='line'>netmask 255.255.255.0
</span><span class='line'>
</span><span class='line'>auto eth2
</span><span class='line'>iface eth2 inet static
</span><span class='line'>address 192.168.1.3
</span><span class='line'>netmask 255.255.255.0</span></code></pre></td></tr></table></div></figure>


<p>计算节点:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>auto lo
</span><span class='line'>iface lo inet loopback
</span><span class='line'>
</span><span class='line'># The primary network interface
</span><span class='line'>auto eth0
</span><span class='line'>iface eth0 inet static
</span><span class='line'>address 10.55.55.4
</span><span class='line'>netmask 255.255.255.0
</span><span class='line'>gateway 10.55.55.1
</span><span class='line'>dns-nameservers 114.114.114.114
</span><span class='line'>
</span><span class='line'>auto eth1
</span><span class='line'>iface eth1 inet static
</span><span class='line'>address 10.66.66.4
</span><span class='line'>netmask 255.255.255.0
</span></code></pre></td></tr></table></div></figure>


<p>每个节点分别更改其<code>/etc/hostname</code>为对应的名字，而每台机器上的<code>/etc/hosts</code>也做对应的修改，例如Controlle节点上的例子如下:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /etc/hosts
</span><span class='line'>127.0.0.1       localhost
</span><span class='line'>127.0.1.1       Controller
</span><span class='line'>10.55.55.2      Controller
</span><span class='line'>10.55.55.3      Network
</span><span class='line'>10.55.55.4      Compute
</span><span class='line'>......
</span><span class='line'>
</span><span class='line'>$ cat /etc/hostname
</span><span class='line'>Controller
</span></code></pre></td></tr></table></div></figure>


<p>网络配置完毕后，保证可以通过<code>ping Controller</code>等命令达到互通。</p>

<p>在进入到后续步骤前，更新所有节点到最新状态:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get update && sudo apt-get upgrade && sudo apt-get dist-upgrade && sudo reboot</span></code></pre></td></tr></table></div></figure>


<p></p>

<h3>NTP 服务器/客户端配置</h3>

<p>使用NTP来保证各个节点之间的时间同步，对后续加入的各个节点，同样需要使用NTP来同步该节点时间。我们将Controller作为NTP服务器,在Controller上，安装和配置NTP服务器：</p>

<h4>NTP服务器</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get -y install ntp
</span><span class='line'># vim /etc/ntp.conf
</span><span class='line'>    # 修改成大陆时间
</span><span class='line'>    server 2.cn.pool.ntp.org
</span><span class='line'>    server 1.asia.pool.ntp.org
</span><span class='line'>    server 2.asia.pool.ntp.org
</span><span class='line'>    # 修改 restrict 設定
</span><span class='line'>    restrict -4 default kod notrap nomodify
</span><span class='line'>    restrict -6 default kod notrap nomodify
</span><span class='line'># service ntp restart</span></code></pre></td></tr></table></div></figure>


<h4>NTP客户端</h4>

<p>其他的节点上都需要安装NTP客户端并使用NTP服务器时间同步。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get -y install ntp
</span><span class='line'># vim /etc/ntp.conf
</span><span class='line'>    # 設定 controller 為參照的 time server
</span><span class='line'>    # 並將其他 server 開頭的設定進行註解
</span><span class='line'>    server 10.55.55.2 iburst
</span><span class='line'># service ntp restart</span></code></pre></td></tr></table></div></figure>


<p>检查结果是否正确:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@JunoNetwork:~# ntpq -c peers
</span><span class='line'>     remote           refid      st t when poll reach   delay   offset  jitter
</span><span class='line'>==============================================================================
</span><span class='line'> Controller  59.106.180.168   3 u    1   64    1    0.239  447024.   0.049</span></code></pre></td></tr></table></div></figure>


<p>接下来真正进入OpenStack的安装和配置过程。</p>

<h3>源设定</h3>

<p>Juno的源没有被包含在Ubuntu14.04的官方源中(官方源中版本为IceHouse)，所以通过下列命令添加OpenStack Juno源:   <br/>
所有节点上(Controller,Network,Compute):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install ubuntu-cloud-keyring
</span><span class='line'>$ sudo bash
</span><span class='line'># echo "deb http://ubuntu-cloud.archive.canonical.com/ubuntu" "trusty-updates/juno main" &gt; /etc/apt/sources.list.d/cloudarchive-juno.list
</span><span class='line'># apt-get update && apt-get -y dist-upgrade</span></code></pre></td></tr></table></div></figure>


<p>第一部分就先到这里。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/23/use-apt-cacher-for-speeding-up-deployment/">Use Apt-cacher for Speeding Up Deployment</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-23T08:27:55+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>8:27 am</span></time>
        
         | <a href="/blog/2015/05/23/use-apt-cacher-for-speeding-up-deployment/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Installation</h3>

<p>Install apt-cacher via following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install apt-cacher</span></code></pre></td></tr></table></div></figure>


<p>Choose &ldquo;Daemon&rdquo; When you see following picture:</p>

<p><img src="/images/2015_05_23_08_28_39_418x264.jpg" alt="/images/2015_05_23_08_28_39_418x264.jpg" /></p>

<h3>Configuration</h3>

<p>Make sure the configuration <code>AUTOSTART=1</code> in <code>/etc/default/apt-cacher</code>.</p>

<p>Enable <code>allowed_hosts=*</code> in <code>/etc/apt-cacher/apt-cacher.conf</code>.</p>

<p>Now restart the machine, and check the apt-cacher service via following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ps -ef | grep apt
</span><span class='line'>www-data   825     1  0 20:34 ?        00:00:00 /usr/bin/perl /usr/sbin/apt-cacher -R 3 -d -p /var/run/apt-cacher.pid
</span><span class='line'>$ sudo netstat -anp | grep 3142
</span><span class='line'>tcp6       0      0 :::3142                 :::*                    LISTEN      825/perl</span></code></pre></td></tr></table></div></figure>


<p>Now when you setup the machines, point the http-proxy into this machine, it will automatically cache the packages.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/22/change-cobbler-profile-for-using-local-repository/">Change Cobbler Profile for Using Local Repository</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-22T14:12:58+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2015</span></span> <span class='time'>2:12 pm</span></time>
        
         | <a href="/blog/2015/05/22/change-cobbler-profile-for-using-local-repository/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Cobbler Profiles</h3>

<p>For getting the profiles and get the detailed information of the profile.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cobbler profile list
</span><span class='line'>   ubuntu1404-x86_64
</span><span class='line'># cobbler profile help
</span><span class='line'>usage
</span><span class='line'>=====
</span><span class='line'>cobbler profile add
</span><span class='line'>cobbler profile copy
</span><span class='line'>cobbler profile dumpvars
</span><span class='line'>cobbler profile edit
</span><span class='line'>cobbler profile find
</span><span class='line'>cobbler profile getks
</span><span class='line'>cobbler profile list
</span><span class='line'>cobbler profile remove
</span><span class='line'>cobbler profile rename
</span><span class='line'>cobbler profile report
</span><span class='line'># cobbler profile report ubuntu1404-x86_64
</span><span class='line'>......
</span><span class='line'>Kickstart                      : /var/lib/cobbler/kickstarts/sample.seed
</span><span class='line'>......
</span></code></pre></td></tr></table></div></figure>


<h3>Use Local Repository</h3>

<p>For adding the repository via following command, you could use your local repository:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo cobbler repo add --name=local-trusty --breed=apt --arch=x86_64 --mirror=http://xxxxxxxxxxxxxx/ubuntu --apt-components=main,restricted,universe,multiverse --apt-dists=trusty,trusty-updates,trusty-security
</span><span class='line'>$ sudo cobbler repo sync</span></code></pre></td></tr></table></div></figure>


<p>After syncing, the folder will contains all of the packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pwd
</span><span class='line'>/var/www/cobbler/ks_mirror/ubuntu1404-x86_64
</span><span class='line'># ls
</span><span class='line'>boot  dists  doc  EFI  install  isolinux  md5sum.txt  pics  pool  preseed  README.diskdefines  ubuntu</span></code></pre></td></tr></table></div></figure>


<p>Edit the sample seed via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cp /var/lib/cobbler/kickstarts/sample.seed /var/lib/cobbler/kickstarts/local.seed
</span><span class='line'># vim /var/lib/cobbler/kickstarts/local.seed
</span><span class='line'>
</span><span class='line'>    d-i mirror/http/hostname string $http_server
</span><span class='line'>    # d-i mirror/http/directory string $install_source_directory
</span><span class='line'>    d-i mirror/http/directory string /cobbler/ks_mirror/ubuntu1404-x86_64/ubuntu/
</span><span class='line'>    d-i mirror/http/proxy string 
</span><span class='line'>    d-i apt-setup/security_host string $http_server
</span><span class='line'>    d-i apt-setup/security_path string /cobbler/ks_mirror/Ubuntu-14.04-x86_64/ubuntu
</span><span class='line'>    d-i apt-setup/services-select multiselect none
</span></code></pre></td></tr></table></div></figure>


<p>Then Modify the profile&rsquo;s kickstart via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#  cobbler profile edit --name=ubuntu1404-x86_64 --kickstart=/var/lib/cobbler/kickstarts/local.seed</span></code></pre></td></tr></table></div></figure>


<p>After modification, next time if you re-install the compute, it will directly get the packages from the local repository.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/20/setup-centos6-slash-7-local-repository/">Setup CentOS6/7 Local Repository</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-20T11:32:56+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:32 am</span></time>
        
         | <a href="/blog/2015/05/20/setup-centos6-slash-7-local-repository/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For speeding up the deployment, I have to setup the local repository for CentOS6/7, following is the steps for setting up such two repositories.  <br/>
The steps are followed by following URL:  <br/>
<a href="https://support.opennodecloud.com/wiki/doku.php?id=usrdoc:os:repomirror">https://support.opennodecloud.com/wiki/doku.php?id=usrdoc:os:repomirror</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cd /etc/yum.repos.d/
</span><span class='line'># curl -O https://copr.fedoraproject.org/coprs/baurzhanm/mrepo/repo/epel-6/baurzhanm-mrepo-epel-6.repo
</span><span class='line'># vim baurzhanm-mrepo-epel-6.repo
</span><span class='line'># yum update
</span><span class='line'># yum -y install screen lftp httpd mrepo
</span><span class='line'># vim mrepo.conf
</span><span class='line'>    ### Configuration file for mrepo
</span><span class='line'>    
</span><span class='line'>    ### The [main] section allows to override mrepo's default settings
</span><span class='line'>    ### The mrepo-example.conf gives an overview of all the possible settings
</span><span class='line'>    [main]
</span><span class='line'>    srcdir = /var/mrepo
</span><span class='line'>    wwwdir = /var/www/mrepo
</span><span class='line'>    confdir = /etc/mrepo.conf.d
</span><span class='line'>    arch = x86_64
</span><span class='line'>    
</span><span class='line'>    mailto = root@localhost
</span><span class='line'>    smtp-server = localhost
</span><span class='line'>    
</span><span class='line'>    #rhnlogin = username:password
</span><span class='line'>    
</span><span class='line'>    ### Any other section is considered a definition for a distribution
</span><span class='line'>    ### You can put distribution sections in /etc/mrepo.conf.d/
</span><span class='line'>    ### Examples can be found in the documentation at:
</span><span class='line'>    ###     /usr/share/doc/mrepo-0.8.9/dists/.</span></code></pre></td></tr></table></div></figure>


<p>Add the configuration files for CentOS 6:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim  /etc/mrepo.conf.d/centos6.conf
</span><span class='line'>[centos6]
</span><span class='line'>name = CentOS $release ($arch)
</span><span class='line'>release = 6
</span><span class='line'>arch = x86_64
</span><span class='line'>metadata = yum repomd
</span><span class='line'>
</span><span class='line'>#iso = http://mirrors.aliyun.com/centos/$release/isos/$arch/CentOS-6.6-x86_64-bin-DVD?.iso
</span><span class='line'>#os = http://mirrors.aliyun.com/centos/$release/os/$arch/Packages/ 
</span><span class='line'>#updates = http://mirrors.aliyun.com/centos/$release/updates/$arch/Packages/
</span><span class='line'>extras = http://mirrors.aliyun.com/centos/$release/extras/$arch/Packages/
</span><span class='line'>epel = http://mirrors.aliyun.com/epel/$release/$arch/</span></code></pre></td></tr></table></div></figure>


<p>Add configuraiton files for CentOS 7:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim  /etc/mrepo.conf.d/centos7.conf
</span><span class='line'>[centos7]
</span><span class='line'>name = CentOS $release ($arch)
</span><span class='line'>release = 7
</span><span class='line'>arch = x86_64
</span><span class='line'>metadata = yum repomd
</span><span class='line'>
</span><span class='line'>#iso = http://mirrors.aliyun.com/centos/$release/isos/$arch/CentOS-7.0-1406-x86_64-DVD.iso
</span><span class='line'>#os = http://mirrors.aliyun.com/centos/$release/os/$arch/Packages/ 
</span><span class='line'>#updates = http://mirrors.aliyun.com/centos/$release/updates/$arch/Packages/
</span><span class='line'>#epel = http://mirrors.aliyun.com/epel/$release/$arch/
</span><span class='line'>extra=http://mirrors.aliyun.com/centos/$release/extras/$arch/Packages/</span></code></pre></td></tr></table></div></figure>


<p>Use following comands for initial sync, it will take a very~long~long~long time.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mrepo -g -u -vvv [centos6|centos7]</span></code></pre></td></tr></table></div></figure>


<p>After syncing, add definition into the apache&rsquo;s configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vi /etc/httpd/conf.d/mrepo.conf
</span><span class='line'>--- ADD ---
</span><span class='line'>AddDescription "CentOS 6 for x86" centos6-i386
</span><span class='line'>AddDescription "CentOS 6 for x86_64" centos6-x86_64
</span><span class='line'>AddDescription "CentOS 7 for x86" centos7-i386
</span><span class='line'>AddDescription "CentOS 7 for x86_64" centos7-x86_64
</span><span class='line'>--- ADD ---
</span><span class='line'># Add repofile for CentOS 6 mirror
</span><span class='line'>cat &lt;&lt; 'EOF' &gt; /var/www/mrepo/centos6-x86_64/CentOS-local-http.repo 
</span><span class='line'>#
</span><span class='line'># CentOS-local-http.repo
</span><span class='line'>#
</span><span class='line'> 
</span><span class='line'>[0-base]
</span><span class='line'>name=CentOS-local-base
</span><span class='line'>baseurl=http://mirror.local.int/mrepo/centos6-x86_64/RPMS.os/
</span><span class='line'>gpgcheck=0
</span><span class='line'> 
</span><span class='line'>[0-updates]
</span><span class='line'>name=CentOS-local-updates
</span><span class='line'>baseurl=http://mirror.local.int/mrepo/centos6-x86_64/RPMS.updates/
</span><span class='line'>gpgcheck=0
</span><span class='line'>EOF
</span><span class='line'> 
</span><span class='line'># Add repofile for CentOS 7 mirror
</span><span class='line'>cat &lt;&lt; 'EOF' &gt; /var/www/mrepo/centos7-x86_64/CentOS-local-http.repo 
</span><span class='line'>#
</span><span class='line'># CentOS-local-http.repo
</span><span class='line'>#
</span><span class='line'> 
</span><span class='line'>[0-base]
</span><span class='line'>name=CentOS-local-base
</span><span class='line'>baseurl=http://mirror.local.int/mrepo/centos7-x86_64/RPMS.os/
</span><span class='line'>gpgcheck=0
</span><span class='line'> 
</span><span class='line'>[0-updates]
</span><span class='line'>name=CentOS-local-updates
</span><span class='line'>baseurl=http://mirror.local.int/mrepo/centos7-x86_64/RPMS.updates/
</span><span class='line'>gpgcheck=0
</span><span class='line'>EOF
</span><span class='line'> 
</span><span class='line'># chkconfig httpd on
</span><span class='line'># service httpd restart
</span></code></pre></td></tr></table></div></figure>


<h3>mrepo for CentOS6.5</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root:/home/juju/mrepo]# cat /etc/mrepo.conf.d/centos6.5.conf  
</span><span class='line'>### URL: http://www.centos.org/
</span><span class='line'> 
</span><span class='line'>[centos6.5]
</span><span class='line'>name = CentOS $release ($arch)
</span><span class='line'>release = 6.5
</span><span class='line'>arch = x86_64
</span><span class='line'>metadata = yum repomd
</span><span class='line'>
</span><span class='line'>os=http://vault.centos.org/$release/os/$arch/Packages/
</span><span class='line'>updates=http://vault.centos.org/$release/updates/$arch/Packages/
</span><span class='line'>extras=http://vault.centos.org/$release/extras/$arch/Packages/
</span><span class='line'>centosplus=http://vault.centos.org/$release/centosplus/$arch/Packages/
</span><span class='line'>fasttrack=http://vault.centos.org/$release/fasttrack/$arch/Packages/</span></code></pre></td></tr></table></div></figure>


<p>sync the repository via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mrepo -g -u -vvv centos6.5</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/19/setup-local-repository/">Setup Local Repository</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-19T11:57:19+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:57 am</span></time>
        
         | <a href="/blog/2015/05/19/setup-local-repository/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Ubuntu</h3>

<p>After using apt-mirror syncing all of the packages from the repository website, setup a ftp site:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get install -y proftpd
</span><span class='line'># cat conf.d/anonymous.conf 
</span><span class='line'>&lt;Anonymous ~ftp&gt;
</span><span class='line'>   User                    ftp
</span><span class='line'>   Group                nogroup
</span><span class='line'>   UserAlias         anonymous ftp
</span><span class='line'>   RequireValidShell        off
</span><span class='line'>#   MaxClients                   10
</span><span class='line'>   &lt;Directory *&gt;
</span><span class='line'>     &lt;Limit WRITE&gt;
</span><span class='line'>       DenyAll
</span><span class='line'>     &lt;/Limit&gt;
</span><span class='line'>   &lt;/Directory&gt;
</span><span class='line'> &lt;/Anonymous&gt;
</span><span class='line'>#  mount --bind /mnt/myrepo/mirror/mirrors.aliyun.com/ /srv/ftp/
</span><span class='line'># service proftpd restart</span></code></pre></td></tr></table></div></figure>


<p>Now Open your browser to <code>ftp://Your_URL/</code>, you will find the repository available.</p>

<h3>CentOS Proftpd</h3>

<p>Just remember the default directory is located at <code>/var/ftp</code>,</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># yum install -y proftpd
</span><span class='line'># mount --bind /mirror/mirrors.aliyun.com/ /var/ftp/
</span><span class='line'># service proftpd restart</span></code></pre></td></tr></table></div></figure>


<h3>Client Configuration</h3>

<p>Replace the URL into your ftp url:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim /etc/apt/sources.list
</span><span class='line'>deb ftp://YourURL/ubuntu/ trusty main restricted universe multiverse
</span><span class='line'>deb ftp://YourURL/ubuntu/ trusty-security main restricted universe multiverse
</span><span class='line'>deb ftp://YourURL/ubuntu/ trusty-updates main restricted universe multiverse
</span><span class='line'>deb ftp://YourURL/ubuntu/ trusty-proposed main restricted universe multiverse
</span><span class='line'>deb ftp://YourURL/ubuntu/ trusty-backports main restricted universe multiverse
</span><span class='line'>deb-src ftp://YourURL/ubuntu/ trusty main restricted universe multiverse
</span><span class='line'>deb-src ftp://YourURL/ubuntu/ trusty-security main restricted universe multiverse
</span><span class='line'>deb-src ftp://YourURL/ubuntu/ trusty-updates main restricted universe multiverse
</span><span class='line'>deb-src ftp://YourURL/ubuntu/ trusty-proposed main restricted universe multiverse
</span><span class='line'>deb-src ftp://YourURL/ubuntu/ trusty-backports main restricted universe multiverse
</span><span class='line'># apt-get update && apt-get upgrade </span></code></pre></td></tr></table></div></figure>


<p>Using local repository will greately improve your development speed.</p>

<h3>Use apache way(On CentOS6.6)</h3>

<p>By using the symlinks and enable the httpd to start automatically at systemboot.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root:/var/www]# cd html/
</span><span class='line'>[root:/var/www/html]# ln /home/juju/myrepo/mirror/mirrors.aliyun.com/ubuntu -s
</span><span class='line'>[root:/var/www/html]# chkconfig httpd on</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/18/my-configuration-on-cobbler-for-deploying-ubuntu12-dot-04/">My Configuration on Cobbler for Deploying Ubuntu12.04</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-18T18:15:47+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>6:15 pm</span></time>
        
         | <a href="/blog/2015/05/18/my-configuration-on-cobbler-for-deploying-ubuntu12-dot-04/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Configuration file for preseed, put it under: /var/lib/cobbler/kickstarts/autoinstall.seed:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># BASIC
</span><span class='line'>d-i  debian-installer/locale    string en_US.UTF-8
</span><span class='line'>d-i  debian-installer/splash    boolean false
</span><span class='line'>d-i  console-setup/ask_detect   boolean false
</span><span class='line'>d-i  console-setup/layoutcode   string us
</span><span class='line'>d-i  console-setup/variantcode  string
</span><span class='line'>d-i  clock-setup/utc            boolean true
</span><span class='line'>d-i  clock-setup/ntp            boolean true
</span><span class='line'>
</span><span class='line'># DISKPART
</span><span class='line'>d-i  partman-auto/method                string regular
</span><span class='line'>d-i  partman-lvm/device_remove_lvm      boolean true
</span><span class='line'>d-i  partman-lvm/confirm                boolean true
</span><span class='line'>d-i  partman/confirm_write_new_label    boolean true
</span><span class='line'>d-i  partman/choose_partition           select Finish partitioning and write changes to disk
</span><span class='line'>d-i  partman/confirm                    boolean true
</span><span class='line'>d-i  partman/confirm_nooverwrite        boolean true
</span><span class='line'>d-i  partman/default_filesystem         string ext3
</span><span class='line'>
</span><span class='line'># SOFTWARE
</span><span class='line'># /var/www/cobbler/ks_mirror/Ubuntu12.04-x86_64/ubuntu/
</span><span class='line'>d-i  mirror/country             string manual
</span><span class='line'>d-i  mirror/http/hostname       string $http_server
</span><span class='line'>d-i  mirror/http/directory      string /cobbler/ks_mirror/Ubuntu12.04-x86_64/ubuntu
</span><span class='line'>d-i  mirror/http/proxy          string
</span><span class='line'>d-i  apt-setup/security_host    string $http_server
</span><span class='line'>d-i  apt-setup/security_path    string /cobbler/ks_mirror/Ubuntu12.04-x86_64/ubuntu
</span><span class='line'>d-i  apt-setup/services-select  multiselect none
</span><span class='line'>d-i  pkgsel/upgrade             select none
</span><span class='line'>d-i  pkgsel/language-packs      multiselect
</span><span class='line'>d-i  pkgsel/update-policy       select none
</span><span class='line'>d-i  pkgsel/updatedb            boolean true
</span><span class='line'>d-i  pkgsel/include             string openssh-server
</span><span class='line'>
</span><span class='line'># USER
</span><span class='line'>d-i  passwd/root-login                  boolean true
</span><span class='line'>d-i  passwd/make-user                   boolean false
</span><span class='line'>d-i  passwd/root-password               password root
</span><span class='line'>d-i  passwd/root-password-again         password root
</span><span class='line'>d-i  user-setup/allow-password-weak     boolean true
</span><span class='line'>
</span><span class='line'># FINISH
</span><span class='line'>d-i  grub-installer/skip                boolean false
</span><span class='line'>d-i  lilo-installer/skip                boolean false
</span><span class='line'>d-i  grub-installer/only_debian         boolean true
</span><span class='line'>d-i  grub-installer/with_other_os       boolean true
</span><span class='line'>d-i  finish-install/keep-consoles       boolean false
</span><span class='line'>d-i  finish-install/reboot_in_progress  note
</span><span class='line'>d-i  cdrom-detect/eject                 boolean true
</span><span class='line'>d-i  debian-installer/exit/halt         boolean false
</span><span class='line'>d-i  debian-installer/exit/poweroff     boolean false
</span><span class='line'>
</span><span class='line'># EXTRA
</span><span class='line'>d-i  preseed/late_command       string echo "UseDNS no" &gt;&gt; /target/etc/ssh/sshd_config
</span></code></pre></td></tr></table></div></figure>


<p>Edit the profile via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cobbler profile list
</span><span class='line'>$ cobbler profile edit --name=Ubuntu12.04-x86_64 --kickstart=/var/lib/cobbler/kickstarts/autoinstall.seed </span></code></pre></td></tr></table></div></figure>


<p>Now select the installation, your installation will use local repository.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/16/re-orgnize-blog/">Re-Orgnize Blog</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-16T10:53:00+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:53 am</span></time>
        
         | <a href="/blog/2015/05/16/re-orgnize-blog/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since my last blog touched something special, I have to delete the whole repository and re-orgnize the structure again. This time I also use Octopress, but the version has been upgraded to the 3.0, this article records the steps.</p>

<h3>Github Account</h3>

<p>Register a new account, and verrify the email, add your own ssh key, test it via ssh -T <a href="&#x6d;&#97;&#x69;&#108;&#116;&#111;&#x3a;&#103;&#x69;&#x74;&#64;&#x67;&#x69;&#116;&#x68;&#x75;&#x62;&#x2e;&#99;&#x6f;&#109;">&#103;&#x69;&#x74;&#64;&#103;&#x69;&#116;&#x68;&#x75;&#98;&#46;&#99;&#x6f;&#109;</a></p>

<h3>Repository</h3>

<p>Get the latest repository via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/imathis/octopress.git
</span></code></pre></td></tr></table></div></figure>


<p>Configuration of the konsole, enable the <code>zsh -l</code> at the login shell.   Settings-> Edit Current Profile-> General -> Command(/bin/zsh -l)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rvm use 1.9.3
</span><span class='line'>$ ruby --version
</span><span class='line'>ruby 1.9.3p547 (2014-05-14 revision 45962) [x86_64-linux]
</span><span class='line'>$ gem install bundler
</span><span class='line'>$ vim Gemfile
</span><span class='line'>#source "https://rubygems.org"
</span><span class='line'>source "http://mirrors.aliyun.com/rubygems/"
</span><span class='line'>$ bundle install
</span><span class='line'>$ rake install
</span></code></pre></td></tr></table></div></figure>


<p>Now the basic configuration of the repository has been added.</p>

<h3>Plugins</h3>

<p>For adding videos:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/manojlds/octopress-plugins.git
</span><span class='line'>$ cd octopress
</span><span class='line'>$ cd plugins
</span><span class='line'>$ cp ../../octopress-plugins/youtube.rb ./
</span></code></pre></td></tr></table></div></figure>


<h3>Encryption</h3>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/14/setup-a-more-intelligent-openwrt-router/">Setup a More Intelligent OpenWRT Router</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-14T21:01:00+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:01 pm</span></time>
        
         | <a href="/blog/2015/05/14/setup-a-more-intelligent-openwrt-router/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Openssh-Server</h3>

<p>The default sshd is provided by dropbear, the functionality is not good, so I have to replace it with openssh-server.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@OpenWrt:~# uci set dropbear.@dropbear[0].Port=2222
</span><span class='line'>root@OpenWrt:~# uci commit dropbear
</span><span class='line'>root@OpenWrt:~# /etc/init.d/dropbear restart
</span><span class='line'>root@OpenWrt:~# opkg install openssh-server
</span><span class='line'>root@OpenWrt:~# opkg install openssh-client
</span></code></pre></td></tr></table></div></figure>


<p>Configure the OpenSSH:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># /etc/init.d/sshd enable
</span><span class='line'># /etc/init.d/sshd start
</span><span class='line'># /etc/init.d/dropbear disable
</span><span class='line'># /etc/init.d/dropbear stop
</span></code></pre></td></tr></table></div></figure>


<p>The next time you login will ask you for changing your password, do it and continue for using ssh.</p>

<h3>ShadowSocks and DNS</h3>

<p>For ShadowSocks you could refer to my previous blogs. <br/>
DNS Server is for automatically analyze the dns in server, install it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo yum install dnsmasq
</span></code></pre></td></tr></table></div></figure>


<p>Configure it to another port rather than the default 53.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>redsocks 翻墙
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/14/setup-the-cobbler-server/">Setup the Cobbler Server</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-14T09:38:00+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:38 am</span></time>
        
         | <a href="/blog/2015/05/14/setup-the-cobbler-server/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The reference material is mainly from:  <br/>
<a href="http://www.cobblerd.org/manuals/quickstart/">http://www.cobblerd.org/manuals/quickstart/</a></p>

<h3>Prepartion</h3>

<p>First install the CentOS6.6, choose the basic server. <br/>
After installation, update to the latest system via <code>yum -y update</code>. <br/>
Disable the SELinux via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim /etc/selinux/config
</span><span class='line'>#SELINUX=enforcing                                                                                                                       │
</span><span class='line'>SELINUX=disabled 
</span></code></pre></td></tr></table></div></figure>


<p>Then restart the compute.  <br/>
Add epel repository:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-6.repo
</span><span class='line'># yum update
</span><span class='line'># yum install -y cobbler cobbler-web
</span></code></pre></td></tr></table></div></figure>


<h3>Configuration</h3>

<p>Change the default password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># openssl passwd -1                                                                                                     │
</span><span class='line'>Password:                                                                                                                                 │
</span><span class='line'>Verifying - Password:                                                                                                                     │
</span><span class='line'>igaowugoauwgoueougo
</span><span class='line'>[root@CobblerServer ~]# vim /etc/cobbler/settings          
</span><span class='line'>default_password_crypted: "agowuoguwoawoguwoe"
</span></code></pre></td></tr></table></div></figure>


<p>Set the Server and Next_Server to the specified IP Address, DO NOT use 0.0.0.0:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># default, localhost
</span><span class='line'>server: 10.3.3.3.
</span><span class='line'>
</span><span class='line'># default, localhost
</span><span class='line'>next_server: 10.3.3.3
</span></code></pre></td></tr></table></div></figure>


<p>Enable the dhcp managed:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>manage_dhcp: 0
</span></code></pre></td></tr></table></div></figure>


<p>Edit the dhcp template via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vi /etc/cobbler/dhcp.template
</span><span class='line'>subnet 10.3.3.0 netmask 255.255.255.0 {
</span><span class='line'>     option routers             10.3.3.1;                                                                                                  
</span><span class='line'>     range dynamic-bootp        10.3.3.4 10.3.3.254;
</span><span class='line'>     option domain-name-servers 114.114.114.114, 8.8.8.8;     
</span><span class='line'>     option subnet-mask         255.255.255.0;         
</span><span class='line'>     filename                   "/pxelinux.0";       
</span><span class='line'>     default-lease-time         21600;           
</span><span class='line'>     max-lease-time             43200;      
</span><span class='line'>     next-server                $next_server; 
</span><span class='line'>}          
</span></code></pre></td></tr></table></div></figure>


<p>Start and check the service status:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@CobblerServer ~]# service cobblerd start                                                                                           
</span><span class='line'>Starting cobbler daemon:                                   [  OK  ]
</span><span class='line'>[root@CobblerServer ~]# chkconfig cobblerd on                     
</span><span class='line'>[root@CobblerServer ~]# chkconfig httpd on                     
</span><span class='line'>[root@CobblerServer ~]# service cobblerd status                  
</span><span class='line'>cobblerd (pid 1564) is running...     
</span></code></pre></td></tr></table></div></figure>


<p>Better you restart the machine and verify your installation via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@CobblerServer ~]# cobbler check
</span><span class='line'>The following are potential configuration items that you may want to fix:
</span><span class='line'>
</span><span class='line'>1 : dhcpd is not installed
</span><span class='line'>2 : some network boot-loaders are missing from /var/lib/cobbler/loaders, you may run 'cobbler get-loaders' to download them, or, if you only want to handle x86/x86_64 netbooting, you may ensure that you have installed a *recent* version of the syslinux package installed and can ignore this message entirely.  Files in this directory, should you want to support all architectures, should include pxelinux.0, menu.c32, elilo.efi, and yaboot. The 'cobbler get-loaders' command is the easiest way to resolve these requirements.
</span><span class='line'>3 : change 'disable' to 'no' in /etc/xinetd.d/rsync
</span><span class='line'>4 : since iptables may be running, ensure 69, 80/443, and 25151 are unblocked
</span><span class='line'>5 : debmirror package is not installed, it will be required to manage debian deployments and repositories
</span><span class='line'>6 : ksvalidator was not found, install pykickstart
</span><span class='line'>7 : fencing tools were not found, and are required to use the (optional) power management features. install cman or fence-agents to use them
</span></code></pre></td></tr></table></div></figure>


<p>OOOOPs, so many errors, so first install dhcpd:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># yum install -y dhcpd
</span><span class='line'># chkconfig dhcpd on
</span><span class='line'># chkconfig xinetd on
</span></code></pre></td></tr></table></div></figure>


<p>Manullly edit the dhcpd configuration file as in following files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@CobblerServer ~]# cat /etc/dhcp/dhcpd.conf 
</span><span class='line'>#
</span><span class='line'># DHCP Server Configuration file.
</span><span class='line'>#   see /usr/share/doc/dhcp*/dhcpd.conf.sample
</span><span class='line'>#   see 'man 5 dhcpd.conf'
</span><span class='line'>#
</span><span class='line'># create new
</span><span class='line'># specify domain name
</span><span class='line'>option domain-name "server.world";
</span><span class='line'># specify name server's hostname or IP address
</span><span class='line'>option domain-name-servers 114.114.114.114;
</span><span class='line'># default lease time
</span><span class='line'>default-lease-time 600;
</span><span class='line'># max lease time
</span><span class='line'>max-lease-time 7200;
</span><span class='line'># this DHCP server to be declared valid
</span><span class='line'>authoritative;
</span><span class='line'># specify network address and subnet mask
</span><span class='line'>subnet 10.3.3.0 netmask 255.255.255.0 {
</span><span class='line'>    # specify the range of lease IP address
</span><span class='line'>    range dynamic-bootp 10.3.3.4 10.3.3.254;
</span><span class='line'>    # specify broadcast address
</span><span class='line'>    option broadcast-address 10.3.3.255;
</span><span class='line'>    # specify default gateway
</span><span class='line'>    option routers 10.3.3.1;
</span><span class='line'>}
</span><span class='line'># service dhcpd restart
</span></code></pre></td></tr></table></div></figure>


<p>One trouble after another, solve them:  <br/>
Get Loaders:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@CobblerServer ~]# cobbler get-loaders
</span></code></pre></td></tr></table></div></figure>


<p>Enable the rsync configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  # vim /etc/xinetd.d/rsync 
</span><span class='line'>        disable = no
</span></code></pre></td></tr></table></div></figure>


<p>Add the following lines into the /etc/sysconfig/iptables:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>:OUTPUT ACCEPT [0:0]
</span><span class='line'>-A INPUT -p udp -m multiport --dports 69,80,443,25151 -j ACCEPT 
</span><span class='line'>-A INPUT -p tcp -m multiport --dports 69,80,443,25151 -j ACCEPT 
</span><span class='line'>-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
</span></code></pre></td></tr></table></div></figure>


<p>Or:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># iptables -I INPUT -p udp -m multiport --dports 69,80,443,25151 -j ACCEPT
</span><span class='line'># iptables -I INPUT -p tcp -m multiport --dports 69,80,443,25151 -j ACCEPT
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>The difference is the latter won&rsquo;t last for long once the machine got restarted.</p>

<p>Install following packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@CobblerServer ~]# yum install -y debmirror pykickstart cman
</span></code></pre></td></tr></table></div></figure>


<p>Now check again:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cobbler check
</span><span class='line'>$ cobbler sync
</span></code></pre></td></tr></table></div></figure>


<h3>Import ISO</h3>

<p>I use the CentOS7 iso(CentOS-7-x86_64-Everything-1503-01.iso).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@CobblerServer ~]# mount -o loop -t iso9660 ./CentOS-7-x86_64-Everything-1503-01.iso  /mnt
</span><span class='line'>[root@CobblerServer ~]# cobbler import --name=CentOS-7 --arch=x86_64 --path=/mnt
</span><span class='line'>path=/mnt
</span><span class='line'>task started: 2015-05-14_035209_import
</span><span class='line'>task started (id=Media import, time=Thu May 14 03:52:09 2015)
</span><span class='line'>Found a candidate signature: breed=redhat, version=rhel6
</span><span class='line'>Found a candidate signature: breed=redhat, version=rhel7
</span><span class='line'>Found a matching signature: breed=redhat, version=rhel7
</span><span class='line'>Adding distros from path /var/www/cobbler/ks_mirror/CentOS-7-x86_64:
</span><span class='line'>creating new distro: CentOS-7-x86_64
</span><span class='line'>trying symlink: /var/www/cobbler/ks_mirror/CentOS-7-x86_64 -&gt; /var/www/cobbler/links/CentOS-7-x86_64
</span><span class='line'>creating new profile: CentOS-7-x86_64
</span><span class='line'>associating repos
</span><span class='line'>checking for rsync repo(s)
</span><span class='line'>checking for rhn repo(s)
</span><span class='line'>checking for yum repo(s)
</span><span class='line'>starting descent into /var/www/cobbler/ks_mirror/CentOS-7-x86_64 for CentOS-7-x86_64
</span><span class='line'>processing repo at : /var/www/cobbler/ks_mirror/CentOS-7-x86_64
</span><span class='line'>need to process repo/comps: /var/www/cobbler/ks_mirror/CentOS-7-x86_64
</span><span class='line'>looking for /var/www/cobbler/ks_mirror/CentOS-7-x86_64/repodata/*comps*.xml
</span><span class='line'>Keeping repodata as-is :/var/www/cobbler/ks_mirror/CentOS-7-x86_64/repodata
</span><span class='line'>*** TASK COMPLETE ***
</span></code></pre></td></tr></table></div></figure>


<p>Check it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@CobblerServer ~]# cobbler distro list
</span><span class='line'>   CentOS-7-x86_64
</span><span class='line'>[root@CobblerServer ~]# cobbler profile list
</span><span class='line'>   CentOS-7-x86_64
</span><span class='line'>[root@CobblerServer ~]# cobbler distro report --name=CentOS-7-x86_64
</span><span class='line'>Name                           : CentOS-7-x86_64
</span><span class='line'>Architecture                   : x86_64
</span><span class='line'>TFTP Boot Files                : {}
</span><span class='line'>Breed                          : redhat
</span><span class='line'>Comment                        : 
</span><span class='line'>Fetchable Files                : {}
</span><span class='line'>Initrd                         : /var/www/cobbler/ks_mirror/CentOS-7-x86_64/images/pxeboot/initrd.img
</span><span class='line'>Kernel                         : /var/www/cobbler/ks_mirror/CentOS-7-x86_64/images/pxeboot/vmlinuz
</span><span class='line'>Kernel Options                 : {}
</span><span class='line'>Kernel Options (Post Install)  : {}
</span><span class='line'>Kickstart Metadata             : {'tree': 'http://@@http_server@@/cblr/links/CentOS-7-x86_64'}
</span><span class='line'>Management Classes             : []
</span><span class='line'>OS Version                     : rhel7
</span><span class='line'>Owners                         : ['admin']
</span><span class='line'>Red Hat Management Key         : &lt;&lt;inherit&gt;&gt;
</span><span class='line'>Red Hat Management Server      : &lt;&lt;inherit&gt;&gt;
</span><span class='line'>Template Files                 : {}
</span></code></pre></td></tr></table></div></figure>


<h3>Installation</h3>

<p>Install the system, via setup a machine which boot from PXE in the same subnet, then this machine will hint you with installing the corresponding system. <br/>
The new system&rsquo;s username/password is the same as we set in the cobbler configuration file.</p>

<h3>Enable Web Interface</h3>

<p>Change the default password via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cp /etc/cobbler/users.digest /etc/cobbler/users.digest.back
</span><span class='line'>$ htdigest /etc/cobbler/users.digest "Cobbler" cobbler
</span></code></pre></td></tr></table></div></figure>


<p>Now restart the cobblerd, you could visit following URL for visiting the Web Inteface:  <br/>
<a href="http://10.3.3.3/cobbler_web">http://10.3.3.3/cobbler_web</a></p>

<h3>Import Multiple ISOs</h3>

<p>Import the first iso as usual.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mount -o loop -t iso9660 ./CentOS-6.6-x86_64-bin-DVD1.iso  /mnt
</span><span class='line'># cobbler import --name=CentOS-6.6 --arch=x86_64 --path=/mnt
</span></code></pre></td></tr></table></div></figure>


<p>The Second iso first mount to /mnt1/ directory, then import with following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#  rsync -a '/mnt1/' /var/www/cobbler/ks_mirror/CentOS-6.6-x86_64/ --exclude-from=/etc/cobbler/rsync.exclude --progress
</span><span class='line'>#  COMPSXML=$(ls /var/www/cobbler/ks_mirror/CentOS-6.6-x86_64/repodata/*comps*.xml)
</span><span class='line'>#  createrepo -c cache -s sha --update --groupfile ${COMPSXML} /var/www/cobbler/ks_mirror/CentOS-6.6-x86_64
</span></code></pre></td></tr></table></div></figure>


<p>Verify it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cobbler distro list
</span><span class='line'># cobbler profile list
</span><span class='line'># cobbler distro report --name=CentOS-6.6-x86_64
</span></code></pre></td></tr></table></div></figure>


<p>Verify it via installing a new machine running CentOS6.6.</p>

<h3>Trouble-Shooting on fence</h3>

<p>Lacking of fence equipment.</p>

<p>Trouble shooting for controlling the Systems(which is the node information which added into cobbler system).   <br/>
For Power Management:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@CobblerServer ~]# cobbler system poweroff --name Node1
</span><span class='line'>task started: 2015-05-14_064600_power
</span><span class='line'>task started (id=Power management (off), time=Thu May 14 06:46:00 2015)
</span><span class='line'>cobbler power configuration is:
</span><span class='line'>      type   : virsh
</span><span class='line'>      address: qemu+ssh://root@10.3.3.1/system
</span><span class='line'>      user   : root
</span><span class='line'>      id     : CobblerTest
</span><span class='line'>running: /usr/sbin/fence_virsh
</span><span class='line'>received on stdout: 
</span><span class='line'>received on stderr: Unable to connect/login to fencing device
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/11/tips-for-setting-up-centos-local-repository/">Tips for Setting Up CentOS Local Repository</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-11T20:48:00+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:48 pm</span></time>
        
         | <a href="/blog/2015/05/11/tips-for-setting-up-centos-local-repository/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The material is learned from:   <br/>
<a href="http://paulcodr.co/blog/2015/yumrepo-server-local/">http://paulcodr.co/blog/2015/yumrepo-server-local/</a></p>

<h3>Steps</h3>

<p>Local ISO Preparation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost ~]# mkdir isos bin
</span><span class='line'>[root@localhost ~]# ls isos
</span><span class='line'>CentOS-6.6-x86_64-bin-DVD1.iso  CentOS-6.6-x86_64-bin-DVD2.iso
</span></code></pre></td></tr></table></div></figure>


<p>Download the scripts:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cd bin
</span><span class='line'># wget http://paulcodr.co/download/yum-scripts.zip
</span><span class='line'># unzip yum-scripts.zip 
</span><span class='line'>Archive:  yum-scripts.zip
</span><span class='line'>   creating: yum-scripts/
</span><span class='line'>  inflating: yum-scripts/yum-create-server-centos6.6.sh  
</span><span class='line'>  inflating: yum-scripts/yum-rsync-minimal-centos6.6.sh  
</span></code></pre></td></tr></table></div></figure>


<p>Change the priviledges:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost bin]# chown -R root:root /root/isos
</span><span class='line'>[root@localhost bin]# chmod 750 -R /root/bin
</span></code></pre></td></tr></table></div></figure>


<p>Execute the script:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost bin]# mv yum-scripts/* ./
</span><span class='line'>[root@localhost bin]# ls
</span><span class='line'>yum-create-server-centos6.6.sh  yum-rsync-minimal-centos6.6.sh  yum-scripts  yum-scripts.zip
</span><span class='line'>[root@localhost bin]# ./yum-create-server-centos6.6.sh 2&gt;&1 | tee createserver.log
</span></code></pre></td></tr></table></div></figure>


<p>Verify it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost bin]#  du -hs /data/www/yumrpms/centos6.6/6.6/os/x86_64
</span><span class='line'>5.6G    /data/www/yumrpms/centos6.6/6.6/os/x86_64
</span><span class='line'>[root@localhost bin]#  ls -lh /data/www/yumrpms/centos6.6/
</span><span class='line'>total 4.0K
</span><span class='line'>lrwxrwxrwx 1 apache apache    3 May 11 12:49 6 -&gt; 6.6
</span><span class='line'>drwxr-xr-x 3 apache apache 4.0K May 11 12:47 6.6
</span></code></pre></td></tr></table></div></figure>


<p>Verify it on another PC:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root:/home/juju/iso]# curl http://10.7.7.124/yumrpms/centos6.6/6/os/x86_64/
</span><span class='line'>.....
</span><span class='line'>&lt;/table&gt;
</span><span class='line'>&lt;address&gt;Apache/2.2.15 (CentOS) Server at 10.7.7.124 Port 80&lt;/address&gt;
</span><span class='line'>&lt;/body&gt;&lt;/html&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Change the rsync repository in yum-rsync-minimal-cent6.6.sh:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rsync://mirrors.yun-idc.com/centos/
</span></code></pre></td></tr></table></div></figure>


<p>Then:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost bin]# ./yum-rsync-minimal-centos6.6.sh 2&gt;&1 | tee syncserver.log
</span></code></pre></td></tr></table></div></figure>


<p>Wait for rsync&hellip;&hellip;</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/21">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/19">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/06/07/rackhd-worktips/">RackHD Worktips</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/06/01/use-rakehd-for-deploying-systems/">Use RackHD for Deploying Systems</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/31/bu-tong-zhuo-mian-huan-jing-zhan-yong-nei-cun-slash-cpudui-bi/">不同桌面环境占用内存/CPU对比</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/29/yang-cheng-man-bu-er/">羊城漫步(二)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/28/yang-cheng-man-bu-yi/">羊城漫步(一)</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>









<div style="display:none">
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=2101056" charset="utf-8"></script>
</div>





</body>
</html>
