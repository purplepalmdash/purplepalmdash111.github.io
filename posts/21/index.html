
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="Since I enabled OpenSuse, later all of the docker related operation could be operated on OpenSuse13.2. Installation Install docker via: 1
2
3
$ sudo &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/21">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//fonts.googleapis.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/07/play-docker-5/">Play Docker(5)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-07T04:22:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>4:22 am</span></time>
        
         | <a href="/blog/2015/02/07/play-docker-5/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since I enabled OpenSuse, later all of the docker related operation could be operated on OpenSuse13.2.</p>

<h3>Installation</h3>

<p>Install docker via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo zypper in docker
</span><span class='line'>$ which docker
</span><span class='line'>/usr/bin/docker
</span></code></pre></td></tr></table></div></figure>


<h3>Specify Storage Location</h3>

<p>The /var directory has the limitation, thus we have to specify the storage locateion in /etc/sysconfig/docker:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pwd
</span><span class='line'>/etc/sysconfig
</span><span class='line'>$  cat docker 
</span><span class='line'>
</span><span class='line'>## Path           : System/Management
</span><span class='line'>## Description    : Extra cli switches for docker daemon
</span><span class='line'>## Type           : string
</span><span class='line'>## Default        : ""
</span><span class='line'>## ServiceRestart : docker
</span><span class='line'>#
</span><span class='line'>DOCKER_OPTS="-g /home/xxxxxx/Code/Virtualization/Docker/docker/"
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>Now we could use the nearly 2T Size /home partition for storing docker images..</p>

<h3>Use China Resources</h3>

<p>The default dockhub is banned by GFW, so we have to use replacement repository in China. <br/>
Add the options to /ec/sysconfig/docker:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>DOCKER_OPTS="-g /home/clouder/Code/Virtualization/Docker/docker/ --insecure-registry dl.dockerpool.com:5000"
</span></code></pre></td></tr></table></div></figure>


<p>Then restart the docker via <code>systemctl restart docker</code>, after them we could use following command for pull back images:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker pull dl.dockerpool.com:5000/ubuntu:14.04
</span></code></pre></td></tr></table></div></figure>


<p>After pull back ,check the name of our fetched back ubuntu:14.04 is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker images
</span><span class='line'>dl.dockerpool.com:5000/ubuntu            14.04               5506de2b643b        3 months ago        197.8 MB
</span><span class='line'>dl.dockerpool.com:5000/ubuntu            latest              5506de2b643b        3 months ago        197.8 MB
</span></code></pre></td></tr></table></div></figure>


<p>Change to a differenet tag name:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker tag dl.dockerpool.com:5000/ubuntu:14.04 ubuntu:14.04
</span></code></pre></td></tr></table></div></figure>


<p>Now check again and you will find the long and hard-to-remember name has been changed to <code>ubuntu:14.04</code>.  <br/>
Our version of docker runs on OpenSuse is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker --version
</span><span class='line'>Docker version 1.4.1, build 5bc2ff8
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/06/build-pidgin-and-webqq/">Build Pidgin and WebQQ</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-06T20:35:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:35 pm</span></time>
        
         | <a href="/blog/2015/02/06/build-pidgin-and-webqq/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Strangely my OpenSuse&rsquo;s official installation version&rsquo;s pidgin doesn&rsquo;t support webqq plugins. So I have to build from source and let it run as a webQQ&rsquo;s version of pidgin.</p>

<h3>Getting Source.</h3>

<p>First download the source code from:  <br/>
<a href="http://sourceforge.net/projects/pidgin/files/Pidgin/2.10.11/pidgin-2.10.11.tar.bz2/download?accel_key=62%3A1423272982%3Ahttp%253A//www.pidgin.im/download/source/%3A20b420a2%24f93cd8a6095e965a3448df4a97a1c4786bf0a085&amp;click_id=b8d33c98-ae69-11e4-8d6d-0200ac1d1d8d&amp;source=accel">http://sourceforge.net/projects/pidgin/files/Pidgin/2.10.11/pidgin-2.10.11.tar.bz2/download?accel_key=62%3A1423272982%3Ahttp%253A//www.pidgin.im/download/source/%3A20b420a2%24f93cd8a6095e965a3448df4a97a1c4786bf0a085&amp;click_id=b8d33c98-ae69-11e4-8d6d-0200ac1d1d8d&amp;source=accel</a>  <br/>
Install related packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo zypper in intltool
</span><span class='line'>$ sudo zypper in gtk3-devel
</span><span class='line'>$ sudo zypper in gtk2-devel
</span><span class='line'>$ sudo zypper in gstreamer-devel
</span><span class='line'>$ sudo zypper in libidn-devel
</span><span class='line'>$ sudo zypper in meanwhile-devel
</span><span class='line'>$ sudo zypepr in libavahi-devel
</span><span class='line'>$ sudo zypper in libavahi-glib-devel
</span><span class='line'>$ sudo zypper in libgnutls-openssl-devel
</span><span class='line'>$ sudo zypper in tcl-devel 
</span><span class='line'>$ sudo zypper in tk-devel 
</span><span class='line'>$ sudo zypper in gtkspell-devel
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>Configure pidign via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./configure --prefix=/home/Trusty/bin --disable-screensaver  --disable-gstreamer --disable-vv
</span></code></pre></td></tr></table></div></figure>


<p>Notice here I disable the screensave support and gstreamer support.</p>

<h3>Make</h3>

<p>Via <code>make</code> and <code>make install</code> we could let it run. <br/>
Make install the corresponding plugins, and now your webqq is OK.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/04/deploy-vagrant/">Deploy Vagrant</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-04T02:49:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:49 am</span></time>
        
         | <a href="/blog/2015/02/04/deploy-vagrant/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Installation</h3>

<p>Couldn&rsquo;t install the vagrant via rubygems, so we directly download packages in vagrantup.com, rpm for OpenSuse.  <br/>
<a href="https://www.vagrantup.com/downloads.html">https://www.vagrantup.com/downloads.html</a>  <br/>
<a href="https://dl.bintray.com/mitchellh/vagrant/vagrant_1.7.2_x86_64.rpm">https://dl.bintray.com/mitchellh/vagrant/vagrant_1.7.2_x86_64.rpm</a>  <br/>
Install it via <code>rpm -ivh xxxx.rpm</code>.</p>

<h3></h3>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/03/install-gitlab-and-gogs/">Install GitLab and Gogs</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-03T22:23:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>10:23 pm</span></time>
        
         | <a href="/blog/2015/02/03/install-gitlab-and-gogs/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For sharing the git managed codes, we need setup the online repositories, we got two options, one is for gitlab, the other is for gogs.</p>

<h3>Gitlab</h3>

<p>The reference URL is listed as in:  <br/>
<a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-gitlab-as-your-very-own-private-github-clone">https://www.digitalocean.com/community/tutorials/how-to-set-up-gitlab-as-your-very-own-private-github-clone</a>  <br/>
But following the tutorial you will met the problem, following records the solution:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo -u git -H bundle install --deployment --without development test postgres
</span><span class='line'>   Could not find modernizr-2.6.2 in any of the sources
</span><span class='line'>$ cd /home/git/gitlab
</span><span class='line'>$ wget http://rubygems.org/downloads/modernizr-2.6.2.gem
</span><span class='line'>$ sudo gem install modernizr
</span><span class='line'>$ vim Gemfile
</span><span class='line'>gem "modernizr"    "2.6.2"   ===&gt; gem "modernizr-rails",        "2.7.1"
</span><span class='line'>$ vim Gemfile.lock
</span><span class='line'>modernizr  (2.6.2)   ===&gt;     modernizr-rails (2.7.1)
</span><span class='line'>modernizr  (2.6.2)   ===&gt;     modernizr-rails (= 2.7.1)
</span><span class='line'>$ sudo -u git -H bundle install --deployment --without development test postgres 
</span></code></pre></td></tr></table></div></figure>


<h3>Gogs</h3>

<p>We use docker for installing Gogs, the command listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># sh -c "wget -qO- https://get.docker.io/gpg | apt-key add -"
</span><span class='line'># sh -c "echo deb http://get.docker.io/ubuntu docker main\
</span><span class='line'>&gt; /etc/apt/sources.list.d/docker.list"
</span><span class='line'># apt-get update
</span><span class='line'># apt-get install lxc-docker
</span><span class='line'># proxychains4 docker pull codeskyblue/docker-gogs
</span></code></pre></td></tr></table></div></figure>


<p>This pull back the <code>docker-gogs</code> image, later you could run the gogs server via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir /var/gogs
</span><span class='line'>$ docker run -d -p 2223:22 -p 3000:3000 -v /var/gogs:/data codeskyblue/docker-gogs
</span></code></pre></td></tr></table></div></figure>


<p>Then visit <code>http://1xx.xx.xx.xxx:3000</code> you will got the installation webpage, simply install it.  <br/>
Everytime you run into error case, you could remove the <code>/var/gogs</code> directory and let everything happen from zero.</p>

<h3>Using Gogs</h3>

<p>Create Repository, then <code>git clone</code>, then add your own files, <code>git add .</code>, <code>git commit -m</code>, <code>git push origin master</code>, the same as you did in github.</p>

<p>Some problems happens&hellip;. We changed to OpenSuse for installing.  <br/>
Remove all of the .git directory in sub-directories via following command, then problem won&rsquo;t happen.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>find ./* -name ".git" | xargs rm -rf
</span></code></pre></td></tr></table></div></figure>


<p>Now git push all of the changes to the remote repository and you got everything works well.  <br/>
Add the running command into <code>/etc/rc.local</code> thus the docker runs together with the system startup.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/03/prison-break-for-something/">Prison-Break for Something</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-03T04:02:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>4:02 am</span></time>
        
         | <a href="/blog/2015/02/03/prison-break-for-something/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;ve worked two days on prison-break something, this will greatly improve my working efficiency. There are so many steps for recording, so I will detailed described them in following parts.</p>

<h3>Single MOde</h3>

<p>In Single Mode you could get an terminal with root then you could do anything you want, simply pass <code>init=/bin/bash</code> in Grub then you could do anything.   <br/>
Question: why Unix-like system enable this command?  <br/>
Answer: In Unix-like systems, init is the first process to be run, and the ultimate ancestor of all processes ever run. It&rsquo;s responsible for running all the init scripts.  <br/>
We could add sudo users, with sudo users, you could get more priviledges.</p>

<h3>privoxy</h3>

<p>This fantanstic software could let you setup your own proxy server, simply compile it and let it run under user <code>root</code>, after it starts up, a proxy which listens on 8118 will be available for using.</p>

<h3>System Upgrade</h3>

<p>!!!Notice!!!: Always keep at least 2 root loginned terminal alive, thus if any problem happens you could do debugging. <br/>
Since you have the privoxy for using proxy, you could do anything you want, you could upgrade system from default 11.3 to the latest 13.2. The reference URLs are listed as following:   <br/>
Upgrade from 11.3 to 12.3:  <br/>
<a href="https://zh.opensuse.org/SDB:%E7%B3%BB%E7%BB%9F%E5%8D%87%E7%BA%A7">https://zh.opensuse.org/SDB:%E7%B3%BB%E7%BB%9F%E5%8D%87%E7%BA%A7</a>  <br/>
Main tips:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo zypper addrepo --check --name 'openSUSE-11.3-Update' http://download.opensuse.org/update/11.3/repo-update
</span><span class='line'>$ sudo zypper ref && zypper update
</span><span class='line'>$ sudo reboot
</span><span class='line'>.....
</span><span class='line'>$ sudo zypper mr -da
</span><span class='line'>$ sudo zypper ar -f http://download.openSUSE.org/distribution/12.3/repo/oss/ openSUSE:12.3:OSS
</span><span class='line'>$ sudo zypper ar -f http://download.openSUSE.org/distribution/12.3/repo/non-oss/ openSUSE:12.3:NON-OSS
</span><span class='line'>$ sudo zypper addlock liblzma0
</span><span class='line'>$ sudo zypper dup --download "in-advance"
</span><span class='line'>$ sudo shutdown -hP now                                                                                                                       
</span></code></pre></td></tr></table></div></figure>


<p>                                                                                                                                         <br/>
Upgrade from 11.3 to 12.3 won&rsquo;t cause any problems, and on my machine the new system become available for using immediately.                <br/>
Upgrade from 12.3 to 13.2:  <br/>
<a href="https://en.opensuse.org/SDB:System_upgrade">https://en.opensuse.org/SDB:System_upgrade</a>  <br/>
Main tips:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo zypper addrepo --check --name 'openSUSE-12.3-Update' http://download.opensuse.org/update/12.3/repo-update
</span><span class='line'>$ sudo zypper ref && zypper update
</span><span class='line'>$ sudo reboot
</span><span class='line'>.....
</span><span class='line'>$ sudo zypper mr -da
</span><span class='line'>$ sudo zypper ar -f http://download.openSUSE.org/distribution/13.2/repo/oss/ openSUSE:13.2:OSS
</span><span class='line'>$ sudo zypper ar -f http://download.openSUSE.org/distribution/13.2/repo/non-oss/ openSUSE:13.2:NON-OSS
</span><span class='line'>$ sudo zypper addlock liblzma0
</span><span class='line'>$ sudo zypper dup --download "in-advance"
</span><span class='line'>$ sudo shutdown -hP now
</span></code></pre></td></tr></table></div></figure>


<p>Trouble shooting:   <br/>
1. When upgrading the system, zypper will halt(hang) at following packages:  <br/>
zypper dup locks up Bug #802525. Workaround: make sure to keep a root shell open while zypper dup is running. Run &ldquo;killall dbus-send&rdquo; when zypper dup hangs at rtkit.  <br/>
<a href="https://en.opensuse.org/openSUSE:Most_annoying_bugs_13.1_dev">https://en.opensuse.org/openSUSE:Most_annoying_bugs_13.1_dev</a>   <br/>
2. tuned installation got stuck:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ps -ef | grep tuned
</span><span class='line'>$ kill tunned
</span><span class='line'>$ ps -ef | grep rpm 
</span><span class='line'>$ kill greped_rpm_install
</span></code></pre></td></tr></table></div></figure>


<h3>Route</h3>

<p>References:  <br/>
<a href="http://w.gdu.me/wiki/Linux/iptables_forward_internetshare.html">http://w.gdu.me/wiki/Linux/iptables_forward_internetshare.html</a>  <br/>
First in the middleware machine, add following rules in iptables:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># iptables -P FORWARD ALLOW
</span><span class='line'># iptables -A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT
</span><span class='line'># iptables -t nat -A POSTROUTING -s 10.1.1.0/24 -j SNAT --to 60.1.1.1
</span><span class='line'># iptables -A FORWARD -s 10.1.1.9 -j ACCEPT
</span></code></pre></td></tr></table></div></figure>


<p>Now you could use this middle machine for acrossing something.   <br/>
But, in your own machine, should use the following command for deleting the routes and add new routes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># route del default gw xxx.xxx.xxx.xxx
</span><span class='line'># route add default gw xxx.xxx.xxx.xxx
</span></code></pre></td></tr></table></div></figure>


<p>There are also some complicated commands for holding the routes, but we could also edit the following files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pwd
</span><span class='line'>/etc/sysconfig/network
</span><span class='line'>linux:/etc/sysconfig/network # cat routes 
</span><span class='line'>default xxx.xx.xxx.xxx - - 
</span><span class='line'>any net xxx.xx.0.0 netmask 255.255.0.0 gw xxx.xxx.xxx.200
</span></code></pre></td></tr></table></div></figure>


<p>Now even if you reboot the machine, the default route and the exchange route will be also added into the system.</p>

<h3>More Safer</h3>

<p>Change the opensshd listenning port.  <br/>
More and more.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/31/try-opencontrail-in-ubuntu/">Try OpenContrail in Ubuntu</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-31T23:36:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>11:36 pm</span></time>
        
         | <a href="/blog/2015/01/31/try-opencontrail-in-ubuntu/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>To be write</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/30/speed-up-the-wp-website-in-tianchao/">Speed-Up the WP Website in TianChao</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-30T23:09:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:09 pm</span></time>
        
         | <a href="/blog/2015/01/30/speed-up-the-wp-website-in-tianchao/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since our Great Fire Wall forbidden the google, thus all of the google related service becomes available in china, this leads to access to wordpress based website which uses google online fonts pretty slow. Following is how to speedup your website without too many changes:   <br/>
First go to your website&rsquo;s folder, find the files which calls <code>fonts.googleapis.com</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ grep -i "fonts.googleapis.com" ./ -r
</span><span class='line'>./wp-content/themes/twentytwelve/functions.php:       $font_url = add_query_arg( $query_args, "$protocol://fonts.googleapis.com/css" );
</span><span class='line'>./wp-content/themes/twentyfifteen/functions.php:      ), '//fonts.googleapis.com/css' );
</span><span class='line'>./wp-content/themes/twentyfourteen/functions.php:     $font_url = add_query_arg( 'family', urlencode( 'Lato:300,400,700,900,300italic,400italic,700italic' ), "//fonts.googleapis.com/css" );
</span><span class='line'>./wp-content/themes/tdpersona/functions.php:  wp_enqueue_style( 'tdpersona-googlefonts', '//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' );
</span><span class='line'>./wp-content/themes/twentythirteen/functions.php:     $fonts_url = add_query_arg( $query_args, "//fonts.googleapis.com/css" );
</span><span class='line'>./wp-includes/script-loader.php:      $open_sans_font_url = "//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,300,400,600&subset=$subsets";
</span><span class='line'>./wp-includes/js/tinymce/plugins/compat3x/css/dialog.css:@import url(//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,300,400,600&subset=latin-ext,latin);
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>Replace all of the <code>fonts.googleapis.com</code> with <code>fonts.useso.com</code>, this could be done via scripts. <br/>
After modification, your website will be much more faster than before.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/29/play-docker-4/">Play Docker(4)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-29T22:41:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:41 pm</span></time>
        
         | <a href="/blog/2015/01/29/play-docker-4/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Fig(Continue)</h3>

<p>Met some problems in last article, so this part will continue to work on Fig, the correct configuration files are listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls
</span><span class='line'>app.py  Dockerfile  fig.yml  requirements.txt
</span><span class='line'>$ cat Dockerfile 
</span><span class='line'>FROM python:2.7
</span><span class='line'>ADD . /code
</span><span class='line'>WORKDIR /code
</span><span class='line'>RUN pip install -r requirements.txt
</span><span class='line'>$ cat fig.yml 
</span><span class='line'>web:
</span><span class='line'>  build: .
</span><span class='line'>  command: python app.py
</span><span class='line'>  ports:
</span><span class='line'>   - "5000:5000"
</span><span class='line'>  volumes:
</span><span class='line'>   - .:/code
</span><span class='line'>  links:
</span><span class='line'>   - redis
</span><span class='line'>redis:
</span><span class='line'>  image: redis
</span><span class='line'>$ cat requirements.txt 
</span><span class='line'>flask
</span><span class='line'>redis
</span><span class='line'>$ cat app.py 
</span><span class='line'>from flask import Flask
</span><span class='line'>from redis import Redis
</span><span class='line'>import os
</span><span class='line'>app = Flask(__name__)
</span><span class='line'>redis = Redis(host='redis', port=6379)
</span><span class='line'>
</span><span class='line'>@app.route('/')
</span><span class='line'>def hello():
</span><span class='line'>    redis.incr('hits')
</span><span class='line'>    return 'Hello World! I have been seen %s times.' % redis.get('hits')
</span><span class='line'>
</span><span class='line'>if __name__ == "__main__":
</span><span class='line'>    app.run(host="0.0.0.0", debug=True)
</span></code></pre></td></tr></table></div></figure>


<p>via <code>fig up</code> you could quickly build this app and let it run.  <br/>
When it running, you could use <code>fig ps</code> for viewing the running instance:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo fig ps
</span><span class='line'>      Name             Command             State              Ports       
</span><span class='line'>-------------------------------------------------------------------------
</span><span class='line'>figtest_redis_1    /entrypoint.sh     Up                 6379/tcp         
</span><span class='line'>                   redis-server                                           
</span><span class='line'>figtest_web_1      python app.py      Up                 0.0.0.0:5000-&gt;50 
</span><span class='line'>                                                         00/tcp    
</span></code></pre></td></tr></table></div></figure>


<p>Use <code>sudo fig run web env</code> you could view all of the variables of the running instance web, or change web into redis then displaying the variables of redis.  <br/>
Use <code>sudo fig stop</code> to stop all of the running instance.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo fig stop
</span><span class='line'>Stopping figtest_web_1...
</span><span class='line'>Stopping figtest_redis_1...
</span></code></pre></td></tr></table></div></figure>


<p>Use <code>sudo fig run web env</code> for displaying all of the variables of running <code>web</code>.</p>

<h3>Create Django</h3>

<p>Configuration files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat Dockerfile 
</span><span class='line'>FROM python:2.7
</span><span class='line'>ENV PYTHONUNBUFFERED 1
</span><span class='line'>RUN mkdir /code
</span><span class='line'>WORKDIR /code
</span><span class='line'>ADD requirements.txt /code/
</span><span class='line'>RUN pip install -r requirements.txt
</span><span class='line'>ADD . /code/
</span><span class='line'>
</span><span class='line'>$ cat fig.yml 
</span><span class='line'>db:
</span><span class='line'>  image: postgres
</span><span class='line'>web:
</span><span class='line'>  build: .
</span><span class='line'>  command: python manage.py runserver 0.0.0.0:8000
</span><span class='line'>  volumes:
</span><span class='line'>    - .:/code
</span><span class='line'>  ports:
</span><span class='line'>    - "8000:8000"
</span><span class='line'>  links:
</span><span class='line'>    - db
</span><span class='line'>
</span><span class='line'>$ cat requirements.txt 
</span><span class='line'>Django
</span><span class='line'>psycopg2
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>Via <code>sudo  fig run web django-admin.py startproject figexample .</code>  <br/>
This means, first fig will create the image, then use this image for running <code>django-admin.py startproject figexample</code>,
Examine via different methods:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker ps
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS               NAMES
</span><span class='line'>1abcafc5bd59        postgres:9          "/docker-entrypoint.   4 minutes ago       Up 3 minutes        5432/tcp            django_db_1         
</span><span class='line'>741b0e375c73        postgres:9          "/docker-entrypoint.   4 minutes ago       Up 4 minutes        5432/tcp            Django_db_1         
</span><span class='line'>[Trusty@DashCentOS django]$ sudo fig ps
</span><span class='line'>   Name                  Command               State    Ports   
</span><span class='line'>---------------------------------------------------------------
</span><span class='line'>django_db_1   /docker-entrypoint.sh postgres   Up      5432/tcp 
</span></code></pre></td></tr></table></div></figure>


<p>Change the configuration file of the django project:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo vim figexample/settings.py
</span><span class='line'>
</span><span class='line'>DATABASES = {
</span><span class='line'>    'default': {
</span><span class='line'>        'ENGINE': 'django.db.backends.postgresql_psycopg2',
</span><span class='line'>        'NAME': 'postgres',
</span><span class='line'>        'USER': 'postgres',
</span><span class='line'>        'HOST': 'db',
</span><span class='line'>        'PORT': 5432,
</span><span class='line'>    }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Save the file and run <code>sudo fig up</code>, this time your django project connects to the right postgresql server.  <br/>
Examine the running containers:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo fig ps
</span><span class='line'>      Name             Command             State              Ports       
</span><span class='line'>-------------------------------------------------------------------------
</span><span class='line'>django_db_1        /docker-           Up                 5432/tcp         
</span><span class='line'>                   entrypoint.sh                                          
</span><span class='line'>                   postgres                                               
</span><span class='line'>django_web_1       python manage.py   Up                 0.0.0.0:8000-&gt;80 
</span><span class='line'>                   runserver ...                         00/tcp           
</span><span class='line'>$ sudo docker ps
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                    NAMES
</span><span class='line'>d3c3c8bb6d0e        django_web:latest   "python manage.py ru   4 minutes ago       Up 4 minutes        0.0.0.0:8000-&gt;8000/tcp   django_web_1        
</span><span class='line'>3f7b61fdd09e        postgres:9          "/docker-entrypoint.   4 minutes ago       Up 4 minutes        5432/tcp                 django_db_1        
</span></code></pre></td></tr></table></div></figure>


<h3>Run ASP</h3>

<p>Refers to:  <br/>
<a href="http://dockerone.com/article/164">http://dockerone.com/article/164</a>  <br/>
The steps are listed as:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/aspnet/Home.git
</span><span class='line'>$ cd Home/
</span><span class='line'>$ cd samples/HelloWeb/
</span><span class='line'>$ vim Dockerfile
</span><span class='line'>FROM microsoft/aspnet
</span><span class='line'>
</span><span class='line'>COPY . /app
</span><span class='line'>WORKDIR /app
</span><span class='line'>RUN ["kpm", "restore"]
</span><span class='line'>
</span><span class='line'>EXPOSE 5004
</span><span class='line'>ENTRYPOINT ["k", "kestrel"]
</span><span class='line'>$ sudo docker build -t myapp .
</span><span class='line'>$ sudo docker images
</span><span class='line'>REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
</span><span class='line'>myapp               latest              6c0d622049ea        2 hours ago         492 MB
</span><span class='line'>microsoft/aspnet    latest              1e67fe2f5a59        13 days ago         465.3 MB
</span><span class='line'>$ sudo docker run -t -d -p 80:5004 myapp
</span></code></pre></td></tr></table></div></figure>


<p>Open your browser and visit <code>http://xxx.xx.xx.xxx:80</code> and you could found the asp based app runs.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/29/build-specified-version-of-opencontrail/">Build Specified Version of OpenContrail</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-29T20:50:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:50 pm</span></time>
        
         | <a href="/blog/2015/01/29/build-specified-version-of-opencontrail/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since the default building of OpenContrail is master branch, while the installation deb file named like <code>contrail-install-packages_1.21-74~havana_all.deb</code>, this gap need to be filled via building.</p>

<h3>View Different Branches</h3>

<p>Repo hold all of the versions locally, simply view them via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pwd
</span><span class='line'>/root/Code/OpenContrail/.repo/manifests
</span><span class='line'># git branch -a | cut -d / -f 3
</span><span class='line'>* default
</span><span class='line'>master -&gt; origin
</span><span class='line'>R1.04
</span><span class='line'>R1.05
</span><span class='line'>R1.06
</span><span class='line'>R1.06c1
</span><span class='line'>R1.10
</span><span class='line'>R1.30
</span><span class='line'>R2.0
</span><span class='line'>R2.1
</span><span class='line'>gh-pages
</span><span class='line'>master
</span><span class='line'>opserver
</span><span class='line'>rajreddy_doc_update
</span><span class='line'>rajreddy_doc_update2
</span><span class='line'>rajreddy_webui_third
</span></code></pre></td></tr></table></div></figure>


<p>While these branches doesn&rsquo;t contains <code>1.21</code>, why?</p>

<h3>Specify Different Tag</h3>

<p>In git admined project, tag is frequently be used, thus we could fetch the code via specified tag.  <br/>
Repo need to run following command to enable all of the sub-project syncs to specified tag, following I use <code>v1.21</code> tag for syncing.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ repo forall -c 'git checkout v1.21`
</span><span class='line'>$ repo sync
</span><span class='line'>$ python third_party/fetch_package.py && scons && make -f packages.make
</span></code></pre></td></tr></table></div></figure>


<p>Need a long time for checking the generated packages.    <br/>
Problem:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dpkg-source: error: syntax error in contrail/debian/control at line 33: block
</span><span class='line'>lacks the 'Package' field
</span><span class='line'>dpkg-buildpackage: error: dpkg-source --before-build contrail gave error exit
</span><span class='line'>status 25
</span></code></pre></td></tr></table></div></figure>


<p>when running <code>make -f packages.make</code>, it will failed, just remove the line before <code>packages</code> it will be OK.</p>

<h3>Specify Different Branch</h3>

<p>Specify the branch of:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>repo init -b android-2.3_r1 ; repo sync
</span><span class='line'>repo init -b R2.20
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/29/build-contrial-source-code/">Build Contrial Source Code</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-29T01:44:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:44 am</span></time>
        
         | <a href="/blog/2015/01/29/build-contrial-source-code/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Reference</h3>

<p><a href="http://juniper.github.io/contrail-vnc/README.html">http://juniper.github.io/contrail-vnc/README.html</a></p>

<h3>Hardware &amp;&amp; Software</h3>

<p>Vitualized machine which have 1G memory and 1 core.   <br/>
Running 12.04:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat /etc/issue
</span><span class='line'>Ubuntu 12.04.3 LTS \n \l
</span></code></pre></td></tr></table></div></figure>


<h3>Packages</h3>

<p>You should install following packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo add-apt-repository ppa:opencontrail/ppa
</span><span class='line'>$ sudo vim /etc/apt/source.lists
</span><span class='line'>deb http://ppa.launchpad.net/opencontrail/ppa/ubuntu precise main
</span><span class='line'>deb-src http://ppa.launchpad.net/opencontrail/ppa/ubuntu precise main
</span><span class='line'>$ sudo apt-get install  -y scons git python-lxml wget gcc patch make unzip flex bison g++ libssl-dev autoconf automake libtool pkg-config vim python-dev python-setuptools libprotobuf-dev protobuf-compiler libsnmp-python libgettextpo0 libxml2-utils debhelper python-sphinx ruby-ronn libipfix python-all libpcap-dev module-assistant libtbb-dev libboost-dev liblog4cplus-dev libghc-curl-dev
</span><span class='line'>$ sudo apt-get install python-pip
</span><span class='line'>$ sudo pip install gevent bottle netaddr 
</span></code></pre></td></tr></table></div></figure>


<h3>Getting Source Code</h3>

<p>Use repo for getting the source code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo
</span><span class='line'>$ chmod a+x ~/bin/repo
</span><span class='line'>$ echo "export PATH=/usr/local/git/bin:$PATH"&gt;&gt;~/.bashrc
</span><span class='line'>$ source ~/.bashrc
</span></code></pre></td></tr></table></div></figure>


<p>Fetch the repository and sync it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir ~/Code/OpenContrail
</span><span class='line'>$ cd ~/Code/OpenContrail
</span><span class='line'>$ repo init -u git@github.com:Juniper/contrail-vnc
</span><span class='line'>$ repo sync
</span></code></pre></td></tr></table></div></figure>


<p>Some of the packages will be blocked by GFW, be sure you use proxy for downloading them.  <br/>
Fetch the third party packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ python third_party/fetch_packages.py
</span></code></pre></td></tr></table></div></figure>


<h3>Build the OpenContrail &amp; Pakages</h3>

<p>The build step is simply via <code>scons</code>, after a long wait, it will pass.   <br/>
Generate packages via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ make -f packages.make
</span></code></pre></td></tr></table></div></figure>


<p>The default configuration will make <code>all</code> of the components in packages.make, or you could seperately build single component.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/22">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/20">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/01/26/read-digest-on-kvm/">Read Digest on KVM</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/18/tips-on-setup-mesos-cluster/">Tips on Setup Mesos Cluster</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/15/linux-tips-4/">Linux Tips(4)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/15/vlan-experiment/">Vlan Experiment</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/14/cloudstackshi-yong-lxcyao-dian/">CloudStackLXC</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
