
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="Problem Could see the SSID, but could not connect to it. Trouble Shooting First check the log in /var/log/wicd: 1
2
3
4
5
6
7
8
9
[root@TrustyArch &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/21">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.useso.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/04/trouble-shooting-on-wicd-wireless-connection/">Trouble Shooting on Wicd Wireless Connection</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-04T20:46:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:46 pm</span></time>
        
         | <a href="/blog/2014/12/04/trouble-shooting-on-wicd-wireless-connection/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Problem</h3>

<p>Could see the SSID, but could not connect to it.</p>

<h3>Trouble Shooting</h3>

<p>First check the log in <code>/var/log/wicd</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@TrustyArch wicd]# cat wicd.log
</span><span class='line'>2014/12/04 20:32:02 :: DHCP connection successful
</span><span class='line'>2014/12/04 20:32:02 :: not verifying
</span><span class='line'>2014/12/04 20:32:02 :: Connecting thread exiting.
</span><span class='line'>2014/12/04 20:32:03 :: Sending connection attempt result success
</span><span class='line'>2014/12/04 20:34:20 :: trying to load backend external
</span><span class='line'>2014/12/04 20:34:20 :: trying to load backend ioctl
</span><span class='line'>2014/12/04 20:34:20 :: WARNING: python-iwscan not found, falling back to using iwlist scan.
</span><span class='line'>2014/12/04 20:34:20 :: WARNING: python-wpactrl not found, falling back to using wpa_cli.
</span></code></pre></td></tr></table></div></figure>


<p>I think it&rsquo;s because the dhcpcd still alive, so manually kill this process via <code>pkill dhcpcd</code>, then re-connect again.  <br/>
Trouble Solved.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/04/flask-and-angularjs-blog-tips/">Flask&amp;AngularJS Blog Tips</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-04T15:32:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>3:32 pm</span></time>
        
         | <a href="/blog/2014/12/04/flask-and-angularjs-blog-tips/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Background</h3>

<p>For setup the local blog which used for recording some articles, and provide the RESTful APIs for remote usage.   <br/>
The tutorial is located at:  <br/>
<a href="http://blog.john.mayonvolcanosoftware.com/building-a-blog-using-flask-and-angularjs-part-1/">http://blog.john.mayonvolcanosoftware.com/building-a-blog-using-flask-and-angularjs-part-1/</a></p>

<h3>Installation of Packages</h3>

<p>First preapare the environment using virtualenv2:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ virtualenv2 flask_blog
</span><span class='line'>$ source flask_blog/bin/activate
</span></code></pre></td></tr></table></div></figure>


<p>Now write a requirements.txt file, under the current folder, the content is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Flask==0.10.1
</span><span class='line'>Flask-Bcrypt==0.6.0
</span><span class='line'>Flask-HTTPAuth==2.2.1
</span><span class='line'>Flask-RESTful==0.2.12
</span><span class='line'>Flask-SQLAlchemy==1.0
</span><span class='line'>Flask-WTF==0.10.0
</span><span class='line'>Jinja2==2.7.3
</span><span class='line'>MarkupSafe==0.23
</span><span class='line'>SQLAlchemy==0.9.7
</span><span class='line'>SQLAlchemy-Utils==0.26.9
</span><span class='line'>WTForms==2.0.1
</span><span class='line'>WTForms-Alchemy==0.12.8
</span><span class='line'>WTForms-Components==0.9.5
</span><span class='line'>Werkzeug==0.9.6
</span><span class='line'>aniso8601==0.83
</span><span class='line'>decorator==3.4.0
</span><span class='line'>infinity==1.3
</span><span class='line'>intervals==0.3.1
</span><span class='line'>itsdangerous==0.24
</span><span class='line'>marshmallow==0.7.0
</span><span class='line'>py-bcrypt==0.4
</span><span class='line'>pytz==2014.4
</span><span class='line'>six==1.7.3
</span><span class='line'>validators==0.6.0
</span><span class='line'>wsgiref==0.1.2
</span></code></pre></td></tr></table></div></figure>


<p>Use <code>pip install -r requirements.txt</code> for installing all of the packages.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/03/use-docker-for-deploying-wp/">Use Docker for Deploying WP</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-03T19:33:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>7:33 pm</span></time>
        
         | <a href="/blog/2014/12/03/use-docker-for-deploying-wp/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Just for swiftly deploy WP and test the RESTful API, I did following operations and runs a WP temporately.</p>

<h3>PULL</h3>

<p>Pull following containers:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker pull mysql
</span><span class='line'>$ docker pull wordpress
</span><span class='line'>$ sudo docker images
</span><span class='line'>REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
</span><span class='line'>&lt;none&gt;              &lt;none&gt;              480ac552cd39        About an hour ago   192.8 MB
</span><span class='line'>mysql               latest              98840bbb442c        39 hours ago        235.5 MB
</span><span class='line'>wordpress           latest              9f51af77fd96        8 days ago          470.5 MB
</span></code></pre></td></tr></table></div></figure>


<h3>Configuration</h3>

<p>Explanation for following commands, <code>--name</code> is the name for our container, <code>-p 8038:80</code> is mapping the host machine&rsquo;s 8038 port to container <code>wordpress_1</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker run --name mysql_1 -e MYSQL_ROOT_PASSWORD=xxxx -d mysql
</span><span class='line'>$ docker run --name wordpress_1 --link mysql_1:mysql -p 8038:80 -d wordpress
</span></code></pre></td></tr></table></div></figure>


<p>Now open your browser to <code>http://localhost:8038</code> and you got the wordpress installation window.</p>

<h3>WP</h3>

<p>After we installed WP, we could install JSON REST API from:  <br/>
<a href="https://wordpress.org/plugins/json-rest-api/">https://wordpress.org/plugins/json-rest-api/</a>  <br/>
After installation, we could test the REST API via curl:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>TBD
</span></code></pre></td></tr></table></div></figure>


<h3>View Docker status</h3>

<p>First we should grab the docker&rsquo;s PID via following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker  inspect  --format ""  mysql_1 
</span><span class='line'>28254
</span><span class='line'>$ docker  inspect  --format ""  wordpress_1
</span><span class='line'>28754
</span></code></pre></td></tr></table></div></figure>


<p>Then we could nsenter the docker container and view its status:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo nsenter --target 28254 --mount --uts --ipc --net --pid -- /bin/bash
</span><span class='line'>$ sudo nsenter --target 28754 --mount --uts --ipc --net --pid -- /bin/bash
</span></code></pre></td></tr></table></div></figure>


<p>In the &lsquo;attached&rsquo; environment we could inspect the status for corresponding services.</p>

<h3>Stop docker contains</h3>

<p>via <code>docker stop</code> we could simply stop the docker container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@~/code/30days/Docker]$ sudo docker ps
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                  NAMES
</span><span class='line'>0995854e2144        wordpress:latest    "/entrypoint.sh apac   About an hour ago   Up About an hour    0.0.0.0:8038-&gt;80/tcp   wordpress_1         
</span><span class='line'>99d257ad6e24        mysql:latest        "/entrypoint.sh mysq   About an hour ago   Up About an hour    3306/tcp               mysql_1             
</span><span class='line'>[Trusty@~/code/30days/Docker]$ docker stop 0995854e2144
</span><span class='line'>0995854e2144
</span><span class='line'>[Trusty@~/code/30days/Docker]$ docker stop 99d257ad6e24
</span><span class='line'>99d257ad6e24
</span><span class='line'>[Trusty@~/code/30days/Docker]$ sudo docker ps
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/03/yong-flaskda-jian-ni-zi-ji-de-restful-api/">用Flask搭建你自己的Restful API</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-03T16:35:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>4:35 pm</span></time>
        
         | <a href="/blog/2014/12/03/yong-flaskda-jian-ni-zi-ji-de-restful-api/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>背景</h3>

<p>最近在过一个《30天学习30种新技术》，过到第10天用Phonegap开发APP的时候，发现作者提供的API不可用，所以费心研究了一下Restful API, 顺利构建出了环境写完了那个APP，下面是一些摘要。  <br/>
我用的Tutorial来自这里：  <br/>
<a href="http://blog.miguelgrinberg.com/post/designing-a-restful-api-with-python-and-flask">http://blog.miguelgrinberg.com/post/designing-a-restful-api-with-python-and-flask</a>   <br/>
开发环境是ArchLinux.</p>

<h3>Hello Flask</h3>

<p>原Tutorial中给出的是一个关于todo-list的实现，我们从最简单的"Hello Flask"开始：  <br/>
首先安装python虚拟环境和flask，注意因为Arch默认的python版本是3，所以这里我们使用了virtualenv2来创建python虚拟运行环境。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir todo-api
</span><span class='line'>$ cd todo-api
</span><span class='line'>$ virtualenv2 flask
</span><span class='line'>$ source flask/bin/activate
</span><span class='line'>(flask) $ pip install flask
</span></code></pre></td></tr></table></div></figure>


<p>在当前目录下建立<code>app.py</code>文件， 输入以下内容：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="c">#!flask/bin/python</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
</span><span class='line'>
</span><span class='line'><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="s">&quot;Hello, Flask!&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在改变文件属性，运行之:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="err">$</span> <span class="n">chmod</span> <span class="n">a</span><span class="o">+</span><span class="n">x</span> <span class="n">app</span><span class="o">.</span><span class="n">py</span>
</span><span class='line'><span class="err">$</span> <span class="o">./</span><span class="n">app</span><span class="o">.</span><span class="n">py</span>
</span></code></pre></td></tr></table></div></figure>


<p>打开浏览器访问<code>http://127.0.0.1:5000</code>,，我们可以看到Hello Flask已经出现在浏览器里了。</p>

<h3>实现最简单的Restful API</h3>

<p>Flask本身支持很多插件，可以用于实现Restful API，由于我们这里只是做DEMO使用，需求比较简单，我们抛弃那些繁琐的插件，手动来写。  <br/>
这里我们也不会引入数据库等内容，我们将task任务列表直接保存在内存中，所以一旦断电这些数据就将消失。在实际的生产环境中，我们是需要引入不同的数据库来存储这些数据的。   <br/>
在上面生成的<code>app.py</code>中添加以下内容:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="c">#!flask/bin/python</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>
</span><span class='line'>
</span><span class='line'><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">u&#39;Buy groceries&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">u&#39;Milk, Cheese, Pizza, Fruit, Tylenol&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;done&#39;</span><span class="p">:</span> <span class="bp">False</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">u&#39;Learn Python&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">u&#39;Need to find a good Python tutorial on the web&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;done&#39;</span><span class="p">:</span> <span class="bp">False</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/todo/api/v1.0/tasks&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">get_tasks</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;tasks&#39;</span><span class="p">:</span> <span class="n">tasks</span><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在打开终端，用curl就可以访问到我们新添加的API了:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>curl -i http://127.0.0.1:5000/todo/api/v1.0/tasks
</span><span class='line'>HTTP/1.0 <span class="m">200</span> OK
</span><span class='line'>Content-Type: application/json
</span><span class='line'>Content-Length: 316
</span><span class='line'>Server: Werkzeug/0.9.6 Python/2.7.8
</span><span class='line'>Date: Wed, <span class="m">03</span> Dec <span class="m">2014</span> 08:59:55 GMT
</span><span class='line'>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  <span class="s2">&quot;tasks&quot;</span>: <span class="o">[</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="s2">&quot;description&quot;</span>: <span class="s2">&quot;Milk, Cheese, Pizza, Fruit, Tylenol&quot;</span>,
</span><span class='line'>      <span class="s2">&quot;done&quot;</span>: <span class="nb">false</span>,
</span><span class='line'>      <span class="s2">&quot;id&quot;</span>: 1,
</span><span class='line'>      <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;Buy groceries&quot;</span>
</span><span class='line'>    <span class="o">}</span>,
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="s2">&quot;description&quot;</span>: <span class="s2">&quot;Need to find a good Python tutorial on the web&quot;</span>,
</span><span class='line'>      <span class="s2">&quot;done&quot;</span>: <span class="nb">false</span>,
</span><span class='line'>      <span class="s2">&quot;id&quot;</span>: 2,
</span><span class='line'>      <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;Learn Python&quot;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">]</span>
</span><span class='line'><span class="o">}</span>%
</span></code></pre></td></tr></table></div></figure>


<p>第一个Restful的API就这样创建成功了。</p>

<h3>添加第二个RESTful API</h3>

<p>我们接着来添加第二个RESTful API, 加入下列代码到已有的<code>app.py</code>中:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">abort</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/todo/api/v1.0/tasks/&lt;int:task_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
</span><span class='line'><span class="k">def</span> <span class="nf">get_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">):</span>
</span><span class='line'>    <span class="n">task</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">task_id</span><span class="p">,</span> <span class="n">tasks</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">task</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>        <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;task&#39;</span><span class="p">:</span> <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在用curl来测试，结果应该是这样的:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="p">(</span><span class="n">flask</span><span class="p">)[</span><span class="n">Trusty</span><span class="err">@</span><span class="o">~/</span><span class="n">code</span><span class="o">/</span><span class="mi">30</span><span class="n">days</span><span class="o">/</span><span class="n">todo</span><span class="o">-</span><span class="n">api</span><span class="p">]</span><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">151</span>
</span><span class='line'><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">0.9</span><span class="o">.</span><span class="mi">6</span> <span class="n">Python</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">8</span>
</span><span class='line'><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mo">03</span> <span class="n">Dec</span> <span class="mi">2014</span> <span class="mi">09</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">25</span> <span class="n">GMT</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;task&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;Need to find a good Python tutorial on the web&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;done&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Learn Python&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="o">%</span>                                                                                                                                                   <span class="p">(</span><span class="n">flask</span><span class="p">)[</span><span class="n">Trusty</span><span class="err">@</span><span class="o">~/</span><span class="n">code</span><span class="o">/</span><span class="mi">30</span><span class="n">days</span><span class="o">/</span><span class="n">todo</span><span class="o">-</span><span class="n">api</span><span class="p">]</span><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span><span class="o">/</span><span class="mi">3</span>
</span><span class='line'><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">404</span> <span class="n">NOT</span> <span class="n">FOUND</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">233</span>
</span><span class='line'><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">0.9</span><span class="o">.</span><span class="mi">6</span> <span class="n">Python</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">8</span>
</span><span class='line'><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mo">03</span> <span class="n">Dec</span> <span class="mi">2014</span> <span class="mi">09</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">27</span> <span class="n">GMT</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">HTML</span> <span class="n">PUBLIC</span> <span class="s">&quot;-//W3C//DTD HTML 3.2 Final//EN&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="mi">404</span> <span class="n">Not</span> <span class="n">Found</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Not</span> <span class="n">Found</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">The</span> <span class="n">requested</span> <span class="n">URL</span> <span class="n">was</span> <span class="ow">not</span> <span class="n">found</span> <span class="n">on</span> <span class="n">the</span> <span class="n">server</span><span class="o">.</span>  <span class="n">If</span> <span class="n">you</span> <span class="n">entered</span> <span class="n">the</span> <span class="n">URL</span> <span class="n">manually</span> <span class="n">please</span> <span class="n">check</span> <span class="n">your</span> <span class="n">spelling</span> <span class="ow">and</span> <span class="k">try</span> <span class="n">again</span><span class="o">.&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>由于我们引用了abort方法，所以当我们给出的task id错误时，将弹出404错误。</p>

<h3>错误提示JSON化</h3>

<p>通过引入<code>make_response</code>模块我们可以把404返回错误JSON化，添加以下代码到app.py中：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">make_response</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@app.errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">not_found</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">make_response</span><span class="p">(</span><span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;error&#39;</span><span class="p">:</span> <span class="s">&#39;Not found&#39;</span><span class="p">}),</span> <span class="mi">404</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在访问一个不存在的task id将返回如下结果：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="p">(</span><span class="n">flask</span><span class="p">)[</span><span class="n">Trusty</span><span class="err">@</span><span class="o">~/</span><span class="n">code</span><span class="o">/</span><span class="mi">30</span><span class="n">days</span><span class="o">/</span><span class="n">todo</span><span class="o">-</span><span class="n">api</span><span class="p">]</span><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span><span class="o">/</span><span class="mi">3</span>
</span><span class='line'><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">404</span> <span class="n">NOT</span> <span class="n">FOUND</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">26</span>
</span><span class='line'><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">0.9</span><span class="o">.</span><span class="mi">6</span> <span class="n">Python</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">8</span>
</span><span class='line'><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mo">03</span> <span class="n">Dec</span> <span class="mi">2014</span> <span class="mi">09</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">50</span> <span class="n">GMT</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;error&quot;</span><span class="p">:</span> <span class="s">&quot;Not found&quot;</span>
</span><span class='line'><span class="p">}</span><span class="o">%</span>
</span></code></pre></td></tr></table></div></figure>


<h3>实现POST方法</h3>

<p>添加以下代码以实现POST方法:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/todo/api/v1.0/tasks&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;POST&#39;</span><span class="p">])</span>
</span><span class='line'><span class="k">def</span> <span class="nf">create_task</span><span class="p">():</span>
</span><span class='line'>    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">or</span> <span class="ow">not</span> <span class="s">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">:</span>
</span><span class='line'>        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
</span><span class='line'>    <span class="n">task</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="n">tasks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">],</span>
</span><span class='line'>        <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
</span><span class='line'>        <span class="s">&#39;done&#39;</span><span class="p">:</span> <span class="bp">False</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;task&#39;</span><span class="p">:</span> <span class="n">task</span><span class="p">}),</span> <span class="mi">201</span>
</span></code></pre></td></tr></table></div></figure>


<p>用curl测试的结果如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="p">(</span><span class="n">flask</span><span class="p">)[</span><span class="n">Trusty</span><span class="err">@</span><span class="o">~/</span><span class="n">code</span><span class="o">/</span><span class="mi">30</span><span class="n">days</span><span class="o">/</span><span class="n">todo</span><span class="o">-</span><span class="n">api</span><span class="p">]</span><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">H</span> <span class="s">&quot;Content-Type: application/json&quot;</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">d</span> <span class="s">&#39;{&quot;title&quot;:&quot;Read a book&quot;}&#39;</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span>
</span><span class='line'><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">201</span> <span class="n">CREATED</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">104</span>
</span><span class='line'><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">0.9</span><span class="o">.</span><span class="mi">6</span> <span class="n">Python</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">8</span>
</span><span class='line'><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mo">03</span> <span class="n">Dec</span> <span class="mi">2014</span> <span class="mi">09</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">55</span> <span class="n">GMT</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;task&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;done&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Read a book&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="o">%</span>
</span><span class='line'> <span class="p">(</span><span class="n">flask</span><span class="p">)[</span><span class="n">Trusty</span><span class="err">@</span><span class="o">~/</span><span class="n">code</span><span class="o">/</span><span class="mi">30</span><span class="n">days</span><span class="o">/</span><span class="n">todo</span><span class="o">-</span><span class="n">api</span><span class="p">]</span><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span>
</span><span class='line'><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">423</span>
</span><span class='line'><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">0.9</span><span class="o">.</span><span class="mi">6</span> <span class="n">Python</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">8</span>
</span><span class='line'><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mo">03</span> <span class="n">Dec</span> <span class="mi">2014</span> <span class="mi">09</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">24</span> <span class="n">GMT</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;tasks&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;Milk, Cheese, Pizza, Fruit, Tylenol&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;done&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Buy groceries&quot;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;Need to find a good Python tutorial on the web&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;done&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Learn Python&quot;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;done&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Read a book&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">]</span>
</span><span class='line'><span class="p">}</span><span class="o">%</span>
</span></code></pre></td></tr></table></div></figure>


<p>从上面的测试中我们可以看到一个新的任务被添加到了task列表中。</p>

<h3>最后两个RESTful API</h3>

<p>最后的两个RESTful API代码如下:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/todo/api/v1.0/tasks/&lt;int:task_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;PUT&#39;</span><span class="p">])</span>
</span><span class='line'><span class="k">def</span> <span class="nf">update_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">):</span>
</span><span class='line'>    <span class="n">task</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">task_id</span><span class="p">,</span> <span class="n">tasks</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">task</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>        <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">:</span>
</span><span class='line'>        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="s">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">unicode</span><span class="p">:</span>
</span><span class='line'>        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="s">&#39;description&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;description&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">unicode</span><span class="p">:</span>
</span><span class='line'>        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="s">&#39;done&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;done&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">:</span>
</span><span class='line'>        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
</span><span class='line'>    <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;title&#39;</span><span class="p">])</span>
</span><span class='line'>    <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;description&#39;</span><span class="p">])</span>
</span><span class='line'>    <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;done&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;done&#39;</span><span class="p">,</span> <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;done&#39;</span><span class="p">])</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;task&#39;</span><span class="p">:</span> <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/todo/api/v1.0/tasks/&lt;int:task_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;DELETE&#39;</span><span class="p">])</span>
</span><span class='line'><span class="k">def</span> <span class="nf">delete_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">):</span>
</span><span class='line'>    <span class="n">task</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">task_id</span><span class="p">,</span> <span class="n">tasks</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">task</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>        <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</span><span class='line'>    <span class="n">tasks</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;result&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>测试代码如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">H</span> <span class="s">&quot;Content-Type: application/json&quot;</span> <span class="o">-</span><span class="n">X</span> <span class="n">PUT</span> <span class="o">-</span><span class="n">d</span> <span class="s">&#39;{&quot;done&quot;:true}&#39;</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span><span class="o">/</span><span class="mi">2</span>
</span></code></pre></td></tr></table></div></figure>


<p>运行上面的命令可以将第2条记录里的done字段由false改成true.</p>

<h3>改进接口</h3>

<p>加入以下代码后，我们调用tasks方法将不再返回id,而是返回URIs，这样取回来就能用了。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">url_for</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">make_public_task</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
</span><span class='line'>    <span class="n">new_task</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">task</span><span class="p">:</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">field</span> <span class="o">==</span> <span class="s">&#39;id&#39;</span><span class="p">:</span>
</span><span class='line'>            <span class="n">new_task</span><span class="p">[</span><span class="s">&#39;uri&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s">&#39;get_task&#39;</span><span class="p">,</span> <span class="n">task_id</span><span class="o">=</span><span class="n">task</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">_external</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">new_task</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="n">field</span><span class="p">]</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">new_task</span>
</span></code></pre></td></tr></table></div></figure>


<p>同时我们重写以下方法:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/todo/api/v1.0/tasks&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
</span><span class='line'><span class="k">def</span> <span class="nf">get_tasks</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;tasks&#39;</span><span class="p">:</span> <span class="nb">map</span><span class="p">(</span><span class="n">make_public_task</span><span class="p">,</span> <span class="n">tasks</span><span class="p">)})</span>
</span></code></pre></td></tr></table></div></figure>


<p>测试结果如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span>
</span><span class='line'><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">406</span>
</span><span class='line'><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">0.9</span><span class="o">.</span><span class="mi">6</span> <span class="n">Python</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">8</span>
</span><span class='line'><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mo">03</span> <span class="n">Dec</span> <span class="mi">2014</span> <span class="mi">09</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mi">12</span> <span class="n">GMT</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;tasks&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;Milk, Cheese, Pizza, Fruit, Tylenol&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;done&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Buy groceries&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;uri&quot;</span><span class="p">:</span> <span class="s">&quot;http://127.0.0.1:5000/todo/api/v1.0/tasks/1&quot;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;Need to find a good Python tutorial on the web&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;done&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Learn Python&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;uri&quot;</span><span class="p">:</span> <span class="s">&quot;http://127.0.0.1:5000/todo/api/v1.0/tasks/2&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">]</span>
</span><span class='line'><span class="p">}</span><span class="o">%</span>
</span></code></pre></td></tr></table></div></figure>


<h3>加密RESTful网络接口</h3>

<p>好了，我们的RESTful接口搭建完毕了，但是由于接口对所有人都是开放的，为了考虑安全因素，我们会采用简单加密。   <br/>
首先安装flask-httpauth模块:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="err">$</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">flask</span><span class="o">-</span><span class="n">httpauth</span>
</span></code></pre></td></tr></table></div></figure>


<p>而后添加以下代码：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="kn">from</span> <span class="nn">flask.ext.httpauth</span> <span class="kn">import</span> <span class="n">HTTPBasicAuth</span>
</span><span class='line'><span class="n">auth</span> <span class="o">=</span> <span class="n">HTTPBasicAuth</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@auth.get_password</span>
</span><span class='line'><span class="k">def</span> <span class="nf">get_password</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">username</span> <span class="o">==</span> <span class="s">&#39;miguel&#39;</span><span class="p">:</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="k">return</span> <span class="bp">None</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@auth.error_handler</span>
</span><span class='line'><span class="k">def</span> <span class="nf">unauthorized</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">make_response</span><span class="p">(</span><span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;error&#39;</span><span class="p">:</span> <span class="s">&#39;Unauthorized access&#39;</span><span class="p">}),</span> <span class="mi">401</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>加密路由实现如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/todo/api/v1.0/tasks&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
</span><span class='line'><span class="nd">@auth.login_required</span>
</span><span class='line'><span class="k">def</span> <span class="nf">get_tasks</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;tasks&#39;</span><span class="p">:</span> <span class="n">tasks</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>测试结果如下, 未通过授权时:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span>
</span><span class='line'><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">401</span> <span class="n">UNAUTHORIZED</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">36</span>
</span><span class='line'><span class="n">WWW</span><span class="o">-</span><span class="n">Authenticate</span><span class="p">:</span> <span class="n">Basic</span> <span class="n">realm</span><span class="o">=</span><span class="s">&quot;Authentication Required&quot;</span>
</span><span class='line'><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">0.9</span><span class="o">.</span><span class="mi">6</span> <span class="n">Python</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">8</span>
</span><span class='line'><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mo">03</span> <span class="n">Dec</span> <span class="mi">2014</span> <span class="mi">09</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mo">02</span> <span class="n">GMT</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;error&quot;</span><span class="p">:</span> <span class="s">&quot;Unauthorized access&quot;</span>
</span><span class='line'><span class="p">}</span><span class="o">%</span>
</span></code></pre></td></tr></table></div></figure>


<p>通过授权时:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">u</span> <span class="n">miguel</span><span class="p">:</span><span class="n">python</span> <span class="o">-</span><span class="n">i</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span>
</span><span class='line'><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">406</span>
</span><span class='line'><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">0.9</span><span class="o">.</span><span class="mi">6</span> <span class="n">Python</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">8</span>
</span><span class='line'><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mo">03</span> <span class="n">Dec</span> <span class="mi">2014</span> <span class="mi">09</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">24</span> <span class="n">GMT</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;tasks&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;Milk, Cheese, Pizza, Fruit, Tylenol&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;done&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Buy groceries&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;uri&quot;</span><span class="p">:</span> <span class="s">&quot;http://localhost:5000/todo/api/v1.0/tasks/1&quot;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'><span class="o">.....</span>
</span></code></pre></td></tr></table></div></figure>


<p>我们可以把出错时返回的错误号从401改变为403,这样返回的就是forbidden错误。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/03/enable-timestamp-in-new-octopress-theme/">Enable Timestamp in New Octopress Theme</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-03T10:40:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>10:40 am</span></time>
        
         | <a href="/blog/2014/12/03/enable-timestamp-in-new-octopress-theme/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>After installing the flattern theme of octopress, I found the post date missed. Following is the steps for catching it back.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake install['flatten']
</span></code></pre></td></tr></table></div></figure>


<p>Modify the following file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat .themes/flatten/source/_includes/post/date.html
</span></code></pre></td></tr></table></div></figure>


<p>Then in <code>.themes/flatten/source/_layouts/post.html</code>, modify the following lines:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;p class="meta"&gt;
</span><span class='line'>//.....//
</span><span class='line'>&lt;/p&gt;
</span></code></pre></td></tr></table></div></figure>


<p>After modification, you would see the time is displayed before the comment numbers.  <br/>
Notice, the modification is not visible in codeblocks because the embedded symbol could not be resolved thus will cause build error, so the detailed code would be only fetched from my github repository but remains blank codeblocks here in this article.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/01/virtual-node-environment-for-phonegap-development/">Virtual Node Environment for PhoneGap Development</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-01T12:18:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2014</span></span> <span class='time'>12:18 pm</span></time>
        
         | <a href="/blog/2014/12/01/virtual-node-environment-for-phonegap-development/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Background</h3>

<p>I met some tutorials which were write one or two years ago, while at that time the corresponding plugins are in an old version, so I need to find a whole &ldquo;virtual&rdquo; environment for developing these tutorials.</p>

<h3>Install Nodeenv</h3>

<p>&ldquo;Node.js virtual environment builder&rdquo; &mdash; is the introduction for Nodeenv.  <br/>
Install it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ virtualenv2 venv
</span><span class='line'>source venv/bin/activate
</span><span class='line'>(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ 
</span><span class='line'>$ pip install nodeenv
</span><span class='line'>(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ which nodeenv
</span><span class='line'>/home/Trusty/code/30days/PhoneGap2.9.0/venv/bin/nodeenv
</span><span class='line'>(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ nodeenv --version
</span><span class='line'>0.11.1
</span></code></pre></td></tr></table></div></figure>


<p>With this nodeenv we could setup all kinds of the dev environments.</p>

<h3>Wrok With Nodeenv</h3>

<p>Install the node.js first, this may cause long time:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ nodeenv nodeenv 
</span><span class='line'> * Install node.js (0.10.33 
</span><span class='line'>[Trusty@~/code/30days/PhoneGap2.9.0]$ du -hs *
</span><span class='line'>170M    nodeenv
</span><span class='line'>8.9M    venv
</span><span class='line'>(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ ls
</span><span class='line'>nodeenv  npm-debug.log  venv
</span><span class='line'>(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ . nodeenv/bin/activate 
</span><span class='line'>(nodeenv)(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ which npm
</span><span class='line'>/home/Trusty/code/30days/PhoneGap2.9.0/nodeenv/bin/npm
</span><span class='line'>(nodeenv)(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ which node
</span><span class='line'>/home/Trusty/code/30days/PhoneGap2.9.0/nodeenv/bin/node
</span></code></pre></td></tr></table></div></figure>


<p>Now we could install the specified version of PhoneGap, first we should find the specified versions:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ npm view phonegap
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>This will returns the specified versions of all of the phonegap.   <br/>
Choose whichever you want.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ npm install phonegap@2.9.0-rc1-0.12.2
</span></code></pre></td></tr></table></div></figure>


<p>This will install the phonegap around Dec,2013, which should be fit well to the tutorial.      <br/>
Then re-activate , or manually modify the PATH as:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ export PATH=/home/Trusty/code/30days/PhoneGap2.9.0/nodeenv/bin:$PATH
</span><span class='line'>(nodeenv)(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ phonegap -v
</span><span class='line'>2.9.0-rc1-0.12.2
</span></code></pre></td></tr></table></div></figure>


<h3>Run Tutorial</h3>

<h4>Create Apps</h4>

<p>Create the app via following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(nodeenv)(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ npm config set https_proxy http://1xx.x.xx.xxx:2xxxx
</span><span class='line'>(nodeenv)(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ npm config set proxy http://1xx.x.xx.xxx:2xxx
</span><span class='line'>$ phonegap create audero-feed-reade com.audero.free.utility.auderofeedreader "Audero Feed Reader"
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/28/setup-dev-env-on-do/">Setup Dev Env on DO</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-28T10:14:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:14 am</span></time>
        
         | <a href="/blog/2014/11/28/setup-dev-env-on-do/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Prepare</h3>

<p>Install the following packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install python-virtualenv
</span><span class='line'>$ sudo apt-get install ruby-full ruby
</span><span class='line'>$ sudo gem install rhc
</span></code></pre></td></tr></table></div></figure>


<p>Since DO&rsquo;s network is pretty good, so it&rsquo;s very swift for developing on it.</p>

<h3>TextBlob</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ virtualenv venv --python=python2.7
</span><span class='line'>$ . venv/bin/activate
</span><span class='line'>$ pip install textblob
</span><span class='line'>$ python -m textblob.download_corpora
</span><span class='line'>$ pip install flask
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/27/apache-parameter-adjust/">Apache Parameter Adjust</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-27T21:46:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>9:46 pm</span></time>
        
         | <a href="/blog/2014/11/27/apache-parameter-adjust/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Background</h3>

<p>A wordpress machine runs on DigitalOcean often sudden the mysqld database lost error.</p>

<h3>Analyze</h3>

<p>This is because the memory is exhausted in DO, so first I enable the swap for machine. This method solved the problem for a long time.   <br/>
But later it seems the robots who sent the rubbish comments continue to attack the system, causing the mysqld halt again, this time, I modified the apahce2&rsquo;s works:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ grep -Ri MaxRequestWorkers /etc/apache2/
</span><span class='line'>/etc/apache2/mods-enabled/mpm_prefork.conf:# MaxRequestWorkers: maximum number of server processes allowed to start
</span><span class='line'>/etc/apache2/mods-enabled/mpm_prefork.conf:     MaxRequestWorkers         150
</span><span class='line'>/etc/apache2/mods-available/mpm_prefork.conf:# MaxRequestWorkers: maximum number of server processes allowed to start
</span><span class='line'>/etc/apache2/mods-available/mpm_prefork.conf:   MaxRequestWorkers         150
</span><span class='line'>$ vim /etc/apache2/mods-available/mpm_prefork.conf
</span><span class='line'>$ vim /etc/apache2/mods-available/mpm_worker.conf
</span><span class='line'>$ vim /etc/apache2/mods-available/mpm_itk.conf
</span><span class='line'>$ vim /etc/apache2/mods-available/mpm_event.conf
</span><span class='line'>$ service apache2 restart
</span></code></pre></td></tr></table></div></figure>


<p>The vim command is changing the MaxRequestWorkers from 150 to 10, hope this will solve the problem.</p>

<h3>TBD</h3>

<p>If the mysql runs into death again, then we must limit its connection towards apache2.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/27/tips-on-30days30skills-4/">Tips on 30Days30Skills(4)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-27T16:49:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:49 pm</span></time>
        
         | <a href="/blog/2014/11/27/tips-on-30days30skills-4/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Day 9 - TextBlob</h3>

<p>Installation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Yosemite:TextBlob Trusty$ mkdir myapp
</span><span class='line'>Yosemite:TextBlob Trusty$ cd myapp/
</span><span class='line'>Yosemite:myapp Trusty$ virtualenv venv --python=python2.7
</span><span class='line'>Running virtualenv with interpreter /usr/bin/python2.7
</span><span class='line'>New python executable in venv/bin/python
</span><span class='line'>Installing setuptools, pip...done.
</span><span class='line'>Yosemite:myapp Trusty$ . venv/bin/activate
</span><span class='line'>(venv)Yosemite:myapp Trusty$ pip install textblob
</span><span class='line'>$ pip install -U textblob
</span><span class='line'>$ python -m textblob.download_corpora
</span></code></pre></td></tr></table></div></figure>


<p>After adding the textblob, create flask:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pip install flask
</span><span class='line'>$ vim app.py
</span><span class='line'>$ mkdir templates
</span><span class='line'>$ touch templates/index.html
</span></code></pre></td></tr></table></div></figure>


<p>Modify the app.py for listening on all of the ip addresses:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>if __name__ == "__main__":
</span><span class='line'>    app.run(host='0.0.0.0',debug=True)
</span></code></pre></td></tr></table></div></figure>


<p>Then <code>python app.py</code> could get you to the website and run your apps.</p>

<p>The analyze code is listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>        $.get('/api/v1/sentiment/'+input,function(result){
</span><span class='line'>
</span><span class='line'>            if(result.polarity &lt; 0.0){
</span><span class='line'>
</span><span class='line'>                $('#result').addClass("alert alert-danger")   .text(input);
</span><span class='line'>            } else if( result.polarity &gt;= 0.0 && result.polarity &lt;= 0.5){
</span><span class='line'>                $('#result').addClass("alert alert-warning").text(input);
</span><span class='line'>            }else{
</span><span class='line'>                $('#result').addClass("alert alert-success").text(input);
</span><span class='line'>            }
</span><span class='line'>
</span><span class='line'>        })
</span></code></pre></td></tr></table></div></figure>


<p>You could easily update the apps to your rhc.</p>

<h3>Day 10 - PhoneGap</h3>

<h4>Android</h4>

<p>Install steps:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo npm install -g phonegap
</span><span class='line'>$ sudo npm install -g cordova
</span><span class='line'>$ phonegap create reader --id io.reader --name Reader30
</span><span class='line'>$ sudo android
</span></code></pre></td></tr></table></div></figure>


<p><code>sudo android</code> is for installing the android SDK, we have to select revision 19 for phonegap currently support 19.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cordova platform add android
</span><span class='line'>$ sudo pacman -S apache-ant
</span><span class='line'>$ phonegap run android
</span></code></pre></td></tr></table></div></figure>


<p>Now you could see a screen which displayed &ldquo;Device Ready&rdquo;.   <br/>
Install some plugins for accessing the equipment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cordova plugin add org.apache.cordova.geolocation
</span><span class='line'>cordova plugin add org.apache.cordova.dialogs
</span></code></pre></td></tr></table></div></figure>


<p>Edit steps:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim www/index.html     # Add front page
</span><span class='line'>$ rm -f www/js/index.js
</span><span class='line'>$ cp -r ../example/30technologies30days-mobile-app/www/js/vendor ./www/js
</span><span class='line'>$ cp -r ../example/30technologies30days-mobile-app/www/css/vendor ./www/css
</span><span class='line'>$ vim www/js/app.js
</span><span class='line'>$ vim www/index.html  # Add form
</span><span class='line'>$ vim www/js/app.js
</span></code></pre></td></tr></table></div></figure>


<p>Now run <code>phonegap run android</code> you could see the app runs on your android emulator.</p>

<h4>IOS</h4>

<p>In ios, we could use following command for installing the ios specified resources.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(venv)Yosemite:PhoneGap Trusty$ cd reader/
</span><span class='line'>(venv)Yosemite:reader Trusty$ cordova platform add ios
</span><span class='line'>$ sudo npm install -g ios-deploy
</span><span class='line'>$ sudo npm install -g ios-sim
</span><span class='line'>$ phonegap run ios
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/27/tips-on-30days30skills-3/">Tips on 30Days30Skills(3)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-27T15:46:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>3:46 pm</span></time>
        
         | <a href="/blog/2014/11/27/tips-on-30days30skills-3/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Day 7 - GruntJS(2)</h3>

<h4>GruntJS Markdown Plugin</h4>

<p>First download the source file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/shekhargulati/day7-gruntjs-livereload-example.git
</span><span class='line'>$ cd day7-gruntjs-livereload-example
</span><span class='line'>$ sudo npm install -g grunt
</span><span class='line'>$ grunt $ cd day7-gruntjs-livereload-example
</span><span class='line'>$ sudo npm install -g grunt
</span><span class='line'>$ npm init
</span><span class='line'>$ npm install grunt
</span><span class='line'>$ sudo npm install grunt-contrib-uglify grunt-markdown grunt-contrib-watch -g
</span><span class='line'>$ grunt
</span><span class='line'>&gt;&gt; Local Npm module "grunt-contrib-watch" not found. Is it installed?
</span><span class='line'>
</span><span class='line'>Running "uglify:build" (uglify) task
</span><span class='line'>&gt;&gt; 1 file created.
</span><span class='line'>
</span><span class='line'>Running "markdown:all" (markdown) task
</span><span class='line'>File "docs/html/day1.html" created.
</span><span class='line'>
</span><span class='line'>Done, without errors.
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div id="main" class="container"&gt;
</span><span class='line'>  &lt;%=content%&gt;
</span><span class='line'>&lt;/div&gt;
</span></code></pre></td></tr></table></div></figure>


<p>After grunt, the generated html file is listed as :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div id="main" class="container"&gt;
</span><span class='line'>  &lt;p&gt;Today is the fourth day of my challenge to learn 30 technologies in 30 days. So far I am enjoying it and getting good response from fellow developers. I am more than motivated to do it for full 30 days. In this blog, I will cover how we can very easily build b
</span><span class='line'>.....
</span><span class='line'>&lt;/div&gt;
</span></code></pre></td></tr></table></div></figure>


<h4>grunt-contrib-watch</h4>

<p>Following command will install grunt-contrib-watch and update the package.json:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ npm install grunt-contrib-watch --save-dev
</span></code></pre></td></tr></table></div></figure>


<p>Add following code into grunt&rsquo;s initConfig method, these code ensure that if file changes, grunt will run uglify and markdown task:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>watch :{
</span><span class='line'>    scripts :{
</span><span class='line'>      files : ['js/app.js','*.md','css/*.css'],
</span><span class='line'>      tasks : ['uglify','markdown']
</span><span class='line'>    }
</span><span class='line'>  }
</span></code></pre></td></tr></table></div></figure>


<p>Add following line to Gruntfile for watch task:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grunt.loadNpmTasks('grunt-contrib-watch');
</span></code></pre></td></tr></table></div></figure>


<p>Now run <code>grunt watch</code>, then modify some files, like <code>app.js</code> under <code>js</code> folder, then detect if the generated files are modified or not.</p>

<p>Now run <code>grunt watch</code>, then modify some files, like <code>app.js</code> under <code>js</code> folder, then detect if the generated files are modified or not.</p>

<h4>livereload</h4>

<p>Edit the watch&rsquo;s configuration, enable the livereload, this will enable the service in 35729 port. Or you could modify the service port by yourself.  <br/>
Add content into the templates/index.html:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;script src="http://localhost:9090/livereload.js"&gt;&lt;/script&gt;
</span></code></pre></td></tr></table></div></figure>


<p>
Now every single modification will let you see the final result immediately.</p>

<h3>Day 8 Harp.JS</h3>

<p>Install the Harp.JS via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo npm install -g harp
</span></code></pre></td></tr></table></div></figure>


<p>Then initiate the blog via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ harp init blog
</span></code></pre></td></tr></table></div></figure>


<p>This step won&rsquo;t be continue because the program will complain that <code>Template not found</code>.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/22">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/20">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/11/01/moving-cloudstack-from-vm-to-physical-node/">Moving CloudStack From VM to Physical Node</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/29/thinking-in-vr/">Thinking in VR</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/29/use-autohotkey-together-with-synergy/">Use AutoHotKey Together With Synergy</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/25/openstack-libertyan-zhuang-1/">OpenStack Liberty安装(1)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/23/tips-on-ceph-on-docker/">Tips on Ceph on Docker</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
