
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="ArchLinux Installation First we download the iso from the archlinux.org, then using iso to boot. Partition it into many disks as you like. Now begin &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/32">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.useso.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/27/basic-archlinux-setting-i386/">Basic ArchLinux Setting(i386)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-27T19:10:00+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>7:10 pm</span></time>
        
         | <a href="/blog/2014/03/27/basic-archlinux-setting-i386/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>ArchLinux Installation</h3>

<p>First we download the iso from the archlinux.org, then using iso to boot. Partition it into many disks as you like.<br /></p>

<p>Now begin to install:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mount /dev/sda2 /mnt
</span><span class='line'>$ swapon /dev/sda1
</span><span class='line'>$ pacstrap /mnt base
</span><span class='line'>$ genfstab -p /mnt &gt;&gt; /mnt/etc/fstab
</span></code></pre></td></tr></table></div></figure>


<p>Chroot into the newly installed system:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ arch-chroot /mnt
</span><span class='line'>$ ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</span><span class='line'>$ vi /etc/locale.gen
</span><span class='line'># enable en_US related
</span><span class='line'>$ locale-gen
</span><span class='line'>$ vi /etc/mkinitcpio.conf
</span><span class='line'># we can remain the default, notice if you use usb, enable usb related. 
</span><span class='line'>$ mkinitcpio -p linux
</span><span class='line'>$ passwd root
</span></code></pre></td></tr></table></div></figure>


<p>Grub install and configure:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pacman -S grub
</span><span class='line'>$ grub-install --target=i386-pc --recheck --debug /dev/sda
</span><span class='line'>$ grub-install --target=i386-pc --recheck --debug /dev/sda
</span></code></pre></td></tr></table></div></figure>


<p>Install vim:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pacman -S vim
</span></code></pre></td></tr></table></div></figure>


<p>Install dhcpcd:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pacman -S dhcpcd
</span><span class='line'>$ systemctl enable dhcpcd@enp0s3
</span><span class='line'>$ pacman -S net-tools # for using ifconfig
</span></code></pre></td></tr></table></div></figure>


<p>Install openssh:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pacman -S openssh
</span><span class='line'>$ systemctl start sshd
</span><span class='line'>$ systemcrl enable sshd.service
</span></code></pre></td></tr></table></div></figure>


<h3>Build rsim3 on ArchLinux</h3>

<p>First download the package from rsim3.<br />
Install the base-devel:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pacman -S base-devel
</span></code></pre></td></tr></table></div></figure>


<p>Install boost, boost-libs, libpcap, cppunit:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pacman -S boost boost-libs libpcap cppunit
</span></code></pre></td></tr></table></div></figure>


<p>Then you can enjoy the compiling and get the result.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/21/use-redis-for-inter-communication/">Use Redis for Inter-Communication</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-21T15:55:00+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2014</span></span> <span class='time'>3:55 pm</span></time>
        
         | <a href="/blog/2014/03/21/use-redis-for-inter-communication/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Play With Redis</h3>

<p>On ArchLinux, we install redis via:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S redis</span></code></pre></td></tr></table></div></figure>


<p>Enalbe and start the redis.service:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo systemctl enable redis.service
</span><span class='line'>$ sudo systemctl start redis.service
</span><span class='line'>$ ps -ef | grep redis
</span><span class='line'>redis     7609     1  0 16:03 ?        00:00:00 /usr/bin/redis-server 127.0.0.1:6379</span></code></pre></td></tr></table></div></figure>


<p>Play with redis:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@DashArch queue]$ redis-cli 
</span><span class='line'>127.0.0.1:6379&gt; set name leezk
</span><span class='line'>OK
</span><span class='line'>127.0.0.1:6379&gt; get name
</span><span class='line'>"leezk"
</span><span class='line'>127.0.0.1:6379&gt; del name
</span><span class='line'>(integer) 1
</span><span class='line'>127.0.0.1:6379&gt; exists name
</span><span class='line'>(integer) 0
</span><span class='line'>127.0.0.1:6379&gt; exit</span></code></pre></td></tr></table></div></figure>


<h3>RQ: Simple Job Queue For Python</h3>

<p>Install redis and rq:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pip2 install redis
</span><span class='line'>$ sudo pip2 install rq</span></code></pre></td></tr></table></div></figure>


<p>Install requests for debugging(Not related with RQ and Redis):<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pip2 install requests</span></code></pre></td></tr></table></div></figure>


<p>Use following file for RedisQueue:<br /></p>

<figure class='code'><figcaption><span>RedisQueue.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="kn">import</span> <span class="nn">redis</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">RedisQueue</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;Simple Queue with Redis Backend&quot;&quot;&quot;</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s">&#39;queue&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">redis_kwargs</span><span class="p">):</span>
</span><span class='line'>        <span class="sd">&quot;&quot;&quot;The default connection parameters are: host=&#39;localhost&#39;, port=6379, db=0&quot;&quot;&quot;</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">__db</span><span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span><span class="o">**</span><span class="n">redis_kwargs</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">qsize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="sd">&quot;&quot;&quot;Return the approximate size of the queue.&quot;&quot;&quot;</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__db</span><span class="o">.</span><span class="n">llen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="sd">&quot;&quot;&quot;Return True if the queue is empty, False otherwise.&quot;&quot;&quot;</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">qsize</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</span><span class='line'>        <span class="sd">&quot;&quot;&quot;Put item into the queue.&quot;&quot;&quot;</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">__db</span><span class="o">.</span><span class="n">rpush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class='line'>        <span class="sd">&quot;&quot;&quot;Remove and return an item from the queue. </span>
</span><span class='line'>
</span><span class='line'><span class="sd">        If optional args block is true and timeout is None (the default), block</span>
</span><span class='line'><span class="sd">        if necessary until an item is available.&quot;&quot;&quot;</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
</span><span class='line'>            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__db</span><span class="o">.</span><span class="n">blpop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__db</span><span class="o">.</span><span class="n">lpop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="n">item</span><span class="p">:</span>
</span><span class='line'>            <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">item</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_nowait</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="sd">&quot;&quot;&quot;Equivalent to get(False).&quot;&quot;&quot;</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Testing the RedisQueue with following:<br />
Put something into the RedisQueue:<br /></p>

<figure class='code'><figcaption><span>RedisQueue.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">RedisQueue</span> <span class="kn">import</span> <span class="n">RedisQueue</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">q</span> <span class="o">=</span> <span class="n">RedisQueue</span><span class="p">(</span><span class="s">&#39;test&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">&#39;hello World!&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Fetch something from the RedisQueue:<br /></p>

<figure class='code'><figcaption><span>RedisQueue.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">RedisQueue</span> <span class="kn">import</span> <span class="n">RedisQueue</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">q</span> <span class="o">=</span> <span class="n">RedisQueue</span><span class="p">(</span><span class="s">&#39;test&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span class='line'><span class="s">&#39;hello World!&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Rewrite Dictionary Program</h3>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/20/re-compile-kernel-for-supporting-512m-memory-for-raspberrypi-in-qemu/">Re-compile Kernel for Supporting 512M Memory for RaspberryPI in Qemu</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-20T09:43:00+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>9:43 am</span></time>
        
         | <a href="/blog/2014/03/20/re-compile-kernel-for-supporting-512m-memory-for-raspberrypi-in-qemu/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Cross Compiler Prepration</h3>

<p>Get the cross-compiler from github:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@XXXyyy tools]$ pwd
</span><span class='line'>/media/y/raspberryPI/tools
</span><span class='line'>[Trusty@XXXyyy tools]$ git clone git://github.com/raspberrypi/tools.git
</span></code></pre></td></tr></table></div></figure>


<p>Add the cross-compiler to system path:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export PATH="/media/y/raspberryPI/tools/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian/bin:$PATH"
</span></code></pre></td></tr></table></div></figure>


<p>Now input &ldquo;arm-linux-g&rdquo; + tab you will see the cross-compiler is ready.<br /></p>

<h3>Prepare the kernel</h3>

<p>Get the kernel source from github:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://github.com/raspberrypi/linux.git
</span></code></pre></td></tr></table></div></figure>


<p>Now we need to get the patches for supporting the raspberryPI, Torlus has done the patches which could also be downloaded from github:<br /></p>

<p>Now we need to configure the kernel:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd linux
</span><span class='line'>make ARCH=arm versatile_defconfig
</span></code></pre></td></tr></table></div></figure>


<p>NO, I MADE A MISTAKE, IT SHOULDN&rsquo;T COMPILE KERNEL, SHOULD COMPILE QEMU!!!</p>

<h3>Compile qemu</h3>

<p>Get the modified qemu branch from github:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://github.com/Torlus/qemu.git
</span></code></pre></td></tr></table></div></figure>


<p>Switch to &lsquo;rpi&rsquo; branch:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git fetch origin
</span><span class='line'>git branch -v -a # List the available branches.
</span><span class='line'>git checkout -b raspberry origin/rpi  # Checkout the origin/rpi to local raspberry
</span><span class='line'>git fetch
</span><span class='line'>git checkout raspberry
</span></code></pre></td></tr></table></div></figure>


<p>Begin to configure qemu, notice we have to use python2 for configuring the qemu:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>workon venv2
</span><span class='line'>./configure --help
</span><span class='line'>./configure --target-list="arm-softmmu arm-linux-user" --enable-sdl 
</span></code></pre></td></tr></table></div></figure>


<p>Now begin to make the qemu, use -j8 for speeding up, adjust the number according to your own machine:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>make -j8
</span></code></pre></td></tr></table></div></figure>


<p>Now under the following directory you will get the qemu-system-arm:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pwd
</span><span class='line'>/media/y/raspberryPI/qemu/arm-softmmu
</span></code></pre></td></tr></table></div></figure>


<p>Get the kernel.img from the SD image. <br /></p>

<h3>Use the compiled qemu for running</h3>

<p>We have to change the scripts for running the qemu:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/media/y/raspberryPI/qemu/arm-softmmu/qemu-system-arm -net nic,macaddr=$macaddr -net user -kernel kernel.img -cpu arm1176 -m 512 -M raspi -no-reboot -serial stdio -append "rw earlyprintk loglevel=8 panic=120 keep_bootcon rootwait dma.dmachans=0x7f35 bcm2708_fb.fbwidth=1024 bcm2708_fb.fbheight=768 bcm2708.boardrev=0xf bcm2708.serial=0xcad0eedf smsc95xx.macaddr=B8:27:EB:D0:EE:DF sdhci-bcm2708.emmc_clock_freq=100000000 vc_mem.mem_base=0x1c000000 vc_mem.mem_size=0x20000000  dwc_otg.lpm_enable=0 kgdboc=ttyAMA0,115200 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline rootwait" -sd 2014-01-07-wheezy-raspbian.img  -device usb-kbd -device usb-mouse -usbdevice net 
</span></code></pre></td></tr></table></div></figure>


<p>Now we can run the raspberryPI in QEMU with 512MB memory, but, the network is still unavailable.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/18/building-qemu-based-raspberrypi-development-environment/">Building Qemu Based RaspberryPI Development Environment</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-18T16:00:00+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:00 pm</span></time>
        
         | <a href="/blog/2014/03/18/building-qemu-based-raspberrypi-development-environment/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>First download the latest image from <a href="http://www.raspberrypi.org/downloads">http://www.raspberrypi.org/downloads</a>, mine is Wheezy. <br />
And we also have to download the qemu-compatible kernel from following address:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget http://xecdesign.com/downloads/linux-qemu/kernel-qemu
</span></code></pre></td></tr></table></div></figure>


<p>Change the img file according to <a href="http://localhost/blog/2013/09/04/qemu-for-raspberrypi/">http://localhost/blog/2013/09/04/qemu-for-raspberrypi/</a>, follow this tutorial, you have to change the img file size and its content, but we have to do some modifications. <br />
The run-qemu file is changed to following: <br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/bin/bash
</span><span class='line'>USERID=$(whoami)
</span><span class='line'>
</span><span class='line'># Get name of newly created TAP device; see https://bbs.archlinux.org/viewtopic.php?pid=1285079#p1285079
</span><span class='line'>precreationg=$(/usr/bin/ip tuntap list | /usr/bin/cut -d: -f1 | /usr/bin/sort)
</span><span class='line'>sudo /usr/bin/ip tuntap add user $USERID mode tap
</span><span class='line'>postcreation=$(/usr/bin/ip tuntap list | /usr/bin/cut -d: -f1 | /usr/bin/sort)
</span><span class='line'>IFACE=$(comm -13 &lt;(echo "$precreationg") &lt;(echo "$postcreation"))
</span><span class='line'>
</span><span class='line'># This line creates a random mac address. The downside is the dhcp server will assign a different ip each time
</span><span class='line'>printf -v macaddr "52:54:%02x:%02x:%02x:%02x" $(( $RANDOM & 0xff)) $(( $RANDOM & 0xff )) $(( $RANDOM & 0xff)) $(( $RANDOM & 0xff ))
</span><span class='line'># Instead, uncomment and edit this line to set an static mac address. The benefit is that the dhcp server will assign the same ip.
</span><span class='line'># macaddr='52:54:be:36:42:a9'
</span><span class='line'>    macaddr = '52:54:79:3c:80:c0'
</span><span class='line'> 
</span><span class='line'>qemu-system-arm -net nic,macaddr=$macaddr -net tap,ifname="$IFACE" -append "root=/dev/sda2 panic=1 rootfstype=ext4 rw" $*
</span><span class='line'>  
</span><span class='line'>sudo ip link set dev $IFACE down &&gt; /dev/null
</span><span class='line'>sudo ip tuntap del $IFACE mode tap &&gt; /dev/null
</span></code></pre></td></tr></table></div></figure>


<p>In router, we add the static address for mac corresponding to 10.0.0.168, you can alter it according to your habit. <br /></p>

<p>Now we want to disable the X at every startup and use vnc instead. <br />
And we can overlocking the raspberryPI to 1000MHZ, this will greatly improve the performance.<br /></p>

<p>Enable the vncserver:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ apt-get install tightvncserver vim 
</span></code></pre></td></tr></table></div></figure>


<p>Now startup the vncserver and use vncviewer to view the desktop:<br /></p>

<p><img src="/images/Screenshot-QEMU.png" alt="/images/Screenshot-QEMU.png" /></p>

<p>No, the correct method is listed as: <br /></p>

<figure class='code'><figcaption><span>startvnc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>cat /eroot@raspberrypi:~# cat /etc/init.d/startvnc
</span><span class='line'><span class="c">#!/bin/sh -e</span>
</span><span class='line'><span class="c">### BEGIN INIT INFO</span>
</span><span class='line'><span class="c"># Provides:          vncserver</span>
</span><span class='line'><span class="c"># Required-Start:    networking</span>
</span><span class='line'><span class="c"># Default-Start:     3 4 5</span>
</span><span class='line'><span class="c"># Default-Stop:      0 6</span>
</span><span class='line'><span class="c">### END INIT INFO</span>
</span><span class='line'>
</span><span class='line'><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;$PATH:/usr/X11R6/bin/&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># The Username:Group that will run VNC</span>
</span><span class='line'><span class="nb">export </span><span class="nv">USER</span><span class="o">=</span><span class="s2">&quot;pi&quot;</span>
</span><span class='line'><span class="c">#${RUNAS}</span>
</span><span class='line'>
</span><span class='line'><span class="c"># The display that VNC will use</span>
</span><span class='line'><span class="nv">DISPLAY</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Color depth (between 8 and 32)</span>
</span><span class='line'><span class="nv">DEPTH</span><span class="o">=</span><span class="s2">&quot;16&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># The Desktop geometry to use.</span>
</span><span class='line'><span class="c">#GEOMETRY=&quot;&lt;WIDTH&gt;x&lt;HEIGHT&gt;&quot;</span>
</span><span class='line'><span class="c">#GEOMETRY=&quot;800x600&quot;</span>
</span><span class='line'><span class="c">#GEOMETRY=&quot;1024x768&quot;</span>
</span><span class='line'><span class="nv">GEOMETRY</span><span class="o">=</span><span class="s2">&quot;1280x1024&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># The name that the VNC Desktop will have.</span>
</span><span class='line'><span class="nv">NAME</span><span class="o">=</span><span class="s2">&quot;my-vnc-server&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">&quot;-name ${NAME} -depth ${DEPTH} -geometry ${GEOMETRY} :${DISPLAY}&quot;</span>
</span><span class='line'>
</span><span class='line'>. /lib/lsb/init-functions
</span><span class='line'>
</span><span class='line'><span class="k">case</span> <span class="s2">&quot;$1&quot;</span> in
</span><span class='line'>start<span class="o">)</span>
</span><span class='line'>log_action_begin_msg <span class="s2">&quot;Starting vncserver for user &#39;${USER}&#39; on   localhost:${DISPLAY}&quot;</span>
</span><span class='line'>su <span class="k">${</span><span class="nv">USER</span><span class="k">}</span> -c <span class="s2">&quot;/usr/bin/vncserver ${OPTIONS}&quot;</span>
</span><span class='line'><span class="p">;;</span>
</span><span class='line'>
</span><span class='line'>stop<span class="o">)</span>
</span><span class='line'>log_action_begin_msg <span class="s2">&quot;Stoping vncserver for user &#39;${USER}&#39; on localhost:${DISPLAY}&quot;</span>
</span><span class='line'>su <span class="k">${</span><span class="nv">USER</span><span class="k">}</span> -c <span class="s2">&quot;/usr/bin/vncserver -kill :${DISPLAY}&quot;</span>
</span><span class='line'><span class="p">;;</span>
</span><span class='line'>
</span><span class='line'>restart<span class="o">)</span>
</span><span class='line'><span class="nv">$0</span> stop
</span><span class='line'><span class="nv">$0</span> start
</span><span class='line'><span class="p">;;</span>
</span><span class='line'><span class="k">esac</span>
</span><span class='line'>
</span><span class='line'><span class="nb">exit </span>0
</span></code></pre></td></tr></table></div></figure>


<p>And now we can add this script into /etc/rc.local as:<br /></p>

<figure class='code'><figcaption><span>startvnc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># Start the vncserver here:</span>
</span><span class='line'>/etc/init.d/startvnc start
</span></code></pre></td></tr></table></div></figure>


<p>So everytime we startup the qemu based raspberryPI, we can easily attached to its geometry, and we can easily adapt the resolution.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/18/moving-weather-app-to-bbb/">Moving Weather App to BBB</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-18T13:56:00+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:56 pm</span></time>
        
         | <a href="/blog/2014/03/18/moving-weather-app-to-bbb/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Following is the steps for moving the weather app to BBB(BeagleBone Black)<br /></p>

<h3>Apache Configuration</h3>

<p>Create the site definition file under /etc/apache2/sites-available: <br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cp default nanjing
</span></code></pre></td></tr></table></div></figure>


<p>Edit the nanjing file with the following content:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat nanjing
</span><span class='line'>&lt;VirtualHost *:7778&gt;
</span><span class='line'>  ServerAdmin webmaster@localhost
</span><span class='line'>        ServerName nanjing
</span><span class='line'>        ServerAlias nanjing.weather
</span><span class='line'>
</span><span class='line'>  DocumentRoot /srv/www1
</span><span class='line'>  &lt;Directory /&gt;
</span><span class='line'>      Options FollowSymLinks
</span><span class='line'>      AllowOverride None
</span><span class='line'>  &lt;/Directory&gt;
</span><span class='line'>  &lt;Directory /srv/www1/&gt;
</span><span class='line'>      Options Indexes FollowSymLinks MultiViews
</span><span class='line'>      AllowOverride None
</span><span class='line'>      Order allow,deny
</span><span class='line'>      Allow from all
</span><span class='line'>  &lt;/Directory&gt;
</span><span class='line'>
</span><span class='line'>  ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
</span><span class='line'>  &lt;Directory "/usr/lib/cgi-bin"&gt;
</span><span class='line'>      AllowOverride None
</span><span class='line'>      Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
</span><span class='line'>      Order allow,deny
</span><span class='line'>      Allow from all
</span><span class='line'>  &lt;/Directory&gt;
</span><span class='line'>
</span><span class='line'>  ErrorLog ${APACHE_LOG_DIR}/error.log
</span><span class='line'>
</span><span class='line'>  # Possible values include: debug, info, notice, warn, error, crit,
</span><span class='line'>  # alert, emerg.
</span><span class='line'>  LogLevel warn
</span><span class='line'>
</span><span class='line'>  CustomLog ${APACHE_LOG_DIR}/access.log combined
</span><span class='line'>&lt;/VirtualHost&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Then we have to edit the /etc/apache2/ports.conf file, to add the newly-added site definition file. <br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat ports.conf
</span><span class='line'>NameVirtualHost *:7777
</span><span class='line'>Listen 7777
</span><span class='line'>NameVirtualHost *:7778
</span><span class='line'>Listen 7778
</span><span class='line'>NameVirtualHost *:7779
</span><span class='line'>Listen 7779
</span><span class='line'>NameVirtualHost *:7780
</span><span class='line'>Listen 7780
</span></code></pre></td></tr></table></div></figure>


<p>Now you already could visit the site of <a href="http://Your_Ip_Address:7777">http://Your_Ip_Address:7777</a> for the nanjing weather infos. <br /></p>

<h3>Script Moving</h3>

<p>Be sure following modules has been installed:&lt; br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pip install django pywapi pinyin
</span><span class='line'>$ pip install BeautifulSoup
</span></code></pre></td></tr></table></div></figure>


<p>Add the crontab tasks:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>0 */1 * * * python /root/code/genhtml.py
</span><span class='line'>15 */1 * * * python /root/code/genhtml_bj.py
</span><span class='line'>30 */1 * * * python /root/code/genhtml_changsha.py
</span></code></pre></td></tr></table></div></figure>


<p>Now the script will be run every hour at 0/15/30 minutes, enjoy it. <br />
Notice the timezone should be correctly configured:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$  dpkg-reconfigure tzdata
</span><span class='line'># Choose Asia/Shanghai
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/17/deploy-weather-app-on-raspberrypi/">Deploy Weather APP on RaspberryPI</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-17T20:10:00+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:10 pm</span></time>
        
         | <a href="/blog/2014/03/17/deploy-weather-app-on-raspberrypi/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since I enabled the RaspberryPI and disabled the PogoPlug, I have to move the Weather App on RaspberryPI. <br />
The main difference lies on the python version, on PogoPlug the default python version is python2.7, while on RaspberryPI it&rsquo;s python3.3, thus I have to use the virtualenvironment of Python. <br /></p>

<h3>Setup the virtualenv</h3>

<p>Following is the steps for setting up the virtual environment for python2.7 on ArchLinux:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir ~/pyves
</span><span class='line'>$ cat &gt;~/.virtualenvrc &lt;&lt;EOF
</span><span class='line'>export WORKON_HOME="$HOME/pyves"
</span><span class='line'>export PROJECT_HOME="$HOME/pyves"
</span><span class='line'>source /usr/bin/virtualenvwrapper.sh
</span><span class='line'>EOF
</span><span class='line'>$ source  ~/.virtualenvrc
</span><span class='line'>$ cat &gt;&gt;~/.bashrc &lt;&lt;EOF
</span><span class='line'>source $HOME/.virtualenvrc
</span><span class='line'>EOF
</span><span class='line'>$ mkvirtualenv --python=/usr/bin/python2.7 v27
</span><span class='line'>$ workon v27
</span><span class='line'>$ pip install pywapi django sqlite3
</span></code></pre></td></tr></table></div></figure>


<h3>Deployment Python Script</h3>

<p>Copy the script to some directory, mine is under /root/code/weather.<br />
If we want cron to call the virtual environment, we have to create a script and in the script to call the python script.<br /></p>

<figure class='code'><figcaption><span>NJ.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="c"># Export everything.</span>
</span><span class='line'><span class="nb">source</span> /root/.bashrc
</span><span class='line'><span class="c"># Change to the virtual environment</span>
</span><span class='line'>workon v27
</span><span class='line'><span class="c"># Call python</span>
</span><span class='line'>python /root/code/weather/genhtml.py
</span></code></pre></td></tr></table></div></figure>


<p>Now we add this script to crontab, at every whole point, each hour it will run once. <br /></p>

<figure class='code'><figcaption><span>NJ.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>crontab -e
</span><span class='line'><span class="m">0</span> */1 * * * /root/code/weather/NJ.sh
</span><span class='line'><span class="m">15</span> */1 * * * /root/code/weather/BJ.sh
</span><span class='line'><span class="m">30</span> */1 * * * /root/code/weather/CS.sh
</span></code></pre></td></tr></table></div></figure>


<p>Now at every 0/15/30, our cron job will be run, and retrieve the data generate the flot image for displaying.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/17/mirageting-from-asp-to-wordpress/">Miragating From ASP to Wordpress(2)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-17T16:02:00+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:02 pm</span></time>
        
         | <a href="/blog/2014/03/17/mirageting-from-asp-to-wordpress/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recent days I am doing a data migration from asp website to WordPress, Following is how-to. <br /></p>

<h3>Database</h3>

<p>First we have to download the whole website content from the server, in my situation, the website contains a database called &ldquo;xxxx.mdb&rdquo;, I downloaded this database and renamed its name to &ldquo;origin.mdb&rdquo;<br />
We can use Microsoft Access for opening this database file, and from the left side panel we can see all of the tables. <br />
We know the about/news1/news2/news3/news4 table which contains the actual webpages content. <br />
We can see the picture of news1 which displayed as following: <br />
<img src="/images/tablesInAccess.jpg" alt="/images/tablesInAccess.jpg" /></p>

<h3>CSV Preparation</h3>

<p>In a Ubuntu machine, we install mdbtools via following command:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install mdbtools
</span></code></pre></td></tr></table></div></figure>


<p>Export the specified tables from the mdb file: <br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mdb-export origin.mdb news &gt; news.csv
</span></code></pre></td></tr></table></div></figure>


<p>The CSV file is seperated via semicolon, just linke following:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat news.csv
</span><span class='line'>id,title,entitle,url,body,enbody,zz,hit,data,ssfl,img,ly,enly,color,encolor,tuijian,px_id,pass,kin
</span><span class='line'>58,"关于海外游学",,,"&lt;DIV&gt;&lt;B&gt;&lt;FONT size=2 face=Arial&gt;关于游学&lt;/FONT&gt;&lt;/B&gt;&lt;/DIV&gt;
</span><span class='line'>&lt;DIV&gt;&lt;FONT size=2&gt;&lt;FONT face=Arial&gt;&lt;STRONG&gt;&lt;/STRONG&gt;&lt;B&gt;&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&n
</span><span class='line'>............
</span></code></pre></td></tr></table></div></figure>


<p>Now the news.csv contains all of the content which contains in the news table. <br /></p>

<h3>WordPress Plugins Installation</h3>

<p>Install the WP Ultimate CSV Importer for importing the csv into the WordPress:<br />
This Plug-ins is fairly frendly, we simply upload the csv onto the plug-in, the plugin will analyse the csv&rsquo;s content,and begin to mapping the database fields. <br />
<img src="/images/csvimport.jpg" alt="/images/csvimport.jpg" /></p>

<p>Notice: You can import the csv into posts or pages, here I choose &ldquo;Pages&rdquo;, and it got the Parent Pages, so first you have to create the parent page, just as following:<br />
<img src="/images/parentpage.jpg" alt="/images/parentpage.jpg" /></p>

<p>The content of parent page named &ldquo;[child_pages]&rdquo; is also another plug-in, this plug-in is called &ldquo;Child Pages Shortcode&rdquo;, after installed it, you can get the &ldquo;screenshots&rdquo; of the child pages.<br />
The actual effects is listed as following picture: <br />
<img src="/images/childpageshot.jpg" alt="/images/childpageshot.jpg" /></p>

<p>Another plug-in is called &ldquo;Children Index Shortcode&rdquo;. This plug-in will generate all of the child pages' hyper-links. You can call this plug-in via insert &ldquo;children-index&rdquo; into the content of the parent page. <br /></p>

<h3>Change The Theme</h3>

<p>You can easily install themes in wordpress, via Appearence->Theme. <br />
Currently I use &ldquo;BlackBird Wordpress Theme&rdquo;, the default suport of chinese is pretty good. <br />
Things to be do:<br />
1. Check all of the images. <br />
2. Beautify the pages. <br />
3. Customize the pages. <br /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/15/migrating-from-asp-to-wordpress/">Migrating From ASP to WordPress(1)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-15T11:00:00+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:00 am</span></time>
        
         | <a href="/blog/2014/03/15/migrating-from-asp-to-wordpress/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I will moving an old-style website from ASP to WorldPress, that&rsquo;s a funny work. This series will record the steps for migrating. <br /></p>

<h3>Preparation</h3>

<p>First I got all of the files which locates in the ASP.NET Server, the database is very simple, it&rsquo;s a mdb file, which could be viewed by Microsoft Access.<br /></p>

<p>The static files and images could also be downloaded from the server, thus the materials is enough for building a whole-new WorldPress based website.<br /></p>

<h3>Using Python To Generate Content</h3>

<p>All of the webpage information are located in the mdb file, thus we have to do some dealing with this database file. Python could easily retrieve the data out from the database.<br />
Install pyodbc:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pip install pyodbc
</span></code></pre></td></tr></table></div></figure>


<p>Notice when you are using Microsoft  Access for visiting the database, the system will automatically generate a ldb file for you.<br /></p>

<p>In Linux, the pyodbc will encouter un-predicted problems, so I use ActivePython in Windows for analyzing the mdb file.<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pypm search pyodbc
</span><span class='line'>$ pypm install pyodbc
</span></code></pre></td></tr></table></div></figure>


<p>Now begin to analyse the database</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>TBD
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/14/trouble-shotting-on-wordpress/">Trouble-Shotting on Wordpress</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-14T15:52:00+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>3:52 pm</span></time>
        
         | <a href="/blog/2014/03/14/trouble-shotting-on-wordpress/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since the Wordpress is located at home, there are several problems for dealing with.<br /></p>

<h3>Changeing Apache Listening Port</h3>

<p>Nanjing Unicom has banned the port 80, thus I have to change the default listening port of apache from 80 to other ports. Following is How-To:<br />
First import an variable in /etc/apache2/envvars:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export VHOST_PORT_HTTP=7777
</span></code></pre></td></tr></table></div></figure>


<p>Then Change the /etc/apache2/ports.conf: <br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># NameVirtualHost *:80
</span><span class='line'># Listen 80
</span><span class='line'>NameVirtualHost *:${VHOST_PORT_HTTP}
</span><span class='line'>Listen ${VHOST_PORT_HTTP}
</span></code></pre></td></tr></table></div></figure>


<p>Finally change the site-enabled:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:/etc/apache2# cat sites-enabled/000-default
</span><span class='line'>&lt;VirtualHost *:${VHOST_PORT_HTTP}&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Now restart the apache2 service, you should see the apache listens the 7777 port. <br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/etc/init.d/apache2 restart
</span></code></pre></td></tr></table></div></figure>


<h3>Configurating the WordPress</h3>

<p>Install this light-weight browser for changing configurations. <br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pacman -S midori
</span></code></pre></td></tr></table></div></figure>


<p>After remote login with &ldquo;ssh -Y&rdquo;, simply input: <br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>midori 
</span></code></pre></td></tr></table></div></figure>


<p>Then you can get a local window. <br />
But wait, midori relies on window, but we&rsquo;d better do everything in command-line for savign the bandwidth, thus we install the elinks, and use it for configurating the wordpress.<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ apt-get install elinks
</span></code></pre></td></tr></table></div></figure>


<p>You have to change the configuration->General, from <a href="http://xxx.xxx.xxx.xxx">http://xxx.xxx.xxx.xxx</a> to <a href="http://xxx.xxx.xxx.xxx:7777,">http://xxx.xxx.xxx.xxx:7777,</a> then we can change the port and let it show in browser. <br /></p>

<p>Now you can access the wordpress in everywhere.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/13/customize-wordpress-on-beaglebone-black/">Customize Wordpress on BeagleBone Black</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-13T16:59:00+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:59 pm</span></time>
        
         | <a href="/blog/2014/03/13/customize-wordpress-on-beaglebone-black/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For Using proxy for Wordpress, we can directly edit the wp-config file:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat wp-config.php
</span><span class='line'>/** Set following for working behind the proxy **/
</span><span class='line'>//define('WP_PROXY_HOST', '10.0.0.221');
</span><span class='line'>//define('WP_PROXY_PORT', '9001');
</span><span class='line'>#define('WP_PROXY_BYPASS_HOSTS','*.local-intranet');
</span><span class='line'>##
</span><span class='line'>define('WP_EMMORY_LIMIT', '64M');
</span></code></pre></td></tr></table></div></figure>


<p>A trouble shooting, you have to edit the /etc/resolv.conf to change the default dns server, then your wordpress could reach the network and install new plugins or themes. <br /></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/33">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/31">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/06/29/insert-public-key-into-cobbler-deployed-system/">Insert Public Key Into Cobbler Deployed System</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/29/linux-tips-2/">Linux Tips(2)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/25/for-deploying-148-tips/">For Deploying 148 Tips</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/24/wh-worktips-6/">WH Worktips(6)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/24/install-newest-version-of-cobbler/">Install Newest Version of Cobbler</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
