
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="System Install Fedora 23, select fedora server and install the system, then using the
lastest development kernel via: 1
2
$ curl -s https://repos. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/5">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//fonts.googleapis.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/31/virtio-gpu-working-tips/">Virtio-gpu Working Tips</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-31T11:49:13+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2016</span></span> <span class='time'>11:49 am</span></time>
        
         | <a href="/blog/2016/01/31/virtio-gpu-working-tips/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>System</h3>

<p>Install Fedora 23, select fedora server and install the system, then using the
lastest development kernel via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ curl -s https://repos.fedorapeople.org/repos/thl/kernel-vanilla.repo | sudo tee /etc/yum.repos.d/kernel-vanilla.repo
</span><span class='line'>$ sudo dnf --enablerepo=kernel-vanilla-mainline update</span></code></pre></td></tr></table></div></figure>


<p>Checking the running kernel via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ uname -r
</span><span class='line'>4.5.0-0.rc1.git0.1.vanilla.knurd.1.fc23.x86_64</span></code></pre></td></tr></table></div></figure>


<p>Running the system which have kernel version newer than 4.4  is the basis for enable the virt-io.</p>

<h3>Install packages</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo dnf install -y gcc zlib-devel glib2-devel pixman-devel libfdt-devel \ 
</span><span class='line'>lzo-devel snappy-devel bzip2-devel libseccomp-devel gtk2-devel gtk3-devel \ 
</span><span class='line'>gnutls-devel vte-devel SDL-devel librdmacm-devel libuuid-devel \ 
</span><span class='line'> libcap-ng-devel libcurl-devel ceph-devel libssh2-devel libaio-devel \ 
</span><span class='line'>glusterfs-devel glusterfs-api-devel numactl-devel gperftools-devel \ 
</span><span class='line'> texinfo libiscsi-devel spice-server-devel libusb-devel usbredir-devel \ 
</span><span class='line'>libnfs-devel libcap-devel libattr-devel  </span></code></pre></td></tr></table></div></figure>


<h3>virglrenderer</h3>

<p>coprs have the repository for this:  <br/>
<a href="https://copr.fedorainfracloud.org/coprs/kraxel/">https://copr.fedorainfracloud.org/coprs/kraxel/</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd /etc/yum.repos.d/
</span><span class='line'>$ sudo wget https://copr.fedorainfracloud.org/coprs/kraxel/virgl/repo/fedora-23/kraxel-virgl-fedora-23.repo</span></code></pre></td></tr></table></div></figure>


<p>Install the virglrenderer via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo dnf install virglrenderer</span></code></pre></td></tr></table></div></figure>


<h3>qemu</h3>

<p>Git clone the source code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://www.kraxel.org/cgit/qemu</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/26/read-digest-on-kvm/">Read Digest on KVM</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-26T09:12:26+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:12 am</span></time>
        
         | <a href="/blog/2016/01/26/read-digest-on-kvm/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Some Words</h3>

<p>VMM: (Virtual Machine Monitor)   <br/>
VMX: (Virtual Machine eXtensions):  instructions on processors with x86 virtualization.</p>

<p>Virtualization software:  is most often used to emulate a complete computer system in
order to allow a guest operating system to be run, for example allowing Linux to run as
a guest on top of a PC that is natively running a Microsoft Windows operating system
(or the inverse, running Windows as a guest on Linux).</p>

<p>CPU Ring:   <br/>
<a href="https://en.wikipedia.org/wiki/Protection_ring">https://en.wikipedia.org/wiki/Protection_ring</a></p>

<p><img src="/images/300px-Priv_rings.svg.png" alt="/images/300px-Priv_rings.svg.png" /></p>

<p>VT-d, I/O Hardware Virtualization.   <br/>
VT-c, Networking Hardware Virtualization.</p>

<h3>Host kickstart file</h3>

<p>Add following installation packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>%packages
</span><span class='line'>@virtualization
</span><span class='line'>@Base
</span><span class='line'>@Core
</span><span class='line'>@additional-devel
</span><span class='line'>@base
</span><span class='line'>@large-systems
</span><span class='line'>@storage-client-iscsi
</span><span class='line'>@systgem-management-snmp
</span><span class='line'>@virtualization
</span><span class='line'>@virtualization-client
</span><span class='line'>@virtualization-platform
</span><span class='line'>@virtualization-tools
</span><span class='line'>%end</span></code></pre></td></tr></table></div></figure>


<h3>Mouse On Windows Virtual Machine</h3>

<p>Add twice the usb mouse:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;input type='tablet' bus='usb'</span></code></pre></td></tr></table></div></figure>


<h3>NUMA</h3>

<p>Install the numa configuration tools via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-cache search numactl
</span><span class='line'>numactl - NUMA scheduling and memory placement tool
</span><span class='line'># apt-get -y install numactl</span></code></pre></td></tr></table></div></figure>


<p>Command: <code>numactl --hardware</code>, <code>numastat</code>, <code>numastat -c qemu-kvm</code>.</p>

<p>Check the numa banlancing policy via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat /proc/sys/kernel/numa_balancing
</span><span class='line'>0</span></code></pre></td></tr></table></div></figure>


<p><code>echo 1</code> for open the auto balancing.</p>

<p>KSM, could merge the same memory page, even in different NUMA node.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat /sys/kernel/mm/ksm/merge_across_nodes 
</span><span class='line'>1</span></code></pre></td></tr></table></div></figure>


<h3>CPU Binding</h3>

<p>Use <code>virsh vcpuinfo xx</code> for displaying the VCPU/CPU corresponding relationship.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>virsh # emulatorpin 79
</span><span class='line'>emulator: CPU Affinity
</span><span class='line'>----------------------------------
</span><span class='line'>       *: 0-7</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Change it dynamically:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>virsh # emulatorpin 79 0-3 --live
</span><span class='line'>
</span><span class='line'>virsh # emulatorpin 79
</span><span class='line'>emulator: CPU Affinity
</span><span class='line'>----------------------------------
</span><span class='line'>       *: 0-3</span></code></pre></td></tr></table></div></figure>


<p>Now you could check the result via <code>virsh dumpxml xxx</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  &lt;vcpu placement='static'&gt;4&lt;/vcpu&gt;
</span><span class='line'>  &lt;cputune&gt;
</span><span class='line'>    &lt;emulatorpin cpuset='0-3'/&gt;
</span><span class='line'>  &lt;/cputune&gt;</span></code></pre></td></tr></table></div></figure>


<p>1-1 binding using virsh:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># virsh vcpupin 79 0 0    
</span><span class='line'># virsh vcpupin 79 1 1
</span><span class='line'># virsh vcpupin 79 2 2
</span><span class='line'># virsh vcpupin 79 3 3
</span><span class='line'># virsh dumpxml 79 | more
</span><span class='line'>  &lt;cputune&gt;
</span><span class='line'>    &lt;vcpupin vcpu='0' cpuset='0'/&gt;
</span><span class='line'>    &lt;vcpupin vcpu='1' cpuset='1'/&gt;
</span><span class='line'>    &lt;vcpupin vcpu='2' cpuset='2'/&gt;
</span><span class='line'>    &lt;vcpupin vcpu='3' cpuset='3'/&gt;</span></code></pre></td></tr></table></div></figure>


<p>Now view the vcpuinfo via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># virsh vcpuinfo 79
</span><span class='line'>VCPU:           0
</span><span class='line'>CPU:            0
</span><span class='line'>State:          running
</span><span class='line'>CPU time:       9.2s
</span><span class='line'>CPU Affinity:   y-------</span></code></pre></td></tr></table></div></figure>


<h3>CPU Hot-Plug-in</h3>

<p>The cpu configuration info is listed as:</p>

<p><img src="/images/2016_01_26_10_54_29_285x127.jpg" alt="/images/2016_01_26_10_54_29_285x127.jpg" /></p>

<p>View the CPU infos via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat /proc/interrupts 
</span><span class='line'>           CPU0       CPU1       </span></code></pre></td></tr></table></div></figure>


<p>Change the CPUs to 3:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>virsh # setvcpus 80 3 --live</span></code></pre></td></tr></table></div></figure>


<p>Now in the vm the result should be(or detect it via <code>cat /proc/cpuinfo</code>) :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat /proc/interrupts 
</span><span class='line'>           CPU0       CPU1       CPU2  </span></code></pre></td></tr></table></div></figure>


<h3>CPU Working Mode</h3>

<p>If we select the pass-through, then the cpuinfo should be:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># virsh dumpxml xxxxx
</span><span class='line'>  &lt;cpu mode='host-passthrough'&gt;
</span><span class='line'>  &lt;/cpu&gt;
</span><span class='line'># cat /proc/cpuinfo
</span><span class='line'>processor       : 1
</span><span class='line'>vendor_id       : GenuineIntel
</span><span class='line'>cpu family      : 6
</span><span class='line'>model           : 58
</span><span class='line'>model name      : Intel(R) Core(TM) i7-3770 CPU @ 3.40GHz</span></code></pre></td></tr></table></div></figure>


<p>If we select the host-model, will choose the most similar:  <br/>
Or If we choose <code>Copy host cpu mode</code>, like following:  <br/>
<img src="/images/2016_01_26_11_07_32_299x274.jpg" alt="/images/2016_01_26_11_07_32_299x274.jpg" /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat /proc/cpuinfo
</span><span class='line'>....
</span><span class='line'>processor       : 1
</span><span class='line'>vendor_id       : GenuineIntel
</span><span class='line'>cpu family      : 6
</span><span class='line'>model           : 42
</span><span class='line'>model name      : Intel Xeon E312xx (Sandy Bridge)</span></code></pre></td></tr></table></div></figure>


<h3>Memory Balloon</h3>

<p>Change the memory balloon to 1024 or 4096 via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># virsh qemu-monitor-command PerfTune --hmp --cmd balloon 1024
</span><span class='line'># virsh qemu-monitor-command PerfTune --hmp --cmd info balloon
</span><span class='line'>balloon: actual=1024
</span><span class='line'># virsh qemu-monitor-command PerfTune --hmp --cmd balloon 4096</span></code></pre></td></tr></table></div></figure>


<h3>Memory Limitation</h3>

<p>Make configuration of the memory via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>virsh memtune PerfTune --hard-limit xxxxx --config
</span><span class='line'>virsh memtune PerfTune --soft-limit xxxxx --config
</span><span class='line'>virsh memtune PerfTune --swap-hard-limit xxxxx --config
</span><span class='line'>virsh memtune PerfTune --min_guarantee xxxxx --config</span></code></pre></td></tr></table></div></figure>


<p>&ndash;config, write to configuration xml
&ndash;live, lively write
&ndash;current ?</p>

<h3>HugePage</h3>

<p>Enable hugepage via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># grep -i huge /proc/meminfo 
</span><span class='line'>AnonHugePages:  12820480 kB
</span><span class='line'>HugePages_Total:       0
</span><span class='line'>HugePages_Free:        0
</span><span class='line'>HugePages_Rsvd:        0
</span><span class='line'>HugePages_Surp:        0
</span><span class='line'>Hugepagesize:       2048 kB</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/18/tips-on-setup-mesos-cluster/">Tips on Setup Mesos Cluster</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-18T10:01:17+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>10:01 am</span></time>
        
         | <a href="/blog/2016/01/18/tips-on-setup-mesos-cluster/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Prerequisition</h3>

<p>Install on Ubuntu14.04, so first we update to the latest version via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get update && sudo apt-get upgrade -y</span></code></pre></td></tr></table></div></figure>


<p>Prepare the repository of mesos via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># sudo apt-key adv --keyserver keyserver.ubuntu.com --recv E56151BF
</span><span class='line'># DISTRO=$(lsb_release -is | tr '[:upper:]' '[:lower:]')
</span><span class='line'># CODENAME=$(lsb_release -cs)
</span><span class='line'># echo "deb http://repos.mesosphere.io/${DISTRO} ${CODENAME} main" | sudo tee /etc/apt/sources.list.d/mesosphere.list</span></code></pre></td></tr></table></div></figure>


<p>mesos depends on java8, so we should install java8 on ubuntu machine via following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install software-properties-common
</span><span class='line'>$ sudo add-apt-repository ppa:webupd8team/java -y
</span><span class='line'>$ sudo apt-get update
</span><span class='line'>$ sudo apt-get install oracle-java8-installer</span></code></pre></td></tr></table></div></figure>


<h3>Installation</h3>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/15/linux-tips-4.markdown~/">Linux Tips(4)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-15T18:37:03+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>6:37 pm</span></time>
        
         | <a href="/blog/2016/01/15/linux-tips-4.markdown~/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content">### 1. Run ansible commands
Run commands in all hosts:    

```
# ansible all -i inventory.ini -m command -u root --args "uptime"
```

### 2. mesos introduction
[http://www.infoq.com/cn/articles/analyse-mesos-part-02](http://www.infoq.com/cn/articles/analyse-mesos-part-02)    

### 3. Limit ansible run hosts

```
# ansible-playbook -i inventory_mesos_cluster changehostname.yml -u root -k
-vvvv --list-hosts

playbook: changehostname.yml

  play #1 (master1): host count=1
    10.47.58.31

#  ansible-playbook -i
inventory_mesos_cluster changehostname.yml -u root -k -vvvv --limit="master1"

```

### 4. Configure the dhcp configuration of libvirtd
First edit the net configuration:    

```
# virsh net-edit xxxxx
```

![/images/2016_01_16_20_23_08_715x270.jpg](/images/2016_01_16_20_23_08_715x270.jpg)    
### 5. Copy items into clipboard in vim
Hit `Ctrl+v` to visual model, then select the items you want to copy, after select
them, click `"*y` will copy whatever you selected into your clipbard.     

Copy from clipboard---- simply hit `p` in command mode.    

### 6. mesos.cli
When you meet `no module named mesos`, install it via pip:    

```
$ pip install mesos.cli
```

### 7. Startdict In Command Line

```
$ sudo apt-get install -y sdcv
$ wget
https://web.archive.org/web/20140917131745/http://abloz.com/huzheng/stardict-dic/dict.org/stardict-dictd_www.dict.org_gcide-2.4.2.tar.bz2
$ sudo mkdir -p /usr/share/stardict/dic/
$ sudo tar xjvf stardict-dictd_www.dict.org_gcide-2.4.2.tar.bz2 -C /usr/share/stardict/dic 

```

### 8. Golden Dict
Golden Dict.   

### 9. Latest Info On OpenStack
[https://mp.weixin.qq.com/s?__biz=MzA3MjkwMDY5OA==&mid=404253985&idx=1&sn=0d6c544dfb129e35bde7d19a0de8887b&scene=1&srcid=01267Etq7arAdYaFqbUG5BNa&pass_ticket=qT7Nk3zsTIegBKqnPTUL%2FTtS%2FMNDH%2F07Fz%2Bfua9RcTwSHVO5OLo5wDpfeb%2FBLCEH#rd](https://mp.weixin.qq.com/s?__biz=MzA3MjkwMDY5OA==&mid=404253985&idx=1&sn=0d6c544dfb129e35bde7d19a0de8887b&scene=1&srcid=01267Etq7arAdYaFqbUG5BNa&pass_ticket=qT7Nk3zsTIegBKqnPTUL%2FTtS%2FMNDH%2F07Fz%2Bfua9RcTwSHVO5OLo5wDpfeb%2FBLCEH#rd)    

### 10. Quickly Configure vagrant machine
Via following you could get outside world:     

```
ip route del default gw 10.0.2.2 dev enp0s3
ip a del 192.168.10.199/24 dev enp0s8
ip a add 192.168.10.199/16 dev enp0s8
ip route add default via 192.168.0.79 dev enp0s8
```

### 11. Change the default gateway On CentOS 7
Default gateway should go here:    

```
$ cat /etc/sysconfig/network
# Created by anaconda
GATEWAY=192.168.0.79
```

And remove the origin default gateway by adding following definitions :    

```
$ cat /etc/sysconfig/network-scripts/ifcfg-enp0s3 
# Generated by dracut initrd
NAME="enp0s3"
DEVICE="enp0s3"
BOOTPROTO=dhcp
# This one is not the default gw
DEFROUTE=no
# Do not override the dns
PEERDNS=no
```
Thus the default gateway won't go from enp0s3, but from enp0s8, won't configure the dns
address to 10.0.x.x.    

### 12. On VPNs

```
http://linsir.org/post/how_to_install_IPSec_IKEV2_base_on_strongswan_with_CentOS7
https://quericy.me/blog/512
https://quericy.me/blog/699
http://lifehacker.io/post/108814979111/%E5%9C%A8%E6%90%AC%E7%93%A6%E5%B7%A5%E7%9A%84centos7%E4%B8%8B%E6%90%AD%E5%BB%BAstrongswan%E5%AE%9E%E7%8E%B0%E5%9C%A8ios%E4%B8%8A%E6%8C%89%E9%9C%80%E8%BF%9E%E6%8E%A5vpn
https://raymii.org/s/tutorials/IPSEC_vpn_with_CentOS_7.html
https://linux.cn/article-5938-weibo.html
```

MMC snap-in:    
[https://technet.microsoft.com/en-us/library/cc722035.aspx](https://technet.microsoft.com/en-us/library/cc722035.aspx)    

### 13. Use iptables On CentOS7
Use  following steps for disable firewalld and use iptables.    

```
$ systemctl stop firewalld
$ systemctl mask firewalld
$ yum install iptables-services
$ systemctl enable iptables
$ systemctl start iptables

```

### 14. Quickly Goes kernel configuration
When you want to configure the newer kernel source tree using your old kernel
configuration, simply do following:    

```
# yes "" | make oldconfig
```

### 15. iptables problem
After installing the newest kernel, I cannot use iptables, showing ` can't initialize iptables : table does not exist`.       

Solution: compile the modules again, select nat.     

![/images/2016_01_28_16_05_52_496x361.jpg](/images/2016_01_28_16_05_52_496x361.jpg)    

Selecting from:     
Networking Support    
Network Options     
Network packet filtering framework(Netfilter)    
IP: Netfilter Configuration    


Then you should `make modules_install` under your kernel source building directory.     

### 16. DistCC For Building Kernel DEB
On configurating distcc:    
[http://linuxdeveloper.blogspot.tw/2012/03/distributed-kernel-compilation-in.html](http://linuxdeveloper.blogspot.tw/2012/03/distributed-kernel-compilation-in.html)    

On building Linux kernel deb files:    

[http://www.cyberciti.biz/faq/debian-ubuntu-building-installing-a-custom-linux-kernel/](http://www.cyberciti.biz/faq/debian-ubuntu-building-installing-a-custom-linux-kernel/)     

And:    

[https://help.ubuntu.com/community/Kernel/Compile](https://help.ubuntu.com/community/Kernel/Compile)     

Actual command:    

```
$ time sudo make -j12 CC=distcc
$ sudo MAKEFLAGS="CC=distcc" make-kpkg --rootcmd fakeroot --initrd --append-to-version=-suspend2 kernel-image kernel-headers kernel-source -j16
```

Really takes long time for building the kernel out, but the iptables won't works.    


### 17. dmenu On Ubuntu
dmenu is in the package of suckless-tools.    

```
$ sudo apt-get install suckless-tools
```

### 18. Virtio-GPU How-to
[https://www.kraxel.org/blog/2015/06/virtio-gpu-on-the-way-upstream/](https://www.kraxel.org/blog/2015/06/virtio-gpu-on-the-way-upstream/)    

### 20. Use Latest Dev Kernel On Fedora
Refers to
[http://fedoraproject.org/wiki/Kernel_Vanilla_Repositories](http://fedoraproject.org/wiki/Kernel_Vanilla_Repositories)     

```
$ curl -s https://repos.fedorapeople.org/repos/thl/kernel-vanilla.repo | sudo tee /etc/yum.repos.d/kernel-vanilla.repo
$ sudo dnf --enablerepo=kernel-vanilla-mainline update
```

Fall back to the stable one:    

```
$ sudo dnf --enablerepo=kernel-vanilla-stable update
```

### 21. Install grub on usb disk/ArchLinux

```
# chattr -i /boot/grub/i386-pc/core.img 
# grub-install --target=i386-pc --recheck --debug --force /dev/sdb
# chattr +i /boot/grub/i386-pc/core.img 
```
### 22. fcitx-gtk3
Since now firefox using gtk3, so if you want to input chinese in firefox, simply install `fcitx-gtk3` then you get fcitx working.     

### 23. Polkit And Virt-manager
Problem:    

```
$ virsh -c qemu:///system
error: failed to connect to the hypervisor
error: authentication failed: no agent is available to authenticate
```

Add the configuration for the polkit and restart the service:    

```
$ sudo vim /etc/polkit-1/rules.d/49-org.libvirt.unix.manager.rules
polkit.addRule(function(action, subject) {
    if (action.id == "org.libvirt.unix.manage" &&
        subject.isInGroup("kvm")) {
            return polkit.Result.YES;
        }
});
```

And also you have to add your current user into the group of `kvm`:    

```
$ sudo usermod -a -G kvm <user name>
```

Restar the polkit service via:    

```
$ sudo systemctl restart polkit.service
```

### 24. Running tasks in byobu
[http://superuser.com/questions/623432/transfer-current-command-to-a-detachable-session-tmux-screen](http://superuser.com/questions/623432/transfer-current-command-to-a-detachable-session-tmux-screen)    

### 25. GPU Pass-Through
[http://www.gitztalk.com/posts/2014/06/30/gaming-in-a-vm/](http://www.gitztalk.com/posts/2014/06/30/gaming-in-a-vm/)    

### 26. yaourt build error
Reason: gpg checking error, solution is:    

```
$ proxychains4 gpg --recv-key  79BE3E4300411886
```

### 27. libvirtd and polkit
Bypass the password prompt:    

[https://wiki.archlinux.org/index.php/Polkit#Bypass_password_prompt](https://wiki.archlinux.org/index.php/Polkit#Bypass_password_prompt)     


### 28. virgl repository
[https://www.kraxel.org/repos/](https://www.kraxel.org/repos/)    

### 29. pass-through howto
[http://vfio.blogspot.com.au/2015/05/vfio-gpu-how-to-series-part-3-host.html](http://vfio.blogspot.com.au/2015/05/vfio-gpu-how-to-series-part-3-host.html)     

### 30. Control the USB port power
[http://stackoverflow.com/questions/4702216/controlling-a-usb-power-supply-on-off-with-linux](http://stackoverflow.com/questions/4702216/controlling-a-usb-power-supply-on-off-with-linux)     

### 31. On how to reverse usb device
[http://www.linuxjournal.com/article/7353?page=0,0](http://www.linuxjournal.com/article/7353?page=0,0)    
[https://www.reddit.com/r/linuxmasterrace/comments/2zveiw/question_about_wine/](https://www.reddit.com/r/linuxmasterrace/comments/2zveiw/question_about_wine/)    

### 32. Set/Unset keyboard LED
Turn on/off the Scroll LED of the keyboard(USB):    

```
xset led 3
xset -led 3
```

### 33. USB In a NutShell
[http://www.beyondlogic.org/usbnutshell/usb1.shtml](http://www.beyondlogic.org/usbnutshell/usb1.shtml)    

### 34. Arduino USB Tutorial
[http://codeandlife.com/2012/01/22/avr-attiny-usb-tutorial-part-1/](http://codeandlife.com/2012/01/22/avr-attiny-usb-tutorial-part-1/)     

### 35. Auduino USB Project
[https://www.obdev.at/products/vusb/projects.html](https://www.obdev.at/products/vusb/projects.html)    

### 36. Detecting mouse events
Using evtest for detecting mouse events:    

```
$ sudo apt-get install evtest
$ sudo evtest
```

### 37. SteelSeries Mouse (RAW) DEMO

[https://www.youtube.com/watch?v=yvvybR6oyvs](https://www.youtube.com/watch?v=yvvybR6oyvs)    

### 38. USB Device Driver
[http://blog.chinaunix.net/uid-20587912-id-2984380.html](http://blog.chinaunix.net/uid-20587912-id-2984380.html)    

[http://www.wzona.info/2012/10/usb-duomenu-perdavimas-atmega.html](http://www.wzona.info/2012/10/usb-duomenu-perdavimas-atmega.html)   


### 39. Reverse usb device driver
[http://phoeagon.byethost15.com/2012/05/05/%e7%bb%99%e6%9d%82%e7%89%8c%e5%b9%bb%e7%81%af%e7%89%87usb%e9%81%a5%e6%8e%a7%e5%86%99linux%e9%a9%b1%e5%8a%a8-%e4%b8%8a/](http://phoeagon.byethost15.com/2012/05/05/%e7%bb%99%e6%9d%82%e7%89%8c%e5%b9%bb%e7%81%af%e7%89%87usb%e9%81%a5%e6%8e%a7%e5%86%99linux%e9%a9%b1%e5%8a%a8-%e4%b8%8a/)    

[http://www.phoronix.com/scan.php?page=news_item&px=MTEzODU](http://www.phoronix.com/scan.php?page=news_item&px=MTEzODU)    


[https://bbs.archlinux.org/viewtopic.php?id=187995](https://bbs.archlinux.org/viewtopic.php?id=187995)    

[https://www.youtube.com/watch?v=GdvmsWnZkyc](https://www.youtube.com/watch?v=GdvmsWnZkyc)    

[https://learn.adafruit.com/hacking-the-kinect/more-kinect-information](https://learn.adafruit.com/hacking-the-kinect/more-kinect-information)   

[https://www.linuxvoice.com/drive-it-yourself-usb-car-6/](https://www.linuxvoice.com/drive-it-yourself-usb-car-6/)    

Total Phase USB:    

[http://www.totalphase.com/products/beagle-usb12/](http://www.totalphase.com/products/beagle-usb12/)    

[https://github.com/dmage/co2mon](https://github.com/dmage/co2mon)    

### 40. v-usb tutorial
[http://www.workinprogress.ca/v-usb-tutorial-software-only-usb-for-mega-tiny/](http://www.workinprogress.ca/v-usb-tutorial-software-only-usb-for-mega-tiny/)    

### 41. v-usb and Arduino
[https://www.hackster.io/rayburne/arduino-to-excel-using-v-usb-cbf701](https://www.hackster.io/rayburne/arduino-to-excel-using-v-usb-cbf701)   

[http://www.geek-workshop.com/forum.php?mod=viewthread&tid=8578&highlight=v-usb](http://www.geek-workshop.com/forum.php?mod=viewthread&tid=8578&highlight=v-usb)    

[http://coopermaa2nd.blogspot.tw/2011/10/v-usb-examples-for-arduino.html](http://coopermaa2nd.blogspot.tw/2011/10/v-usb-examples-for-arduino.html)    

[http://www.geek-workshop.com/thread-1137-1-1.html](http://www.geek-workshop.com/thread-1137-1-1.html)    

[http://www.geek-workshop.com/forum.php?mod=viewthread&tid=15114&highlight=v-usb](http://www.geek-workshop.com/forum.php?mod=viewthread&tid=15114&highlight=v-usb)    

### 42.Set Timezone of the ArchLinux
Change from UTC to Asia/Shanghai:    

```
$ timedatectl set-timezone Asia/Shanghai
```

### 43. Empty all of the bash history
Empty the bash history via:    

```
$ rm -f ~/.bash_history
```

### 44. Specify qemu-binary in Packer.io
Edit the json files:    

```
"builders":
[
{
"type": "qemu",
"qemu_binary" : "/usr/libexec/qemu-kvm.sh",
```

### 45. apprmor.d

```
I modified /etc/apparmor.d/abstractions/libvirt-qemu to include the
backing store directory
```

### 46. Recover UEFI bootloader
After remove the mainline linux kernel, the archlinux is using the default kernel, but
the UEFI bootloader didn't notice this, following are the steps for recover the UEFI
bootloader.     

```
grub-install --target=x86_64-efi --efi-directory=/boot/EFI   --bootloader-id=arch_grub --recheck
cat ./EFI/loader/entries/arch.conf
```
Change the items into `initramfs-linux`.     

If you cannot login to the system, you could start the machine via USB disk or
installation media, using `arch-chroot /mnt/ /bin/bash` for login to the chroot system,
then do the above operations.   

### 47. bonding
[http://sanswers.com/tube/wotC5GZ2FV0/bonding-eth0-and-wlan0-on-arch-linux](http://sanswers.com/tube/wotC5GZ2FV0/bonding-eth0-and-wlan0-on-arch-linux)    

### 48. Fix currpted zsh history 
history corrupted.    

```
$ mv .zsh_history .zsh_history_bad
$ strings .zsh_history_bad > .zsh_history
$ fc -R .zsh_history
```

### 49. pulp
Using pulp for managing the repositories of RPM/Docker, etc.    

### 50. Chromium flash
Install chromium-pepper-flash in aur.    

### 51. Install xfce4 on CentOS
Install xfce in epel repository via:    

```
# yum --enablerepo=epel -y groups install "Xfce" 
```

### 52. LED controller
[http://www.seeedstudio.com/recipe/402-smart-power-outlet.html](http://www.seeedstudio.com/recipe/402-smart-power-outlet.html)     

### 53. Build php envs
[https://medium.com/dev-tricks/apache-and-php-on-docker-44faef716150#.c8bguolj0](https://medium.com/dev-tricks/apache-and-php-on-docker-44faef716150#.c8bguolj0)   

### 54. handle docker changes
[http://dbaron.org/linux/handle-dock-change.py](http://dbaron.org/linux/handle-dock-change.py)    

### 55. python detection of usb storage
[https://linuxmeerkat.wordpress.com/2014/11/12/python-detection-of-usb-storage-device/](https://linuxmeerkat.wordpress.com/2014/11/12/python-detection-of-usb-storage-device/)    
d-feet for debugging of dbus..       
<<<<<<< HEAD
=======

### 55. Virtualbox Driver Issue
After upgrading the system, the virtualbox won't start the machine, this is because we
didn't install the kernel header, thus the dkms won't be run after system upgrading.
Install kernel-headers:    

```
$ sudo pacman -S linux-headers
$ sudo /sbin/rcvboxdrv setup
``` 
>>>>>>> a1f598b4a14cb4ed25034e682d6d400238fb5f21
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/15/linux-tips-4.markdown/">Linux Tips(4)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-15T18:37:03+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>6:37 pm</span></time>
        
         | <a href="/blog/2016/01/15/linux-tips-4.markdown/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content">### 1. Run ansible commands
Run commands in all hosts:    

```
# ansible all -i inventory.ini -m command -u root --args "uptime"
```

### 2. mesos introduction
[http://www.infoq.com/cn/articles/analyse-mesos-part-02](http://www.infoq.com/cn/articles/analyse-mesos-part-02)    

### 3. Limit ansible run hosts

```
# ansible-playbook -i inventory_mesos_cluster changehostname.yml -u root -k
-vvvv --list-hosts

playbook: changehostname.yml

  play #1 (master1): host count=1
    10.47.58.31

#  ansible-playbook -i
inventory_mesos_cluster changehostname.yml -u root -k -vvvv --limit="master1"

```

### 4. Configure the dhcp configuration of libvirtd
First edit the net configuration:    

```
# virsh net-edit xxxxx
```

![/images/2016_01_16_20_23_08_715x270.jpg](/images/2016_01_16_20_23_08_715x270.jpg)    
### 5. Copy items into clipboard in vim
Hit `Ctrl+v` to visual model, then select the items you want to copy, after select
them, click `"*y` will copy whatever you selected into your clipbard.     

Copy from clipboard---- simply hit `p` in command mode.    

### 6. mesos.cli
When you meet `no module named mesos`, install it via pip:    

```
$ pip install mesos.cli
```

### 7. Startdict In Command Line

```
$ sudo apt-get install -y sdcv
$ wget
https://web.archive.org/web/20140917131745/http://abloz.com/huzheng/stardict-dic/dict.org/stardict-dictd_www.dict.org_gcide-2.4.2.tar.bz2
$ sudo mkdir -p /usr/share/stardict/dic/
$ sudo tar xjvf stardict-dictd_www.dict.org_gcide-2.4.2.tar.bz2 -C /usr/share/stardict/dic 

```

### 8. Golden Dict
Golden Dict.   

### 9. Latest Info On OpenStack
[https://mp.weixin.qq.com/s?__biz=MzA3MjkwMDY5OA==&mid=404253985&idx=1&sn=0d6c544dfb129e35bde7d19a0de8887b&scene=1&srcid=01267Etq7arAdYaFqbUG5BNa&pass_ticket=qT7Nk3zsTIegBKqnPTUL%2FTtS%2FMNDH%2F07Fz%2Bfua9RcTwSHVO5OLo5wDpfeb%2FBLCEH#rd](https://mp.weixin.qq.com/s?__biz=MzA3MjkwMDY5OA==&mid=404253985&idx=1&sn=0d6c544dfb129e35bde7d19a0de8887b&scene=1&srcid=01267Etq7arAdYaFqbUG5BNa&pass_ticket=qT7Nk3zsTIegBKqnPTUL%2FTtS%2FMNDH%2F07Fz%2Bfua9RcTwSHVO5OLo5wDpfeb%2FBLCEH#rd)    

### 10. Quickly Configure vagrant machine
Via following you could get outside world:     

```
ip route del default gw 10.0.2.2 dev enp0s3
ip a del 192.168.10.199/24 dev enp0s8
ip a add 192.168.10.199/16 dev enp0s8
ip route add default via 192.168.0.79 dev enp0s8
```

### 11. Change the default gateway On CentOS 7
Default gateway should go here:    

```
$ cat /etc/sysconfig/network
# Created by anaconda
GATEWAY=192.168.0.79
```

And remove the origin default gateway by adding following definitions :    

```
$ cat /etc/sysconfig/network-scripts/ifcfg-enp0s3 
# Generated by dracut initrd
NAME="enp0s3"
DEVICE="enp0s3"
BOOTPROTO=dhcp
# This one is not the default gw
DEFROUTE=no
# Do not override the dns
PEERDNS=no
```
Thus the default gateway won't go from enp0s3, but from enp0s8, won't configure the dns
address to 10.0.x.x.    

### 12. On VPNs

```
http://linsir.org/post/how_to_install_IPSec_IKEV2_base_on_strongswan_with_CentOS7
https://quericy.me/blog/512
https://quericy.me/blog/699
http://lifehacker.io/post/108814979111/%E5%9C%A8%E6%90%AC%E7%93%A6%E5%B7%A5%E7%9A%84centos7%E4%B8%8B%E6%90%AD%E5%BB%BAstrongswan%E5%AE%9E%E7%8E%B0%E5%9C%A8ios%E4%B8%8A%E6%8C%89%E9%9C%80%E8%BF%9E%E6%8E%A5vpn
https://raymii.org/s/tutorials/IPSEC_vpn_with_CentOS_7.html
https://linux.cn/article-5938-weibo.html
```

MMC snap-in:    
[https://technet.microsoft.com/en-us/library/cc722035.aspx](https://technet.microsoft.com/en-us/library/cc722035.aspx)    

### 13. Use iptables On CentOS7
Use  following steps for disable firewalld and use iptables.    

```
$ systemctl stop firewalld
$ systemctl mask firewalld
$ yum install iptables-services
$ systemctl enable iptables
$ systemctl start iptables

```

### 14. Quickly Goes kernel configuration
When you want to configure the newer kernel source tree using your old kernel
configuration, simply do following:    

```
# yes "" | make oldconfig
```

### 15. iptables problem
After installing the newest kernel, I cannot use iptables, showing ` can't initialize iptables : table does not exist`.       

Solution: compile the modules again, select nat.     

![/images/2016_01_28_16_05_52_496x361.jpg](/images/2016_01_28_16_05_52_496x361.jpg)    

Selecting from:     
Networking Support    
Network Options     
Network packet filtering framework(Netfilter)    
IP: Netfilter Configuration    


Then you should `make modules_install` under your kernel source building directory.     

### 16. DistCC For Building Kernel DEB
On configurating distcc:    
[http://linuxdeveloper.blogspot.tw/2012/03/distributed-kernel-compilation-in.html](http://linuxdeveloper.blogspot.tw/2012/03/distributed-kernel-compilation-in.html)    

On building Linux kernel deb files:    

[http://www.cyberciti.biz/faq/debian-ubuntu-building-installing-a-custom-linux-kernel/](http://www.cyberciti.biz/faq/debian-ubuntu-building-installing-a-custom-linux-kernel/)     

And:    

[https://help.ubuntu.com/community/Kernel/Compile](https://help.ubuntu.com/community/Kernel/Compile)     

Actual command:    

```
$ time sudo make -j12 CC=distcc
$ sudo MAKEFLAGS="CC=distcc" make-kpkg --rootcmd fakeroot --initrd --append-to-version=-suspend2 kernel-image kernel-headers kernel-source -j16
```

Really takes long time for building the kernel out, but the iptables won't works.    


### 17. dmenu On Ubuntu
dmenu is in the package of suckless-tools.    

```
$ sudo apt-get install suckless-tools
```

### 18. Virtio-GPU How-to
[https://www.kraxel.org/blog/2015/06/virtio-gpu-on-the-way-upstream/](https://www.kraxel.org/blog/2015/06/virtio-gpu-on-the-way-upstream/)    

### 20. Use Latest Dev Kernel On Fedora
Refers to
[http://fedoraproject.org/wiki/Kernel_Vanilla_Repositories](http://fedoraproject.org/wiki/Kernel_Vanilla_Repositories)     

```
$ curl -s https://repos.fedorapeople.org/repos/thl/kernel-vanilla.repo | sudo tee /etc/yum.repos.d/kernel-vanilla.repo
$ sudo dnf --enablerepo=kernel-vanilla-mainline update
```

Fall back to the stable one:    

```
$ sudo dnf --enablerepo=kernel-vanilla-stable update
```

### 21. Install grub on usb disk/ArchLinux

```
# chattr -i /boot/grub/i386-pc/core.img 
# grub-install --target=i386-pc --recheck --debug --force /dev/sdb
# chattr +i /boot/grub/i386-pc/core.img 
```
### 22. fcitx-gtk3
Since now firefox using gtk3, so if you want to input chinese in firefox, simply install `fcitx-gtk3` then you get fcitx working.     

### 23. Polkit And Virt-manager
Problem:    

```
$ virsh -c qemu:///system
error: failed to connect to the hypervisor
error: authentication failed: no agent is available to authenticate
```

Add the configuration for the polkit and restart the service:    

```
$ sudo vim /etc/polkit-1/rules.d/49-org.libvirt.unix.manager.rules
polkit.addRule(function(action, subject) {
    if (action.id == "org.libvirt.unix.manage" &&
        subject.isInGroup("kvm")) {
            return polkit.Result.YES;
        }
});
```

And also you have to add your current user into the group of `kvm`:    

```
$ sudo usermod -a -G kvm <user name>
```

Restar the polkit service via:    

```
$ sudo systemctl restart polkit.service
```

### 24. Running tasks in byobu
[http://superuser.com/questions/623432/transfer-current-command-to-a-detachable-session-tmux-screen](http://superuser.com/questions/623432/transfer-current-command-to-a-detachable-session-tmux-screen)    

### 25. GPU Pass-Through
[http://www.gitztalk.com/posts/2014/06/30/gaming-in-a-vm/](http://www.gitztalk.com/posts/2014/06/30/gaming-in-a-vm/)    

### 26. yaourt build error
Reason: gpg checking error, solution is:    

```
$ proxychains4 gpg --recv-key  79BE3E4300411886
```

### 27. libvirtd and polkit
Bypass the password prompt:    

[https://wiki.archlinux.org/index.php/Polkit#Bypass_password_prompt](https://wiki.archlinux.org/index.php/Polkit#Bypass_password_prompt)     


### 28. virgl repository
[https://www.kraxel.org/repos/](https://www.kraxel.org/repos/)    

### 29. pass-through howto
[http://vfio.blogspot.com.au/2015/05/vfio-gpu-how-to-series-part-3-host.html](http://vfio.blogspot.com.au/2015/05/vfio-gpu-how-to-series-part-3-host.html)     

### 30. Control the USB port power
[http://stackoverflow.com/questions/4702216/controlling-a-usb-power-supply-on-off-with-linux](http://stackoverflow.com/questions/4702216/controlling-a-usb-power-supply-on-off-with-linux)     

### 31. On how to reverse usb device
[http://www.linuxjournal.com/article/7353?page=0,0](http://www.linuxjournal.com/article/7353?page=0,0)    
[https://www.reddit.com/r/linuxmasterrace/comments/2zveiw/question_about_wine/](https://www.reddit.com/r/linuxmasterrace/comments/2zveiw/question_about_wine/)    

### 32. Set/Unset keyboard LED
Turn on/off the Scroll LED of the keyboard(USB):    

```
xset led 3
xset -led 3
```

### 33. USB In a NutShell
[http://www.beyondlogic.org/usbnutshell/usb1.shtml](http://www.beyondlogic.org/usbnutshell/usb1.shtml)    

### 34. Arduino USB Tutorial
[http://codeandlife.com/2012/01/22/avr-attiny-usb-tutorial-part-1/](http://codeandlife.com/2012/01/22/avr-attiny-usb-tutorial-part-1/)     

### 35. Auduino USB Project
[https://www.obdev.at/products/vusb/projects.html](https://www.obdev.at/products/vusb/projects.html)    

### 36. Detecting mouse events
Using evtest for detecting mouse events:    

```
$ sudo apt-get install evtest
$ sudo evtest
```

### 37. SteelSeries Mouse (RAW) DEMO

[https://www.youtube.com/watch?v=yvvybR6oyvs](https://www.youtube.com/watch?v=yvvybR6oyvs)    

### 38. USB Device Driver
[http://blog.chinaunix.net/uid-20587912-id-2984380.html](http://blog.chinaunix.net/uid-20587912-id-2984380.html)    

[http://www.wzona.info/2012/10/usb-duomenu-perdavimas-atmega.html](http://www.wzona.info/2012/10/usb-duomenu-perdavimas-atmega.html)   


### 39. Reverse usb device driver
[http://phoeagon.byethost15.com/2012/05/05/%e7%bb%99%e6%9d%82%e7%89%8c%e5%b9%bb%e7%81%af%e7%89%87usb%e9%81%a5%e6%8e%a7%e5%86%99linux%e9%a9%b1%e5%8a%a8-%e4%b8%8a/](http://phoeagon.byethost15.com/2012/05/05/%e7%bb%99%e6%9d%82%e7%89%8c%e5%b9%bb%e7%81%af%e7%89%87usb%e9%81%a5%e6%8e%a7%e5%86%99linux%e9%a9%b1%e5%8a%a8-%e4%b8%8a/)    

[http://www.phoronix.com/scan.php?page=news_item&px=MTEzODU](http://www.phoronix.com/scan.php?page=news_item&px=MTEzODU)    


[https://bbs.archlinux.org/viewtopic.php?id=187995](https://bbs.archlinux.org/viewtopic.php?id=187995)    

[https://www.youtube.com/watch?v=GdvmsWnZkyc](https://www.youtube.com/watch?v=GdvmsWnZkyc)    

[https://learn.adafruit.com/hacking-the-kinect/more-kinect-information](https://learn.adafruit.com/hacking-the-kinect/more-kinect-information)   

[https://www.linuxvoice.com/drive-it-yourself-usb-car-6/](https://www.linuxvoice.com/drive-it-yourself-usb-car-6/)    

Total Phase USB:    

[http://www.totalphase.com/products/beagle-usb12/](http://www.totalphase.com/products/beagle-usb12/)    

[https://github.com/dmage/co2mon](https://github.com/dmage/co2mon)    

### 40. v-usb tutorial
[http://www.workinprogress.ca/v-usb-tutorial-software-only-usb-for-mega-tiny/](http://www.workinprogress.ca/v-usb-tutorial-software-only-usb-for-mega-tiny/)    

### 41. v-usb and Arduino
[https://www.hackster.io/rayburne/arduino-to-excel-using-v-usb-cbf701](https://www.hackster.io/rayburne/arduino-to-excel-using-v-usb-cbf701)   

[http://www.geek-workshop.com/forum.php?mod=viewthread&tid=8578&highlight=v-usb](http://www.geek-workshop.com/forum.php?mod=viewthread&tid=8578&highlight=v-usb)    

[http://coopermaa2nd.blogspot.tw/2011/10/v-usb-examples-for-arduino.html](http://coopermaa2nd.blogspot.tw/2011/10/v-usb-examples-for-arduino.html)    

[http://www.geek-workshop.com/thread-1137-1-1.html](http://www.geek-workshop.com/thread-1137-1-1.html)    

[http://www.geek-workshop.com/forum.php?mod=viewthread&tid=15114&highlight=v-usb](http://www.geek-workshop.com/forum.php?mod=viewthread&tid=15114&highlight=v-usb)    

### 42.Set Timezone of the ArchLinux
Change from UTC to Asia/Shanghai:    

```
$ timedatectl set-timezone Asia/Shanghai
```

### 43. Empty all of the bash history
Empty the bash history via:    

```
$ rm -f ~/.bash_history
```

### 44. Specify qemu-binary in Packer.io
Edit the json files:    

```
"builders":
[
{
"type": "qemu",
"qemu_binary" : "/usr/libexec/qemu-kvm.sh",
```

### 45. apprmor.d

```
I modified /etc/apparmor.d/abstractions/libvirt-qemu to include the
backing store directory
```

### 46. Recover UEFI bootloader
After remove the mainline linux kernel, the archlinux is using the default kernel, but
the UEFI bootloader didn't notice this, following are the steps for recover the UEFI
bootloader.     

```
grub-install --target=x86_64-efi --efi-directory=/boot/EFI   --bootloader-id=arch_grub --recheck
cat ./EFI/loader/entries/arch.conf
```
Change the items into `initramfs-linux`.     

If you cannot login to the system, you could start the machine via USB disk or
installation media, using `arch-chroot /mnt/ /bin/bash` for login to the chroot system,
then do the above operations.   

### 47. bonding
[http://sanswers.com/tube/wotC5GZ2FV0/bonding-eth0-and-wlan0-on-arch-linux](http://sanswers.com/tube/wotC5GZ2FV0/bonding-eth0-and-wlan0-on-arch-linux)    

### 48. Fix currpted zsh history 
history corrupted.    

```
$ mv .zsh_history .zsh_history_bad
$ strings .zsh_history_bad > .zsh_history
$ fc -R .zsh_history
```

### 49. pulp
Using pulp for managing the repositories of RPM/Docker, etc.    

### 50. Chromium flash
Install chromium-pepper-flash in aur.    

### 51. Install xfce4 on CentOS
Install xfce in epel repository via:    

```
# yum --enablerepo=epel -y groups install "Xfce" 
```

### 52. LED controller
[http://www.seeedstudio.com/recipe/402-smart-power-outlet.html](http://www.seeedstudio.com/recipe/402-smart-power-outlet.html)     

### 53. Build php envs
[https://medium.com/dev-tricks/apache-and-php-on-docker-44faef716150#.c8bguolj0](https://medium.com/dev-tricks/apache-and-php-on-docker-44faef716150#.c8bguolj0)   

### 54. handle docker changes
[http://dbaron.org/linux/handle-dock-change.py](http://dbaron.org/linux/handle-dock-change.py)    

### 55. python detection of usb storage
[https://linuxmeerkat.wordpress.com/2014/11/12/python-detection-of-usb-storage-device/](https://linuxmeerkat.wordpress.com/2014/11/12/python-detection-of-usb-storage-device/)    
d-feet for debugging of dbus..       

<<<<<<< HEAD
### 56. libmtp related
Install `gvfp-mtp`, then you could get your nautillus have the mtp device
support.     

Using `mtp-detect` for detecting the equipments and `mtp-connect` for
connecting the device.    
=======
### 55. Virtualbox Driver Issue
After upgrading the system, the virtualbox won't start the machine, this is because we
didn't install the kernel header, thus the dkms won't be run after system upgrading.
Install kernel-headers:    

```
$ sudo pacman -S linux-headers
$ sudo /sbin/rcvboxdrv setup
``` 
>>>>>>> a1f598b4a14cb4ed25034e682d6d400238fb5f21
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/15/linux-tips-4/">Linux Tips(4)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-15T18:37:03+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>6:37 pm</span></time>
        
         | <a href="/blog/2016/01/15/linux-tips-4/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>1. Run ansible commands</h3>

<p>Run commands in all hosts:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ansible all -i inventory.ini -m command -u root --args "uptime"</span></code></pre></td></tr></table></div></figure>


<h3>2. mesos introduction</h3>

<p><a href="http://www.infoq.com/cn/articles/analyse-mesos-part-02">http://www.infoq.com/cn/articles/analyse-mesos-part-02</a></p>

<h3>3. Limit ansible run hosts</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ansible-playbook -i inventory_mesos_cluster changehostname.yml -u root -k
</span><span class='line'>-vvvv --list-hosts
</span><span class='line'>
</span><span class='line'>playbook: changehostname.yml
</span><span class='line'>
</span><span class='line'>  play #1 (master1): host count=1
</span><span class='line'>    10.47.58.31
</span><span class='line'>
</span><span class='line'>#  ansible-playbook -i
</span><span class='line'>inventory_mesos_cluster changehostname.yml -u root -k -vvvv --limit="master1"
</span></code></pre></td></tr></table></div></figure>


<h3>4. Configure the dhcp configuration of libvirtd</h3>

<p>First edit the net configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># virsh net-edit xxxxx</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/2016_01_16_20_23_08_715x270.jpg" alt="/images/2016_01_16_20_23_08_715x270.jpg" /></p>

<h3>5. Copy items into clipboard in vim</h3>

<p>Hit <code>Ctrl+v</code> to visual model, then select the items you want to copy, after select
them, click <code>"*y</code> will copy whatever you selected into your clipbard.</p>

<p>Copy from clipboard&mdash;- simply hit <code>p</code> in command mode.</p>

<h3>6. mesos.cli</h3>

<p>When you meet <code>no module named mesos</code>, install it via pip:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pip install mesos.cli</span></code></pre></td></tr></table></div></figure>


<h3>7. Startdict In Command Line</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install -y sdcv
</span><span class='line'>$ wget
</span><span class='line'>https://web.archive.org/web/20140917131745/http://abloz.com/huzheng/stardict-dic/dict.org/stardict-dictd_www.dict.org_gcide-2.4.2.tar.bz2
</span><span class='line'>$ sudo mkdir -p /usr/share/stardict/dic/
</span><span class='line'>$ sudo tar xjvf stardict-dictd_www.dict.org_gcide-2.4.2.tar.bz2 -C /usr/share/stardict/dic 
</span></code></pre></td></tr></table></div></figure>


<h3>8. Golden Dict</h3>

<p>Golden Dict.</p>

<h3>9. Latest Info On OpenStack</h3>

<p><a href="https://mp.weixin.qq.com/s?__biz=MzA3MjkwMDY5OA==&amp;mid=404253985&amp;idx=1&amp;sn=0d6c544dfb129e35bde7d19a0de8887b&amp;scene=1&amp;srcid=01267Etq7arAdYaFqbUG5BNa&amp;pass_ticket=qT7Nk3zsTIegBKqnPTUL%2FTtS%2FMNDH%2F07Fz%2Bfua9RcTwSHVO5OLo5wDpfeb%2FBLCEH#rd">https://mp.weixin.qq.com/s?__biz=MzA3MjkwMDY5OA==&amp;mid=404253985&amp;idx=1&amp;sn=0d6c544dfb129e35bde7d19a0de8887b&amp;scene=1&amp;srcid=01267Etq7arAdYaFqbUG5BNa&amp;pass_ticket=qT7Nk3zsTIegBKqnPTUL%2FTtS%2FMNDH%2F07Fz%2Bfua9RcTwSHVO5OLo5wDpfeb%2FBLCEH#rd</a></p>

<h3>10. Quickly Configure vagrant machine</h3>

<p>Via following you could get outside world:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ip route del default gw 10.0.2.2 dev enp0s3
</span><span class='line'>ip a del 192.168.10.199/24 dev enp0s8
</span><span class='line'>ip a add 192.168.10.199/16 dev enp0s8
</span><span class='line'>ip route add default via 192.168.0.79 dev enp0s8</span></code></pre></td></tr></table></div></figure>


<h3>11. Change the default gateway On CentOS 7</h3>

<p>Default gateway should go here:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /etc/sysconfig/network
</span><span class='line'># Created by anaconda
</span><span class='line'>GATEWAY=192.168.0.79</span></code></pre></td></tr></table></div></figure>


<p>And remove the origin default gateway by adding following definitions :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /etc/sysconfig/network-scripts/ifcfg-enp0s3 
</span><span class='line'># Generated by dracut initrd
</span><span class='line'>NAME="enp0s3"
</span><span class='line'>DEVICE="enp0s3"
</span><span class='line'>BOOTPROTO=dhcp
</span><span class='line'># This one is not the default gw
</span><span class='line'>DEFROUTE=no
</span><span class='line'># Do not override the dns
</span><span class='line'>PEERDNS=no</span></code></pre></td></tr></table></div></figure>


<p>Thus the default gateway won&rsquo;t go from enp0s3, but from enp0s8, won&rsquo;t configure the dns
address to 10.0.x.x.</p>

<h3>12. On VPNs</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>http://linsir.org/post/how_to_install_IPSec_IKEV2_base_on_strongswan_with_CentOS7
</span><span class='line'>https://quericy.me/blog/512
</span><span class='line'>https://quericy.me/blog/699
</span><span class='line'>http://lifehacker.io/post/108814979111/%E5%9C%A8%E6%90%AC%E7%93%A6%E5%B7%A5%E7%9A%84centos7%E4%B8%8B%E6%90%AD%E5%BB%BAstrongswan%E5%AE%9E%E7%8E%B0%E5%9C%A8ios%E4%B8%8A%E6%8C%89%E9%9C%80%E8%BF%9E%E6%8E%A5vpn
</span><span class='line'>https://raymii.org/s/tutorials/IPSEC_vpn_with_CentOS_7.html
</span><span class='line'>https://linux.cn/article-5938-weibo.html</span></code></pre></td></tr></table></div></figure>


<p>MMC snap-in:  <br/>
<a href="https://technet.microsoft.com/en-us/library/cc722035.aspx">https://technet.microsoft.com/en-us/library/cc722035.aspx</a></p>

<h3>13. Use iptables On CentOS7</h3>

<p>Use  following steps for disable firewalld and use iptables.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ systemctl stop firewalld
</span><span class='line'>$ systemctl mask firewalld
</span><span class='line'>$ yum install iptables-services
</span><span class='line'>$ systemctl enable iptables
</span><span class='line'>$ systemctl start iptables
</span></code></pre></td></tr></table></div></figure>


<h3>14. Quickly Goes kernel configuration</h3>

<p>When you want to configure the newer kernel source tree using your old kernel
configuration, simply do following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># yes "" | make oldconfig</span></code></pre></td></tr></table></div></figure>


<h3>15. iptables problem</h3>

<p>After installing the newest kernel, I cannot use iptables, showing <code>can't initialize iptables : table does not exist</code>.</p>

<p>Solution: compile the modules again, select nat.</p>

<p><img src="/images/2016_01_28_16_05_52_496x361.jpg" alt="/images/2016_01_28_16_05_52_496x361.jpg" /></p>

<p>Selecting from:   <br/>
Networking Support  <br/>
Network Options   <br/>
Network packet filtering framework(Netfilter)  <br/>
IP: Netfilter Configuration</p>

<p>Then you should <code>make modules_install</code> under your kernel source building directory.</p>

<h3>16. DistCC For Building Kernel DEB</h3>

<p>On configurating distcc:  <br/>
<a href="http://linuxdeveloper.blogspot.tw/2012/03/distributed-kernel-compilation-in.html">http://linuxdeveloper.blogspot.tw/2012/03/distributed-kernel-compilation-in.html</a></p>

<p>On building Linux kernel deb files:</p>

<p><a href="http://www.cyberciti.biz/faq/debian-ubuntu-building-installing-a-custom-linux-kernel/">http://www.cyberciti.biz/faq/debian-ubuntu-building-installing-a-custom-linux-kernel/</a></p>

<p>And:</p>

<p><a href="https://help.ubuntu.com/community/Kernel/Compile">https://help.ubuntu.com/community/Kernel/Compile</a></p>

<p>Actual command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ time sudo make -j12 CC=distcc
</span><span class='line'>$ sudo MAKEFLAGS="CC=distcc" make-kpkg --rootcmd fakeroot --initrd --append-to-version=-suspend2 kernel-image kernel-headers kernel-source -j16</span></code></pre></td></tr></table></div></figure>


<p>Really takes long time for building the kernel out, but the iptables won&rsquo;t works.</p>

<h3>17. dmenu On Ubuntu</h3>

<p>dmenu is in the package of suckless-tools.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install suckless-tools</span></code></pre></td></tr></table></div></figure>


<h3>18. Virtio-GPU How-to</h3>

<p><a href="https://www.kraxel.org/blog/2015/06/virtio-gpu-on-the-way-upstream/">https://www.kraxel.org/blog/2015/06/virtio-gpu-on-the-way-upstream/</a></p>

<h3>20. Use Latest Dev Kernel On Fedora</h3>

<p>Refers to
<a href="http://fedoraproject.org/wiki/Kernel_Vanilla_Repositories">http://fedoraproject.org/wiki/Kernel_Vanilla_Repositories</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ curl -s https://repos.fedorapeople.org/repos/thl/kernel-vanilla.repo | sudo tee /etc/yum.repos.d/kernel-vanilla.repo
</span><span class='line'>$ sudo dnf --enablerepo=kernel-vanilla-mainline update</span></code></pre></td></tr></table></div></figure>


<p>Fall back to the stable one:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo dnf --enablerepo=kernel-vanilla-stable update</span></code></pre></td></tr></table></div></figure>


<h3>21. Install grub on usb disk/ArchLinux</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># chattr -i /boot/grub/i386-pc/core.img 
</span><span class='line'># grub-install --target=i386-pc --recheck --debug --force /dev/sdb
</span><span class='line'># chattr +i /boot/grub/i386-pc/core.img </span></code></pre></td></tr></table></div></figure>


<h3>22. fcitx-gtk3</h3>

<p>Since now firefox using gtk3, so if you want to input chinese in firefox, simply install <code>fcitx-gtk3</code> then you get fcitx working.</p>

<h3>23. Polkit And Virt-manager</h3>

<p>Problem:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ virsh -c qemu:///system
</span><span class='line'>error: failed to connect to the hypervisor
</span><span class='line'>error: authentication failed: no agent is available to authenticate</span></code></pre></td></tr></table></div></figure>


<p>Add the configuration for the polkit and restart the service:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo vim /etc/polkit-1/rules.d/49-org.libvirt.unix.manager.rules
</span><span class='line'>polkit.addRule(function(action, subject) {
</span><span class='line'>    if (action.id == "org.libvirt.unix.manage" &&
</span><span class='line'>        subject.isInGroup("kvm")) {
</span><span class='line'>            return polkit.Result.YES;
</span><span class='line'>        }
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>


<p>And also you have to add your current user into the group of <code>kvm</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo usermod -a -G kvm &lt;user name&gt;</span></code></pre></td></tr></table></div></figure>


<p>Restar the polkit service via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo systemctl restart polkit.service</span></code></pre></td></tr></table></div></figure>


<h3>24. Running tasks in byobu</h3>

<p><a href="http://superuser.com/questions/623432/transfer-current-command-to-a-detachable-session-tmux-screen">http://superuser.com/questions/623432/transfer-current-command-to-a-detachable-session-tmux-screen</a></p>

<h3>25. GPU Pass-Through</h3>

<p><a href="http://www.gitztalk.com/posts/2014/06/30/gaming-in-a-vm/">http://www.gitztalk.com/posts/2014/06/30/gaming-in-a-vm/</a></p>

<h3>26. yaourt build error</h3>

<p>Reason: gpg checking error, solution is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ proxychains4 gpg --recv-key  79BE3E4300411886</span></code></pre></td></tr></table></div></figure>


<h3>27. libvirtd and polkit</h3>

<p>Bypass the password prompt:</p>

<p><a href="https://wiki.archlinux.org/index.php/Polkit#Bypass_password_prompt">https://wiki.archlinux.org/index.php/Polkit#Bypass_password_prompt</a></p>

<h3>28. virgl repository</h3>

<p><a href="https://www.kraxel.org/repos/">https://www.kraxel.org/repos/</a></p>

<h3>29. pass-through howto</h3>

<p><a href="http://vfio.blogspot.com.au/2015/05/vfio-gpu-how-to-series-part-3-host.html">http://vfio.blogspot.com.au/2015/05/vfio-gpu-how-to-series-part-3-host.html</a></p>

<h3>30. Control the USB port power</h3>

<p><a href="http://stackoverflow.com/questions/4702216/controlling-a-usb-power-supply-on-off-with-linux">http://stackoverflow.com/questions/4702216/controlling-a-usb-power-supply-on-off-with-linux</a></p>

<h3>31. On how to reverse usb device</h3>

<p><a href="http://www.linuxjournal.com/article/7353?page=0,0">http://www.linuxjournal.com/article/7353?page=0,0</a>  <br/>
<a href="https://www.reddit.com/r/linuxmasterrace/comments/2zveiw/question_about_wine/">https://www.reddit.com/r/linuxmasterrace/comments/2zveiw/question_about_wine/</a></p>

<h3>32. Set/Unset keyboard LED</h3>

<p>Turn on/off the Scroll LED of the keyboard(USB):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xset led 3
</span><span class='line'>xset -led 3</span></code></pre></td></tr></table></div></figure>


<h3>33. USB In a NutShell</h3>

<p><a href="http://www.beyondlogic.org/usbnutshell/usb1.shtml">http://www.beyondlogic.org/usbnutshell/usb1.shtml</a></p>

<h3>34. Arduino USB Tutorial</h3>

<p><a href="http://codeandlife.com/2012/01/22/avr-attiny-usb-tutorial-part-1/">http://codeandlife.com/2012/01/22/avr-attiny-usb-tutorial-part-1/</a></p>

<h3>35. Auduino USB Project</h3>

<p><a href="https://www.obdev.at/products/vusb/projects.html">https://www.obdev.at/products/vusb/projects.html</a></p>

<h3>36. Detecting mouse events</h3>

<p>Using evtest for detecting mouse events:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install evtest
</span><span class='line'>$ sudo evtest</span></code></pre></td></tr></table></div></figure>


<h3>37. SteelSeries Mouse (RAW) DEMO</h3>

<p><a href="https://www.youtube.com/watch?v=yvvybR6oyvs">https://www.youtube.com/watch?v=yvvybR6oyvs</a></p>

<h3>38. USB Device Driver</h3>

<p><a href="http://blog.chinaunix.net/uid-20587912-id-2984380.html">http://blog.chinaunix.net/uid-20587912-id-2984380.html</a></p>

<p><a href="http://www.wzona.info/2012/10/usb-duomenu-perdavimas-atmega.html">http://www.wzona.info/2012/10/usb-duomenu-perdavimas-atmega.html</a></p>

<h3>39. Reverse usb device driver</h3>

<p><a href="http://phoeagon.byethost15.com/2012/05/05/%e7%bb%99%e6%9d%82%e7%89%8c%e5%b9%bb%e7%81%af%e7%89%87usb%e9%81%a5%e6%8e%a7%e5%86%99linux%e9%a9%b1%e5%8a%a8-%e4%b8%8a/">http://phoeagon.byethost15.com/2012/05/05/%e7%bb%99%e6%9d%82%e7%89%8c%e5%b9%bb%e7%81%af%e7%89%87usb%e9%81%a5%e6%8e%a7%e5%86%99linux%e9%a9%b1%e5%8a%a8-%e4%b8%8a/</a></p>

<p><a href="http://www.phoronix.com/scan.php?page=news_item&amp;px=MTEzODU">http://www.phoronix.com/scan.php?page=news_item&amp;px=MTEzODU</a></p>

<p><a href="https://bbs.archlinux.org/viewtopic.php?id=187995">https://bbs.archlinux.org/viewtopic.php?id=187995</a></p>

<p><a href="https://www.youtube.com/watch?v=GdvmsWnZkyc">https://www.youtube.com/watch?v=GdvmsWnZkyc</a></p>

<p><a href="https://learn.adafruit.com/hacking-the-kinect/more-kinect-information">https://learn.adafruit.com/hacking-the-kinect/more-kinect-information</a></p>

<p><a href="https://www.linuxvoice.com/drive-it-yourself-usb-car-6/">https://www.linuxvoice.com/drive-it-yourself-usb-car-6/</a></p>

<p>Total Phase USB:</p>

<p><a href="http://www.totalphase.com/products/beagle-usb12/">http://www.totalphase.com/products/beagle-usb12/</a></p>

<p><a href="https://github.com/dmage/co2mon">https://github.com/dmage/co2mon</a></p>

<h3>40. v-usb tutorial</h3>

<p><a href="http://www.workinprogress.ca/v-usb-tutorial-software-only-usb-for-mega-tiny/">http://www.workinprogress.ca/v-usb-tutorial-software-only-usb-for-mega-tiny/</a></p>

<h3>41. v-usb and Arduino</h3>

<p><a href="https://www.hackster.io/rayburne/arduino-to-excel-using-v-usb-cbf701">https://www.hackster.io/rayburne/arduino-to-excel-using-v-usb-cbf701</a></p>

<p><a href="http://www.geek-workshop.com/forum.php?mod=viewthread&amp;tid=8578&amp;highlight=v-usb">http://www.geek-workshop.com/forum.php?mod=viewthread&amp;tid=8578&amp;highlight=v-usb</a></p>

<p><a href="http://coopermaa2nd.blogspot.tw/2011/10/v-usb-examples-for-arduino.html">http://coopermaa2nd.blogspot.tw/2011/10/v-usb-examples-for-arduino.html</a></p>

<p><a href="http://www.geek-workshop.com/thread-1137-1-1.html">http://www.geek-workshop.com/thread-1137-1-1.html</a></p>

<p><a href="http://www.geek-workshop.com/forum.php?mod=viewthread&amp;tid=15114&amp;highlight=v-usb">http://www.geek-workshop.com/forum.php?mod=viewthread&amp;tid=15114&amp;highlight=v-usb</a></p>

<h3>42.Set Timezone of the ArchLinux</h3>

<p>Change from UTC to Asia/Shanghai:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ timedatectl set-timezone Asia/Shanghai</span></code></pre></td></tr></table></div></figure>


<h3>43. Empty all of the bash history</h3>

<p>Empty the bash history via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rm -f ~/.bash_history</span></code></pre></td></tr></table></div></figure>


<h3>44. Specify qemu-binary in Packer.io</h3>

<p>Edit the json files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>"builders":
</span><span class='line'>[
</span><span class='line'>{
</span><span class='line'>"type": "qemu",
</span><span class='line'>"qemu_binary" : "/usr/libexec/qemu-kvm.sh",</span></code></pre></td></tr></table></div></figure>


<h3>45. apprmor.d</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>I modified /etc/apparmor.d/abstractions/libvirt-qemu to include the
</span><span class='line'>backing store directory</span></code></pre></td></tr></table></div></figure>


<h3>46. Recover UEFI bootloader</h3>

<p>After remove the mainline linux kernel, the archlinux is using the default kernel, but
the UEFI bootloader didn&rsquo;t notice this, following are the steps for recover the UEFI
bootloader.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grub-install --target=x86_64-efi --efi-directory=/boot/EFI   --bootloader-id=arch_grub --recheck
</span><span class='line'>cat ./EFI/loader/entries/arch.conf</span></code></pre></td></tr></table></div></figure>


<p>Change the items into <code>initramfs-linux</code>.</p>

<p>If you cannot login to the system, you could start the machine via USB disk or
installation media, using <code>arch-chroot /mnt/ /bin/bash</code> for login to the chroot system,
then do the above operations.</p>

<h3>47. bonding</h3>

<p><a href="http://sanswers.com/tube/wotC5GZ2FV0/bonding-eth0-and-wlan0-on-arch-linux">http://sanswers.com/tube/wotC5GZ2FV0/bonding-eth0-and-wlan0-on-arch-linux</a></p>

<h3>48. Fix currpted zsh history</h3>

<p>history corrupted.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mv .zsh_history .zsh_history_bad
</span><span class='line'>$ strings .zsh_history_bad &gt; .zsh_history
</span><span class='line'>$ fc -R .zsh_history</span></code></pre></td></tr></table></div></figure>


<h3>49. pulp</h3>

<p>Using pulp for managing the repositories of RPM/Docker, etc.</p>

<h3>50. Chromium flash</h3>

<p>Install chromium-pepper-flash in aur.</p>

<h3>51. Install xfce4 on CentOS</h3>

<p>Install xfce in epel repository via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># yum --enablerepo=epel -y groups install "Xfce" </span></code></pre></td></tr></table></div></figure>


<h3>52. LED controller</h3>

<p><a href="http://www.seeedstudio.com/recipe/402-smart-power-outlet.html">http://www.seeedstudio.com/recipe/402-smart-power-outlet.html</a></p>

<h3>53. Build php envs</h3>

<p><a href="https://medium.com/dev-tricks/apache-and-php-on-docker-44faef716150#.c8bguolj0">https://medium.com/dev-tricks/apache-and-php-on-docker-44faef716150#.c8bguolj0</a></p>

<h3>54. handle docker changes</h3>

<p><a href="http://dbaron.org/linux/handle-dock-change.py">http://dbaron.org/linux/handle-dock-change.py</a></p>

<h3>55. python detection of usb storage</h3>

<p><a href="https://linuxmeerkat.wordpress.com/2014/11/12/python-detection-of-usb-storage-device/">https://linuxmeerkat.wordpress.com/2014/11/12/python-detection-of-usb-storage-device/</a>  <br/>
d-feet for debugging of dbus..</p>

<h3>56. libmtp related</h3>

<p>Install <code>gvfp-mtp</code>, then you could get your nautillus have the mtp device
support.</p>

<p>Using <code>mtp-detect</code> for detecting the equipments and <code>mtp-connect</code> for
connecting the device.</p>

<h3>57. Virtualbox Driver Issue</h3>

<p>After upgrading the system, the virtualbox won&rsquo;t start the machine, this is because we
didn&rsquo;t install the kernel header, thus the dkms won&rsquo;t be run after system upgrading.
Install kernel-headers:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S linux-headers
</span><span class='line'>$ sudo /sbin/rcvboxdrv setup</span></code></pre></td></tr></table></div></figure>


<p></p>

<h3>58. Creation tools</h3>

<p><a href="https://linux.cn/article-7072-1.html">https://linux.cn/article-7072-1.html</a></p>

<h3>59. rvm reinstall issue</h3>

<p>openssl load error:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rvm pkg install openssl
</span><span class='line'>$ rvm install 2.2.1  --with-openssl-dir=$HOME/.rvm/usr
</span><span class='line'>$ proxychains4 gem update bundler</span></code></pre></td></tr></table></div></figure>


<p>Then you can continue to use your octopress.</p>

<h3>60 Install go on ArchLinux</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S go
</span><span class='line'>$ mkdir ~/go
</span><span class='line'>$ vim ~/.zshrc
</span><span class='line'>export GOPATH=~/go
</span><span class='line'>export PATH=$PATH:~/go/bin</span></code></pre></td></tr></table></div></figure>


<h3>61. Packer Development Version</h3>

<p>The steps on building packer on Ubuntu:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo add-apt-repository ppa:ubuntu-lxc/lxd-stable
</span><span class='line'>$ sudo apt-get update
</span><span class='line'>$ sudo apt-get install golang
</span><span class='line'>$ mkdir -p $HOME/Documents/golang
</span><span class='line'>$ export GOPATH=$HOME/Documents/golang
</span><span class='line'>$ export GO15VENDOREXPERIMENT=1
</span><span class='line'>$ export PATH=$PATH:$GOPATH/bin
</span><span class='line'>$ go get github.com/mitchellh/packer
</span><span class='line'>$ cd $GOPATH/src/github.com/mitchellh/packer
</span><span class='line'>$ sudo chown -R dash /home/dash/
</span><span class='line'>$ make</span></code></pre></td></tr></table></div></figure>


<p>bitnami</p>

<h3>62. Install add-apt-repository command</h3>

<p>add-apt-repository missing:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install software-properties-common</span></code></pre></td></tr></table></div></figure>


<h3>63. git checkout specified tags</h3>

<p>For checkout specified tag:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git tag -l
</span><span class='line'>.....
</span><span class='line'>.....
</span><span class='line'>xxyy
</span><span class='line'>$ git checkout tags/xxyy -b xxyy_local</span></code></pre></td></tr></table></div></figure>


<h3>64. Nested kvm On ArchLinux</h3>

<p>Enable the nested kvm for ArchLinux via following steps:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  ~ systool -m kvm_intel -v | grep nested
</span><span class='line'>    nested              = "N"
</span><span class='line'>  ~ modprobe -r kvm_intel
</span><span class='line'>modprobe: ERROR: could not remove 'kvm_intel': Operation not permitted
</span><span class='line'>  ~ sudo modprobe -r kvm_intel
</span><span class='line'>  ~ sudo modprobe kvm_intel nested=1
</span><span class='line'>  ~ sudo vim /etc/modprobe.d/modprobe.conf
</span><span class='line'>options kvm_intel nested=1
</span><span class='line'>  ~ systool -m kvm_intel -v | grep nested
</span><span class='line'>    nested              = "Y"</span></code></pre></td></tr></table></div></figure>


<h3>65. Failed to build rubygem</h3>

<p>Issue:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Unable to install gem - Failed to build gem native extension - cannot load
</span><span class='line'>such file  mkmf (LoadError)</span></code></pre></td></tr></table></div></figure>


<p>Solved by: <code>sudo apt-get install -y ruby-dev</code>.</p>

<h3>66. xe-tools location</h3>

<p>Loation for finding xe-tools:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pwd
</span><span class='line'>/opt/xensource/packages/iso
</span><span class='line'># ls
</span><span class='line'>XenCenter.iso  xs-tools-6.5.0-20001.iso  xs-tools-6.5.0.iso</span></code></pre></td></tr></table></div></figure>


<h3>67. Qemu Tunnel Types</h3>

<p><a href="http://linuxsimba.com/qemu-tunnel-types/">http://linuxsimba.com/qemu-tunnel-types/</a></p>

<h3>68. zsh history</h3>

<p>Error message is <code>zsh: corrupt history file /home/myusername/.zsh_history</code>.</p>

<p>Solved by:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  ~ mv .zsh_history .zsh_history_bad
</span><span class='line'>  ~ strings .zsh_history_bad &gt; .zsh_history
</span><span class='line'>  ~ fc -R .zsh_history</span></code></pre></td></tr></table></div></figure>


<h3>69. virsh priviledge In Ubuntu</h3>

<p>When met following issue, solved via add current user to <code>libvirtd</code> and <code>kvm</code>, relogin
again then issue would be solved:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Error while connecting to libvirt: Error making a connection to libvirt URI
</span><span class='line'>qemu:///system?no_verify=1&keyfile=/home/dash/.ssh/id_rsa:
</span><span class='line'>Call to virConnectOpen failed: Failed to connect socket to
</span><span class='line'>'/var/run/libvirt/libvirt-sock': Permission denied</span></code></pre></td></tr></table></div></figure>


<p>Solution :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo usermod -a -G kvm dash
</span><span class='line'>$ sudo usermod -a -G libvirtd dash</span></code></pre></td></tr></table></div></figure>


<h3>70. Vagrant ext vars</h3>

<p><a href="http://stackoverflow.com/questions/23008367/ansible-with-vagrant-read-inventory-from-vagrantfile-extra-vars">http://stackoverflow.com/questions/23008367/ansible-with-vagrant-read-inventory-from-vagrantfile-extra-vars</a></p>

<h3>71. rootpasswd in Kickstart</h3>

<p>Formats, and to generate the encrypted format.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rootpw "password here"
</span><span class='line'>rootpw --iscrypted password_hash
</span><span class='line'>$ openssl passwd -1 "password here"</span></code></pre></td></tr></table></div></figure>


<h3>72. On Vagrant Xenserver</h3>

<p>To build Xenserver vagrant box in packer:  <br/>
<a href="https://github.com/imduffy15/packer-xenserver">https://github.com/imduffy15/packer-xenserver</a></p>

<p>Possible usable vagrant box(For Xenserver): <br/>
<a href="https://vagrantcloud.com/duffy/boxes/xenserver">https://vagrantcloud.com/duffy/boxes/xenserver</a></p>

<p>Remote provisioning to a xenserver hypervisor:  <br/>
<a href="http://serverfault.com/questions/631837/remote-automated-provisioning-to-a-xenserver-hypervisor">http://serverfault.com/questions/631837/remote-automated-provisioning-to-a-xenserver-hypervisor</a></p>

<p>Ansible and Xen:  <br/>
<a href="http://sharknet.us/2013/12/13/276/">http://sharknet.us/2013/12/13/276/</a></p>

<p>Vagrant and XenServer:  <br/>
<a href="https://github.com/jonludlam/vagrant-xenserver">https://github.com/jonludlam/vagrant-xenserver</a></p>

<h3>73. Tips on Xenserver In Vagrant</h3>

<p>Mac address:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim /etc/sysconfig/network-scripts/interface-rename-data/static-rules.conf
</span><span class='line'>eth0:mac = "xxxxxxxxx"
</span><span class='line'># interface-rename --dry-run --reset-to-install</span></code></pre></td></tr></table></div></figure>


<p>Then  you could reset all of your configuration into the initial status.</p>

<h3>74. oh-my-vagrant</h3>

<p><a href="https://github.com/purpleidea/oh-my-vagrant">https://github.com/purpleidea/oh-my-vagrant</a></p>

<h3>75. Detect System</h3>

<p><a href="http://unix.stackexchange.com/questions/89714/easy-way-to-determine-virtualization-technology">http://unix.stackexchange.com/questions/89714/easy-way-to-determine-virtualization-technology</a></p>

<p>Use dmidecode.</p>

<h3>76. git remove untracked files</h3>

<p>Following commands will remove the untracked files in .gitignore.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$  git rm --cached .vagrant
</span><span class='line'>$  git rm --cached -r .vagrant
</span><span class='line'>$  git rm -r --cached . 
</span><span class='line'>$  git add .
</span><span class='line'>$  git commit -m "Added with gitignored"
</span><span class='line'>$  git push origin master</span></code></pre></td></tr></table></div></figure>


<h3>77. node mcu good example</h3>

<p><a href="http://bbs.nodemcu.com/t/nodemcu/1147">http://bbs.nodemcu.com/t/nodemcu/1147</a></p>

<h3>78. 8723ae issue</h3>

<p>Do following to make the rtl8723awe working more effeciently.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim  /etc/modprobe.d/rtl8723ae.conf
</span><span class='line'>options rtl8723ae fwlps=0</span></code></pre></td></tr></table></div></figure>


<h3>79. PDF Chinese</h3>

<p>Poppler-data will enable chinese support.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S poppler-data</span></code></pre></td></tr></table></div></figure>


<h3>80. Join multiple lines with comma</h3>

<p>abc.txt should remove the end enter and replaced with comma.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat abc.txt | tr '\n' ','</span></code></pre></td></tr></table></div></figure>


<p>Refers to:  <br/>
<a href="http://blog.irreverence.co.uk/?p=209">http://blog.irreverence.co.uk/?p=209</a></p>

<h3>81. Shrink vhd file</h3>

<p>In XenServer vms:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /dev/zero &gt; zero.dat ; sync ; sleep 1 ; sync ; rm zero.dat</span></code></pre></td></tr></table></div></figure>


<h3>82. VHD File Compact</h3>

<p>shirinking the vhd file via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ VBoxManage clonehd target.vhd cloned.vhd
</span><span class='line'>$ VBoxManage modifyhd cloned.vhd --compact</span></code></pre></td></tr></table></div></figure>


<h3>83. 1602 And RPI</h3>

<p><a href="http://www.raspberrypi-spy.co.uk/2015/05/using-an-i2c-enabled-lcd-screen-with-the-raspberry-pi/">http://www.raspberrypi-spy.co.uk/2015/05/using-an-i2c-enabled-lcd-screen-with-the-raspberry-pi/</a>  <br/>
<a href="http://raspberrypi.stackexchange.com/questions/28991/how-can-i-use-a-lcd-display-with-a-i2c-adapter">http://raspberrypi.stackexchange.com/questions/28991/how-can-i-use-a-lcd-display-with-a-i2c-adapter</a></p>

<h3>84. CPU Frequency</h3>

<p>Install and enable the service of cpupower via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S cpupower
</span><span class='line'>$ sudo systemctl enable cpupower.service
</span><span class='line'>$ sudo systemctl start cpupower.service</span></code></pre></td></tr></table></div></figure>


<p>configure the cpupower parameters via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$  cat /etc/default/cpupower   
</span><span class='line'># Define CPUs governor
</span><span class='line'># valid governors: ondemand, performance, powersave, conservative, userspace.
</span><span class='line'>governor='performance'</span></code></pre></td></tr></table></div></figure>


<p>Some useful commands should be like:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo cpupower frequency-set -f  3.06
</span><span class='line'>$ cpupower frequency-info
</span><span class='line'>$ watch grep \"cpu MHz\" /proc/cpuinfo</span></code></pre></td></tr></table></div></figure>


<h3>85. Gmail Mutt</h3>

<p><a href="https://www.linux.com/community/blogs/133-general-linux/850945-setup-mutt-with-gmail-on-centos-and-ubuntu">https://www.linux.com/community/blogs/133-general-linux/850945-setup-mutt-with-gmail-on-centos-and-ubuntu</a></p>

<h3>86. Fake Video</h3>

<p><a href="http://www.atechnote.com/2014/11/create-fake-webcam.html">http://www.atechnote.com/2014/11/create-fake-webcam.html</a>  <br/>
<a href="https://developer.ubuntu.com/en/snappy/start/">https://developer.ubuntu.com/en/snappy/start/</a></p>

<h3>87. Way Of Snappy Extend</h3>

<p><a href="http://askubuntu.com/questions/577105/is-there-a-way-to-add-repo-to-snappy-ubuntu-core">http://askubuntu.com/questions/577105/is-there-a-way-to-add-repo-to-snappy-ubuntu-core</a></p>

<h3>88. pl2802 driver</h3>

<p>You probably have a counterfeit adapter. It won&rsquo;t work with the updated driver. You
need to find the 3.2.0.0 driver and use it instead. You can find it here
<a href="http://www.miklor.com/COM/UV_Drivers.php">http://www.miklor.com/COM/UV_Drivers.php</a></p>

<h3>83. collectd On ArchLinux</h3>

<p>Install collectd via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S rrdtool net-snmp liboping collectd</span></code></pre></td></tr></table></div></figure>


<h3>84. gem path</h3>

<p>Use <code>gem env</code> for detecting the system variables, some variables should be added into
system path.</p>

<h3>85. Vagrant and packer.io</h3>

<p><a href="http://boxupp.com/">http://boxupp.com/</a>  <br/>
<a href="http://phansible.com/">http://phansible.com/</a>  <br/>
<a href="https://puphpet.com/#">https://puphpet.com/#</a>  <br/>
<a href="getprotobox.com/">getprotobox.com/</a>  <br/>
<a href="http://www.sitepoint.com/5-easy-ways-getting-started-php-vagrant/">http://www.sitepoint.com/5-easy-ways-getting-started-php-vagrant/</a>  <br/>
<a href="http://rove.io/">http://rove.io/</a></p>

<h3>86 Install latest ansible</h3>

<p>Install the latest ansible on Ubuntu:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get update
</span><span class='line'>$ sudo apt-get install software-properties-common
</span><span class='line'>$ sudo apt-add-repository ppa:ansible/ansible</span></code></pre></td></tr></table></div></figure>


<h3>87. Packer And Ansible</h3>

<p><a href="http://www.jeffgeerling.com/blog/server-vm-images-ansible-and-packer">http://www.jeffgeerling.com/blog/server-vm-images-ansible-and-packer</a></p>

<h3>88. Vagrant issue</h3>

<p>Problem is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo vagrant up
</span><span class='line'>Bringing machine 'tunirserver' up with 'libvirt' provider...
</span><span class='line'>/usr/share/gems/gems/fog-1.23.0/lib/fog/libvirt/requests/compute/list_volumes.rb:32:in `info': Call to virStorageVolGetInfo failed: Storage volume not found: no storage vol with matching path '/tmp/orbit-kdas' (Libvirt::RetrieveError)</span></code></pre></td></tr></table></div></figure>


<p>Solved by:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$  sudo virsh pool-list
</span><span class='line'> Name                 State      Autostart 
</span><span class='line'>-------------------------------------------
</span><span class='line'> default              active     yes       
</span><span class='line'> tmp                  active     yes 
</span><span class='line'>Then refreshing each pool manually.
</span><span class='line'>
</span><span class='line'>$  sudo virsh pool-refresh tmp
</span><span class='line'>Pool tmp refreshed
</span><span class='line'>$  sudo virsh pool-refresh default
</span><span class='line'>Pool default refreshed</span></code></pre></td></tr></table></div></figure>


<h3>89. apicv tips.</h3>

<p>View and modify the parameters.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>options kvm_intel nested=1
</span><span class='line'>options kvm_intel enable_shadow_vmcs=1
</span><span class='line'>options kvm_intel enable_apicv=1
</span><span class='line'>options kvm_intel ept=1
</span><span class='line'>
</span><span class='line'>By setting enable_apicv=0 the messages are gone
</span><span class='line'>cat /sys/module/kvm_intel/parameters/enable_apicv
</span><span class='line'>N </span></code></pre></td></tr></table></div></figure>


<h3>90. Disable apic in XenServer</h3>

<p><a href="http://discussions.citrix.com/topic/350144-xen62-turn-off-acpi-without-grubconfmenulst/">http://discussions.citrix.com/topic/350144-xen62-turn-off-acpi-without-grubconfmenulst/</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>if you look into the /boot/extlinux.conf the safe mode uses acpi=off params  as
</span><span class='line'>
</span><span class='line'>label safe
</span><span class='line'>  # XenServer in Safe Mode
</span><span class='line'>  kernel mboot.c32
</span><span class='line'>  append /boot/xen.gz nosmp noreboot noirqbalance acpi=off noapic mem=1024G dom0_max_vcpus=4 dom0_mem=752M,max:752M com1=115200,8n1 console=com1,vga --- /boot/vmlinuz-2.6-xen nousb root=LABEL=root-fxfyhkuc ro console=tty0 xencons=hvc console=hvc0 --- /boot/initrd-2.6-xen.img</span></code></pre></td></tr></table></div></figure>


<h3>91. Quickly devstack</h3>

<p>Clone the repository from:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone http://github.com/openstack-dev/devstack
</span><span class='line'>cd devstack/</span></code></pre></td></tr></table></div></figure>


<p>Edit localrc via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>For Git Clone
</span><span class='line'>
</span><span class='line'> git clone http://git.trystack.cn/openstack/nova.git 
</span><span class='line'>
</span><span class='line'>For DevStack
</span><span class='line'>
</span><span class='line'>Add GIT_BASE, NOVNC_REPO and SPICE_REPO variables to local.conf file.
</span><span class='line'>
</span><span class='line'>[[local|localrc]]
</span><span class='line'>
</span><span class='line'># use TryStack git mirror
</span><span class='line'>GIT_BASE=http://git.trystack.cn
</span><span class='line'>NOVNC_REPO=http://git.trystack.cn/kanaka/noVNC.git
</span><span class='line'>SPICE_REPO=http://git.trystack.cn/git/spice/spice-html5.git
</span></code></pre></td></tr></table></div></figure>


<p>Here you could go on with devstack.sh</p>

<h3>92. find and replace string in one directory</h3>

<p>Be sure to use /bin/bash without any colors.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grep -rli '192.168.1.69' | xargs -i@ sed -i 's/192.168.1.69/192.168.0.121:8080/g' @</span></code></pre></td></tr></table></div></figure>


<h3>93. Two IDES</h3>

<p>Startup the cloud9 and eclise-orion via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -it -d -p 8888:80 kdelfour/cloud9-docker
</span><span class='line'>$ sudo docker run -it -d -p 8889:8080 fabric8/eclipse-orion  </span></code></pre></td></tr></table></div></figure>


<h3>94. RaspberryPI And WebTop</h3>

<p><a href="http://www.instructables.com/id/Raspberry-PI-Motorola-Lapdock/step7/References/">http://www.instructables.com/id/Raspberry-PI-Motorola-Lapdock/step7/References/</a></p>

<h3>95. npm china</h3>

<p>Use following command for using cnpm for replacing the npm:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ npm install -g cnpm --registry=https://registry.npm.taobao.org</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/15/vlan-experiment/">Vlan Experiment</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-15T09:16:34+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:16 am</span></time>
        
         | <a href="/blog/2016/01/15/vlan-experiment/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I am busy with configurating the LXC networking in Cloudstack, so following is
how I understanding the vlan experiment on how to understand the
public/private/management networking in CloudStack.</p>

<h3>Prerequisite</h3>

<p>Prepare 2 virtual machine of CentOS6.7, each connected to a seperated networking. <br/>
Machine 1, dhcp, got 10.47.58.203. Named vlan1.      <br/>
Machine 2, dhcp, got 10.47.58.214. Named vlan2.</p>

<h3>Install Software</h3>

<p>For easily configure 802.1Q vlan tagging networking in CentOS7, install following packages.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ yum install vconfig</span></code></pre></td></tr></table></div></figure>


<h3>Vlan Configurating</h3>

<p>Configure like following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0
</span><span class='line'>DEVICE="eth0"
</span><span class='line'>#BOOTPROTO="dhcp"
</span><span class='line'>BOOTPROTO="none"
</span><span class='line'>NM_CONTROLLED="yes"
</span><span class='line'>ONBOOT="yes"
</span><span class='line'>TYPE="Ethernet"
</span><span class='line'>[root@localhost ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0.100 
</span><span class='line'>DEVICE=eth0.100
</span><span class='line'>ONBOOT=yes
</span><span class='line'>HOTPLUG=no
</span><span class='line'>BOOTPROTO=none
</span><span class='line'>TYPE=Ethernet
</span><span class='line'>VLAN=yes
</span><span class='line'>IPADDR=192.168.42.11
</span><span class='line'>NETMASK=255.255.255.0</span></code></pre></td></tr></table></div></figure>


<p>In another machine, configure the eth0.100 as <code>192.168.42.12</code>, after reboot, they could
be reached via this vlan tagging 100 address.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/14/cloudstackshi-yong-lxcyao-dian/">CloudStackLXC</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-14T19:41:03+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>7:41 pm</span></time>
        
         | <a href="/blog/2016/01/14/cloudstackshi-yong-lxcyao-dian/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3></h3>

<p>Cloudstack 4.6.0, Management Server, Agent.   <br/>
KVM.</p>

<h3>Agent</h3>

<p>hypervisorLXC:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim /etc/cloudstack/agent/agent.properties
</span><span class='line'> hypervisor.type=lxc
</span><span class='line'>$ service cloudstack-agent restart</span></code></pre></td></tr></table></div></figure>


<h3>LXC</h3>

<p>CloudStack Management,:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ /usr/share/cloudstack-common/scripts/storage/secondary/cloud-install-sys-tmplt -m /mnt1 -u http://192.168.177.13/systemvm64template-4.6.0-kvm.qcow2.bz2 -h lxc -F</span></code></pre></td></tr></table></div></figure>


<p>.</p>

<h3>Zone</h3>

<p>Zone,hypervisorLXC.  <br/>
/.  <br/>
, enable zone, , HVM.</p>

<p>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/11/install-cloudstack-mgmt-server-on-centos7/">Install CloudStack Mgmt Server on CentOS7</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-11T15:03:38+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>3:03 pm</span></time>
        
         | <a href="/blog/2016/01/11/install-cloudstack-mgmt-server-on-centos7/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Steps</h3>

<p>Disable selinux:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># setenforce permissive
</span><span class='line'># vim /etc/selinux/config 
</span><span class='line'>SELINUX=permissive</span></code></pre></td></tr></table></div></figure>


<p>Edit the hostname and hosts file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@csman ~]# cat /etc/hostname 
</span><span class='line'>csman
</span><span class='line'>[root@csman ~]# cat /etc/hosts
</span><span class='line'>127.0.0.1 localhost localhost.cstack.local
</span><span class='line'>192.168.56.12 csman.cstack.local csman
</span><span class='line'>192.168.56.101 xenserver.cstack.local xenserver</span></code></pre></td></tr></table></div></figure>


<p>Enable the ntp server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># yum install -y ntp
</span><span class='line'># chkconfig ntpd on
</span><span class='line'># service ntpd start</span></code></pre></td></tr></table></div></figure>


<p>Configure the nfs sharing:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mkdir /exports
</span><span class='line'># mkdir -p /exports/primary
</span><span class='line'># mkdir -p /exports/secondary
</span><span class='line'># chmod 777 -R /exports
</span><span class='line'># echo "/exports/primary 10.10.100.0/24(rw,async,no_root_squash)" &gt; /etc/exports
</span><span class='line'># echo "/exports/secondary 10.10.101.0/24(rw,async,no_root_squash)" &gt;&gt; /etc/exports
</span><span class='line'># exportfs -a</span></code></pre></td></tr></table></div></figure>


<p>Configure the nfs ruls:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># sed -i -e '/#MOUNTD_NFS_V3="no"/ c\MOUNTD_NFS_V3="yes"' -e '/#RQUOTAD_PORT=875/ c\RQUOTAD_PORT=875' -e '/#LOCKD_TCPPORT=32803/ c\LOCKD_TCPPORT=32803' -e '/#LOCKD_UDPPORT=32769/ c\LOCKD_UDPPORT=32769' -e '/#MOUNTD_PORT=892/ c\MOUNTD_PORT=892' -e '/#STATD_PORT=662/ c\STATD_PORT=662' -e '/#STATD_OUTGOING_PORT=2020/ c\STATD_OUTGOING_PORT=2020' /etc/sysconfig/nfs
</span><span class='line'># sed -i -e "/:OUTPUT/ a\-A INPUT -p tcp -m tcp --dport 111 -j ACCEPT" /etc/sysconfig/iptables
</span><span class='line'># sed -i -e "/:OUTPUT/ a\-A INPUT -p udp -m udp --dport 111 -j ACCEPT" /etc/sysconfig/iptables
</span><span class='line'># sed -i -e "/:OUTPUT/ a\-A INPUT -p tcp -m tcp --dport 2049 -j ACCEPT" /etc/sysconfig/iptables
</span><span class='line'># sed -i -e "/:OUTPUT/ a\-A INPUT -p udp -m udp --dport 2049 -j ACCEPT" /etc/sysconfig/iptables
</span><span class='line'># sed -i -e "/:OUTPUT/ a\-A INPUT -p tcp -m tcp --dport 2020 -j ACCEPT" /etc/sysconfig/iptables
</span><span class='line'># sed -i -e "/:OUTPUT/ a\-A INPUT -p tcp -m tcp --dport 32803 -j ACCEPT" /etc/sysconfig/iptables
</span><span class='line'># sed -i -e "/:OUTPUT/ a\-A INPUT -p udp -m udp --dport 32769 -j ACCEPT" /etc/sysconfig/iptables
</span><span class='line'># sed -i -e "/:OUTPUT/ a\-A INPUT -p tcp -m tcp --dport 892 -j ACCEPT" /etc/sysconfig/iptables
</span><span class='line'># sed -i -e "/:OUTPUT/ a\-A INPUT -p udp -m udp --dport 892 -j ACCEPT" /etc/sysconfig/iptables
</span><span class='line'># sed -i -e "/:OUTPUT/ a\-A INPUT -p tcp -m tcp --dport 875 -j ACCEPT" /etc/sysconfig/iptables
</span><span class='line'># sed -i -e "/:OUTPUT/ a\-A INPUT -p udp -m udp --dport 875 -j ACCEPT" /etc/sysconfig/iptables
</span><span class='line'># sed -i -e "/:OUTPUT/ a\-A INPUT -p tcp -m tcp --dport 662 -j ACCEPT" /etc/sysconfig/iptables
</span><span class='line'># sed -i -e "/:OUTPUT/ a\-A INPUT -p udp -m udp --dport 662 -j ACCEPT" /etc/sysconfig/iptables
</span><span class='line'># service iptables restart
</span><span class='line'># chkconfig nfs on
</span><span class='line'># service nfs restart</span></code></pre></td></tr></table></div></figure>


<p>Install the packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># yum install -y cloudstack-management
</span><span class='line'># yum -y install mariadb-server mariadb</span></code></pre></td></tr></table></div></figure>


<p>Configure the mariadb:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># sed -i -e '/datadir/ a\innodb_rollback_on_timeout=1' -e '/datadir/ a\innodb_lock_wait_timeout=600' -e '/datadir/ a\max_connections=350' -e '/datadir/ a\log-bin=mysql-bin' -e "/datadir/ a\binlog-format = 'ROW'" -e "/datadir/ a\bind-address = 0.0.0.0" /etc/my.cnf
</span><span class='line'># systemctl enable mariadb
</span><span class='line'># systemctl start mariadb
</span><span class='line'># systemctl start mariadb.service
</span><span class='line'># mysql_secure_installation</span></code></pre></td></tr></table></div></figure>


<p>Setup the privileges:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@csman system]# mysql -u root -pengine123
</span><span class='line'>MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION;
</span><span class='line'>MariaDB [(none)]&gt; quit</span></code></pre></td></tr></table></div></figure>


<p>Setup the management database and setup the managment server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cloudstack-setup-databases cloud:&lt;password&gt;@127.0.0.1 --deploy-as=root:&lt;password&gt;
</span><span class='line'># cloudstack-setup-management --tomcat7
</span><span class='line'># service cloudstack-management start
</span><span class='line'># /bin/systemctl enable  cloudstack-management.service</span></code></pre></td></tr></table></div></figure>


<p>Nginx:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># echo "[nginx]
</span><span class='line'>name=nginx repo
</span><span class='line'>baseurl=http://nginx.org/packages/centos/\$releasever/\$basearch/
</span><span class='line'>gpgcheck=0
</span><span class='line'>enabled=1" &gt; /etc/yum.repos.d/nginx.repo
</span><span class='line'># yum install nginx -y
</span><span class='line'># cd /usr/share/nginx/html
</span><span class='line'># wget -nc http://download.cloud.com/templates/builtin/centos56-x86_64.vhd.bz2
</span><span class='line'># sed -i -e "/:OUTPUT/ a\-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT" /etc/sysconfig/iptables
</span><span class='line'># service iptables restart</span></code></pre></td></tr></table></div></figure>


<p>vhd-utils:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cd /usr/share/cloudstack-common/scripts/vm/hypervisor/xenserver/
</span><span class='line'># wget http://download.cloud.com.s3.amazonaws.com/tools/vhd-util
</span><span class='line'># chmod 755 /usr/share/cloudstack-common/scripts/vm/hypervisor/xenserver/vhd-util</span></code></pre></td></tr></table></div></figure>


<p>SystemVM Template:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># /usr/share/cloudstack-common/scripts/storage/secondary/cloud-install-sys-tmplt -m /exports/secondary -u http://xxxxxxxxxxxxx -h xenserver -F</span></code></pre></td></tr></table></div></figure>


<p>CloudStack usage server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># yum install cloudstack-usage -y
</span><span class='line'># service cloudstack-usage start</span></code></pre></td></tr></table></div></figure>


<p>Mysql related:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mysql -p&lt;password&gt; cloud -e \ "INSERT INTO cloud.configuration (category, instance, component, name, value, description) VALUES ('Advanced', 'DEFAULT', 'management-server', 'xen.check.hvm', 'false', 'Shoud we allow only the XenServers support HVM');"
</span></code></pre></td></tr></table></div></figure>


<h3>If KVM</h3>

<p>Install bridge-utils:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># yum install -y bridge-utils</span></code></pre></td></tr></table></div></figure>


<p>Edit the bridge connections:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat /etc/sysconfig/network-scripts/ifcfg-eth0 
</span><span class='line'>DEVICE="eth0"
</span><span class='line'>ONBOOT="yes"
</span><span class='line'>BOOTPROTO=none
</span><span class='line'>NM_CONTROLLED="no"
</span><span class='line'>BRIDGE="cloudbr0"
</span><span class='line'>TYPE=Ethernet
</span><span class='line'># cat /etc/sysconfig/network-scripts/ifcfg-cloudbr0
</span><span class='line'>DEVICE="cloudbr0"
</span><span class='line'>ONBOOT="yes"
</span><span class='line'>NM_CONTROLLED=yes
</span><span class='line'>TYPE="Bridge"
</span><span class='line'>BOOTPROTO=static
</span><span class='line'>IPADDR=10.47.58.11
</span><span class='line'>NETMASK=255.255.255.0
</span><span class='line'>GATEWAY=10.47.58.1
</span><span class='line'>DNS1=223.5.5.5
</span><span class='line'>DEFROUTE=yes</span></code></pre></td></tr></table></div></figure>


<h3>Building 4.5.2/4.5.1 For CentOS 7</h3>

<p>Key-Step:</p>

<p><a href="http://zooi.widodh.nl/cloudstack/build-dep/cloud-manageontap.jar">http://zooi.widodh.nl/cloudstack/build-dep/cloud-manageontap.jar</a></p>

<h3>CentOS7 Isuse On CloudStack4.5.2</h3>

<p>Could not start the service of cloudstack-management, then you should manually add one
line in definition of the service file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@csmgmt ~]# vim /usr/lib/systemd/system/cloudstack-management.service
</span><span class='line'>[Service]
</span><span class='line'>+ PermissionsStartOnly=true
</span><span class='line'>[root@csmgmt ~]# systemctl daemon-reload
</span><span class='line'>[root@csmgmt ~]# service cloudstack-management start
</span><span class='line'>Redirecting to /bin/systemctl start  cloudstack-management.service
</span><span class='line'>[root@csmgmt ~]# netstat -anp | grep 8080
</span><span class='line'>tcp6       0      0 :::8080                 :::*                    LISTEN
</span><span class='line'>5665/java  </span></code></pre></td></tr></table></div></figure>


<p>Another issue:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Could not load org.apache.commons.pool.impl.CursorableLinkedList$Cursor</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/01/04/purge-cloudstack-env/">Purge CloudStack Env</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-04T16:26:30+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>4:26 pm</span></time>
        
         | <a href="/blog/2016/01/04/purge-cloudstack-env/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For totally reset the configured cloudstack environment, do following commands:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># service cloudstack-management stop
</span><span class='line'># mysql -pengine123 -e 'drop database cloud'
</span><span class='line'># mysql -pengine123 -e 'drop database cloud_usage'
</span><span class='line'># cloudstack-setup-databases cloud:engine123@localhost --deploy-as=root:engine123
</span><span class='line'># rm -rf /var/log/cloud/management/*
</span><span class='line'># cloudstack-setup-management 
</span><span class='line'># service cloudstack-management start</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/6">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/4">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/04/20/devstack-enable-neutron/">DevStack Enable Neutron</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/04/18/change-ip-in-devstack/">Change IP in DevStack</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/04/15/moving-docker-repository-position/">Moving Docker Repository Position</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/04/06/tips-on-setup-eclipse-che/">Tips on Setup Eclipse CHE</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/04/05/extend-vagrants-disk/">Extend Vagrant's Disk</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
