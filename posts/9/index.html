
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="For playing docker and prepare for my presentation, I wrote this series and try to record my tips on playing docker. Background I created a droplet &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/9">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.useso.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/27/play-docker-1/">Play Docker(1)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-27T20:39:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:39 pm</span></time>
        
         | <a href="/blog/2015/01/27/play-docker-1/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For playing docker and prepare for my presentation, I wrote this series and try to record my tips on playing docker.</p>

<h3>Background</h3>

<p>I created a droplet on DigitalOcean.com, which is running CentOS 7, the memory is only 512M, with one core and 20G size disk, which means its caculation resource is pretty limited, so heavy tasks should be avoid, like building.  <br/>
Since the memory is only 512M, I allocated 1G swapfile to the machine.  <br/>
The usable disk is 17G now.</p>

<h3>Docker Installation</h3>

<p>Docker is already part of CentOS7, so install it directly via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo yum install -y docker
</span><span class='line'>$ which docker
</span><span class='line'>/usr/bin/docker
</span></code></pre></td></tr></table></div></figure>


<p>Start the service and make it default:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo service docker start
</span><span class='line'>Redirecting to /bin/systemctl start  docker.service
</span><span class='line'>$ sudo chkconfig docker on
</span><span class='line'>Note: Forwarding request to 'systemctl enable docker.service'.
</span><span class='line'>ln -s '/usr/lib/systemd/system/docker.service' '/etc/systemd/system/multi-user.target.wants/docker.service'
</span></code></pre></td></tr></table></div></figure>


<p>Now even if you restart the machine, the service would be automatically started together with system boot.</p>

<h3>First Instance</h3>

<p>Pull the debian back:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker pull debian
</span><span class='line'>Pulling repository debian
</span><span class='line'>c90d655b99b2: Download complete 
</span><span class='line'>511136ea3c5a: Download complete 
</span><span class='line'>30d39e59ffe2: Download complete 
</span><span class='line'>Status: Downloaded newer image for debian:latest
</span><span class='line'>$ sudo docker images
</span><span class='line'>REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
</span><span class='line'>debian              wheezy              c90d655b99b2        8 hours ago         85.12 MB
</span><span class='line'>debian              7                   c90d655b99b2        8 hours ago         85.12 MB
</span><span class='line'>debian              7.8                 c90d655b99b2        8 hours ago         85.12 MB
</span><span class='line'>debian              latest              c90d655b99b2        8 hours ago         85.12 MB
</span></code></pre></td></tr></table></div></figure>


<p>Install the <code>lsb_release</code>, then run different tags, all of them are the same:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -i -t debian:7.8 /bin/bash
</span><span class='line'>xxxxxxx # lsb_release -a 
</span><span class='line'>No LSB modules are available.
</span><span class='line'>Distributor ID:   Debian
</span><span class='line'>Description:  Debian GNU/Linux 7.8 (wheezy)
</span><span class='line'>Release:  7.8
</span><span class='line'>Codename: wheezy
</span></code></pre></td></tr></table></div></figure>


<h3>Destroy Container</h3>

<p>List all of the container via <code>sudo docker ps -a</code>, then destroy the container via <code>sudo docker rm xxxxxx</code> while xxxxxx is the container ID.  <br/>
Play magic, one line for remove all of the containers:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker rm `sudo docker ps -a -q`
</span><span class='line'>16d606046c24
</span><span class='line'>65ceffcf4a7b
</span><span class='line'>dfbc6d0fa051
</span><span class='line'>1dd18dbf8b9c
</span><span class='line'>66c931879c2c
</span><span class='line'>$ sudo docker ps -a
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span></code></pre></td></tr></table></div></figure>


<h3>Remove The Images</h3>

<p>One line for remove all of the ununsed images:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker images -q
</span><span class='line'>c90d655b99b2
</span><span class='line'>c90d655b99b2
</span><span class='line'>c90d655b99b2
</span><span class='line'>c90d655b99b2
</span><span class='line'>$ sudo docker rmi `sudo docker images -q`
</span><span class='line'>Untagged: debian:7
</span><span class='line'>Untagged: debian:7.8
</span><span class='line'>Untagged: debian:latest
</span><span class='line'>Untagged: debian:wheezy
</span><span class='line'>Deleted: c90d655b99b2ec5b7e94d38c87f92dce015c17a313caeaae0e980d9b9bed8444
</span><span class='line'>Deleted: 30d39e59ffe287f29a41a3f8bd70734afc8728329e3289945cbdc5bbf07cd980
</span><span class='line'>Deleted: 511136ea3c5a64f264b78b5433614aec563103b4d4702f3ba7d4d2698e22c158
</span><span class='line'>Error response from daemon: No such image: c90d655b99b2
</span><span class='line'>Error response from daemon: No such image: c90d655b99b2
</span><span class='line'>Error response from daemon: No such image: c90d655b99b2
</span><span class='line'>2015/01/27 21:14:01 Error: failed to remove one or more images
</span><span class='line'>$ sudo docker images
</span><span class='line'>REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
</span></code></pre></td></tr></table></div></figure>


<p>But it would be add a pipe like <code>sudo docker images -q | uniq</code></p>

<h3>Connect To Existing Running Container</h3>

<h4>Docker 1.3 Ways</h4>

<p>From Docker 1.3, we could use <code>docker exec -it</code> for attaching to running container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -i -t centos /bin/bash
</span><span class='line'>[root@1f9005d495c6 /]# 
</span><span class='line'>$ sudo docker ps
</span><span class='line'>[sudo] password for Trusty: 
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span><span class='line'>1f9005d495c6        centos:7            "/bin/bash"         8 minutes ago       Up 8 minutes                            sick_jones          
</span><span class='line'>$ sudo docker exec -it 1f9005d495c6 /bin/bash
</span><span class='line'>[root@1f9005d495c6 /]# 
</span></code></pre></td></tr></table></div></figure>


<p>But the Container&rsquo;s lifecycle is controlled by the first instance, <code>docker exec</code> only attached to, this means if you exit the container, all of the <code>docker exec</code> tty will be shutdown.</p>

<h4>Nsenter Ways</h4>

<p>First use <code>docker inspect</code> for get the PID.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker ps 
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span><span class='line'>8337ea52cfd1        centos:7            "/bin/bash"         4 seconds ago       Up 4 seconds                            pensive_blackwell   
</span><span class='line'>$ PID=$(sudo docker inspect --format  8337ea52cfd1)
</span><span class='line'>$ echo $PID
</span><span class='line'>3951
</span></code></pre></td></tr></table></div></figure>


<p>Use nsenter for enter the PID&rsquo;s namespace:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo nsenter --target $PID --mount --uts --ipc --net --pid
</span><span class='line'>[root@8337ea52cfd1 /]#
</span></code></pre></td></tr></table></div></figure>


<h4>Lazy Wrap of Nsenter Ways</h4>

<p>Just visit:   <br/>
<a href="https://github.com/jpetazzo/nsenter">https://github.com/jpetazzo/nsenter</a>, download the docker-enter, and place it in the right place:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker ps 
</span><span class='line'>[sudo] password for Trusty: 
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span><span class='line'>8337ea52cfd1        centos:7            "/bin/bash"         11 minutes ago      Up 11 minutes                           pensive_blackwell   
</span><span class='line'>$ sudo docker-enter pensive_blackwell ls -la
</span><span class='line'>...
</span><span class='line'>$ sudo docker-enter 8337ea52cfd1 /bin/bash
</span><span class='line'>[root@8337ea52cfd1 /]# 
</span></code></pre></td></tr></table></div></figure>


<h4>Docker Attach</h4>

<p>If you attach to the container, you must remember, better you use tmux holding the whole instance.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker ps
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span><span class='line'>057435c2f1cb        centos:7            "/bin/bash"         5 seconds ago       Up 4 seconds                            evil_kirch          
</span><span class='line'>$ sudo docker attach 057435c2f1cb
</span><span class='line'>[root@057435c2f1cb /]# ls
</span><span class='line'>bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  selinux  srv  sys  tmp  usr  var
</span></code></pre></td></tr></table></div></figure>


<p>Once you quit from the &ldquo;attached&rdquo; tty, the origin tty will also quit.</p>

<h3>More System Info</h3>

<p>Use <code>docker info</code> to get more detailed system infos:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker info
</span><span class='line'>Containers: 3
</span><span class='line'>Images: 3
</span><span class='line'>Storage Driver: devicemapper
</span><span class='line'> Pool Name: docker-253:1-397799-pool
</span><span class='line'> Pool Blocksize: 65.54 kB
</span><span class='line'> Data file: /var/lib/docker/devicemapper/devicemapper/data
</span><span class='line'> Metadata file: /var/lib/docker/devicemapper/devicemapper/metadata
</span><span class='line'> Data Space Used: 563.1 MB
</span><span class='line'> Data Space Total: 107.4 GB
</span><span class='line'> Metadata Space Used: 1.069 MB
</span><span class='line'> Metadata Space Total: 2.147 GB
</span><span class='line'> Library Version: 1.02.84-RHEL7 (2014-03-26)
</span><span class='line'>Execution Driver: native-0.2
</span><span class='line'>Kernel Version: 3.10.0-123.8.1.el7.x86_64
</span><span class='line'>Operating System: CentOS Linux 7 (Core)
</span><span class='line'>$ sudo docker images
</span><span class='line'>REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
</span><span class='line'>centos              7                   8efe422e6104        3 weeks ago         224 MB
</span><span class='line'>centos              centos7             8efe422e6104        3 weeks ago         224 MB
</span><span class='line'>centos              latest              8efe422e6104        3 weeks ago         224 MB
</span><span class='line'>$ sudo docker ps -a
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                       PORTS               NAMES
</span><span class='line'>057435c2f1cb        centos:7            "/bin/bash"         3 minutes ago       Exited (0) 54 seconds ago                        evil_kirch          
</span><span class='line'>8337ea52cfd1        centos:7            "/bin/bash"         21 minutes ago      Exited (127) 4 minutes ago                       pensive_blackwell   
</span><span class='line'>1f9005d495c6        centos:7            "/bin/bash"         34 minutes ago      Exited (0) 24 minutes ago                        sick_jones          
</span></code></pre></td></tr></table></div></figure>


<h3>Commit Changes</h3>

<p>Install the vim in the running container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -i -t centos /bin/bash
</span><span class='line'>[sudo] password for Trusty: 
</span><span class='line'>[root@ea29113ba0e1 /]# which vim
</span><span class='line'>/usr/bin/which: no vim in (/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin)
</span><span class='line'>[root@ea29113ba0e1 /]# yum install -y vim
</span></code></pre></td></tr></table></div></figure>


<p>In another container, commit the changes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker commit ea29113ba0e1 vim_installed
</span><span class='line'>54cebb627e37600e81a832616eb3253af5dd26d0d248b9a9251e23bc8c93567d
</span><span class='line'>$ sudo docker images
</span><span class='line'>REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
</span><span class='line'>vim_installed       latest              54cebb627e37        12 seconds ago      362.6 MB
</span><span class='line'>centos              latest              8efe422e6104        3 weeks ago         224 MB
</span><span class='line'>centos              7                   8efe422e6104        3 weeks ago         224 MB
</span><span class='line'>centos              centos7             8efe422e6104        3 weeks ago         224 MB
</span></code></pre></td></tr></table></div></figure>


<p>Next time if you want to use the vim installed images, simply run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -it vim_installed /bin/bash
</span><span class='line'>[root@4b76f0c7bc46 /]# which vim
</span><span class='line'>/usr/bin/vim
</span></code></pre></td></tr></table></div></figure>


<h3>Job Controlling</h3>

<p>Use environment variables for recording the running job:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ JOB=$(sudo docker run -d vim_installed /bin/sh -c "while true; do echo Hello World; sleep 1; done")
</span><span class='line'>$ echo $JOB
</span><span class='line'>5dcb0884d27077e84ef4fea7fc0b3e8151657e92e0c2d4d1e33f84483715dfb9
</span></code></pre></td></tr></table></div></figure>


<p>Examine the log from the app&rsquo;s output:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker logs $JOB
</span><span class='line'>$ sudo docker logs --follow $JOB
</span></code></pre></td></tr></table></div></figure>


<p>Add &ndash;follow will continue to view the log output.  <br/>
Stop the running container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker stop $JOB
</span><span class='line'>5dcb0884d27077e84ef4fea7fc0b3e8151657e92e0c2d4d1e33f84483715dfb9
</span></code></pre></td></tr></table></div></figure>


<p>Start the stopped container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker start $JOB
</span><span class='line'>5dcb0884d27077e84ef4fea7fc0b3e8151657e92e0c2d4d1e33f84483715dfb9
</span></code></pre></td></tr></table></div></figure>


<p>Or Restart:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker restart $JOB
</span></code></pre></td></tr></table></div></figure>


<p>Or kill:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker kill $JOB
</span></code></pre></td></tr></table></div></figure>


<p>Notice the kill exit code is -1:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker ps
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span><span class='line'>$ sudo docker ps -a
</span><span class='line'>CONTAINER ID        IMAGE                  COMMAND                CREATED             STATUS                        PORTS               NAMES
</span><span class='line'>5dcb0884d270        vim_installed:latest   "/bin/sh -c 'while t   9 minutes ago       Exited (-1) 8 seconds ago                         focused_pike 
</span></code></pre></td></tr></table></div></figure>


<p><code>sudo docker rm $JOB</code> will remove the job.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/26/using-new-do-system/">Using New DO System</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-26T23:05:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:05 pm</span></time>
        
         | <a href="/blog/2015/01/26/using-new-do-system/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since the coreOS met some critical errors, I have to re-construct the DO System using CentOS. So I destroyed the old CoreOS machine, runs CentOS.</p>

<h3>Configure</h3>

<h3>Install packages</h3>

<p>Update and install vim</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ yum update
</span><span class='line'>$ yum install vim
</span></code></pre></td></tr></table></div></figure>


<h4>Add Swap</h4>

<p>512M is not enough for playing, enlarge the swapfile.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># dd if=/dev/zero of=/swapfile bs=1M count=1024
</span><span class='line'># chmod 600 /swapfile
</span><span class='line'># mkswap /swapfile
</span><span class='line'>$ sudo vim /etc/systemd/system/swap.service
</span><span class='line'> [Unit]  
</span><span class='line'> Description=Turn on swap  
</span><span class='line'> [Service]  
</span><span class='line'> Type=oneshot  
</span><span class='line'> Environment="SWAPFILE=/swapfile"
</span><span class='line'> RemainAfterExit=true  
</span><span class='line'> ExecStartPre=/usr/sbin/losetup -f ${SWAPFILE}  
</span><span class='line'> ExecStart=/usr/bin/sh -c "/sbin/swapon $(/usr/sbin/losetup -j ${SWAPFILE} | /usr/bin/cut -d : -f 1)"  
</span><span class='line'> ExecStop=/usr/bin/sh -c "/sbin/swapoff $(/usr/sbin/losetup -j ${SWAPFILE} | /usr/bin/cut -d : -f 1)"  
</span><span class='line'> ExecStopPost=/usr/bin/sh -c "/usr/sbin/losetup -d $(/usr/sbin/losetup -j ${SWAPFILE} | /usr/bin/cut -d : -f 1)"  
</span><span class='line'> [Install]  
</span><span class='line'> WantedBy=multi-user.target 
</span><span class='line'>$ sudo  systemctl enable /etc/systemd/system/swap.service  
</span><span class='line'>$ sudo systemctl start swap  
</span></code></pre></td></tr></table></div></figure>


<p>Now the swapfile is 1000MB, enough for doing various operations.</p>

<h4>Add new user</h4>

<p>Add new user and changes its password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># useradd -m -g root -G root -s /bin/bash Trusty
</span><span class='line'># passwd Trusty
</span></code></pre></td></tr></table></div></figure>


<p>Change the sshd configuration, disable root login, and change the listening port.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vim /etc/ssh/sshd_config
</span><span class='line'>port changes, 
</span><span class='line'>PermitRootLogin no
</span></code></pre></td></tr></table></div></figure>


<p>Now reboot the system, you will got a safe DigitalOcean machine.</p>

<h3>Build OpenContrail</h3>

<p>The repo is the same as the above article, then we install other packages which needed for CengOS.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo yum install -y libtool kernel-devel 
</span><span class='line'>$ sudo yum install -y bzip2 boost-devel tbb-devel libcurl-devel libxml2-devel 
</span></code></pre></td></tr></table></div></figure>


<p>Install epel via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo yum install -y https://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-5.noarch.rpm
</span><span class='line'>$ sudo sed -i -e 's/enabled=1/enabled=0/' /etc/yum.repos.d/epel.repo 
</span></code></pre></td></tr></table></div></figure>


<p>Install following packages from epel:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo yum install -y --disablerepo="*" --enablerepo="epel" scons protobuf protobuf-devel protobuf-compiler 
</span><span class='line'>$  sudo yum install -y python-lxml patch unzip flex bison gcc-c++ openssl-devel make wget python-setuptools
</span></code></pre></td></tr></table></div></figure>


<p>So now you could run the whole compilation via <code>scons</code> under the ~/Code folder.   <br/>
tips: tmux&rsquo;s q will quit ctrl+b mode.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/26/using-do-for-building-opencontrail/">Using DO for Building OpenContrail</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-26T20:32:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:32 pm</span></time>
        
         | <a href="/blog/2015/01/26/using-do-for-building-opencontrail/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since the network environment is not good(In fact, very bad), because of the GFW, so I have to build the opencontrail packages in digitalOcean. Following is the tips and how-to.</p>

<h3>Preparation</h3>

<p>First we have to get the Latest Ubuntu images, and let it OK for building the OpenContrail:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker search ubuntu
</span><span class='line'>.....
</span><span class='line'>$ docker pull ubuntu
</span><span class='line'>$ docker run -i -t ubuntu /bin/bash
</span><span class='line'>root@4c74f2890dbe:/# apt-get update
</span></code></pre></td></tr></table></div></figure>


<p>Now we run into the ubuntu build environment. This is where we want to build the whole opencontrail deb file.  <br/>
Install curl and then install repo:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get install curl
</span><span class='line'># mkdir -p ~/bin
</span><span class='line'># curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo
</span><span class='line'># chmod 777 /root/bin/repo
</span><span class='line'># apt-get install vim
</span><span class='line'># vim ~/.bashrc
</span><span class='line'>export PATH=/root/bin:$PATH
</span><span class='line'># source ~/.bashrc
</span><span class='line'># which repo
</span><span class='line'>/root/bin/repo
</span></code></pre></td></tr></table></div></figure>


<p>Now repo became usable in our system.  <br/>
Install following packages(So many packages!!!) for preparing the building of the opencontrail:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get install -y scons git python-lxml wget gcc patch make unzip flex bison g++ libssl-dev autoconf automake libtool pkg-config vim python-dev python-setuptools libprotobuf-dev protobuf-compiler libsnmp-python libboost-dev libboost-chrono-dev libboost-date-time-dev libboost-filesystem-dev libboost-program-options-dev libboost-python-dev libboost-regex-dev libboost-system-dev libcurl4-openssl-dev google-mock libgoogle-perftools-dev liblog4cplus-dev libtbb-dev libhttp-parser-dev libxml2-dev libicu-dev
</span></code></pre></td></tr></table></div></figure>


<p>Use tmux for holding the building context:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get install tmux
</span><span class='line'># tmux new -s "BuildContrail"
</span></code></pre></td></tr></table></div></figure>


<h3>Clone The Code</h3>

<p>Create the directories and then configure the git&rsquo;s username and Email.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mkdir Code
</span><span class='line'># cd Code/
</span><span class='line'>#  git config --global user.email kkkttt@gmail.com
</span><span class='line'># git config --global user.name kkkttt
</span><span class='line'># ssh-keygen
</span></code></pre></td></tr></table></div></figure>


<p>Upload the generate <code>id_rsa.pub</code> to the github.com, then let your machine verified by github.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ssh -T git@github.com
</span><span class='line'>Hi kkkttt! You've successfully authenticated, but GitHub does not provide shell access.
</span></code></pre></td></tr></table></div></figure>


<p>Now you could use repo for syncing back the code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mkdir -p ~/Code
</span><span class='line'># cd ~/Code
</span><span class='line'># repo init -u git@github.com:Juniper/contrail-vnc
</span><span class='line'># repo sync 
</span></code></pre></td></tr></table></div></figure>


<h3>Third-Party</h3>

<p>There is little trick in syncing the 3rd party source code back, you have to manually create the folder and let it writable, then modify the source code of the python file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mkdir -p /tmp/cache/root/
</span><span class='line'># chmod -R /tmp/cache/root/
</span><span class='line'># vim third_party/*.py
</span><span class='line'>_PACKAGE_CACHE='/tmp/cache/' + os.environ['USER'] + '/third_party'
</span><span class='line'>_PACKAGE_CACHE='/tmp/cache/root/' + '/third_party'
</span></code></pre></td></tr></table></div></figure>


<p>Now use following command for syncing the 3rd party packages back:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># python third_party/fetch_packages.py
</span></code></pre></td></tr></table></div></figure>


<h3>Build</h3>

<p>Building is pretty easy, simply type <code>scons</code> then everything is automatically on-going.  <br/>
Troubles, if you don&rsquo;t specify USER, then the error will be raised, complains the os.environ[&lsquo;USER&rsquo;] got nothing, then scons will be halt.       <br/>
Solution:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># declare -x USER="root"
</span></code></pre></td></tr></table></div></figure>


<p>Then the build begin, and it will last for a long time.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/26/trying-docker-in-company/">Trying Docker in Company</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-26T01:14:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:14 am</span></time>
        
         | <a href="/blog/2015/01/26/trying-docker-in-company/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Installation</h3>

<p>Install docker via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sh -c "wget -qO- https://get.docker.io/gpg | apt-key add -"
</span><span class='line'>$ sh -c "echo deb http://get.docker.io/ubuntu docker main\
</span><span class='line'>&gt; /etc/apt/sources.list.d/docker.list"
</span><span class='line'>$ apt-get update
</span><span class='line'>$ apt-get install lxc-docker
</span><span class='line'>$ which docker
</span><span class='line'>/usr/bin/docker
</span></code></pre></td></tr></table></div></figure>


<h3>Very Beginning</h3>

<p>Docker pull the docker.cn packages back, the speed is around 500K/</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker pull docker.cn/docker/ubuntu
</span></code></pre></td></tr></table></div></figure>


<p>Run into an instance:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># docker run -i -t docker.cn/docker/ubuntu /bin/bash
</span><span class='line'>root@3ad7689e600a:/# ps -ef
</span><span class='line'>UID        PID  PPID  C STIME TTY          TIME CMD
</span><span class='line'>root         1     0  0 06:27 ?        00:00:00 /bin/bash
</span><span class='line'>root        16     1  0 06:27 ?        00:00:00 ps -ef
</span></code></pre></td></tr></table></div></figure>


<p>In another terminal, show the running container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># docker ps
</span><span class='line'>CONTAINER ID        IMAGE                           COMMAND             CREATED             STATUS              PORTS               NAMES
</span><span class='line'>3ad7689e600a        docker.cn/docker/ubuntu:14.04   "/bin/bash"         11 seconds ago      Up 10 seconds                           sick_hodgkin 
</span></code></pre></td></tr></table></div></figure>


<h3>Make Changes And Submit</h3>

<p>First made some modification to our container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install vim
</span></code></pre></td></tr></table></div></figure>


<p>The above command will install vim.  <br/>
Now commit the changes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># docker commit c7ddc390f0c8 installed_vim_container
</span><span class='line'>ed347fc03634e6c66ee45d213cf4d2839e55376f3e34d18c6e58bada1f701425
</span></code></pre></td></tr></table></div></figure>


<p>List all of the images:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># docker images
</span><span class='line'>REPOSITORY                TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
</span><span class='line'>installed_vim_container   latest              ed347fc03634        47 seconds ago      235.8 MB
</span><span class='line'>docker.cn/docker/ubuntu   14.04               b39b81afc8ca        9 days ago          192.7 MB
</span><span class='line'>docker.cn/docker/ubuntu   14.04.1             b39b81afc8ca        9 days ago          192.7 MB
</span><span class='line'>docker.cn/docker/ubuntu   latest              b39b81afc8ca        9 days ago          192.7 MB
</span><span class='line'>docker.cn/docker/ubuntu   trusty              b39b81afc8ca        9 days ago          192.7 MB
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/23/install-openfire-for-lan-chat/">Install OpenFire for LAN Chat</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-23T00:50:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>12:50 am</span></time>
        
         | <a href="/blog/2015/01/23/install-openfire-for-lan-chat/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In order to support chat in LAN, install Openfire, following are the steps for installing and configurating.</p>

<h3>Local Machine</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget 
</span><span class='line'>$ apt-get update &&  apt-get install default-jre
</span></code></pre></td></tr></table></div></figure>


<p>Since another people is also installing this. Change it to DigitalOcean.</p>

<h3>Dockerize Openfire</h3>

<p>Get the image via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>docker pull sameersbn/openfire
</span></code></pre></td></tr></table></div></figure>


<p>Since the installation is already done, docker ignored&hellip;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/22/enable-apache2-redirect/">Enable Apache2 Redirect</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-22T04:02:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2015</span></span> <span class='time'>4:02 am</span></time>
        
         | <a href="/blog/2015/01/22/enable-apache2-redirect/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Problem</h3>

<p>Want to redirect from <code>http://xxx/</code> to <code>http://xxx/a/b</code></p>

<h3>Solution</h3>

<p>Change the configuration file of the <code>/etc/apache2/sites-enabled/000-default</code>, enable the  <code>RedirectMatch</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># For forwarding all of the request to '/' TO '/bin/view'
</span><span class='line'>  RedirectMatch ^/$ /a/b
</span></code></pre></td></tr></table></div></figure>


<p>Restart the service of apache2 then everything goes OK.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/21/building-vrouter/">Building Vrouter</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-21T23:12:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>11:12 pm</span></time>
        
         | <a href="/blog/2015/01/21/building-vrouter/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Preparation</h3>

<p>First we should get repo, while this little kit has been banned via GFW, thus we should use DO machine for getting it down and ssh to local machine.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir ~/bin
</span><span class='line'>$ PATH=~/bin:$PATH
</span><span class='line'>$ curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo
</span><span class='line'>$ chmod a+x ~/bin/repo
</span><span class='line'>$ tail ~/.zshrc
</span><span class='line'># Add our own bin/ folder for using different tools:    
</span><span class='line'>export PATH="$PATH:$HOME/bin"
</span></code></pre></td></tr></table></div></figure>


<p>Now we could use repo.</p>

<h3>Oops, git is old!</h3>

<p>The default version of git is too old in CentOS, thus we have to upgrade it. , repo needs git version newer than 1.7.2, or you won&rsquo;t get any results from github.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>~% git --version
</span><span class='line'>git version 1.7.1
</span></code></pre></td></tr></table></div></figure>


<p>Install necessary packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel gcc perl-ExtUtils-MakeMaker
</span></code></pre></td></tr></table></div></figure>


<p>Now build and install git via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo mkdir -p /usr/local/git
</span><span class='line'>$ wget https://www.kernel.org/pub/software/scm/git/git-1.9.4.tar.gz
</span><span class='line'>$ tar xzvf git-1.9.4.tar.gz
</span><span class='line'>$ cd git-1.9.4
</span><span class='line'>$ make prefix=/usr/local/git all
</span><span class='line'>$ sudo make prefix=/usr/local/git install
</span><span class='line'>$ echo "export PATH=/usr/local/git/bin:$PATH"&gt;&gt;~/.zshrc
</span><span class='line'>$ source ~/.zshrc
</span><span class='line'>$ git --version
</span><span class='line'>git version 1.9.4
</span></code></pre></td></tr></table></div></figure>


<p>Now the git is already the newer version, we could use it together with repo.</p>

<h3>Sync Repository</h3>

<p>Unfortunately we have been blocked by GFW, so we have to enable little tool proxychains:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/rofl0r/proxychains-ng.git 
</span><span class='line'>$ cd proxychains-ng
</span><span class='line'>$ ./configure --prefix=/usr
</span><span class='line'>$ make
</span><span class='line'>$ sudo make install
</span><span class='line'>$ sudo make install-config
</span><span class='line'>$ sudo vim /etc/proxychains.conf
</span><span class='line'># defaults set to "tor"
</span><span class='line'>#socks4   127.0.0.1 9050
</span><span class='line'>socks5    127.0.0.1 1395
</span></code></pre></td></tr></table></div></figure>


<p>Now we could use proxychains for syncing the repositories, simply init the repo via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd /home/xxx.xxxxx/Code/Vrouter_repo
</span><span class='line'>$ proxychains4 repo init -u git@github.com:Juniper/contrail-vnc -m vrouter-manifest.xml
</span></code></pre></td></tr></table></div></figure>


<p>Now sync the repository via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ proxychains4 repo sync
</span></code></pre></td></tr></table></div></figure>


<h3>Build</h3>

<p>After syncing the code, we could finally build this repository, build it via;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ scons vrouter
</span></code></pre></td></tr></table></div></figure>


<p>Seems boost is pretty old on CentOS 6.6, thus we have to manually compile boost on our system.  <br/>
Since some packages are pretty old on CentOS, I switched to the ubuntu for developing.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/21/questions-on-contrail/">Questions on Contrail</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-21T21:43:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>9:43 pm</span></time>
        
         | <a href="/blog/2015/01/21/questions-on-contrail/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Following records my questions on Contrail.</p>

<h3>What is L3 OverLay?</h3>

<p>对于大二层的互通，还有一种简单有效的方法就是vpn，vpn可以工作在二层（如openvpn中的tap模式，左右两边的子网可以相同，但IP肯定不能同，相当于bridge模式），也可以工作在三层（如openvpn中的tun模式, 要求左右两边子网不同）。IPSec只是一种加密模式，L2TP才是二层的vpn接入层，所以L2TP+IPSec肯定可以实现openvpn的tap模式，但是strongswan因为是三层的vpn应该不行。</p>

<p>More detailed info could be found at:  <br/>
<a href="http://blog.csdn.net/quqi99/article/details/11778413">http://blog.csdn.net/quqi99/article/details/11778413</a></p>

<h3>MPLS?</h3>

<p>MPLS(Multiprotocol Label Switching, 多协议标记交换)使用标签(Label)进行转发，一个标签是一个短的、长度固定的数值，由报文的头部携带，不含拓扑信息，只有局部意义。MPLS包头包含20比特的标签，3比特的EXP(通常用作Cos)，1比特的S，用于标识此标签是否为最底层标签，8比特的TTL。  <br/>
More detailed infos here:  <br/>
<a href="http://www.net130.com/netbass/VPN/v111301.htm">http://www.net130.com/netbass/VPN/v111301.htm</a></p>

<h3>GRE?</h3>

<p>（GRE: Generic Routing Encapsulation）  <br/>
通用路由封装 （GRE）定义了在任意一种网络层协议上封装任意一个其它网络层协议的协议。    <br/>
More detailed info could be found here:  <br/>
<a href="http://baike.baidu.com/view/3871502.htm">http://baike.baidu.com/view/3871502.htm</a></p>

<h4>MPLS Over GRE?</h4>

<p> MPLS是多协议标签交换的简称，它用短而定长的标签来封装网络层分组。MPLS最初是为提高路由器的转发速度而提出一个协议。  <br/>
GRE协议是对某些网络层协议的数据报进行封装，使这些被封装的数据报能够在另一个网络层协议中传输。GRE是VPN的第三层隧道协议，在协议层之间采用了一种被称之为Tunnel的技术。  <br/>
MPLS在VPN中的应用，用MPLS为转发通道运行私网流量，使一个运营商的网络可以同时支撑多个不同客户的IP VPN，这样就要求运营商的网络全程支持MPLS转发。但是在实际运用中，有时由于网络规划的原因，运营商网络的中间设备并不支持MPLS功能，而基本的BGP/MPLS VPN是要求所用到的运营商设备全程支持MPLS功能才可以，这样采用基本的BGP/MPLS VPN方法就行不通了，此时GRE的应用很好的解决了这个问题，只需要运营商边缘设备支持MPLS转发就能实现功能。而且GRE只需要保证两端网络类型相同，中间可以穿越其他类型的网络，也降低了对运营商网络的要求。</p>

<p>More detailed info could be found here:  <br/>
<a href="http://blog.sina.com.cn/s/blog_6dc951ef01015bpm.html">http://blog.sina.com.cn/s/blog_6dc951ef01015bpm.html</a></p>

<h3>L3 VPN?</h3>

<p>Layer 3, or VPRN (virtual private routed network), utilizes layer 3 VRF (VPN/virtual routing and forwarding) to segment routing tables for each “customer” utilizing the service. The customer peers with the service provider router and the two exchange routes, which are placed into a routing table specific to the customer. Multiprotocol BGP (MP-BGP) is required in the cloud to utilize the service, which increases complexity of design and implementation. L3 VPNs are typically not deployed on utility networks due to their complexity; however, a L3 VPN could be used to route traffic between corporate or datacenter locations.</p>

<p><a href="http://en.wikipedia.org/wiki/MPLS_VPN#Layer_3_VPN_.28VPRN.29">http://en.wikipedia.org/wiki/MPLS_VPN#Layer_3_VPN_.28VPRN.29</a></p>

<p><a href="http://www.doc88.com/p-0903761953194.html">http://www.doc88.com/p-0903761953194.html</a></p>

<h3>EVPN?</h3>

<p>Fuck,</p>

<h3>VXLAN?</h3>

<p>vxlan(virtual Extensible LAN)虚拟可扩展局域网，是一种overlay的网络技术，使用MAC in UDP的方法进 行封装，共50字节的封装报文头。具体的报文格式如下：   <br/>
<img src="/images/vxlan.png" alt="/images/vxlan.png" />  <br/>
More detailed info could be found here:  <br/>
<a href="http://www.huawei.com/ecommunity/bbs/10239835.html">http://www.huawei.com/ecommunity/bbs/10239835.html</a></p>

<h3>MPLS Over UDP?</h3>

<h3>MPLS Over UDP(L2/L3 OverLay)?</h3>

<h3>L3 Unicast?</h3>

<h3>L2 Unicast?</h3>

<h3>L2 Multicaset?</h3>

<h3>Multicast Tree?</h3>

<h3>BUM Traffic?</h3>

<h3>Overlay vs UnderLay?</h3>

<p>Answer comes here:  <br/>
SDN究竟要不要管物理交换机？  <br/>
<a href="http://www.jianshu.com/p/4c2448e201a2">http://www.jianshu.com/p/4c2448e201a2</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/21/install-chrome-on-centos/">Install Chrome on CentOS</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-21T20:21:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>8:21 pm</span></time>
        
         | <a href="/blog/2015/01/21/install-chrome-on-centos/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Until now I failed in installing chrome on CentOS, for the libstdc++ version is too old in the machine, but record the steps here, later I will continue to work on this issue.</p>

<h3>Repository Preparation</h3>

<p>Add following file in to your <code>/etc/yum.repos.d</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>~% cat /etc/yum.repos.d/google-chrome.repo 
</span><span class='line'>[google-chrome]
</span><span class='line'>name=google-chrome
</span><span class='line'>baseurl=http://dl.google.com/linux/chrome/rpm/stable/$basearch
</span><span class='line'>enabled=1
</span><span class='line'>gpgcheck=1
</span><span class='line'>gpgkey=https://dl-ssl.google.com/linux/linux_signing_key.pub
</span></code></pre></td></tr></table></div></figure>


<p>Now install the chrome via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo yum install google-chrome-stable
</span><span class='line'>   Processing Dependency: libstdc++.so.6(GLIBCXX_3.4.15)(64bit) for package: google-chrome-stable-40.0.2214.91-1.x86_64
</span><span class='line'>--&gt; Finished Dependency Resolution
</span><span class='line'>Error: Package: google-chrome-stable-40.0.2214.91-1.x86_64 (google-chrome)
</span><span class='line'>           Requires: libstdc++.so.6(GLIBCXX_3.4.15)(64bit)
</span></code></pre></td></tr></table></div></figure>


<p>The failure reason is because our libstdc++ version is too old.</p>

<h3>Check Lib Version</h3>

<p>View where is libstdc++:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ldconfig -p | grep stdc++
</span><span class='line'>  libstdc++.so.6 (libc6,x86-64) =&gt; /usr/lib64/libstdc++.so.6
</span></code></pre></td></tr></table></div></figure>


<p>Get the strings which contains LIBCXX in the libstdc++.so.6:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ strings /usr/lib64/libstdc++.so.6  | grep LIBCXX
</span><span class='line'>GLIBCXX_3.4
</span><span class='line'>GLIBCXX_3.4.1
</span><span class='line'>GLIBCXX_3.4.2
</span><span class='line'>GLIBCXX_3.4.3
</span><span class='line'>GLIBCXX_3.4.4
</span><span class='line'>GLIBCXX_3.4.5
</span><span class='line'>GLIBCXX_3.4.6
</span><span class='line'>GLIBCXX_3.4.7
</span><span class='line'>GLIBCXX_3.4.8
</span><span class='line'>GLIBCXX_3.4.9
</span><span class='line'>GLIBCXX_3.4.10
</span><span class='line'>GLIBCXX_3.4.11
</span><span class='line'>GLIBCXX_3.4.12
</span><span class='line'>GLIBCXX_3.4.13
</span><span class='line'>GLIBCXX_FORCE_NEW
</span><span class='line'>GLIBCXX_DEBUG_MESSAGE_LENGTH
</span></code></pre></td></tr></table></div></figure>


<p>We could see the newest version of GLIBCXX is only 3.4.13, while chrome requuires 3.4.15. So the solution should be we install the newer version.</p>

<h3>Upgrade GLIBCXX</h3>

<p>TBD.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/21/using-imacros-for-automatically-access-mail-and-oa/">Using iMacros for Automatically Access Mail and OA</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-21T03:06:00+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2015</span></span> <span class='time'>3:06 am</span></time>
        
         | <a href="/blog/2015/01/21/using-imacros-for-automatically-access-mail-and-oa/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>First we should install imacros from firefox&rsquo;s Add-Ons, after installation, we will restart the firefox and let it run.  <br/>
Click the icon of imacros, the window will be available at the left side of the browser.   <br/>
Rec-> Record for recording the steps  <br/>
Then do what you want to do in browser.   <br/>
Save the current macros into another name, next time if you want to re-do the operations, simply click this saved imacros, then everything is OK.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/10">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/8">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/05/24/san-jie-dian-da-jian-openstack-juno-2/">三节点搭建OpenStack Juno(2)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/24/san-jie-dian-da-jian-openstack-juno/">三节点搭建OpenStack Juno(1)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/23/use-apt-cacher-for-speeding-up-deployment/">Use Apt-cacher for Speeding Up Deployment</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/22/change-cobbler-profile-for-using-local-repository/">Change Cobbler Profile for Using Local Repository</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/20/setup-centos6-slash-7-local-repository/">Setup CentOS6/7 Local Repository</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
