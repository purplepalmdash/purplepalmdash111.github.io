
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="Recently I want to use RTOS on Arduino, but after reading the material I find it&rsquo;s not so easy to run another &ldquo;OS&rdquo; on Arduino. But &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/35">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//fonts.googleapis.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/04/proto-thread-in-arduino/">Proto Thread in Arduino</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-07-04T19:09:00+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>7:09 pm</span></time>
        
         | <a href="/blog/2014/07/04/proto-thread-in-arduino/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I want to use RTOS on Arduino, but after reading the material I find it&rsquo;s not so easy to run another &ldquo;OS&rdquo; on Arduino. But I found this library which named &ldquo;Proto Thread&rdquo; which could afford me thread-like operation. Following is the steps for using this library for controlling 2 different threads.</p>

<h3>Installation of Proto Thread</h3>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/03/turn-joggler-into-a-real-digital-picture-frame/">Turn Joggler Into a Real Digital Picture Frame</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-07-03T14:26:00+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>2:26 pm</span></time>
        
         | <a href="/blog/2014/07/03/turn-joggler-into-a-real-digital-picture-frame/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In fact Joggler initially is released as a digital picture frame, but I turned it into a linux server. Now It&rsquo;s time to turn this server back.</p>

<h3>Change RunLevel</h3>

<p>Edit the gdm.conf file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat /etc/init/gdm.conf
</span><span class='line'># gdm - GNOME Display Manager
</span><span class='line'>#
</span><span class='line'># The display manager service manages the X servers running on the
</span><span class='line'># system, providing login and auto-login services
</span><span class='line'>
</span><span class='line'>description     "GNOME Display Manager"
</span><span class='line'>author          "William Jon McCann &lt;mccann@jhu.edu&gt;"
</span><span class='line'>
</span><span class='line'>start on ((filesystem
</span><span class='line'>           and runlevel [!06]
</span><span class='line'>           # Without 03, assume our default level is 03
</span><span class='line'>           #and runlevel [!03]
</span></code></pre></td></tr></table></div></figure>


<p>To known your default run level, type:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># runlevel
</span><span class='line'>N 3
</span></code></pre></td></tr></table></div></figure>


<p>Then reboot the joggler, to see if you could get the gdm window.</p>

<p>Disable auto-logon via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /etc/init/tty1.conf
</span><span class='line'>respawn
</span><span class='line'>#exec /sbin/mingetty -8 38400 tty1 Trusty -8 38400 tty1
</span><span class='line'>exec /sbin/getty -8 38400 tty1
</span></code></pre></td></tr></table></div></figure>


<p>Install lightdm via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install lightdm
</span><span class='line'>$ sudo dpkg-reconfigure lightdm
</span></code></pre></td></tr></table></div></figure>


<p>Enable auto-login to lightdm:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /etc/lightdm/lightdm.conf 
</span><span class='line'>[SeatDefaults]
</span><span class='line'>autologin-user=Trusty
</span><span class='line'>autologin-user-timeout=0
</span><span class='line'>greeter-session=lightdm-gtk-greeter
</span><span class='line'>user-session=xubuntu
</span></code></pre></td></tr></table></div></figure>


<h3>Enable SlideShow</h3>

<p>Find out the resolution via following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ xrandr | grep '*'
</span><span class='line'>   800x480        60.0* 
</span></code></pre></td></tr></table></div></figure>


<p>Install essential software:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install feh
</span><span class='line'>$ sudo apt-get install unclutter
</span></code></pre></td></tr></table></div></figure>


<p>In fact using feh is not good enough for setting the screenSaver, at last I use xscreensaver, it has a mode of glslideshow, you can specify your own directory.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/03/smtp-problem-solving/">SMTP Problem Solving</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-07-03T10:30:00+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>10:30 am</span></time>
        
         | <a href="/blog/2014/07/03/smtp-problem-solving/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I&rsquo;ve set up a ticket system, OTRS, which uses smtp for sending out email. It works well in my virtual machine, and in my own server. But when deploying it onto the lab PC, it cannot send out email via smtp. Following is the solving procedure for this problem.</p>

<h3>SMTP Server</h3>

<p>When Login into the server, following is how to using smtp for sending out email.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ telnet localhost 25
</span><span class='line'>Trying 127.0.0.1...
</span><span class='line'>Connected to localhost.
</span><span class='line'>Escape character is '^]'.
</span><span class='line'>220 nxxxxx.xxx.fukcfuck-fugkock.com ESMTP Sendmail 8.14.5+Sun/8.13.3; Thu, 26 Jun 2014 06:43:37 -0500 (CDT)
</span><span class='line'>ehlo localhost
</span><span class='line'>250-nxxxxx.xxx.fukcfuck-fugkock.com Hello localhost [127.0.0.1], pleased to meet you
</span><span class='line'>250-ENHANCEDSTATUSCODES
</span><span class='line'>250-PIPELINING
</span><span class='line'>250-EXPN
</span><span class='line'>250-VERB
</span><span class='line'>250-8BITMIME
</span><span class='line'>250-SIZE
</span><span class='line'>250-DSN
</span><span class='line'>250-ETRN
</span><span class='line'>250-DELIVERBY
</span><span class='line'>250 HELP
</span><span class='line'>mail from: kkkkk@xxxxxx.xx.fugkock.com
</span><span class='line'>250 2.1.0 kkkkk@xxxxxx.xx.fugkock.com... Sender ok
</span><span class='line'>rcpt to:xxx_xxx.mao@fukcfuck-fugkock.com
</span><span class='line'>250 2.1.5 xxx_xxx.mao@fukcfuck-fugkock.com... Recipient ok
</span><span class='line'>data
</span><span class='line'>Subjet:354 Enter mail, end with "." on a line by itself
</span><span class='line'>Hi,
</span><span class='line'>Are you there?
</span><span class='line'>regards,
</span><span class='line'>Admin
</span><span class='line'>.
</span><span class='line'>250 2.0.0 s5QBhbEu014970 Message accepted for delivery
</span><span class='line'>quit
</span><span class='line'>221 2.0.0 xxxxxx.xxx.fukcfuck-fugkock.com closing connection
</span><span class='line'>Connection to localhost closed by foreign host.
</span></code></pre></td></tr></table></div></figure>


<h3>Error message</h3>

<p>When sending out the /var/log/messages will record the failure message, like:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Jul  1 00:57:10 Linux01 OTRS-CGI-37[2757]: [Info][Kernel::System::CustomerUser::DB::CustomerUserAdd] CustomerUser: '9988@qq.com' created successfully (1)!
</span><span class='line'>Jul  1 00:57:10 Linux01 OTRS-CGI-37[2757]: [Notice][Kernel::System::CustomerUser::DB::SetPassword] CustomerUser: '9988@qq.com' changed password successfully!
</span><span class='line'>Jul  1 00:57:12 Linux01 OTRS-CGI-37[2757]: [Error][Kernel::System::Email::SMTP::Send][Line:139]: Can't send to '9988@qq.com': 5505.7.1 &lt;9988@qq.com&gt;... Relaying denied. IP name lookup failed [104.xxx.xxx.53]#012! Enable Net::SMTP debug for more info!
</span><span class='line'>Jul  1 00:57:12 Linux01 OTRS-CGI-37[2757]: [Info][Kernel::System::Email::Send] Error sending message
</span></code></pre></td></tr></table></div></figure>


<p>It says the IP name lookup failed.</p>

<h3>Bug Shooting</h3>

<p>Use tcpdump for capturing the package, comparing to the normal package.  <br/>
It indicates the message &ldquo;IP name lookup failed [104.xxx.xxx.53]&rdquo;, so I guess this may caused by reverse refer of smtp server.</p>

<p>Use dnslookup for the correct record:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@Linux01 ~]$ nslookup 104.xxx.xxx.53
</span><span class='line'>Server:        104.xxx.xxx.xxx
</span><span class='line'>Address:    104.xxx.xxx.xxx#53
</span><span class='line'>
</span><span class='line'>** server can't find 53.xxx.xxx.104.in-addr.arpa.: NXDOMAIN
</span><span class='line'>
</span><span class='line'>=============================================================
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>[Trusty@Linux01 ~]$ nslookup 104.xxx.xxx.240
</span><span class='line'>Server:        104.xxx.xxx.xxx
</span><span class='line'>Address:    104.xxx.xxx.xxx#53
</span><span class='line'>
</span><span class='line'>Non-authoritative answer:
</span><span class='line'>240.xxx.xxx.104.in-addr.arpa    name = xxxxxxxx.xx.fukcfuck-fugkock.com.
</span></code></pre></td></tr></table></div></figure>


<p>So the solution is quite clear: If we give 104.xxx.xxx.140 a name, we could easily reached this machine from smtp server, thus the problem may be solved.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/29/otrs-on-ubuntu/">OTRS on Ubuntu</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-06-29T16:00:00+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:00 pm</span></time>
        
         | <a href="/blog/2014/06/29/otrs-on-ubuntu/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>First get the source code from official website, and untar it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo tar xjvf otrs-3.3.8.tar.bz2 -C /opt/
</span><span class='line'>$ cd /opt
</span><span class='line'>$ sudo mv otrs-3.3.8/ otrs
</span></code></pre></td></tr></table></div></figure>


<p>Check the modules :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ /opt/otrs/bin/otrs.CheckModules.pl
</span></code></pre></td></tr></table></div></figure>


<p>Install following packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install liblwp-useragent-determined-perl libapache2-mod-perl2 libnet-dns-perl libnet-smtp-ssl-perl libnet-smtp-tls-butmaintained-perl libyaml-perl
</span><span class='line'>$ sudo apt-get install libgd-text-perl libjson-xs-perl libpdf-api2-perl libtext-csv-xs-perl libxml-parser-perl
</span></code></pre></td></tr></table></div></figure>


<p>Add corresponding users and group:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo useradd -d /opt/otrs/ -c 'OTRS user' otrs
</span><span class='line'>$ sudo usermod -G www-data otrs
</span></code></pre></td></tr></table></div></figure>


<p>Create the OTRS Config Files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pwd
</span><span class='line'>/opt/otrs
</span><span class='line'>$ sudo cp Kernel/Config.pm.dist Kernel/Config.pm
</span><span class='line'>$ sudo cp Kernel/Config/GenericAgent.pm.dist Kernel/Config/GenericAgent.pm
</span></code></pre></td></tr></table></div></figure>


<p>Check dependencies via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ perl -cw /opt/otrs/bin/cgi-bin/index.pl
</span><span class='line'>/opt/otrs/bin/cgi-bin/index.pl syntax OK
</span><span class='line'>$ perl -cw /opt/otrs/bin/cgi-bin/customer.pl
</span><span class='line'>/opt/otrs/bin/cgi-bin/customer.pl syntax OK
</span><span class='line'>$ perl -cw /opt/otrs/bin/otrs.PostMaster.pl
</span><span class='line'>/opt/otrs/bin/otrs.PostMaster.pl syntax OK
</span></code></pre></td></tr></table></div></figure>


<p>Set permission:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo bin/otrs.SetPermissions.pl --otrs-user=otrs --web-user=www-data --otrs-group=www-data --web-group=www-data /opt/otrs
</span></code></pre></td></tr></table></div></figure>


<p>Now Set the conf file for apache2:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo cp /opt/otrs/scripts/apache2-httpd.include.conf /etc/apache2/sites-available/otrs
</span><span class='line'>$ sudo ln -s /etc/apache2/sites-available/otrs.conf  /etc/apache2/sites-enabled/otrs
</span><span class='line'>$ sudo a2ensite otrs
</span><span class='line'>$ sudo service apache2 restart
</span></code></pre></td></tr></table></div></figure>


<p>Now go to following URL for installation:  <br/>
<a href="http://joggler.xxx.xxxx&lt;F2>.com/otrs/installer.pl">http://joggler.xxx.xxx..com/otrs/installer.pl</a></p>

<p>After installation, restart mysql and httpd, or you will meet <code>OTRS - Access denied for user otrs@localhost</code></p>

<p>Add crontab tasks via following commands:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># su otrs
</span><span class='line'>$ cd /opt/otrs/var/cron
</span><span class='line'>$ pwd
</span><span class='line'>/opt/otrs/var/cron
</span><span class='line'>$ for foo in *.dist; do cp $foo `basename $foo .dist`; done
</span><span class='line'>$ /opt/otrs/bin/Cron.sh start
</span><span class='line'>/opt/otrs/var/cron
</span><span class='line'>Cron.sh - start/stop OTRS cronjobs
</span><span class='line'>Copyright (C) 2001-2012 OTRS AG, http://otrs.org/
</span><span class='line'>(using /opt/otrs) done
</span><span class='line'>$ crontab -l
</span></code></pre></td></tr></table></div></figure>


<p>Now everything goes OK, visit <a href="joggler.xxx.xxx.com/otrs/customer.pl">joggler.xxx.xxx..com/otrs/customer.pl</a> for visit the customer panel.</p>

<p>Change the password for root@localhost:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ./otrs.SetPassword.pl root@localhost PLATFORM
</span><span class='line'>Set password for user 'root@localhost'.
</span><span class='line'>Done.
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/28/install-and-configure-otrs-on-centos/">Install and Configure Otrs on CentOS</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-06-28T19:10:00+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>7:10 pm</span></time>
        
         | <a href="/blog/2014/06/28/install-and-configure-otrs-on-centos/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Prerequisite</h3>

<p>Install following Packages under CentOS:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo yum install wget mysql-server mysql php-mysql httpd perl-URI perl-Net-DNS perl-IO-Socket-SSL perl-XML-Parser mod_perl perl-TimeDate perl-Net-DNS procmail perl perl-LDAP perl-Crypt-SSLeay
</span></code></pre></td></tr></table></div></figure>


<p>Now configure the mysqld via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo chkconfig --levels 235 mysqld on
</span><span class='line'>$ sudo service mysqld start
</span><span class='line'>$ sudo /usr/bin/mysql_secure_installation
</span><span class='line'>$ sudo chkconfig --levels 235 httpd on
</span></code></pre></td></tr></table></div></figure>


<h3>Install otrs</h3>

<p>Download the otrs from Official website, I downloaed the rpm package for CentOS, then install it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo rpm -ivh otrs-3.3.8-01.noarch.rpm 
</span></code></pre></td></tr></table></div></figure>


<p>As root do following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cd /etc/httpd/conf.d/
</span><span class='line'># cp zzz_otrs.conf otrs.conf
</span><span class='line'># service httpd start
</span></code></pre></td></tr></table></div></figure>


<p>We have to disable SELinux and delete all of the iptables rules:  <br/>
Close the SELinux via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat /etc/sysconfig/selinux
</span><span class='line'># This file controls the state of SELinux on the system.
</span><span class='line'># SELINUX= can take one of these three values:
</span><span class='line'>#       enforcing - SELinux security policy is enforced.
</span><span class='line'>#       permissive - SELinux prints warnings instead of enforcing.
</span><span class='line'>#       disabled - SELinux is fully disabled.
</span><span class='line'># SELINUX=permissive
</span><span class='line'>SELINUX=disabled
</span></code></pre></td></tr></table></div></figure>


<p>If you don&rsquo;t disable SELINUX, then you may meet following error message:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>消息: Kernel/Config.pm isn't writable!
</span><span class='line'>If you want to use the installer, set the Kernel/Config.pm writable for the webserver user!
</span></code></pre></td></tr></table></div></figure>


<p>After disable the SELINUX, Restart the computer.   <br/>
Flush all of the pre-defined iptables rules:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># iptables -F
</span><span class='line'># service iptables save
</span></code></pre></td></tr></table></div></figure>


<p>Now open the browser visit:
<a href="http://Your_Server/ostr/installer.pl">http://Your_Server/ostr/installer.pl</a></p>

<p>When Configurating the database, in the second step, the machine should be selected as <code>localhost</code>.</p>

<p>If you want to delete the otrs database, or if the installation step tells you otrs database exists, you can using following command for drop this database:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@CentOS conf.d]# mysqladmin -u root -p  drop otrs
</span><span class='line'>Enter password: 
</span><span class='line'>Dropping the database is potentially a very bad thing to do.
</span><span class='line'>Any data stored in the database will be destroyed.
</span><span class='line'>
</span><span class='line'>Do you really want to drop the 'otrs' database [y/N] y
</span><span class='line'>Database "otrs" dropped
</span></code></pre></td></tr></table></div></figure>


<h3>Configuration of otrs</h3>

<p>The start page at:  <br/>
<a href="http://Your_Machine/otrs/index.pl">http://Your_Machine/otrs/index.pl</a></p>

<p>Customer Start page:   <br/>
<a href="http://Your_Machine/otrs/customer.pl">http://Your_Machine/otrs/customer.pl</a></p>

<p>Enable the crons tasks(mandantory):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ su root
</span><span class='line'># su -m otrs -c 'cd /opt/otrs/bin/ && ./Cron.sh start'
</span><span class='line'># crontab -l -u otrs
</span></code></pre></td></tr></table></div></figure>


<p>Add dynamic field via:  <br/>
系统管理->工单设置->动态字段， at the field of &ldquo;工单&rdquo;, click it and then you can add the customized field.  This will affect customer&rsquo;s submitted ticket forms.</p>

<p>Change smtp configuration:  <br/>
系统管理->系统配置-> 搜索<code>smtp</code>, you will meet Core::Sendmail, define the corresponding field and types, then you can use smtp for sending emails.</p>

<h3>Uninstall otrs</h3>

<p>Finally the team didn&rsquo;t use otrs, but its email annoyed me for a long time. Finally I found it&rsquo;s this machine who runs otrs. so I just login to 53, and run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># rpm -e otrs
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>Also remove the crontab jobs and etc.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># su -m otrs 
</span><span class='line'>bash: /root/.bashrc: Permission denied
</span><span class='line'>bash-4.1$ ./Cron.sh stop
</span><span class='line'>/opt/otrs/bin
</span><span class='line'>Cron.sh - start/stop OTRS cronjobs
</span><span class='line'>Copyright (C) 2001-2012 OTRS AG, http://otrs.org/
</span><span class='line'>done
</span><span class='line'>[root@Linux01 conf.d]# crontab -l -u otrs
</span><span class='line'>no crontab for otrs
</span></code></pre></td></tr></table></div></figure>


<p>Also remove the configuration file under /etc/httpd/conf.d/otrs.conf, then restart the httpd server.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/24/tmux-tips/">Tmux Tips</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-06-24T14:00:00+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>2:00 pm</span></time>
        
         | <a href="/blog/2014/06/24/tmux-tips/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Following is my tmux cheet sheet, it will be updated from time to time.  <br/>
Create a new tmux session:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ tmux new
</span></code></pre></td></tr></table></div></figure>


<p>Given session name:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ tmux new -s session-name
</span></code></pre></td></tr></table></div></figure>


<p>Detach: <code>ctrl</code> + <code>b</code>, &rsquo;d`.   <br/>
List existing session:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ tmux ls
</span></code></pre></td></tr></table></div></figure>


<p>Attached to existing session:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ tmux a -t session-name
</span></code></pre></td></tr></table></div></figure>


<p>Attached to first session:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ tmux a
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/24/graphic-card-on-archlinux/">Graphic Card on ArchLinux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-06-24T09:52:00+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>9:52 am</span></time>
        
         | <a href="/blog/2014/06/24/graphic-card-on-archlinux/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since I got several Intel powered PC, It&rsquo;s is essential to know how graphics card works, thus I could get the fastest performance of my PC or Server.</p>

<h3>Detect Graphics Card</h3>

<p>Use lspci we could get the output of all PCI equipments, get the VGA related information via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ lspci | grep VGA
</span><span class='line'>00:02.0 VGA compatible controller: Intel Corporation 2nd Generation Core Processor Family Integrated Graphics Controller (rev 09)
</span></code></pre></td></tr></table></div></figure>


<p>To know the detailed information of this equipment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ lspci -v -s 00:02.0
</span><span class='line'>00:02.0 VGA compatible controller: Intel Corporation 2nd Generation Core Processor Family Integrated Graphics Controller (rev 09) (prog-if 00 [VGA controller])
</span><span class='line'>  Subsystem: Hewlett-Packard Company Device 161c
</span><span class='line'>  Flags: bus master, fast devsel, latency 0, IRQ 57
</span><span class='line'>  Memory at d4000000 (64-bit, non-prefetchable) [size=4M]
</span><span class='line'>  Memory at c0000000 (64-bit, prefetchable) [size=256M]
</span><span class='line'>  I/O ports at 4000 [size=64]
</span><span class='line'>  Expansion ROM at &lt;unassigned&gt; [disabled]
</span><span class='line'>  Capabilities: &lt;access denied&gt;
</span><span class='line'>  Kernel driver in use: i915
</span><span class='line'>  Kernel modules: i915
</span></code></pre></td></tr></table></div></figure>


<p><code>Memory at c0000000 (64-bit, prefetchable) [size=256M]</code> shows the Intel Video Card with 256MB of video RAM. Or you can get the detailed via : <code>sudo lspci -v  | more</code>.</p>

<p>If you want the graphic ways, simply install following tool:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S hardinfo
</span><span class='line'>$ hardinfo
</span></code></pre></td></tr></table></div></figure>


<p>The picture shows as following:</p>

<p><img src="/images/hardinfo.jpg" alt="/images/hardinfo.jpg" /></p>

<p>lshw could also shows the result:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo lshw -class display
</span><span class='line'>  *-display               
</span><span class='line'>       description: VGA compatible controller
</span><span class='line'>       product: 2nd Generation Core Processor Family Integrated Graphics Controller
</span><span class='line'>       vendor: Intel Corporation
</span><span class='line'>       physical id: 2
</span><span class='line'>       bus info: pci@0000:00:02.0
</span><span class='line'>       version: 09
</span><span class='line'>       width: 64 bits
</span><span class='line'>       clock: 33MHz
</span><span class='line'>       capabilities: msi pm vga_controller bus_master cap_list rom
</span><span class='line'>       configuration: driver=i915 latency=0
</span><span class='line'>       resources: irq:57 memory:d4000000-d43fffff memory:c0000000-cfffffff ioport:4000(size=64)
</span></code></pre></td></tr></table></div></figure>


<h3>Get the config from Intel Doc</h3>

<p>Refer to following link:  <br/>
<a href="http://en.wikipedia.org/wiki/Comparison_of_Intel_graphics_processing_units">http://en.wikipedia.org/wiki/Comparison_of_Intel_graphics_processing_units</a>, for example, My cpu is Intel&reg; Core&trade; i5-2520M , then find the &ldquo;Core i5-2xxxM&rdquo;, it shows the graphic card is HD Graphics 3000.</p>

<h3>Configure Intel Graphics Card</h3>

<p>Install driver:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S xf86-video-intel
</span></code></pre></td></tr></table></div></figure>


<p>32-bit 3D Support:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S lib32-intel-dri
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/18/database-in-node-dot-js/">Database in Node.js</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-06-18T19:43:00+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>7:43 pm</span></time>
        
         | <a href="/blog/2014/06/18/database-in-node-dot-js/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>MongoDB</h3>

<p>Install MongoDB via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S mongodb
</span><span class='line'>$ sudo systemctl start mongodb
</span><span class='line'>$ sudo systemctl enable mongodb
</span><span class='line'>$ mongodb
</span></code></pre></td></tr></table></div></figure>


<p>Later I will cover this topic.</p>

<h3>MySQL</h3>

<h4>Installation of MySQL</h4>

<p>The implementation chosen by Arch Linux is called MariaDB, install it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S mariadb 
</span></code></pre></td></tr></table></div></figure>


<p>Configuration steps:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo systemctl start mysqld.service
</span><span class='line'>[Trusty@~]$ sudo mysql_secure_installation
</span><span class='line'>/usr/bin/mysql_secure_installation: line 379: find_mysql_client: command not found
</span><span class='line'>
</span><span class='line'>NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB
</span><span class='line'>      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!
</span><span class='line'>
</span><span class='line'>In order to log into MariaDB to secure it, we'll need the current
</span><span class='line'>password for the root user.  If you've just installed MariaDB, and
</span><span class='line'>you haven't set the root password yet, the password will be blank,
</span><span class='line'>so you should just press enter here.
</span><span class='line'>
</span><span class='line'>Enter current password for root (enter for none): 
</span><span class='line'>OK, successfully used password, moving on...
</span><span class='line'>
</span><span class='line'>Setting the root password ensures that nobody can log into the MariaDB
</span><span class='line'>root user without the proper authorisation.
</span><span class='line'>
</span><span class='line'>Set root password? [Y/n] Y
</span><span class='line'>New password: 
</span><span class='line'>Re-enter new password: 
</span><span class='line'>Password updated successfully!
</span><span class='line'>Reloading privilege tables..
</span><span class='line'> ... Success!
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>By default, a MariaDB installation has an anonymous user, allowing anyone
</span><span class='line'>to log into MariaDB without having to have a user account created for
</span><span class='line'>them.  This is intended only for testing, and to make the installation
</span><span class='line'>go a bit smoother.  You should remove them before moving into a
</span><span class='line'>production environment.
</span><span class='line'>
</span><span class='line'>Remove anonymous users? [Y/n] Y
</span><span class='line'> ... Success!
</span><span class='line'>
</span><span class='line'>Normally, root should only be allowed to connect from 'localhost'.  This
</span><span class='line'>ensures that someone cannot guess at the root password from the network.
</span><span class='line'>
</span><span class='line'>Disallow root login remotely? [Y/n] Y
</span><span class='line'> ... Success!
</span><span class='line'>
</span><span class='line'>By default, MariaDB comes with a database named 'test' that anyone can
</span><span class='line'>access.  This is also intended only for testing, and should be removed
</span><span class='line'>before moving into a production environment.
</span><span class='line'>
</span><span class='line'>Remove test database and access to it? [Y/n] Y
</span><span class='line'> - Dropping test database...
</span><span class='line'> ... Success!
</span><span class='line'> - Removing privileges on test database...
</span><span class='line'> ... Success!
</span><span class='line'>
</span><span class='line'>Reloading the privilege tables will ensure that all changes made so far
</span><span class='line'>will take effect immediately.
</span><span class='line'>
</span><span class='line'>Reload privilege tables now? [Y/n] Y
</span><span class='line'> ... Success!
</span><span class='line'>
</span><span class='line'>Cleaning up...
</span><span class='line'>
</span><span class='line'>All done!  If you've completed all of the above steps, your MariaDB
</span><span class='line'>installation should now be secure.
</span><span class='line'>
</span><span class='line'>Thanks for using MariaDB!
</span></code></pre></td></tr></table></div></figure>


<p>Now you can login the mariadb via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mysql -u root -p
</span><span class='line'>MariaDB [(none)]&gt; SHOW DATABASES;
</span><span class='line'>+--------------------+
</span><span class='line'>| Database           |
</span><span class='line'>+--------------------+
</span><span class='line'>| information_schema |
</span><span class='line'>| mysql              |
</span><span class='line'>| performance_schema |
</span><span class='line'>+--------------------+
</span><span class='line'>3 rows in set (0.00 sec)
</span></code></pre></td></tr></table></div></figure>


<h4>Node.js of MariaDB</h4>

<h3>Redis</h3>

<p>Running result:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>127.0.0.1:6379&gt; SET my.key test
</span><span class='line'>OK
</span><span class='line'>127.0.0.1:6379&gt; KEYS my.key
</span><span class='line'>1) "my.key"
</span><span class='line'>127.0.0.1:6379&gt; VALUES my.key
</span><span class='line'>(error) ERR unknown command 'VALUES'
</span><span class='line'>127.0.0.1:6379&gt; GET my.key
</span><span class='line'>"test"
</span><span class='line'>127.0.0.1:6379&gt; keys *
</span><span class='line'> 1) "user:jeff@amazon.com:followers"
</span><span class='line'> 2) "user:jeff@amazon.com:follows"
</span><span class='line'> 3) "user:bill@microsoft.com:followers"
</span><span class='line'> 4) "mykey"
</span><span class='line'> 5) "rq:job:b9b76e04-8bb7-4652-83e9-4453de981554"
</span><span class='line'> 6) "rq:queue:default"
</span><span class='line'> 7) "user:mark@facebook.com:data"
</span><span class='line'> 8) "_kombu.binding.celeryev"
</span><span class='line'> 9) "user:fred@fedex.com:data"
</span><span class='line'>10) "user:jeff@amazon.com:data"
</span><span class='line'>11) "rq:queues"
</span><span class='line'>12) "user:bill@microsoft.com:follows"
</span><span class='line'>13) "_kombu.binding.celery"
</span><span class='line'>14) "my.key"
</span><span class='line'>15) "user:bill@microsoft.com:data"
</span><span class='line'>127.0.0.1:6379&gt; KEYS my.key
</span><span class='line'>1) "my.key"
</span><span class='line'>127.0.0.1:6379&gt; SET online.users 0
</span><span class='line'>OK
</span><span class='line'>127.0.0.1:6379&gt; onlien.users
</span><span class='line'>(error) ERR unknown command 'onlien.users'
</span><span class='line'>127.0.0.1:6379&gt; online.users
</span><span class='line'>(error) ERR unknown command 'online.users'
</span><span class='line'>127.0.0.1:6379&gt; KEYS online.users
</span><span class='line'>1) "online.users"
</span><span class='line'>127.0.0.1:6379&gt; GET online.users
</span><span class='line'>"0"
</span><span class='line'>127.0.0.1:6379&gt; INCR online.users
</span><span class='line'>(integer) 1
</span><span class='line'>127.0.0.1:6379&gt; INCR onlien.users
</span><span class='line'>(integer) 1
</span><span class='line'>127.0.0.1:6379&gt; INCR online.users
</span><span class='line'>(integer) 2
</span><span class='line'>127.0.0.1:6379&gt; HSET profile.1 name Guillermo
</span><span class='line'>(integer) 1
</span><span class='line'>127.0.0.1:6379&gt; HGETALL profile.1
</span><span class='line'>1) "name"
</span><span class='line'>2) "Guillermo"
</span><span class='line'>127.0.0.1:6379&gt; HSET profile.1 last Rauch
</span><span class='line'>(integer) 1
</span><span class='line'>127.0.0.1:6379&gt; HGETALL profile.1
</span><span class='line'>1) "name"
</span><span class='line'>2) "Guillermo"
</span><span class='line'>3) "last"
</span><span class='line'>4) "Rauch"
</span><span class='line'>127.0.0.1:6379&gt; HSET profile.1 programmer 1
</span><span class='line'>(integer) 1
</span><span class='line'>127.0.0.1:6379&gt; HGETALL profile.1
</span><span class='line'>1) "name"
</span><span class='line'>2) "Guillermo"
</span><span class='line'>3) "last"
</span><span class='line'>4) "Rauch"
</span><span class='line'>5) "programmer"
</span><span class='line'>6) "1"
</span><span class='line'>127.0.0.1:6379&gt; HDEL profile.1 programmer
</span><span class='line'>(integer) 1
</span><span class='line'>127.0.0.1:6379&gt; HGETALL profile.1
</span><span class='line'>1) "name"
</span><span class='line'>2) "Guillermo"
</span><span class='line'>3) "last"
</span><span class='line'>4) "Rauch"
</span><span class='line'>127.0.0.1:6379&gt; RPSH profile.1.jobs "job 1"
</span><span class='line'>(error) ERR unknown command 'RPSH'
</span><span class='line'>127.0.0.1:6379&gt; RPUSH profile.1.jobs "job 1"
</span><span class='line'>(integer) 1
</span><span class='line'>127.0.0.1:6379&gt; HGET profile.1
</span><span class='line'>(error) ERR wrong number of arguments for 'hget' command
</span><span class='line'>127.0.0.1:6379&gt; HGETALL profile.1
</span><span class='line'>1) "name"
</span><span class='line'>2) "Guillermo"
</span><span class='line'>3) "last"
</span><span class='line'>4) "Rauch"
</span><span class='line'>127.0.0.1:6379&gt; LRANGE profile.1.jobs 0 -1
</span><span class='line'>1) "job 1"
</span><span class='line'>127.0.0.1:6379&gt; 
</span><span class='line'>127.0.0.1:6379&gt; RPUSH profile.1.jobs "job 2"
</span><span class='line'>(integer) 2
</span><span class='line'>127.0.0.1:6379&gt; LRANGE profile.1.jobs 0 -1
</span><span class='line'>1) "job 1"
</span><span class='line'>2) "job 2"
</span><span class='line'>127.0.0.1:6379&gt; RPUSH profile.1.jobs "job 3"
</span><span class='line'>(integer) 3
</span><span class='line'>127.0.0.1:6379&gt; LRANGE profile.1.jobs 0 -1
</span><span class='line'>1) "job 1"
</span><span class='line'>2) "job 2"
</span><span class='line'>3) "job 3"
</span></code></pre></td></tr></table></div></figure>


<p>DataSet in Redis:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>127.0.0.1:6379&gt; SADD myset "a member"
</span><span class='line'>(integer) 1
</span><span class='line'>127.0.0.1:6379&gt; SMEMBERS myset
</span><span class='line'>1) "a member"
</span><span class='line'>127.0.0.1:6379&gt; SADD myset "a second member"
</span><span class='line'>(integer) 1
</span><span class='line'>127.0.0.1:6379&gt; SMEMEBERS myset
</span><span class='line'>(error) ERR unknown command 'SMEMEBERS'
</span><span class='line'>127.0.0.1:6379&gt; SMEMBERS myset
</span><span class='line'>1) "a second member"
</span><span class='line'>2) "a member"
</span><span class='line'>127.0.0.1:6379&gt; SREM myset "a second member"
</span><span class='line'>(integer) 1
</span><span class='line'>127.0.0.1:6379&gt; SMEMBERS myset
</span><span class='line'>1) "a member"
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/16/archlinux-on-surface-pro-1/">ArchLinux on Surface Pro(1)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-06-16T13:51:00+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:51 pm</span></time>
        
         | <a href="/blog/2014/06/16/archlinux-on-surface-pro-1/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>System Management</h3>

<h4>Users and Groups</h4>

<p>Install zsh and use zsh as the newly added users&rsquo;s default SHELL:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pacman -S zsh
</span><span class='line'># useradd -m -g root -G audio -s /bin/zsh Trusty
</span></code></pre></td></tr></table></div></figure>


<p>Then we add the newly added user into the sudo group and configure the sudo parameters:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pacman -S sudo
</span><span class='line'># visudo
</span><span class='line'>Trusty ALL=(ALL) NOPASSWD: ALL
</span><span class='line'>Defaults env_keep += "LANG LANGUAGE LINGUAS LC_* _XKB_CHARSET http_proxy https_proxy ftp_proxy ftps_proxy"
</span></code></pre></td></tr></table></div></figure>


<p>Now the user is OK, and you can directly use newly added user for login, I suggest you swiftly switch to the newly added user, because using root is not a good idea, it&rsquo;s not safe.  <br/>
And we can copy the existing zshrc file from the company machine.</p>

<h4>Yaourt</h4>

<p>Add following command into /etc/pacman.conf:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[archlinuxfr]
</span><span class='line'>SigLevel = Never
</span><span class='line'>Server = http://repo.archlinux.fr/$arch
</span></code></pre></td></tr></table></div></figure>


<p>Then:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo pacman -Syu && sudo pacman -S yaourt
</span></code></pre></td></tr></table></div></figure>


<h4>Packages</h4>

<p>Install following packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pacman -S chromium firefox xorg xorg-xinit awesome xf86-video-intel xf86-video-ati pidgin thunderbird wget libreoffice gnome-terminal tigervnc xfce4  evince gimp smplayer alsa-utils gvim eclipse git subversion wireshark-gtk tcpdump ddd gdb meld qemu virtualbox wqy-bitmapfont wqy-microhei wqy-microhei-lite wqy-zenhei fcitx fcitx-libpinyin rox gpicview conky fcitx-googlepinyin nodejs cronie ntfs-3g dmenu lm_sensors pm-utils
</span></code></pre></td></tr></table></div></figure>


<p>Configure:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@~]$ cat ~/.xinirc 
</span><span class='line'>exec awesome
</span><span class='line'>[Trusty@~]$ cat ~/.vnc/xstartup 
</span><span class='line'>#!/bin/sh
</span><span class='line'>
</span><span class='line'>export XKL_XMODMAP_DISABLE=1
</span><span class='line'>exec startxfce4
</span></code></pre></td></tr></table></div></figure>


<p>Configure crontab:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>crontab -e
</span><span class='line'>*/4 * * * * sudo fdisk -l /dev/sdb
</span></code></pre></td></tr></table></div></figure>


<p>Configure lm_sensors:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># yes | sensors-detect</span></code></pre></td></tr></table></div></figure>


<p>Brightness of the screen(Too light!!!! should be darker!!!):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo echo 1240&gt;/sys/class/brightness/intel_backlight/brightness</span></code></pre></td></tr></table></div></figure>


<h3>Network Configration(Wireless)</h3>

<p>The wireless configuration on SurfacePro is quite annoying procedure, so following are
the steps for configurating it.</p>

<p>Install NetworkManager:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S networkmanager</span></code></pre></td></tr></table></div></figure>


<p>Disable the dhcpd.service of systemd, cause the networkmanager will have its own dhcp
client for configurating:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo systemctl --type=service 
</span><span class='line'>$ sudo systemctl disable dhcpcd.service</span></code></pre></td></tr></table></div></figure>


<p>Now enable and start the NetworkManager.service:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo systemctl enable NetworkManager.service</span></code></pre></td></tr></table></div></figure>


<p>Using the applet for configurating the Network Manager:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S network-manager-applet</span></code></pre></td></tr></table></div></figure>


<p>Call nm-applet via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ nm-applet</span></code></pre></td></tr></table></div></figure>


<p>Configure the wireless connection, the NM will automatically store it so now you could
reboot for using the wifi(Make sure you have removed the wired connection).</p>

<h3>Auto-Login Awesome</h3>

<p>Since awesome will using the terminal by default, while I use synergyc for connecting
to the synergys server, this will cause me to using surface pro&rsquo;s keyboard, so enable
auto-login for avoiding this.</p>

<p>Install lightdm via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S lightdm
</span><span class='line'>$ sudo systemctl enable lightdm.service</span></code></pre></td></tr></table></div></figure>


<p>Install lightdm-greeter via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S lightdm-gtk-greeter
</span><span class='line'>$ sudo vim /etc/lightdm/lightdm.conf
</span><span class='line'>greeter-session=lightdm-gtk-greeter</span></code></pre></td></tr></table></div></figure>


<p>The greeter session could be view under <code>ls -l /usr/share/xgreeters</code>.</p>

<p>Configure the auto-login for awesome:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim /etc/lightdm/lightdm.conf
</span><span class='line'>
</span><span class='line'>[Seat:*]
</span><span class='line'>pam-service=lightdm
</span><span class='line'>pam-autologin-service=lightdm-autologin
</span><span class='line'>autologin-user=username
</span><span class='line'>autologin-user-timeout=0
</span><span class='line'>session-wrapper=/etc/lightdm/Xsession
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># groupadd -r autologin
</span><span class='line'># gpasswd -a username autologin</span></code></pre></td></tr></table></div></figure>


<p>Now restart the machine and it will automatically falls into the awesome login session.</p>

<h3>fcitx</h3>

<p>Always a big problem!!!!!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo pacman -S fcitx fcitx-googlepinyin fcitx-configtool fcitx-qt4 fcitx-qt5
</span><span class='line'>fcitx-gtk2</span></code></pre></td></tr></table></div></figure>


<p>in /etc/locale.conf:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Enable UTF-8 with Australian settings.
</span><span class='line'>LANG="en_US.UTF-8"
</span><span class='line'>
</span><span class='line'># Keep the default sort order (e.g. files starting with a '.'
</span><span class='line'># should appear at the start of a directory listing.)
</span><span class='line'>LC_COLLATE="C"
</span><span class='line'>
</span><span class='line'># Set the short date to YYYY-MM-DD (test with "date +%c")
</span><span class='line'>LC_TIME="en_US.UTF-8"</span></code></pre></td></tr></table></div></figure>


<p>Configure it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim .xprofile 
</span><span class='line'>export GTK_IM_MODULE=fcitx
</span><span class='line'>export QT_IM_MODULE=fcitx
</span><span class='line'>export XMODIFIERS=@im=fcitx</span></code></pre></td></tr></table></div></figure>


<p>Restart the surfacepro, now you could using fcitx along with awesome/lightdm/firefox(need fcitx-gtk2)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/16/archlinux-on-surface-pro/">ArchLinux on Surface Pro</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-06-16T09:26:00+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>9:26 am</span></time>
        
         | <a href="/blog/2014/06/16/archlinux-on-surface-pro/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Following is the steps for installing ArchLinux on Surface Pro, from the very beginning.</p>

<h3>Prerequisite</h3>

<p>First you have to download the iso from <a href="http://www.archlinux.org/download">http://www.archlinux.org/download</a>, Mine is <code>2014.06.01</code>.  <br/>
Also I use a USB-LAN adapter which holds the following information:   <code>ASIX Electronics Corp. AX88772B</code>.   <br/>
A 8G Flash Disk, 80G USB3.0 USB HardDisk. I also use a 4-Port USB2.0 HUB which carries a AC/DC Adapter for using 3 equipemts(FlashDisk/USB Adapter/USB Disk).  <br/>
Make the bootable flash disk via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># dd if=/path/to/archlinux.iso of=/dev/sdX bs=1M && sync
</span></code></pre></td></tr></table></div></figure>


<p>After it finished we insert the flash disk into the USB HUB, boot-up the Surface Pro Holding both the Power Key and Volumn - Key. Shortly we will go into the archlinux installtion shell.</p>

<h3>Installation Of ArchLinux</h3>

<p>These steps are mainly refers to following URL:  <br/>
<a href="https://bbs.archlinuxcn.org/viewtopic.php?id=1037">https://bbs.archlinuxcn.org/viewtopic.php?id=1037</a>   <br/>
First start-up the sshd so we can remotely login onto the terminal, thus we could easily copy-paste the commands.</p>

<h4>Make partitions on disk</h4>

<p>GPT Partition:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cgdisk /dev/sdX
</span></code></pre></td></tr></table></div></figure>


<p>The Partition I made is as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># fdisk -l /dev/sdb
</span><span class='line'>
</span><span class='line'>Disk /dev/sdb: 74.5 GiB, 80026361856 bytes, 156301488 sectors
</span><span class='line'>Units: sectors of 1 * 512 = 512 bytes
</span><span class='line'>Sector size (logical/physical): 512 bytes / 512 bytes
</span><span class='line'>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span><span class='line'>Disklabel type: gpt
</span><span class='line'>Disk identifier: CEFF8C6A-A06A-46DF-9D10-F4C593C32CA0
</span><span class='line'>
</span><span class='line'>Device           Start          End   Size Type
</span><span class='line'>/dev/sdb1         2048      1050623   512M EFI System
</span><span class='line'>/dev/sdb2      1050624      5244927     2G Linux swap
</span><span class='line'>/dev/sdb3      5244928    156301454    72G Linux filesystem
</span></code></pre></td></tr></table></div></figure>


<p>Notice we have to make a seperated EFI partition, because surface pro is UEFI enablbed. We also have a 2-Gigabyte swap partition and remains all of the reset as the root partition. <br/>
Now make the filesystems on the disk:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mkfs.ext4 /dev/sdb3
</span><span class='line'># mkswap /dev/sdb2
</span><span class='line'># mkfs.vfat -F32 /dev/sdb1 </span></code></pre></td></tr></table></div></figure>


<p>If you are using SSD, then format the ext4 without journal will greatly extend your SSD
lifetime.</p>

<p>But this option is not OK?</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mkfs.ext4 -O "^has_journal" /dev/sd
</span><span class='line'># mkfs.ext4 /dev/sdb2
</span><span class='line'># tune2fs -O ^has_journal /dev/sdb2
</span><span class='line'># tune2fs -o discard /dev/sdb2</span></code></pre></td></tr></table></div></figure>


<p>Enable the swap partion:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># swapon /dev/sdb2 
</span></code></pre></td></tr></table></div></figure>


<h4>Installation Of Basic System</h4>

<p>After creating the partition, mount them into the corresponding position:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mount /dev/sdb3 /mnt
</span><span class='line'># mkdir -p /mnt/boot/EFI/
</span><span class='line'># mount /dev/sdb1 /mnt/boot/EFI/
</span></code></pre></td></tr></table></div></figure>


<p>Install the basic system:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pacstrap -i /mnt base
</span></code></pre></td></tr></table></div></figure>


<p>Generate the fstab file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># genfstab -U -p /mnt &gt;&gt; /mnt/etc/fstab
</span></code></pre></td></tr></table></div></figure>


<p>Examine the generate the fstab:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># file /mnt/etc/fstab 
</span><span class='line'># cat /mnt/etc/fstab
</span></code></pre></td></tr></table></div></figure>


<p>Now you have the basic system installed the /dev/sdb, next step we will enter the system and configure this newly installed system.</p>

<h4>Configure The System</h4>

<p>Enter the system via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># arch-chroot /mnt /bin/bash
</span></code></pre></td></tr></table></div></figure>


<p>Locale:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># vim /etc/locale.gen
</span><span class='line'># locale-gen
</span></code></pre></td></tr></table></div></figure>


<p>Default Language:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo LANG=en_US.UTF-8&gt;/etc/locale.conf
</span></code></pre></td></tr></table></div></figure>


<p>Timezone:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</span></code></pre></td></tr></table></div></figure>


<p>HostName:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># echo SurfacePro&gt;/etc/hostname
</span></code></pre></td></tr></table></div></figure>


<p>Auto-configuring the network at startup:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># systemctl start dhcpcd.service
</span><span class='line'># systemctl enable dhcpcd.service    
</span></code></pre></td></tr></table></div></figure>


<p>Set the password for root user:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># passwd
</span></code></pre></td></tr></table></div></figure>


<p>Install grub with efi support:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pacman -S grub efibootmgr
</span><span class='line'># grub-install --target=x86_64-efi --efi-directory=/boot/EFI --bootloader-id=arch_grub --recheck
</span></code></pre></td></tr></table></div></figure>


<p>Generate the configure files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># grub-mkconfig -o /boot/grub/grub.cfg
</span></code></pre></td></tr></table></div></figure>


<h4>Finish</h4>

<p>Return to the installtion environment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>exit
</span></code></pre></td></tr></table></div></figure>


<p>Umount new partion:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># umount -R /mnt
</span></code></pre></td></tr></table></div></figure>


<p>Reboot via <code>shutdown -h now</code> and next time remove the flash-disk, also press power-up and volumn-down key together, this time you will be leading the usb-disk powered system.</p>

<h3>ScreenShot:</h3>

<p>See following picture:</p>

<p><img src="/images/surfacepro1.jpg" alt="/images/surfacepro1.jpg" /></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/36">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/34">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/01/18/tips-on-setup-mesos-cluster/">Tips on Setup Mesos Cluster</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/15/linux-tips-4/">Linux Tips(4)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/15/vlan-experiment/">Vlan Experiment</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/14/cloudstackshi-yong-lxcyao-dian/">CloudStack使用LXC要点</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/11/install-cloudstack-mgmt-server-on-centos7/">Install CloudStack Mgmt Server on CentOS7</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
