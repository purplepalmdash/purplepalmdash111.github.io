
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="Full Circle C 7 Example Following is the origin ifstat.c, this program will list the net-interface payloads, and it will print out the net interface &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/43">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//fonts.googleapis.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/08/programming-in-c-of-fc-tutorial-5/">Programming in C of FC Tutorial 5</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-08T16:17:22+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:17 pm</span></time>
        
         | <a href="/blog/2014/04/08/programming-in-c-of-fc-tutorial-5/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Full Circle C 7</h3>

<h4>Example</h4>

<p>Following is the origin ifstat.c, this program will list the net-interface payloads, and it will print out the net interface statistics every 2 seconds, but notice this program have several bugs:</p>

<figure class='code'><figcaption><span>ifstat.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">ull</span><span class="p">;</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">parseDevFile</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">iface</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">bRx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">pRx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">bTx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">pTx</span><span class="p">);</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">dumpInterfaceUsage</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">iface</span><span class="p">);</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">parseDevFile</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">iface</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">bRx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">pRx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">bTx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">pTx</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">FILE</span> <span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">char</span> <span class="o">*</span> <span class="n">line</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;/proc/net/dev&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">fp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">while</span><span class="p">(</span><span class="n">getline</span><span class="p">(</span><span class="o">&amp;</span><span class="n">line</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="n">strstr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">iface</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                        <span class="n">sscanf</span><span class="p">(</span><span class="n">strstr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;:&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;%llu%llu%*u%*u%*u%*u%*u%*u%llu%llu&quot;</span><span class="p">,</span> <span class="n">bRx</span><span class="p">,</span> <span class="n">pRx</span><span class="p">,</span> <span class="n">bTx</span><span class="p">,</span> <span class="n">pTx</span><span class="p">);</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
</span><span class='line'>        <span class="n">free</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">dumpInterfaceUsage</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">iface</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="n">ull</span> <span class="n">ifaceBRxOld</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ifaceBTxOld</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ifacePRxOld</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ifacePTxOld</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="n">ull</span> <span class="n">ifaceBRxNew</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ifaceBTxNew</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ifacePRxNew</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ifacePTxNew</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="k">const</span> <span class="kt">int</span> <span class="n">SLEEP_TIME</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">parseDevFile</span><span class="p">(</span><span class="n">iface</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifaceBRxOld</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifacePRxOld</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifaceBTxOld</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifacePTxOld</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'>        <span class="n">sleep</span><span class="p">(</span><span class="n">SLEEP_TIME</span><span class="p">);</span>
</span><span class='line'>        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="n">parseDevFile</span><span class="p">(</span><span class="n">iface</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifaceBRxNew</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifacePRxNew</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifaceBTxNew</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifacePTxNew</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'>                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s In: %8.2f kbytes/s  %5llu P/s Out: %8.2f kbytes/s %5llu P/s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">iface</span><span class="p">,</span>
</span><span class='line'>                                <span class="p">(</span><span class="n">ifaceBRxNew</span> <span class="o">-</span> <span class="n">ifaceBRxOld</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">SLEEP_TIME</span> <span class="o">*</span><span class="mf">1024.0</span><span class="p">),</span>
</span><span class='line'>                                <span class="p">(</span><span class="n">ifacePRxNew</span> <span class="o">-</span> <span class="n">ifacePRxOld</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">SLEEP_TIME</span><span class="p">),</span>
</span><span class='line'>                                <span class="p">(</span><span class="n">ifaceBTxNew</span> <span class="o">-</span> <span class="n">ifaceBTxOld</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">SLEEP_TIME</span> <span class="o">*</span><span class="mf">1024.0</span><span class="p">),</span>
</span><span class='line'>                                <span class="p">(</span><span class="n">ifacePTxNew</span> <span class="o">-</span> <span class="n">ifacePTxOld</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">SLEEP_TIME</span><span class="p">));</span>
</span><span class='line'>                <span class="n">ifaceBRxOld</span> <span class="o">=</span> <span class="n">ifaceBRxNew</span><span class="p">;</span>
</span><span class='line'>                <span class="n">ifaceBTxOld</span> <span class="o">=</span> <span class="n">ifaceBTxNew</span><span class="p">;</span>
</span><span class='line'>                <span class="n">ifacePRxOld</span> <span class="o">=</span> <span class="n">ifacePRxNew</span><span class="p">;</span>
</span><span class='line'>                <span class="n">ifacePTxOld</span> <span class="o">=</span> <span class="n">ifacePTxNew</span><span class="p">;</span>
</span><span class='line'>                <span class="n">sleep</span><span class="p">(</span><span class="n">SLEEP_TIME</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage: %s interfacename</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class='line'>                <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">dumpInterfaceUsage</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running result:</p>

<figure class='code'><figcaption><span>run.sh </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># ./ifstat eth0</span>
</span><span class='line'>eth0 In:     0.24 kbytes/s      <span class="m">2</span> P/s Out:     0.25 kbytes/s     <span class="m">1</span> P/s
</span><span class='line'>eth0 In:     0.32 kbytes/s      <span class="m">4</span> P/s Out:     0.97 kbytes/s     <span class="m">3</span> P/s
</span><span class='line'>eth0 In:     1.29 kbytes/s     <span class="m">13</span> P/s Out:     5.06 kbytes/s    <span class="m">13</span> P/s
</span><span class='line'>eth0 In:     0.06 kbytes/s      <span class="m">1</span> P/s Out:     0.08 kbytes/s     <span class="m">0</span> P/s
</span></code></pre></td></tr></table></div></figure>


<h4>Bugs</h4>

<p>Ok, now let&rsquo;s see its bug:</p>

<figure class='code'><figcaption><span>run.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#enable the unlimited:</span>
</span><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># ulimit -c unlimited</span>
</span><span class='line'><span class="c">#Get the core file: </span>
</span><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># ./ifstat b</span>
</span><span class='line'>Segmentation fault <span class="o">(</span>core dumped<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Debugging</h4>

<figure class='code'><figcaption><span>run.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># ls -l -h core*</span>
</span><span class='line'>-rw------- <span class="m">1</span> root root 272K Oct <span class="m">14</span> 06:53 core.3961
</span><span class='line'><span class="c">#Use gdb for anlysing the corefile:    </span>
</span><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># gdb ifstat core.3961</span>
</span><span class='line'>GNU gdb Fedora <span class="o">(</span>6.8-27.el5<span class="o">)</span>
</span><span class='line'>Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2008</span> Free Software Foundation, Inc.
</span><span class='line'>License GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
</span><span class='line'>This is free software: you are free to change and redistribute it.
</span><span class='line'>There is NO WARRANTY, to the extent permitted by law.  Type <span class="s2">&quot;show copying&quot;</span>
</span><span class='line'>and <span class="s2">&quot;show warranty&quot;</span> <span class="k">for</span> details.
</span><span class='line'>This GDB was configured as <span class="s2">&quot;i386-redhat-linux-gnu&quot;</span>...
</span><span class='line'>
</span><span class='line'>warning: Can<span class="s1">&#39;t read pathname for load map: Input/output error.</span>
</span><span class='line'><span class="s1">Reading symbols from /lib/libc.so.6...done.</span>
</span><span class='line'><span class="s1">Loaded symbols for /lib/libc.so.6</span>
</span><span class='line'><span class="s1">Reading symbols from /lib/ld-linux.so.2...done.</span>
</span><span class='line'><span class="s1">Loaded symbols for /lib/ld-linux.so.2</span>
</span><span class='line'><span class="s1">Core was generated by `./ifstat b&#39;</span>.
</span><span class='line'>Program terminated with signal 11, Segmentation fault.
</span><span class='line'><span class="o">[</span>New process 3961<span class="o">]</span>
</span><span class='line'><span class="c">#0  0x00b6f957 in rawmemchr () from /lib/libc.so.6</span>
</span></code></pre></td></tr></table></div></figure>


<p>Seems the corefile is useless, this because the error is not derived from our own code, but rather from the library. Run gdb for anlysing the ./ifstat b</p>

<figure class='code'><figcaption><span>run.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># gdb ./ifstat</span>
</span><span class='line'>GNU gdb Fedora <span class="o">(</span>6.8-27.el5<span class="o">)</span>
</span><span class='line'>Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2008</span> Free Software Foundation, Inc.
</span><span class='line'>License GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
</span><span class='line'>This is free software: you are free to change and redistribute it.
</span><span class='line'>There is NO WARRANTY, to the extent permitted by law.  Type <span class="s2">&quot;show copying&quot;</span>
</span><span class='line'>and <span class="s2">&quot;show warranty&quot;</span> <span class="k">for</span> details.
</span><span class='line'>This GDB was configured as <span class="s2">&quot;i386-redhat-linux-gnu&quot;</span>...
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> run b
</span><span class='line'>Starting program: /root/code/C7/ifstat b
</span><span class='line'>
</span><span class='line'>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'>0x00b6f957 in rawmemchr <span class="o">()</span> from /lib/libc.so.6
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> <span class="nb">break </span>parseDevFile
</span><span class='line'>Breakpoint <span class="m">1</span> at 0x804854a: file ifstat.c, line 10.
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> run b
</span><span class='line'>The program being debugged has been started already.
</span><span class='line'>Start it from the beginning? <span class="o">(</span>y or n<span class="o">)</span> y
</span><span class='line'>Starting program: /root/code/C7/ifstat b
</span><span class='line'>
</span><span class='line'>Breakpoint 1, parseDevFile <span class="o">(</span><span class="nv">iface</span><span class="o">=</span>0xbfe52b5e <span class="s2">&quot;b&quot;</span>, <span class="nv">bRx</span><span class="o">=</span>0xbfe50f80, <span class="nv">pRx</span><span class="o">=</span>0xbfe50f70, <span class="nv">bTx</span><span class="o">=</span>0xbfe50f78, <span class="nv">pTx</span><span class="o">=</span>0xbfe50f68<span class="o">)</span> at ifstat.c:10
</span><span class='line'><span class="m">10</span>              FILE * <span class="nv">fp</span> <span class="o">=</span> NULL<span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">11</span>              char * <span class="nv">line</span> <span class="o">=</span> NULL<span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">12</span>              unsigned int <span class="nv">len</span> <span class="o">=</span> 0<span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">13</span>              <span class="nv">fp</span> <span class="o">=</span> fopen<span class="o">(</span><span class="s2">&quot;/proc/net/dev&quot;</span>, <span class="s2">&quot;r&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> print fp
</span><span class='line'><span class="nv">$1</span> <span class="o">=</span> <span class="o">(</span>FILE *<span class="o">)</span> 0x0
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">14</span>              <span class="k">if</span><span class="o">(</span><span class="nv">fp</span> <span class="o">==</span> NULL<span class="o">)</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> display line
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x0
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9730170 <span class="s2">&quot;Inter-|   Receive&quot;</span>, <span class="s1">&#39; &#39;</span> &lt;repeats <span class="m">48</span> <span class="nb">times</span>&gt;, <span class="s2">&quot;|  Transmit\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9730170 <span class="s2">&quot;Inter-|   Receive&quot;</span>, <span class="s1">&#39; &#39;</span> &lt;repeats <span class="m">48</span> <span class="nb">times</span>&gt;, <span class="s2">&quot;|  Transmit\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9730170 <span class="s2">&quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">22</span>                              sscanf<span class="o">(</span>strstr<span class="o">(</span>line, <span class="s2">&quot;:&quot;</span><span class="o">)</span>+1, <span class="s2">&quot;%llu%llu%*u%*u%*u%*u%*u%*u%llu%llu&quot;</span>, bRx, pRx, bTx, pTx<span class="o">)</span><span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9730170 <span class="s2">&quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'>0x00b6f957 in rawmemchr <span class="o">()</span> from /lib/libc.so.6
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We found another bug, also we can see ./ifstat dba</p>

<figure class='code'><figcaption><span>run.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># gdb ./ifstat</span>
</span><span class='line'>GNU gdb Fedora <span class="o">(</span>6.8-27.el5<span class="o">)</span>
</span><span class='line'>Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2008</span> Free Software Foundation, Inc.
</span><span class='line'>License GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
</span><span class='line'>This is free software: you are free to change and redistribute it.
</span><span class='line'>There is NO WARRANTY, to the extent permitted by law.  Type <span class="s2">&quot;show copying&quot;</span>
</span><span class='line'>and <span class="s2">&quot;show warranty&quot;</span> <span class="k">for</span> details.
</span><span class='line'>This GDB was configured as <span class="s2">&quot;i386-redhat-linux-gnu&quot;</span>...
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> run dba
</span><span class='line'>Starting program: /root/code/C7/ifstat dba
</span><span class='line'>dba In:     0.00 kbytes/s      <span class="m">0</span> P/s Out:     0.00 kbytes/s     <span class="m">0</span> P/s
</span><span class='line'>dba In:     0.00 kbytes/s      <span class="m">0</span> P/s Out:     0.00 kbytes/s     <span class="m">0</span> P/s
</span><span class='line'>
</span><span class='line'>Program received signal SIGINT, Interrupt.
</span><span class='line'>0x00ef3402 in __kernel_vsyscall <span class="o">()</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> <span class="nb">break </span>parseDevFile
</span><span class='line'>Breakpoint <span class="m">1</span> at 0x804854a: file ifstat.c, line 10.
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> run dba
</span><span class='line'>The program being debugged has been started already.
</span><span class='line'>Start it from the beginning? <span class="o">(</span>y or n<span class="o">)</span> y
</span><span class='line'>Starting program: /root/code/C7/ifstat dba
</span><span class='line'>
</span><span class='line'>Breakpoint 1, parseDevFile <span class="o">(</span><span class="nv">iface</span><span class="o">=</span>0xbf81bb5c <span class="s2">&quot;dba&quot;</span>, <span class="nv">bRx</span><span class="o">=</span>0xbf81ad40, <span class="nv">pRx</span><span class="o">=</span>0xbf81ad30, <span class="nv">bTx</span><span class="o">=</span>0xbf81ad38, <span class="nv">pTx</span><span class="o">=</span>0xbf81ad28<span class="o">)</span> at ifstat.c:10
</span><span class='line'><span class="m">10</span>              FILE * <span class="nv">fp</span> <span class="o">=</span> NULL<span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">11</span>              char * <span class="nv">line</span> <span class="o">=</span> NULL<span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">12</span>              unsigned int <span class="nv">len</span> <span class="o">=</span> 0<span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">13</span>              <span class="nv">fp</span> <span class="o">=</span> fopen<span class="o">(</span><span class="s2">&quot;/proc/net/dev&quot;</span>, <span class="s2">&quot;r&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">14</span>              <span class="k">if</span><span class="o">(</span><span class="nv">fp</span> <span class="o">==</span> NULL<span class="o">)</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> display line
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x0
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> step
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;Inter-|   Receive&quot;</span>, <span class="s1">&#39; &#39;</span> &lt;repeats <span class="m">48</span> <span class="nb">times</span>&gt;, <span class="s2">&quot;|  Transmit\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;Inter-|   Receive&quot;</span>, <span class="s1">&#39; &#39;</span> &lt;repeats <span class="m">48</span> <span class="nb">times</span>&gt;, <span class="s2">&quot;|  Transmit\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;    lo: 4684910    2267    0    0    0     0          0         0  4684910    2267    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;    lo: 4684910    2267    0    0    0     0          0         0  4684910    2267    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  eth0: 5135043   75928    0    0    0     0          0         0 15204045  129941    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  eth0: 5135043   75928    0    0    0     0          0         0 15204045  129941    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">25</span>              fclose<span class="o">(</span>fp<span class="o">)</span><span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">26</span>              free<span class="o">(</span>line<span class="o">)</span><span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">27</span>              <span class="k">return</span> 0<span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">28</span>      <span class="o">}</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'>dumpInterfaceUsage <span class="o">(</span><span class="nv">iface</span><span class="o">=</span>0xbf81bb5c <span class="s2">&quot;dba&quot;</span><span class="o">)</span> at ifstat.c:36
</span><span class='line'><span class="m">36</span>              sleep<span class="o">(</span>SLEEP_TIME<span class="o">)</span><span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">39</span>                      <span class="k">if</span><span class="o">(</span>parseDevFile<span class="o">(</span>iface, <span class="p">&amp;</span>ifaceBRxNew, <span class="p">&amp;</span>ifacePRxNew, <span class="p">&amp;</span>ifaceBTxNew, <span class="p">&amp;</span>ifacePTxNew<span class="o">)</span> <span class="o">==</span> -1<span class="o">)</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Breakpoint 1, parseDevFile <span class="o">(</span><span class="nv">iface</span><span class="o">=</span>0xbf81bb5c <span class="s2">&quot;dba&quot;</span>, <span class="nv">bRx</span><span class="o">=</span>0xbf81ad20, <span class="nv">pRx</span><span class="o">=</span>0xbf81ad10, <span class="nv">bTx</span><span class="o">=</span>0xbf81ad18, <span class="nv">pTx</span><span class="o">=</span>0xbf81ad08<span class="o">)</span> at ifstat.c:10
</span><span class='line'><span class="m">10</span>              FILE * <span class="nv">fp</span> <span class="o">=</span> NULL<span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0xaf5ca0 <span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">11</span>              char * <span class="nv">line</span> <span class="o">=</span> NULL<span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0xaf5ca0 <span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">12</span>              unsigned int <span class="nv">len</span> <span class="o">=</span> 0<span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x0
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">13</span>              <span class="nv">fp</span> <span class="o">=</span> fopen<span class="o">(</span><span class="s2">&quot;/proc/net/dev&quot;</span>, <span class="s2">&quot;r&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x0
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">14</span>              <span class="k">if</span><span class="o">(</span><span class="nv">fp</span> <span class="o">==</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x0
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x0
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;Inter-|   Receive&quot;</span>, <span class="s1">&#39; &#39;</span> &lt;repeats <span class="m">48</span> <span class="nb">times</span>&gt;, <span class="s2">&quot;|  Transmit\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;Inter-|   Receive&quot;</span>, <span class="s1">&#39; &#39;</span> &lt;repeats <span class="m">48</span> <span class="nb">times</span>&gt;, <span class="s2">&quot;|  Transmit\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot; face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;    lo: 4684910    2267    0    0    0     0          0         0  4684910    2267    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;    lo: 4684910    2267    0    0    0     0          0         0  4684910    2267    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  eth0: 5141021   76010    0    0    0     0          0         0 15217535  130042    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  eth0: 5141021   76010    0    0    0     0          0         0 15217535  130042    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">20</span>                      <span class="k">if</span><span class="o">(</span>strstr<span class="o">(</span>line, iface<span class="o">)</span> !<span class="o">=</span> NULL<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">18</span>              <span class="k">while</span><span class="o">(</span>getline<span class="o">(</span><span class="p">&amp;</span>line, <span class="p">&amp;</span>len, fp<span class="o">)</span> !<span class="o">=</span> -1<span class="o">)</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">25</span>              fclose<span class="o">(</span>fp<span class="o">)</span><span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">26</span>              free<span class="o">(</span>line<span class="o">)</span><span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">27</span>              <span class="k">return</span> 0<span class="p">;</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'><span class="m">28</span>      <span class="o">}</span>
</span><span class='line'>1: <span class="nv">line</span> <span class="o">=</span> 0x9101170 <span class="s2">&quot;  sit0:       0       0    0    0    0     0          0         0        0       0    0    0    0     0       0          0\n&quot;</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'>dumpInterfaceUsage <span class="o">(</span><span class="nv">iface</span><span class="o">=</span>0xbf81bb5c <span class="s2">&quot;dba&quot;</span><span class="o">)</span> at ifstat.c:40
</span><span class='line'><span class="m">40</span>                      <span class="nb">printf</span><span class="o">(</span><span class="s2">&quot;%s In: %8.2f kbytes/s  %5llu P/s Out: %8.2f kbytes/s %5llu P/s\n&quot;</span>, iface,
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span>
</span><span class='line'>dba In:     0.00 kbytes/s      <span class="m">0</span> P/s Out:     0.00 kbytes/s     <span class="m">0</span> P/s
</span></code></pre></td></tr></table></div></figure>


<h4>Conclusion:</h4>

<p>And now we can get the reason, the ./ifstat b is because we reached the line2 of the /proc/net/dev, it has b for &ldquo;bytes&rdquo;.  <br/>
./ifstat dba always print 0 because we don&rsquo;t have this equipment at all !</p>

<h4>Correcting</h4>

<p>So the corrected code is listed as following:</p>

<figure class='code'><figcaption><span>ifstat_upgrade.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">int</span> <span class="nf">parseDevFile</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">iface</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">bRx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">pRx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">bTx</span><span class="p">,</span> <span class="n">ull</span> <span class="o">*</span><span class="n">pTx</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">FILE</span> <span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">char</span> <span class="o">*</span> <span class="n">line</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">short</span> <span class="kt">int</span> <span class="n">exists</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;/proc/net/dev&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">fp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">while</span><span class="p">(</span><span class="n">getline</span><span class="p">(</span><span class="o">&amp;</span><span class="n">line</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="n">strstr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">iface</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                        <span class="k">if</span><span class="p">(</span><span class="n">strstr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;:&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
</span><span class='line'>                        <span class="p">{</span>
</span><span class='line'>                                <span class="n">sscanf</span><span class="p">(</span><span class="n">strstr</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;:&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;%llu%llu%*u%*u%*u%*u%*u%*u%llu%llu&quot;</span><span class="p">,</span> <span class="n">bRx</span><span class="p">,</span> <span class="n">pRx</span><span class="p">,</span> <span class="n">bTx</span><span class="p">,</span> <span class="n">pTx</span><span class="p">);</span>
</span><span class='line'>                                <span class="n">exists</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>                        <span class="p">}</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
</span><span class='line'>        <span class="n">free</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span> <span class="n">exists</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;Your device %s is not in the file /proc/net/dev!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">iface</span><span class="p">);</span>
</span><span class='line'>                <span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now run it and the result is listed as:</p>

<figure class='code'><figcaption><span>run.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># ./ifstat_upgrade b</span>
</span><span class='line'>Your device b is not in the file /proc/net/dev!
</span><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># ./ifstat_upgrade bba</span>
</span><span class='line'>Your device bba is not in the file /proc/net/dev!
</span><span class='line'><span class="o">[</span>root@localhost C7<span class="o">]</span><span class="c"># ./ifstat_upgrade eth0</span>
</span><span class='line'>eth0 In:     0.03 kbytes/s      <span class="m">0</span> P/s Out:     0.00 kbytes/s     <span class="m">0</span> P/s
</span><span class='line'>eth0 In:     0.03 kbytes/s      <span class="m">0</span> P/s Out:     0.08 kbytes/s     <span class="m">0</span> P/s
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/08/programming-in-c-of-fc-tutorial-4/">Programming in C of FC Tutorial 4</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-08T16:01:06+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:01 pm</span></time>
        
         | <a href="/blog/2014/04/08/programming-in-c-of-fc-tutorial-4/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Full Circle C 6</h3>

<h4>Using valgrid for memory check</h4>

<p>See <a href="www.valgrind.org">www.valgrind.org</a> for more information for using the valgrind available tools.   <br/>
memcheck is the main topic in this chapter.   <br/>
this tool override libc calls that deal with handling memory. And it will do some bookkeeping. is all memory given back to the system, and is all the allocated memory still reachable?</p>

<figure class='code'><figcaption><span>leak.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">leak</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;malloc(10) points to: %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ptr</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="n">leak</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;malloc(15) in main: %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ptr</span><span class="p">);</span>
</span><span class='line'>        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){}</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The result shows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>valgrind --leak-check<span class="o">=</span>full --show-reachable<span class="o">=</span>yes ./memleak
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> Memcheck, a memory error detector.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> Copyright <span class="o">(</span>C<span class="o">)</span> 2002-2006, and GNU GPL<span class="s1">&#39;d, by Julian Seward et al.</span>
</span><span class='line'><span class="s1">==2144== Using LibVEX rev 1658, a library for dynamic binary translation.</span>
</span><span class='line'><span class="s1">==2144== Copyright (C) 2004-2006, and GNU GPL&#39;</span>d, by OpenWorks LLP.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> Using valgrind-3.2.1, a dynamic binary instrumentation framework.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> Copyright <span class="o">(</span>C<span class="o">)</span> 2000-2006, and GNU GPL<span class="err">&#39;</span>d, by Julian Seward et al.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> For more details, rerun with: -v
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022028
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022068
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40220a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40220e8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022128
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022168
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40221a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40221e8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022228
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022268
</span><span class='line'>malloc<span class="o">(</span>15<span class="o">)</span> in main: <span class="nv">0x40222a8</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> ERROR SUMMARY: <span class="m">0</span> errors from <span class="m">0</span> contexts <span class="o">(</span>suppressed: <span class="m">12</span> from 1<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> malloc/free: in use at <span class="nb">exit</span>: <span class="m">115</span> bytes in <span class="m">11</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> malloc/free: <span class="m">11</span> allocs, <span class="m">0</span> frees, <span class="m">115</span> bytes allocated.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> For counts of detected errors, rerun with: -v
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> searching <span class="k">for</span> pointers to <span class="m">11</span> not-freed blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> checked 46,792 bytes.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> <span class="m">15</span> bytes in <span class="m">1</span> blocks are still reachable in loss record <span class="m">1</span> of <span class="nv">2</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>    at 0x40053C0: malloc <span class="o">(</span>vg_replace_malloc.c:149<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>    by 0x8048419: main <span class="o">(</span>leak.c:17<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> <span class="m">100</span> bytes in <span class="m">10</span> blocks are definitely lost in loss record <span class="m">2</span> of <span class="nv">2</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>    at 0x40053C0: malloc <span class="o">(</span>vg_replace_malloc.c:149<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>    by 0x80483C5: leak <span class="o">(</span>leak.c:6<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>    by 0x8048403: main <span class="o">(</span>leak.c:15<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span> LEAK SUMMARY:
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>    definitely lost: <span class="m">100</span> bytes in <span class="m">10</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>      possibly lost: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>    still reachable: <span class="m">15</span> bytes in <span class="m">1</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2144</span><span class="o">==</span>         suppressed: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span></code></pre></td></tr></table></div></figure>


<p>If we change the code into following, this means valgrid won&rsquo;t interpret the output, so this will let the tracked memory add 10</p>

<figure class='code'><figcaption><span>leak1.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">leak</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;malloc(10) points to: %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ptr</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="n">leak</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;malloc(15) in main: %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ptr</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">//while(1){}</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Compile and verify:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gcc -Wall -g leak1.c -o memleak1
</span><span class='line'>View the valgrind result:
</span><span class='line'>valgrind --leak-check<span class="o">=</span>full --show-reachable<span class="o">=</span>yes ./memleak1
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> Memcheck, a memory error detector.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> Copyright <span class="o">(</span>C<span class="o">)</span> 2002-2006, and GNU GPL<span class="s1">&#39;d, by Julian Seward et al.</span>
</span><span class='line'><span class="s1">==2190== Using LibVEX rev 1658, a library for dynamic binary translation.</span>
</span><span class='line'><span class="s1">==2190== Copyright (C) 2004-2006, and GNU GPL&#39;</span>d, by OpenWorks LLP.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> Using valgrind-3.2.1, a dynamic binary instrumentation framework.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> Copyright <span class="o">(</span>C<span class="o">)</span> 2000-2006, and GNU GPL<span class="err">&#39;</span>d, by Julian Seward et al.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> For more details, rerun with: -v
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022028
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022068
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40220a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40220e8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022128
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022168
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40221a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40221e8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022228
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022268
</span><span class='line'>malloc<span class="o">(</span>15<span class="o">)</span> in main: <span class="nv">0x40222a8</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> ERROR SUMMARY: <span class="m">0</span> errors from <span class="m">0</span> contexts <span class="o">(</span>suppressed: <span class="m">12</span> from 1<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> malloc/free: in use at <span class="nb">exit</span>: <span class="m">115</span> bytes in <span class="m">11</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> malloc/free: <span class="m">11</span> allocs, <span class="m">0</span> frees, <span class="m">115</span> bytes allocated.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> For counts of detected errors, rerun with: -v
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> searching <span class="k">for</span> pointers to <span class="m">11</span> not-freed blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> checked 46,796 bytes.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> <span class="m">15</span> bytes in <span class="m">1</span> blocks are definitely lost in loss record <span class="m">1</span> of <span class="nv">2</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>    at 0x40053C0: malloc <span class="o">(</span>vg_replace_malloc.c:149<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>    by 0x8048419: main <span class="o">(</span>leak1.c:17<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> <span class="m">100</span> bytes in <span class="m">10</span> blocks are definitely lost in loss record <span class="m">2</span> of <span class="nv">2</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>    at 0x40053C0: malloc <span class="o">(</span>vg_replace_malloc.c:149<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>    by 0x80483C5: leak <span class="o">(</span>leak1.c:6<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>    by 0x8048403: main <span class="o">(</span>leak1.c:15<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span> LEAK SUMMARY:
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>    definitely lost: <span class="m">115</span> bytes in <span class="m">11</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>      possibly lost: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>    still reachable: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2190</span><span class="o">==</span>         suppressed: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span></code></pre></td></tr></table></div></figure>


<h4>exercise 1:</h4>

<p>vmstat is a tool which report system usage statistics, use strace to figure out which /proc/file(s) it uses to generate its output</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>execve<span class="o">(</span><span class="s2">&quot;/usr/bin/vmstat&quot;</span>, <span class="o">[</span><span class="s2">&quot;vmstat&quot;</span><span class="o">]</span>, <span class="o">[</span>/* <span class="m">29</span> vars */<span class="o">])</span> <span class="o">=</span> 0
</span><span class='line'>brk<span class="o">(</span>0<span class="o">)</span>                                  <span class="o">=</span> 0x96b7000
</span><span class='line'>access<span class="o">(</span><span class="s2">&quot;/etc/ld.so.preload&quot;</span>, R_OK<span class="o">)</span>      <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
</span><span class='line'>open<span class="o">(</span><span class="s2">&quot;/etc/ld.so.cache&quot;</span>, O_RDONLY<span class="o">)</span>      <span class="o">=</span> 3
</span><span class='line'>fstat64<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0644, <span class="nv">st_size</span><span class="o">=</span>95416, ...<span class="o">})</span> <span class="o">=</span> 0
</span><span class='line'>mmap2<span class="o">(</span>NULL, 95416, PROT_READ, MAP_PRIVATE, 3, 0<span class="o">)</span> <span class="o">=</span> 0xb7f80000
</span><span class='line'>close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> 0
</span><span class='line'>open<span class="o">(</span><span class="s2">&quot;/lib/libproc-3.2.7.so&quot;</span>, O_RDONLY<span class="o">)</span> <span class="o">=</span> 3
</span><span class='line'><span class="nb">read</span><span class="o">(</span>3, <span class="s2">&quot;\177ELF\1\1\1\0\0\0\0\0\0\0\0\0\3\0\3\0\1\0\0\0\320c\304\0004\0\0\0&quot;</span>..., 512<span class="o">)</span> <span class="o">=</span> 512
</span><span class='line'>fstat64<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0755, <span class="nv">st_size</span><span class="o">=</span>54212, ...<span class="o">})</span> <span class="o">=</span> 0
</span><span class='line'>mmap2<span class="o">(</span>NULL, 4096, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0xb7f7f000
</span><span class='line'>mmap2<span class="o">(</span>0xc44000, 133592, PROT_READ<span class="p">|</span>PROT_EXEC, MAP_PRIVATE<span class="p">|</span>MAP_DENYWRITE, 3, 0<span class="o">)</span> <span class="o">=</span> 0xc44000
</span><span class='line'>mmap2<span class="o">(</span>0xc51000, 4096, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0xc<span class="o">)</span> <span class="o">=</span> 0xc51000
</span><span class='line'>mmap2<span class="o">(</span>0xc52000, 76248, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0xc52000
</span><span class='line'>close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> 0
</span><span class='line'>open<span class="o">(</span><span class="s2">&quot;/lib/libc.so.6&quot;</span>, O_RDONLY<span class="o">)</span>        <span class="o">=</span> 3
</span><span class='line'><span class="nb">read</span><span class="o">(</span>3, <span class="s2">&quot;\177ELF\1\1\1\0\0\0\0\0\0\0\0\0\3\0\3\0\1\0\0\0\320?\261\0004\0\0\0&quot;</span>..., 512<span class="o">)</span> <span class="o">=</span> 512
</span><span class='line'>fstat64<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0755, <span class="nv">st_size</span><span class="o">=</span>1606808, ...<span class="o">})</span> <span class="o">=</span> 0
</span><span class='line'>mmap2<span class="o">(</span>0xafe000, 1324452, PROT_READ<span class="p">|</span>PROT_EXEC, MAP_PRIVATE<span class="p">|</span>MAP_DENYWRITE, 3, 0<span class="o">)</span> <span class="o">=</span> 0xafe000
</span><span class='line'>mmap2<span class="o">(</span>0xc3c000, 12288, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_DENYWRITE, 3, 0x13e<span class="o">)</span> <span class="o">=</span> 0xc3c000
</span><span class='line'>mmap2<span class="o">(</span>0xc3f000, 9636, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_FIXED<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0xc3f000
</span><span class='line'>close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> 0
</span><span class='line'>mmap2<span class="o">(</span>NULL, 4096, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0xb7f7e000
</span><span class='line'>set_thread_area<span class="o">({</span>entry_number:-1 -&gt; 6, base_addr:0xb7f7e6c0, limit:1048575, seg_32bit:1, contents:0, read_exec_only:0, limit_in_pages:1, seg_not_present:0, useable:1<span class="o">})</span> <span class="o">=</span> 0
</span><span class='line'>mprotect<span class="o">(</span>0xc3c000, 8192, PROT_READ<span class="o">)</span>     <span class="o">=</span> 0
</span><span class='line'>mprotect<span class="o">(</span>0xaf5000, 4096, PROT_READ<span class="o">)</span>     <span class="o">=</span> 0
</span><span class='line'>munmap<span class="o">(</span>0xb7f80000, 95416<span class="o">)</span>               <span class="o">=</span> 0
</span><span class='line'>uname<span class="o">({</span><span class="nv">sys</span><span class="o">=</span><span class="s2">&quot;Linux&quot;</span>, <span class="nv">node</span><span class="o">=</span><span class="s2">&quot;localhost.localdomain&quot;</span>, ...<span class="o">})</span> <span class="o">=</span> 0
</span><span class='line'>brk<span class="o">(</span>0<span class="o">)</span>                                  <span class="o">=</span> 0x96b7000
</span><span class='line'>brk<span class="o">(</span>0x96d8000<span class="o">)</span>                          <span class="o">=</span> 0x96d8000
</span><span class='line'>open<span class="o">(</span><span class="s2">&quot;/proc/stat&quot;</span>, O_RDONLY<span class="o">)</span>            <span class="o">=</span> 3
</span><span class='line'>fstat64<span class="o">(</span>3, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFREG<span class="p">|</span>0444, <span class="nv">st_size</span><span class="o">=</span>0, ...<span class="o">})</span> <span class="o">=</span> 0
</span><span class='line'>mmap2<span class="o">(</span>NULL, 4096, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0xb7f97000
</span><span class='line'><span class="nb">read</span><span class="o">(</span>3, <span class="s2">&quot;cpu  14886 15300 97152 608490 41&quot;</span>..., 4096<span class="o">)</span> <span class="o">=</span> 693
</span><span class='line'><span class="nb">read</span><span class="o">(</span>3, <span class="s2">&quot;&quot;</span>, 4096<span class="o">)</span>                       <span class="o">=</span> 0
</span><span class='line'>close<span class="o">(</span>3<span class="o">)</span>                                <span class="o">=</span> 0
</span><span class='line'>munmap<span class="o">(</span>0xb7f97000, 4096<span class="o">)</span>                <span class="o">=</span> 0
</span><span class='line'>ioctl<span class="o">(</span>1, TIOCGWINSZ, <span class="o">{</span><span class="nv">ws_row</span><span class="o">=</span>36, <span class="nv">ws_col</span><span class="o">=</span>115, <span class="nv">ws_xpixel</span><span class="o">=</span>0, <span class="nv">ws_ypixel</span><span class="o">=</span>0<span class="o">})</span> <span class="o">=</span> 0
</span><span class='line'>fstat64<span class="o">(</span>1, <span class="o">{</span><span class="nv">st_mode</span><span class="o">=</span>S_IFCHR<span class="p">|</span>0620, <span class="nv">st_rdev</span><span class="o">=</span>makedev<span class="o">(</span>136, 4<span class="o">)</span>, ...<span class="o">})</span> <span class="o">=</span> 0
</span><span class='line'>mmap2<span class="o">(</span>NULL, 4096, PROT_READ<span class="p">|</span>PROT_WRITE, MAP_PRIVATE<span class="p">|</span>MAP_ANONYMOUS, -1, 0<span class="o">)</span> <span class="o">=</span> 0xb7f97000
</span><span class='line'>write<span class="o">(</span>1, <span class="s2">&quot;procs -----------memory---------&quot;</span>..., 82procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu------
</span><span class='line'><span class="o">)</span> <span class="o">=</span> 82
</span><span class='line'>write<span class="o">(</span>1, <span class="s2">&quot; r  b   swpd   free   buff  cach&quot;</span>..., <span class="m">81</span> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
</span><span class='line'><span class="o">)</span> <span class="o">=</span> 81
</span><span class='line'>open<span class="o">(</span><span class="s2">&quot;/proc/meminfo&quot;</span>, O_RDONLY<span class="o">)</span>         <span class="o">=</span> 3
</span><span class='line'>lseek<span class="o">(</span>3, 0, SEEK_SET<span class="o">)</span>                   <span class="o">=</span> 0
</span><span class='line'><span class="nb">read</span><span class="o">(</span>3, <span class="s2">&quot;MemTotal:       897068 kB\nMemFre&quot;</span>..., 1023<span class="o">)</span> <span class="o">=</span> 771
</span><span class='line'>open<span class="o">(</span><span class="s2">&quot;/proc/stat&quot;</span>, O_RDONLY<span class="o">)</span>            <span class="o">=</span> 4
</span><span class='line'><span class="nb">read</span><span class="o">(</span>4, <span class="s2">&quot;cpu  14886 15300 97153 608490 41&quot;</span>..., 65535<span class="o">)</span> <span class="o">=</span> 693
</span><span class='line'>open<span class="o">(</span><span class="s2">&quot;/proc/vmstat&quot;</span>, O_RDONLY<span class="o">)</span>          <span class="o">=</span> 5
</span><span class='line'>lseek<span class="o">(</span>5, 0, SEEK_SET<span class="o">)</span>                   <span class="o">=</span> 0
</span><span class='line'><span class="nb">read</span><span class="o">(</span>5, <span class="s2">&quot;nr_anon_pages 29682\nnr_mapped 13&quot;</span>..., 1023<span class="o">)</span> <span class="o">=</span> 803
</span><span class='line'>write<span class="o">(</span>1, <span class="s2">&quot; 0  0    120  16980  32852 67407&quot;</span>..., <span class="m">81</span> <span class="m">0</span>  <span class="m">0</span>    <span class="m">120</span>  <span class="m">16980</span>  <span class="m">32852</span> <span class="m">674076</span>    <span class="m">0</span>    <span class="m">0</span>   <span class="m">228</span>   <span class="m">223</span> <span class="m">1040</span>  <span class="m">432</span>  <span class="m">4</span> <span class="m">13</span> <span class="m">78</span>  <span class="m">5</span>  0
</span><span class='line'><span class="o">)</span> <span class="o">=</span> 81
</span><span class='line'>exit_group<span class="o">(</span>0<span class="o">)</span>                           <span class="o">=</span> ?
</span></code></pre></td></tr></table></div></figure>


<p>From the above output, we can see, it access /proc/stat and /proc/vmstat for output message.</p>

<h4>exercise 2</h4>

<p>Repeat the ltrace /strace example on wget with ivalid URL, TBD</p>

<h4>exercise 3</h4>

<p>Does valgrind automatically trace child process?</p>

<figure class='code'><figcaption><span>fork.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* For using fork() */</span>
</span><span class='line'><span class="cp">#include &lt;sys/types.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* Using errono */</span>
</span><span class='line'><span class="cp">#include &lt;errno.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">leak</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;malloc(10) points to: %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ptr</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="kt">pid_t</span> <span class="n">child</span><span class="p">;</span>
</span><span class='line'>        <span class="cm">/* Parent do leak() */</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="n">leak</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/* Now fork a child process */</span>
</span><span class='line'>        <span class="k">if</span><span class="p">((</span><span class="n">child</span> <span class="o">=</span> <span class="n">fork</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;fork of child failed: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">strerror</span><span class="p">(</span><span class="n">errno</span><span class="p">));</span>
</span><span class='line'>                <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">child</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Now its in child process</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>                <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1">// parent will exit immediately !</span>
</span><span class='line'>                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Parent will exit!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>                <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>                <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Only Child comes here</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Only child comes here!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="n">leak</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We use following command for tracing the output:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>root@localhost code<span class="o">]</span><span class="c"># valgrind --leak-check=full --show-reachable=yes ./memleak_fork</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> Memcheck, a memory error detector.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> Copyright <span class="o">(</span>C<span class="o">)</span> 2002-2006, and GNU GPL<span class="s1">&#39;d, by Julian Seward et al.</span>
</span><span class='line'><span class="s1">==2561== Using LibVEX rev 1658, a library for dynamic binary translation.</span>
</span><span class='line'><span class="s1">==2561== Copyright (C) 2004-2006, and GNU GPL&#39;</span>d, by OpenWorks LLP.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> Using valgrind-3.2.1, a dynamic binary instrumentation framework.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> Copyright <span class="o">(</span>C<span class="o">)</span> 2000-2006, and GNU GPL<span class="err">&#39;</span>d, by Julian Seward et al.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> For more details, rerun with: -v
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022028
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022068
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40220a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40220e8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022128
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022168
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40221a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40221e8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022228
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022268
</span><span class='line'>Now its in child process
</span><span class='line'>Parent will <span class="nb">exit</span>!
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> ERROR SUMMARY: <span class="m">0</span> errors from <span class="m">0</span> contexts <span class="o">(</span>suppressed: <span class="m">12</span> from 1<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> malloc/free: in use at <span class="nb">exit</span>: <span class="m">100</span> bytes in <span class="m">10</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> malloc/free: <span class="m">10</span> allocs, <span class="m">0</span> frees, <span class="m">100</span> bytes allocated.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> For counts of detected errors, rerun with: -v
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> searching <span class="k">for</span> pointers to <span class="m">10</span> not-freed blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> checked 46,796 bytes.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> <span class="m">100</span> bytes in <span class="m">10</span> blocks are definitely lost in loss record <span class="m">1</span> of <span class="nv">1</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>    at 0x40053C0: malloc <span class="o">(</span>vg_replace_malloc.c:149<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>    by 0x8048515: leak <span class="o">(</span>fork.c:15<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>    by 0x8048553: main <span class="o">(</span>fork.c:26<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span> LEAK SUMMARY:
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>    definitely lost: <span class="m">100</span> bytes in <span class="m">10</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>      possibly lost: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>    still reachable: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2561</span><span class="o">==</span>         suppressed: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span><span class='line'><span class="o">[</span>root@localhost code<span class="o">]</span><span class="c"># Only child comes here!</span>
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40222a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40222e8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022328
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022368
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40223a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40223e8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022428
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x4022468
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: 0x40224a8
</span><span class='line'>malloc<span class="o">(</span>10<span class="o">)</span> points to: <span class="nv">0x40224e8</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span> ERROR SUMMARY: <span class="m">0</span> errors from <span class="m">0</span> contexts <span class="o">(</span>suppressed: <span class="m">12</span> from 1<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span> malloc/free: in use at <span class="nb">exit</span>: <span class="m">200</span> bytes in <span class="m">20</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span> malloc/free: <span class="m">20</span> allocs, <span class="m">0</span> frees, <span class="m">200</span> bytes allocated.
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span> For counts of detected errors, rerun with: -v
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span> searching <span class="k">for</span> pointers to <span class="m">20</span> not-freed blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span> checked 46,796 bytes.
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span> <span class="m">200</span> bytes in <span class="m">20</span> blocks are definitely lost in loss record <span class="m">1</span> of <span class="nv">1</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>    at 0x40053C0: malloc <span class="o">(</span>vg_replace_malloc.c:149<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>    by 0x8048515: leak <span class="o">(</span>fork.c:15<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>    by 0x8048553: main <span class="o">(</span>fork.c:26<span class="o">)</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span> LEAK SUMMARY:
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>    definitely lost: <span class="m">200</span> bytes in <span class="m">20</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>      possibly lost: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>    still reachable: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span><span class='line'><span class="o">==</span><span class="nv">2562</span><span class="o">==</span>         suppressed: <span class="m">0</span> bytes in <span class="m">0</span> blocks.
</span></code></pre></td></tr></table></div></figure>


<p>From the above output, we can see valgrid also tracked the child process&rsquo;s memory usage.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/08/programming-in-c-of-fc-tutorial-3/">Programming in C of FC Tutorial 3</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-08T09:41:55+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>9:41 am</span></time>
        
         | <a href="/blog/2014/04/08/programming-in-c-of-fc-tutorial-3/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Full Circle C 5</h3>

<h4>Callback</h4>

<p>Use Call Back function for implementing a calculator:</p>

<figure class='code'><figcaption><span>CB_Calculator.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">minus</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">multiply</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">divide</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">mathFun</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">operator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'>  <span class="n">mathFun</span> <span class="n">f</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">operator</span> <span class="n">functs</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;-&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">minus</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;+&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">add</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;*&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">multiply</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;/&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">divide</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">i</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter a:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter b:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter the operator:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="n">functs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">c</span><span class="o">==</span><span class="n">c</span><span class="p">)</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>              <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Result:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">functs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">));</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Unkown operator:%c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Exercise 1</h4>

<p>Modify the application to operate on floating point numbers instead of integers.</p>

<figure class='code'><figcaption><span>cal_float.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">float</span>  <span class="nf">minus</span><span class="p">(</span><span class="kt">float</span> <span class="n">a</span><span class="p">,</span> <span class="kt">float</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">float</span> <span class="nf">add</span><span class="p">(</span><span class="kt">float</span> <span class="n">a</span><span class="p">,</span> <span class="kt">float</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">float</span> <span class="nf">multiply</span><span class="p">(</span><span class="kt">float</span> <span class="n">a</span><span class="p">,</span> <span class="kt">float</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">float</span> <span class="nf">divide</span><span class="p">(</span><span class="kt">float</span> <span class="n">a</span><span class="p">,</span> <span class="kt">float</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="nf">float</span> <span class="p">(</span><span class="o">*</span><span class="n">mathFun</span><span class="p">)(</span><span class="kt">float</span><span class="p">,</span> <span class="kt">float</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">operator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'>  <span class="n">mathFun</span> <span class="n">f</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">operator</span> <span class="n">functs</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;-&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">minus</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;+&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">add</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;*&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">multiply</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;/&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">divide</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">float</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter a:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%f&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter b:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%f&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter the operator:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="n">functs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">c</span><span class="o">==</span><span class="n">c</span><span class="p">)</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>              <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Result:%f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">functs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">));</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Unkown operator:%c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Exercise 2</h4>

<p>Extend the calculator with the possibility for the user to enter &lsquo;q&rsquo; for quit</p>

<figure class='code'><figcaption><span>qforquit.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">minus</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">multiply</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">divide</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">mathFun</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">operator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'>  <span class="n">mathFun</span> <span class="n">f</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">operator</span> <span class="n">functs</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;-&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">minus</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;+&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">add</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;*&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">multiply</span><span class="p">;</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;/&#39;</span><span class="p">;</span> <span class="n">functs</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">divide</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">q</span><span class="p">;</span>
</span><span class='line'>  <span class="k">do</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">i</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter a:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter b:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter the operator:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="n">functs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">c</span><span class="o">==</span><span class="n">c</span><span class="p">)</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>              <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Result:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">functs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">));</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Unkown operator:%c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter q for quit! Others for continue</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">q</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">q</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="n">q</span> <span class="o">!=</span> <span class="sc">&#39;q&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Exercise 4</h4>

<p>Modify the application that, instead of entering characters, the user is able to enter “5 plus 6” or “6 minus 5”. In order to do this, you will need to adapt the structure to hold a string as the operator, and, instead of reading a character, you will need to read a string. Extra credit if you manage to do this without buffer overrun issues (see man getline) and memory leaks.</p>

<figure class='code'><figcaption><span>human.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">minus</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">multiply</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">divide</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">mathFun</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">operator</span>
</span><span class='line'><span class="p">{</span>  <span class="kt">char</span> <span class="n">c</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
</span><span class='line'>  <span class="n">mathFun</span> <span class="n">f</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">operator</span> <span class="n">functs</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span><span class='line'>  <span class="n">strcpy</span><span class="p">(</span><span class="n">functs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;minus&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">minus</span><span class="p">;</span>
</span><span class='line'>  <span class="n">strcpy</span><span class="p">(</span><span class="n">functs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;add&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">add</span><span class="p">;</span>
</span><span class='line'>  <span class="n">strcpy</span><span class="p">(</span><span class="n">functs</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;mul&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">multiply</span><span class="p">;</span>
</span><span class='line'>  <span class="n">strcpy</span><span class="p">(</span><span class="n">functs</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;div&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">functs</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">f</span><span class="o">=&amp;</span><span class="n">divide</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">i</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">char</span> <span class="n">c</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter a:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter b:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter the operator:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">functs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Result is :%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">functs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">));</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Unkown operator:%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/07/programming-in-c-of-fc-tutorial-2/">Programming in C of FC Tutorial 2</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-07T17:43:26+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:43 pm</span></time>
        
         | <a href="/blog/2014/04/07/programming-in-c-of-fc-tutorial-2/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Full Circle C 3</h3>

<h4>Exercise 1</h4>

<p>Collect all the code snippets on this page and turn them into the working program  <br/>
Pointer:</p>

<figure class='code'><figcaption><span>Pointer.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">anInt</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="o">*</span><span class="n">anIntPointer</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">anInt</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Address: %p Value: %d </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">anInt</span><span class="p">,</span> <span class="n">anInt</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Address of Pointer: %p Address: %p Value: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">anIntPointer</span><span class="p">,</span> <span class="n">anIntPointer</span><span class="p">,</span> <span class="o">*</span><span class="n">anIntPointer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Size of pointer: %d, size of int: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">anIntPointer</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">anInt</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>array.c</p>

<figure class='code'><figcaption><span>array.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">anIntArray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Address of Array: %p </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">anIntArray</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Size of Array: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">anIntArray</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="k">sizeof</span><span class="p">(</span><span class="n">anIntArray</span><span class="p">)</span><span class="o">/</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Index: %x Address: %p Value: %d, Value: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">anIntArray</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">anIntArray</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">*</span><span class="p">(</span><span class="n">anIntArray</span><span class="o">+</span><span class="n">i</span><span class="p">));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>string:</p>

<figure class='code'><figcaption><span>strings.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">aChar</span> <span class="o">=</span> <span class="sc">&#39;c&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span> <span class="n">aString</span> <span class="o">=</span> <span class="s">&quot;Hello&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Address: %p value: %c size: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">aChar</span><span class="p">,</span> <span class="n">aChar</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">aChar</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Address of the string: %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">aString</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Size of String: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">aString</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Value: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">aString</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="n">strlen</span><span class="p">(</span><span class="n">aString</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Index:%x Address: %p, Value:%c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">aString</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">aString</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Structure:</p>

<figure class='code'><figcaption><span>structure.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="k">struct</span> <span class="n">aStruct_def</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">intMember</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="o">*</span> <span class="n">intPointer</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">charMember</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">**</span> <span class="n">stringPointer</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">aStruct_def</span> <span class="n">aStruct</span><span class="p">;</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">aStruct_def</span> <span class="o">*</span><span class="n">aStructPointer</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">anInt</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">aString</span> <span class="o">=</span> <span class="s">&quot;Hello&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Address: %p Size: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">aStruct</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">aStruct_def</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%p %p %p %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">aStruct</span><span class="p">.</span><span class="n">intMember</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">aStruct</span><span class="p">.</span><span class="n">intPointer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">aStruct</span><span class="p">.</span><span class="n">charMember</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">aStruct</span><span class="p">.</span><span class="n">stringPointer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">aStruct</span><span class="p">.</span><span class="n">intMember</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
</span><span class='line'>  <span class="n">aStruct</span><span class="p">.</span><span class="n">intPointer</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">anInt</span><span class="p">;</span>
</span><span class='line'>  <span class="n">aStruct</span><span class="p">.</span><span class="n">charMember</span> <span class="o">=</span> <span class="sc">&#39;k&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">aStruct</span><span class="p">.</span><span class="n">stringPointer</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">aString</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">aStructPointer</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">aStruct</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Member of struct: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="n">aStructPointer</span><span class="p">).</span><span class="n">intMember</span><span class="p">);</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Member of struct: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">aStructPointer</span><span class="p">).</span><span class="n">intPointer</span><span class="p">);</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Member of struct: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">aStructPointer</span><span class="o">-&gt;</span><span class="n">intMember</span><span class="p">);</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Member of struct: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">aStructPointer</span><span class="o">-&gt;</span><span class="n">intPointer</span><span class="p">);</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Member of struct: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">aStructPointer</span><span class="o">-&gt;</span><span class="n">stringPointer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Exercise 2</h4>

<p>Implement strlen yourself use a while() loop:</p>

<figure class='code'><figcaption><span>mystrlen.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">mystrlen</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">strings</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="n">strings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;\0&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="s">&quot;Hello World&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s &#39;s length is %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">mystrlen</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Exercise 3</h3>

<p>A C application typically has &lsquo;int main(int argc, char **argv)&rsquo; as it&rsquo;s main prototype, here argc contains the number of strings passed to the application, and argc is an array of argc strings. Write a small application which prints all arguments given to the application. What is stored in argv[0] ?</p>

<figure class='code'><figcaption><span>mainargs.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">argc</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;arg %d is %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/07/programming-in-c-new-words/">Programming in C New Words</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-07T16:02:47+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:02 pm</span></time>
        
         | <a href="/blog/2014/04/07/programming-in-c-new-words/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Programming In C</h3>

<p>intermediate: 中级的  <br/>
hereby: 特此  <br/>
scary: 恐慌的，提心吊胆的  <br/>
de facto (法)，事实上的  <br/>
span: 跨越  <br/>
interpreted: 可交互的  <br/>
fanatic: 狂热者  <br/>
novice: 新手，入门者  <br/>
concrete: 实际的  <br/>
prime number: 素数，质数
ternary: 三重的，三元的  <br/>
intrusive: 侵入的，打扰的  <br/>
grind: 磨难，磨碎，折磨  <br/>
confessed: 坦白的  <br/>
scary: 提心吊胆的，胆小的  <br/>
apropos: 恰好的  <br/>
grasp: 掌握  <br/>
instalment: 分期付款的  <br/>
gibberish: 乱语，快速而不清楚的话语  <br/>
condense: 电容器</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/07/programming-in-c-of-fc-tutorial/">Programming in C of FC Tutorial</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-07T16:02:08+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:02 pm</span></time>
        
         | <a href="/blog/2014/04/07/programming-in-c-of-fc-tutorial/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Programming In C</h3>

<p>GCC&rsquo;s funcitionality:  <br/>
gcc command calls a compiler(which transforms a higher level language into assembler), an assembler translates assembler into object files(machine instructions), and a linker, which combines several object files into an executable.</p>

<p>launchpad.net is a unique collaboration and hosting platform for free software. <a href="http://www.launchpad.net">http://www.launchpad.net</a>.</p>

<h3>Programming In C II</h3>

<p>Example code:</p>

<figure class='code'><figcaption><span>chapter2.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#define VERSION &quot;1.0&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* </span>
</span><span class='line'><span class="cm"> * Runs a prime check on a given integer, return</span>
</span><span class='line'><span class="cm"> * 1 when the integer is a prime number, 0 otherwise</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">isPrime</span><span class="p">(</span><span class="kt">int</span> <span class="n">prime</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Catch two special cases </span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">prime</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">prime</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">while</span><span class="p">(</span><span class="n">prime</span> <span class="o">%</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">count</span><span class="o">*</span><span class="n">count</span><span class="o">&lt;=</span><span class="n">prime</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">count</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span><span class="n">prime</span><span class="o">%</span><span class="n">count</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">?</span><span class="mi">0</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * Print version information</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">printVersion</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Primality checker version %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">VERSION</span><span class="p">);</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Compiled on %s %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__DATE__</span><span class="p">,</span> <span class="n">__TIME__</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="k">const</span> <span class="kt">int</span> <span class="n">max_prime</span> <span class="o">=</span> <span class="mi">2500</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printVersion</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">max_prime</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">isPrime</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d is prime</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d is not prime</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Execise 1</h4>

<p>Rewrite the for loop in the main() function so it becomes a while loop.</p>

<figure class='code'><figcaption><span>whileloop.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="c1">//for (i = 1; i&lt;max_prime; i++)</span>
</span><span class='line'><span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">max_prime</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">isPrime</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d is prime</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d is not prime</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Execise 2</h4>

<p>Rewrite the if&hellip;else if&hellip;else structure in the isPrime() function to a switch&hellip;case structure.</p>

<figure class='code'><figcaption><span>switchcase.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">returnvalue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Catch two special cases </span>
</span><span class='line'><span class="k">switch</span><span class="p">(</span><span class="n">prime</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>      <span class="n">returnvalue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>      <span class="n">returnvalue</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">default</span><span class="o">:</span>
</span><span class='line'>      <span class="k">while</span><span class="p">(</span><span class="n">prime</span> <span class="o">%</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">count</span><span class="o">*</span><span class="n">count</span> <span class="o">&lt;=</span> <span class="n">prime</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">count</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">returnvalue</span> <span class="o">=</span>  <span class="p">(</span><span class="n">prime</span> <span class="o">%</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">?</span><span class="mi">0</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">return</span> <span class="n">returnvalue</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Execise 3</h4>

<p>Rewrite the ternary(condition)?value1:value2 to an if..else structure</p>

<figure class='code'><figcaption><span>ifelse.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="c1">//return (prime%count==0)?0:1;</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="n">prime</span><span class="o">%</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Execise 4</h4>

<p>Rewrite the if&hellip;else in the main() funciton to make sure the ternary operator</p>

<figure class='code'><figcaption><span>ternary.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">if(isPrime(i))</span>
</span><span class='line'><span class="cm">{</span>
</span><span class='line'><span class="cm"> printf(&quot;%d is prime\n&quot;, i);</span>
</span><span class='line'><span class="cm">}</span>
</span><span class='line'><span class="cm">else</span>
</span><span class='line'><span class="cm">{</span>
</span><span class='line'><span class="cm"> printf(&quot;%d is not prime\n&quot;, i);</span>
</span><span class='line'><span class="cm">}</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d %s prime</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">?</span><span class="s">&quot;is&quot;</span><span class="o">:</span><span class="s">&quot;is not&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Execise 5</h4>

<p>Replace the isPrime() function by an isOdd() function which return 1 when a given integer is odd.</p>

<figure class='code'><figcaption><span>isOdd.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">int</span> <span class="nf">isOdd</span><span class="p">(</span><span class="kt">int</span> <span class="n">odd</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">odd</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">odd</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* Called via */</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="n">isOdd</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d is Odd</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d is not Odd</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Execise 6</h4>

<p>Design and write a small application which print out the n Fibonacci sequence, where n should be easily modifiable.</p>

<figure class='code'><figcaption><span>fib.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* The formula is like</span>
</span><span class='line'><span class="cm"> * a(n+2) = a(n)+a(n+1)</span>
</span><span class='line'><span class="cm"> * while when a1 = 1, a2 =1</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">Fib</span><span class="p">(</span><span class="kt">int</span> <span class="n">fib</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">fib</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">fib</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span><span class="n">Fib</span><span class="p">(</span><span class="n">fib</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fib</span><span class="p">(</span><span class="n">fib</span><span class="o">-</span><span class="mi">2</span><span class="p">));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Please input an integer number</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;The Fibonacci sequence is: </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;a[%d] is %d.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">Fib</span><span class="p">(</span><span class="n">j</span><span class="p">));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Because we use recursion here, when the n is too big, the calculation maybe very slow.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/07/reading-digest-of-fc3/">Reading Digest of FC3</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-07T14:50:58+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>2:50 pm</span></time>
        
         | <a href="/blog/2014/04/07/reading-digest-of-fc3/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Full Circle 3</h3>

<ol>
<li>Page 6 of cn version: DSL(Damn Small Linux), <a href="http://www.damnsmalllinux.org">http://www.damnsmalllinux.org</a>, which could be run on 16MB memory&rsquo;s 486 computer, try it.</li>
<li>Page</li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/07/fc3-new-words/">FC3 New Words</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-07T14:45:26+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>2:45 pm</span></time>
        
         | <a href="/blog/2014/04/07/fc3-new-words/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Full Circle 3</h3>

<p>stunning: 令人惊奇的事物  <br/>
reveal: 揭露  <br/>
footrest: 搁脚物  <br/>
fusion: 融化  <br/>
compiz+beryl = Compiz Fusion  <br/>
trawl: 用拖网捕鱼</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/06/reading-digest-of-fc2/">Reading Digest of FC2</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-06T20:41:10+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:41 pm</span></time>
        
         | <a href="/blog/2014/04/06/reading-digest-of-fc2/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Full Circle 2</h3>

<p>Things to be done:  <br/>
1. Page 3, Visit linuxgeekery?   <br/>
2. Page 4, OpenMOKO, its recent status. Try to visit <a href="www.linuxinsider.com">www.linuxinsider.com</a>  <br/>
3. Page 5, UbuntuHomeServer? <a href="www.ubuntuhomeserver.org">www.ubuntuhomeserver.org</a>  <br/>
4. Page 16, try VPN, use VPN to reach back home.  <br/>
5. Page 25, What is GEDCOM?  <br/>
6. Page 27, What is LDS church?  <br/>
7. Page 28, Still , try Gramps.    <br/>
8. Page 29, ipod support on Ubuntu, libgpod. amaroK  <br/>
9. Page 31, try flock, democracy player, songbird, inkscape   <br/>
10. Page 34, try game tremulous.  <br/>
11. Page 36, try ubuntustudio theme.    <br/>
12. Page 37, try to install these applets and integrate them with awesome.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/06/fc2-new-words/">FC2 New Words</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-06T20:34:16+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:34 pm</span></time>
        
         | <a href="/blog/2014/04/06/fc2-new-words/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Full Circle 2</h3>

<p>affiliate: 归纳，使附属  <br/>
endorse: 签署，赞同，认可  <br/>
mean-machine: 概念机  <br/>
editorial: 编辑的，社论的  <br/>
dose: 剂量  <br/>
sarcasm: 嘲讽，挖苦  <br/>
slip: 滑动，slipped，被忽略  <br/>
niggle: 拘泥小节  <br/>
darter: 飞奔者，投掷者  <br/>
infringement: 侵犯，违反  <br/>
speculation: 投机，推荐，思索，投机买卖  <br/>
litigation: 诉讼，起诉  <br/>
barrier: 障碍物  <br/>
sentiment: 观点，情绪  <br/>
interoperability: 互用性，互操作性  <br/>
imminent: 即将到来的，迫近的  <br/>
Venezuelan: 委内瑞拉  <br/>
Bolivarian: 玻利瓦尔  <br/>
KDE: K Desktop Environment  <br/>
GNOME: GNU Object Model Environment  <br/>
chunk: 块  <br/>
prerequisite: 先决条件  <br/>
wobbling: 颤抖的  <br/>
eyecandy: 视觉糖果  <br/>
tray: 任务栏  <br/>
purge: 移除  <br/>
decorator: 装饰，装修  <br/>
nerds: 书呆子  <br/>
pinkie: 小手指  <br/>
imprint: 加痕迹的，刻上记号的  <br/>
tattoo: 纹身，刻花样的  <br/>
dip: 舀取， 把&hellip;浸入  <br/>
toe: 脚趾，足尖  <br/>
toy: 玩弄，调戏  <br/>
evolve: 发展，进化  <br/>
podcast: 播客  <br/>
zealot: 狂热者，犹太教狂热信徒  <br/>
pingu: 企鹅家族（动画片名)   <br/>
pimping: 拉皮条，很小的，小气的  <br/>
nail salon: 美甲沙龙  <br/>
pingu-pimping: 为企鹅家族拉皮条  <br/>
Dirty Harry: 《警探哈里》，美国70年代“新警察电影”的代表作，塑造一个典型的硬派新警察形象  <br/>
spam: 罐头猪肉，垃圾邮件  <br/>
savvy: 悟性，理解能力，懂行的人  <br/>
wizz: 奇才，专家  <br/>
alley: 小径  <br/>
freak: 怪人，怪事，畸形人  <br/>
fiancee: 未婚妻  <br/>
is right up the alley: 正符合我的要求  <br/>
swipe: 猛击，偷窃，夺得  <br/>
tetris: 俄罗斯方块  <br/>
worn: 疲倦的，用旧的  <br/>
worn-down:   <br/>
cyber-granny:  电脑奶奶, cyber做前缀代表科技的，电脑的，之类  <br/>
pasture: 草地，牧场，牧草，放牧  <br/>
defective: 不完美的，有缺陷的  <br/>
bode: 停留，继续，遭到，预示, bide的过去式  <br/>
cheque: 支票  <br/>
mallware: 广告  <br/>
user-boo-boo: 用户的反感  <br/>
dispose: 处理，处置，安排  <br/>
clog: 阻塞  <br/>
toaster: 烤面包机，烤面包的人  <br/>
easy as firing up a toaster: 像用烤面包机加热面包一样简单？  <br/>
bongos: 邦高鼓  <br/>
rumble: 隆隆作响  <br/>
uncover: 发现，揭开，揭露  <br/>
goodies: 好吃的东西，老妇人，伪君子  <br/>
pentagon: 五角星  <br/>
memo: 备忘录  <br/>
trill: 用颤声唱，用颤声说  <br/>
trilled: 激动  <br/>
frank: 坦白，直白  <br/>
grin: 咧着嘴笑  <br/>
utter: 发出，表达  <br/>
wayward: 任性的，不规则的  <br/>
VPN; Virtual Private Networking   <br/>
presario: 自由人  <br/>
dart: 镖，飞镖  <br/>
stylish: 时髦的  <br/>
pamphlet: 小册子  <br/>
power cord: 电源线  <br/>
pad: 填充  <br/>
workhorse: 重负荷机器  <br/>
lid: 盖子  <br/>
clicky: 滴答的  <br/>
tactile: 触觉的，有触觉的  <br/>
intervention: 介入，调停，妨碍  <br/>
partially: 局部的，部分地  <br/>
optical: 光学的  <br/>
spike: 阻止  <br/>
immune: 免疫  <br/>
dang: 讨厌的  <br/>
nail: 钉，使固定  <br/>
avid: 贪婪的  <br/>
enthusiast: 狂热者，热心家  <br/>
Corel Linux : Corel corporation   <br/>
coral: 珊瑚  <br/>
outdoors: 户外  <br/>
index finger: 食指  <br/>
pull-cart: 拖车  <br/>
obscure: 难懂的，晦涩的  <br/>
slack: 松弛的，疏忽的，缓慢的  <br/>
monty: 必定的事物，尤指赛马时必赢的马  <br/>
appropriate: 恰当的  <br/>
holy grail: 圣杯  <br/>
fictional: 虚构的  <br/>
patronimic: 教名   <br/>
cohesion: 内聚力  <br/>
ego: 自我，自负，自我意识  <br/>
concensus:   <br/>
compromise: 让步  <br/>
deficiency: 缺陷，缺点，不足  <br/>
adhere: 坚持，依附  <br/>
recruit: 招聘，补充，聘用  <br/>
bounty: 发给……奖金  <br/>
overwhelm: 压倒，淹没，受打击  <br/>
aggregator: 聚合器  <br/>
appeal: 呼吁，恳求  <br/>
recipe: 食谱，处方，秘诀  <br/>
landscape: 风景，景色，山水  <br/>
fiddle: 瞎搞，拉小提琴  <br/>
dapper: 短小精悍的  <br/>
drake:  公鸭  <br/>
premium: 保险费，额外费用，奖金   <br/>
lexmark: 利盟公司  <br/>
stingy: 小气，吝啬  <br/>
flock: 成群而行  <br/>
democracy: 民主，民主政治  <br/>
mash: 饲料   <br/>
noob: newbie，新手  <br/>
stumble: 踌躇，蹒跚  <br/>
intrigue: 用诡计取得，激起……的兴趣  <br/>
informative: 教育性的，有益的  <br/>
polish: 优雅，精良  <br/>
whopper: 弥天大谎  <br/>
UV: 紫外线指数</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/44">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/42">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/03/15/ba-wan-ebuddy-4/">把玩ebuddy(4)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/15/shi-yong-squidhuan-cun-suo-you-rpm-slash-deban-zhuang-bao/">使用squid缓存所有rpm/deb安装包</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/13/yong-vagrantguan-li-libvirt/">用Vagrant管理libvirt</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/12/tips-on-5050rgb/">Tips on 5050RGB</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/11/tips-on-w5100/">Tips on W5100</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
