
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="For searching all of the alive machine in the LAN, we could use nmap for searching. Install the nmap via: 1
sudo pacman -S nmap Scan the lan for &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/26">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//fonts.googleapis.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/29/get-alive-machine-in-lan/">Get Alive Machine in LAN</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-29T14:17:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>2:17 pm</span></time>
        
         | <a href="/blog/2014/12/29/get-alive-machine-in-lan/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For searching all of the alive machine in the LAN, we could use nmap for searching.  <br/>
Install the nmap via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo pacman -S nmap
</span></code></pre></td></tr></table></div></figure>


<p>Scan the lan for living host:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># nmap -sP 10.0.0.*
</span><span class='line'>
</span><span class='line'>Starting Nmap 6.47 ( http://nmap.org ) at 2014-12-29 14:25 CST
</span><span class='line'>Nmap scan report for www.routerlogin.com (10.0.0.1)
</span><span class='line'>Host is up (0.00040s latency).
</span><span class='line'>MAC Address: xxx.xxx.xxx.xxx(xxx), 
</span><span class='line'>Nmap scan report for 10.0.0.20
</span><span class='line'>Host is up (0.00019s latency).
</span><span class='line'>MAC Address: xxx.xxx.xxx.xxx(xxx), 
</span></code></pre></td></tr></table></div></figure>


<p>Via this command we could easily detect which machine is living in the LAN.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/29/set-tiny-tiny-rss-reader-on-digitalocean/">Set Tiny Tiny Rss Reader on DigitalOcean</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-29T10:00:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:00 am</span></time>
        
         | <a href="/blog/2014/12/29/set-tiny-tiny-rss-reader-on-digitalocean/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since Google Reader has been closed, many guys cannot find suitable Rss Reader for personal use. Following is a simple guildeline for setting up the Tiny Tiny Rss Reader on DigitalOcean, using docker, it&rsquo;s pretty simple for setting up .</p>

<h3>Container Setup</h3>

<p>Build two containers:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd code
</span><span class='line'>mkdir TinyTinyRss
</span><span class='line'>cd TinyTinyRss/
</span><span class='line'>git clone https://github.com/clue/docker-ttrss.git
</span><span class='line'>cd docker-ttrss/
</span><span class='line'>docker run -d --name ttrssdb nornagon/postgres
</span><span class='line'>docker run -d --link ttrssdb:db -p 8078:80 clue/ttrss
</span></code></pre></td></tr></table></div></figure>


<p>ttrssdb is the dababase name for postgres, while the clue/ttrss is the tinytinyRss Webapp.</p>

<h3>Effect</h3>

<p>Visit the following URL:  <br/>
<code>http://Your_IP:8078</code>  <br/>
Then you would see the following picture:  <br/>
<img src="/images/tinytinyrss.jpg" alt="/images/tinytinyrss.jpg" />  <br/>
The default username/password is admin/123456</p>

<h3>Commit Changes</h3>

<p>List the running images and commit the changes to the new container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>~# docker ps
</span><span class='line'>700c82aa344b        clue/ttrss:latest          /bin/sh -c 'php /con   3 days ago          Up 3 days           0.0.0.0:8078-&gt;80/tcp                                             dreamy_davinci 
</span><span class='line'># docker commit 700c82aa344b wmz_tinyrss
</span><span class='line'>c85a9d1a15b18685ffc3441e18f327059928aca623a39b36780184676f6d0921
</span></code></pre></td></tr></table></div></figure>


<p>Now we could stop the running container and changes the listening port.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># docker stop 700c82aa344b
</span><span class='line'>700c82aa344b
</span><span class='line'># docker run -d --link ttrssdb:db -p 8080:80 wmz_tinyrss
</span><span class='line'>f378197f7a048a02550e9152a44929628cc77ce61ea1c9e223fc3c7a46fb9bb5
</span></code></pre></td></tr></table></div></figure>


<p>Now the tinyRss listens on 8080 port.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/24/dockerize-mail-sender/">Dockerize Mail Sender</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-24T10:57:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:57 am</span></time>
        
         | <a href="/blog/2014/12/24/dockerize-mail-sender/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In DigitalOcean VPS, which runs the Ubuntu 14.04.1 LTS, setup a mail sender server.</p>

<h3>Installation</h3>

<p>Install the docker.io via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get install docker.io
</span></code></pre></td></tr></table></div></figure>


<p>Git clone the repository from the github, configure it and build the container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pwd
</span><span class='line'>/root/code/docker_mail
</span><span class='line'># git clone https://github.com/lava/dockermail.git
</span><span class='line'># ls
</span><span class='line'> dockermail
</span><span class='line'># cd dockermail
</span><span class='line'># cat mail-base/domains 
</span><span class='line'>*******.com.cn
</span><span class='line'># cat mail-base/passwords 
</span><span class='line'>catch-all@xxxxx.com.cn:{PLAIN}password123
</span><span class='line'>admin@xxxxxx.com.cn:{SHA256-CRYPT}$5$3qaCC/fV65Adtfoy$O20EXoSOcgWKf5NyAZnXAtGPQoSgeYRjLm56M25.H12
</span><span class='line'># make
</span></code></pre></td></tr></table></div></figure>


<p>Run the containers:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@lilimarleen:~/code/docker_mail/dockermail# make run-all
</span><span class='line'>docker run -d -p 0.0.0.0:25:25 -p 0.0.0.0:587:587 -p 0.0.0.0:143:143 -v /srv/vmail:/srv/vmail dovecot:2.1.7
</span><span class='line'>4dac1e99be85100d7847fb46976249196b0a970ad4f630136cced4ccdc11ac27
</span><span class='line'>docker run -d -p 127.0.0.1:33100:80 rainloop:1.6.9
</span><span class='line'>e7246bcf39ddee334c45ca41c268eb5ebdc092d069024ff81b70f16a3ab11cb4
</span><span class='line'>docker run -d -p 127.0.0.1:33200:80 -v /srv/owncloud:/var/www/owncloud/data owncloud:7.0.2 
</span><span class='line'>9e62a4f6140cf43caeb5dc096f995649d3a898ffdeb439a7a7c4501c527f3672
</span><span class='line'>root@lilimarleen:~/code/docker_mail/dockermail# docker ps
</span><span class='line'>CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                                                            NAMES
</span><span class='line'>9e62a4f6140c        owncloud:7.0.2      /bin/sh -c 'cp -npr    3 seconds ago       Up 2 seconds        127.0.0.1:33200-&gt;80/tcp                                          backstabbing_sinoussi   
</span><span class='line'>e7246bcf39dd        rainloop:1.6.9      /bin/sh -c 'apachect   3 seconds ago       Up 3 seconds        127.0.0.1:33100-&gt;80/tcp                                          sad_sinoussi            
</span><span class='line'>4dac1e99be85        dovecot:2.1.7       /bin/sh -c 'chown -R   3 seconds ago       Up 3 seconds        0.0.0.0:25-&gt;25/tcp, 0.0.0.0:143-&gt;143/tcp, 0.0.0.0:587-&gt;587/tcp   evil_ptolemy      
</span></code></pre></td></tr></table></div></figure>


<h3>nsenter</h3>

<p>Use nsenter for entering the running container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Ubuntu 14.04 don't have nsenter - the straight forward way required me to install build tools and etc.
</span><span class='line'># I preferred to keep the system clean and install nsenter in a container and then copy the command to the host
</span><span class='line'># Note - its also possible to run nsenter from a container (didn't tried) https://github.com/jpetazzo/nsenter
</span><span class='line'>
</span><span class='line'># start a container
</span><span class='line'>docker run --name nsenter -it ubuntu:14.04 bash
</span><span class='line'>
</span><span class='line'>## in the docker
</span><span class='line'>apt-get update
</span><span class='line'>apt-get install git build-essential libncurses5-dev libslang2-dev gettext zlib1g-dev libselinux1-dev debhelper lsb-release pkg-config po-debconf autoconf automake autopoint libtool
</span><span class='line'>
</span><span class='line'>git clone git://git.kernel.org/pub/scm/utils/util-linux/util-linux.git util-linux
</span><span class='line'>cd util-linux/
</span><span class='line'>
</span><span class='line'>./autogen.sh
</span><span class='line'>./configure --without-python --disable-all-programs --enable-nsenter
</span><span class='line'>make
</span><span class='line'>
</span><span class='line'>## from different shell - on the host
</span><span class='line'>docker cp nsenter:/util-linux/nsenter /usr/local/bin/
</span><span class='line'>docker cp nsenter:/util-linux/bash-completion/nsenter /etc/bash_completion.d/nsenter
</span></code></pre></td></tr></table></div></figure>


<p>Thus you have the nsenter.</p>

<h3>Enter the container</h3>

<p>Get the PID via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># docker inspect --format "" a66adc0e63fc
</span><span class='line'>24740
</span></code></pre></td></tr></table></div></figure>


<p>Enter the docker container and view the status:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># nsenter --target 24740 --mount --uts --ipc --net --pid -- /bin/bash
</span><span class='line'>root@a66adc0e63fc:/# 
</span></code></pre></td></tr></table></div></figure>


<p>Why we want to enter this terminal? Because we want to view the password of the admin. The configuration file says:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat mail-base/passwords 
</span><span class='line'>admin@xxxx.com.cn:{SHA256-CRYPT}$5$3qaCC/fV65Adtfoy$O20EXoSOcgWKf5NyAZnXAtGPQoSgeYRjLm56M25.H12
</span></code></pre></td></tr></table></div></figure>


<p>If you met &ldquo;port has been occupied&rdquo;, you should do like following:   <br/>
Remove all of the containers:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># docker ps -a | grep "ago" |  awk '{print $1}' |  xargs --no-run-if-empty docker rm
</span></code></pre></td></tr></table></div></figure>


<h3>Trouble Shooting</h3>

<p>First you should add corresponding MX record in you domainname service provider.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/19/create-vagrant-for-jd/">Create Vagrant for JD</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-19T09:55:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>9:55 am</span></time>
        
         | <a href="/blog/2014/12/19/create-vagrant-for-jd/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Purpose</h3>

<p>For deploying the development environment in the Vagrant based environment, choose ubuntu 14.04.</p>

<h3>Create</h3>

<p>List the exising Vagrants:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant box list
</span><span class='line'>panamax-coreos-box-494.4.0 (virtualbox, 0)
</span></code></pre></td></tr></table></div></figure>


<p>Now download the vbox file of 14.04 daily Cloud image i386 from <a href="www.vagrantbox.es">www.vagrantbox.es</a>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget https://cloud-images.ubuntu.com/vagrant/trusty/current/trusty-server-cloudimg-i386-vagrant-disk1.box
</span></code></pre></td></tr></table></div></figure>


<p>Though this method could starts the vbox, but it&rsquo;s not clean, it will have problems in our deliveris.  So use the result from <a href="https://atlas.hashicorp.com/boxes/search">https://atlas.hashicorp.com/boxes/search</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant init  ubuntu/trusty32
</span><span class='line'>$ vagrant up
</span></code></pre></td></tr></table></div></figure>


<p>Current we use 32, because we may have windowsxp users, or 32-bit system users.</p>

<p>After installation, list all of the installed vboxes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant box list
</span><span class='line'>panamax-coreos-box-494.4.0 (virtualbox, 0)
</span><span class='line'>ubuntu/trusty32            (virtualbox, 14.04)
</span></code></pre></td></tr></table></div></figure>


<h3>Configuration</h3>

<p>The Bootstrap.sh is listed as following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/usr/bin/env bash</span>
</span><span class='line'>sudo debconf-set-selections <span class="o">&lt;&lt;&lt;</span> <span class="s1">&#39;mysql-server-5.5 mysql-server/root_password password rootpass&#39;</span>
</span><span class='line'>sudo debconf-set-selections <span class="o">&lt;&lt;&lt;</span> <span class="s1">&#39;mysql-server-5.5 mysql-server/root_password_again password rootpass&#39;</span>
</span><span class='line'>apt-get update
</span><span class='line'>apt-get install -y meld
</span><span class='line'>apt-get install -y nginx mysql-server mysql-server-5.5
</span><span class='line'>apt-get install -y nodejs libc-ares2 libv8-3.14.5
</span><span class='line'>apt-get install -y fossil
</span><span class='line'>apt-get install -y git
</span><span class='line'>apt-get install -y php5 php5-fpm
</span><span class='line'>apt-get install -y php5-mysql
</span><span class='line'>apt-get install -y php-pear
</span><span class='line'>apt-get install -y install-info
</span><span class='line'>apt-get install -y php5-dev
</span><span class='line'>apt-get install -y npm
</span><span class='line'>npm install -g pdf.js
</span></code></pre></td></tr></table></div></figure>


<p>then write the Vagrantfile list like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>Vagrant.configure<span class="o">(</span>2<span class="o">)</span> <span class="k">do</span> <span class="p">|</span>config<span class="p">|</span>
</span><span class='line'>  config.vm.box <span class="o">=</span> <span class="s2">&quot;ubuntu/trusty32&quot;</span>
</span><span class='line'>  config.vm.network <span class="s2">&quot;private_network&quot;</span>, ip: <span class="s2">&quot;192.168.50.50&quot;</span>
</span><span class='line'>  config.proxy.http <span class="o">=</span> <span class="s2">&quot;http://1xx.x.xx.xxx:xxxx&quot;</span>
</span><span class='line'>  config.proxy.https <span class="o">=</span> <span class="s2">&quot;http://1xx.x.xx.xxx:xxxx&quot;</span>
</span><span class='line'>  config.proxy.no_proxy <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
</span><span class='line'>  config.vm.provision :shell, path: <span class="s2">&quot;bootstrap.sh&quot;</span>
</span><span class='line'>end
</span></code></pre></td></tr></table></div></figure>


<p>Now run <code>vagrant provision</code> then we could refresh the installation.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/13/dockerize-wordpress-on-digitaloceans-coreos/">Dockerize Wordpress on DigitalOcean's CoreOS</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-13T14:28:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>2:28 pm</span></time>
        
         | <a href="/blog/2014/12/13/dockerize-wordpress-on-digitaloceans-coreos/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Wordpress</h3>

<p>Install it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker pull tutum/wordpress
</span></code></pre></td></tr></table></div></figure>


<p>Run it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker run -p 80:80 tutum/wordpress &
</span></code></pre></td></tr></table></div></figure>


<p>Now configure the backend, and you could directly access <code>http://Your_IP_Address</code> for this wordpress website.</p>

<h3>Import Database And Static Files</h3>

<p>Since I have an old website, I want to import it in this container, following is the steps of how-to.  <br/>
The exising database runs on Debian 7, and its platform is arm-based, see if we could directly retrieve the wordpress and extract them into it.</p>

<h4>Extract the MYSQL Datafile</h4>

<p>Use mysqldump for extracting the existing wordpress file</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mysqldump -u root -p[root-password] wordpress&gt;~/wordpress.mysql
</span></code></pre></td></tr></table></div></figure>


<p>Then copy the <code>wordpress.mysql</code> to the remote server.</p>

<h4>Replacement</h4>

<p>Be sure to use gedit for replacing the old <code>fxx***.iiiouge.biz:7777</code> to <code>1xx.xxx.xxx.xxx</code> then all of your links will be acts well. <br/>
Then upload the /var/www/ directory to your server&rsquo;s corresponding directory, here ours is <code>/var/www/html</code>, eg. <code>/app</code></p>

<h4>Import the MYSQL Datafile</h4>

<p>Attached to running wordpress in DO via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker ps
</span><span class='line'>CONTAINER ID        IMAGE                    COMMAND                CREATED             STATUS              PORTS                          NAMES
</span><span class='line'>cfddafcc96f5        tutum/wordpress:latest   "/run.sh"              25 hours ago        Up 25 hours         3306/tcp, 0.0.0.0:80-&gt;80/tcp   drunk_brown         
</span><span class='line'>$ docker exec -it cfddafcc96f5 bash
</span></code></pre></td></tr></table></div></figure>


<p>This will give you a terminal for accessing the running container. Examine the wordpress running environments:   <br/>
The WP files are located at <code>/var/www/html</code>, the mysql file locates at <code>/var/lib/mysql/wordpress</code>, then how to import the old wordpress website is the things we want to solve.    <br/>
Install phpMyAdmin for importing the database:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install phpmyadmin apache-utils
</span><span class='line'>$ sudo vim /etc/apache2/apache2.conf
</span><span class='line'>Include /etc/phpmyadmin/apache.conf
</span><span class='line'>$ sudo service apache2 restart
</span><span class='line'>Include /etc/phpmyadmin/apache.conf
</span><span class='line'>$ sudo service apache2 restart
</span></code></pre></td></tr></table></div></figure>


<p>Now you could directly access the phpMyAdmin page with username root and empty password, this is dangerous, but we just for demononstration, needn&rsquo;t care it. <br/>
Use phpMyAdmin for importing the sql file which we extracted from the old wordpress.</p>

<h4>Trouble shooting</h4>

<p>When uploading the www file and replaced, the connection shows:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>数据库连接错误
</span><span class='line'>您在wp-config.php文件中提供的数据库用户名和密码可能不正确，或者无法连接到localhost上的数据库服务器，这意味着您的主机数据库服务器已停止工作。
</span><span class='line'>
</span><span class='line'>您确认您提供的用户名和密码正确么？
</span><span class='line'>您确认您提供的主机名正确么？
</span><span class='line'>您确认数据库服务器运行正常么？
</span></code></pre></td></tr></table></div></figure>


<p>This is because we provided the wrong password for the mysql, change it to the username <code>root</code> and nopassword.</p>

<p>Restart the apache2 server now your website acts good.</p>

<h4>Hide phpMyAdmin Page the username <code>root</code> and nopassword.</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo nano /etc/phpmyadmin/apache.conf 
</span><span class='line'>&lt;Directory /usr/share/phpmyadmin&gt;
</span><span class='line'>        Options FollowSymLinks
</span><span class='line'>        DirectoryIndex index.php
</span><span class='line'>        AllowOverride All
</span><span class='line'>        [...]
</span></code></pre></td></tr></table></div></figure>


<p>Add the htaccess method via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo nano /usr/share/phpmyadmin/.htaccess
</span><span class='line'>AuthType Basic
</span><span class='line'>AuthName "Restricted Files"
</span><span class='line'>AuthUserFile /etc/apache2/.phpmyadmin.htpasswd
</span><span class='line'>Require valid-user
</span></code></pre></td></tr></table></div></figure>


<p>Then set the password for root via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo htpasswd -c /etc/apache2/.phpmyadmin.htpasswd root
</span></code></pre></td></tr></table></div></figure>


<p>After doing this, restart the apache2 service, now your phpMyAdmin page is under the protection of the username and the password.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/12/recover-my-openwrt-configuration/">Recover My OpenWRT Configuration</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-12T10:00:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:00 am</span></time>
        
         | <a href="/blog/2014/12/12/recover-my-openwrt-configuration/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Background</h3>

<p>I tried to use <code>192.168.1</code> network for debugging, but after I change back from <code>10.0.0.</code> to <code>192.168.1.</code> the router got no interface for luci and http. So following is the steps for recovering from the fail router.</p>

<h3>Solution</h3>

<p>First I tried to recover the luci and uhttpd, but after a while I think maybe I could swith to a newer version.  <br/>
The newest version currently is &ldquo; &lsquo;Barrier Breaker&rsquo; &rdquo;, its version number is 14.07.  <br/>
My router is Mercury 4530R, which have the following configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CPU  Ram Flash   Network USB Serial  JTag    
</span><span class='line'>Atheros   128MiB  8MiB    4LAN + 2WIFI    Yes Yes ?    
</span></code></pre></td></tr></table></div></figure>


<p>LUCI upgrade failed:  <br/>
<img src="/images/flasherror.jpg" alt="/images/flasherror.jpg" /></p>

<p>The reason:  <br/>
<img src="/images/flasherrorreason.jpg" alt="/images/flasherrorreason.jpg" /></p>

<p>Because in early 2012 Autumn, the official supporting for 4530R is not release, so we modified the machineID, to let 4530R to use TP-Link&rsquo;s patched images, this will display our system as for 4310, but not for 4530R.</p>

<h4>Sysupgrade in CLI</h4>

<p>First check the free memory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@OpenWrt:~# free
</span><span class='line'>             total         used         free       shared      buffers
</span><span class='line'>Mem:        126788        26636       100152            0         1780
</span><span class='line'>-/+ buffers:              24856       101932
</span><span class='line'>Swap:            0            0            0
</span></code></pre></td></tr></table></div></figure>


<p>Download the sysupgrade file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cd /tmp
</span><span class='line'># wget http://downloads.openwrt.org/barrier_breaker/14.07/ar71xx/generic/openwrt-ar71xx-generic-mw4530r-v1-squashfs-sysupgrade.bin
</span><span class='line'># ls -l openwrt-ar71xx-generic-mw4530r-v1-squashfs-sysupgrade.bin 
</span><span class='line'>-rw-r--r--    1 root     root       3342340 Jun 22 17:28 openwrt-ar71xx-generic-mw4530r-v1-squashfs-sysupgrade.bin
</span></code></pre></td></tr></table></div></figure>


<p>Problem when checking:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># sysupgrade -v openwrt-ar71xx-generic-mw4530r-v1-squashfs-sysupgrade.bin 
</span><span class='line'>Invalid image, hardware ID mismatch, hw:43100001 image:45300001.
</span><span class='line'>Image check 'platform_check_image' failed.
</span></code></pre></td></tr></table></div></figure>


<p>
Ignore the Image check:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@OpenWrt:/tmp# sysupgrade -F openwrt-ar71xx-generic-mw4530r-v1-squashfs-sysupgrade.bin 
</span><span class='line'>Invalid image, hardware ID mismatch, hw:43100001 image:45300001.
</span><span class='line'>Image check 'platform_check_image' failed but --force given - will update anyway!
</span><span class='line'>Saving config files...
</span><span class='line'>Sending TERM to remaining processes ... uhttpd dnsmasq smbd nmbd ntpd hotplug2 syslogd klogd hotplug2 ubusd netifd 
</span><span class='line'>Sending KILL to remaining processes ... uhttpd 
</span><span class='line'>Switching to ramdisk...
</span><span class='line'>Performing system upgrade...
</span><span class='line'>Unlocking firmware ...
</span><span class='line'>
</span><span class='line'>Writing from &lt;stdin&gt; to firmware ...     
</span><span class='line'>Appending jffs2 data from /tmp/sysupgrade.tgz to firmware...TRX header not found
</span><span class='line'>Error fixing up TRX header
</span><span class='line'>    
</span><span class='line'>Upgrade completed
</span><span class='line'>Rebooting system...
</span></code></pre></td></tr></table></div></figure>


<p>After a while, your router is flashed to the new system.</p>

<h4>More Happily Play with FlashDisk</h4>

<p>Cause 8M Flash is not enough for playing lots of things, I plug-in a 2G FlashDisk into the usb port as the external disk.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ssh root@192.168.1.1
</span><span class='line'>root@OpenWrt:~# export http_proxy=http://1xx.xx.xxx.xxx:2xxxx
</span><span class='line'>root@OpenWrt:~# df -h
</span><span class='line'>Filesystem                Size      Used Available Use% Mounted on
</span><span class='line'>rootfs                    4.6M    292.0K      4.3M   6% /
</span><span class='line'>/dev/root                 2.3M      2.3M         0 100% /rom
</span><span class='line'>tmpfs                    61.7M    588.0K     61.1M   1% /tmp
</span><span class='line'>/dev/mtdblock3            4.6M    292.0K      4.3M   6% /overlay
</span><span class='line'>overlayfs:/overlay        4.6M    292.0K      4.3M   6% /
</span><span class='line'>tmpfs                   512.0K         0    512.0K   0% /dev
</span><span class='line'>root@OpenWrt:~# opkg update
</span><span class='line'>......
</span><span class='line'>root@OpenWrt:~# opkg install block-mount kmod-usb-storage fdisk kmod-fs-ext4 kmod-usb-storage-extras kmod-scsi-generic
</span><span class='line'>......
</span><span class='line'>root@OpenWrt:~# df -h
</span><span class='line'>Filesystem                Size      Used Available Use% Mounted on
</span><span class='line'>rootfs                    4.6M    836.0K      3.8M  18% /
</span></code></pre></td></tr></table></div></figure>


<p>Now format the flash-disk and plug it into the usb port. Reboot the router and now via <code>fdisk -l</code> you will see the plugged-in flashdisk:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Device    Boot Start       End  Blocks  Id System
</span><span class='line'>/dev/sda1       2048   3948543 1973248  83 Linux
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h4>Transfer Filesystem to External Disk</h4>

<p>The steps is listed as: <br/>
pivot overlay:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@OpenWrt:~# mkdir /mnt/sda1
</span><span class='line'>root@OpenWrt:~# mount /dev/sda1 /mnt/sda1/
</span><span class='line'>root@OpenWrt:~# tar -C /overlay -cvf - . | tar -C /mnt/sda1 -xf -
</span><span class='line'>root@OpenWrt:~# ls /mnt/sda1/
</span><span class='line'>etc         lib         lost+found  mnt         sbin        usr
</span></code></pre></td></tr></table></div></figure>


<p>pivot root:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir -p /tmp/cproot
</span><span class='line'>mount --bind / /tmp/cproot
</span><span class='line'>tar -C /tmp/cproot -cvf - . | tar -C /mnt/sda1 -xf -
</span><span class='line'>umount /tmp/cproot
</span></code></pre></td></tr></table></div></figure>


<p>Configuration file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ block detect
</span><span class='line'>config 'mount'
</span><span class='line'>        option  target  '/mnt/sda1'
</span><span class='line'>        option  uuid    'f6857dac-a12a-49c9-b567-f05a61100bd7'
</span><span class='line'>        option  enabled '0'
</span><span class='line'>
</span><span class='line'>$ cat /etc/config/fstab
</span><span class='line'>config global
</span><span class='line'>        option anon_swap '0'
</span><span class='line'>        option anon_mount '0'
</span><span class='line'>        option auto_swap '1'
</span><span class='line'>        option auto_mount '1'
</span><span class='line'>        option delay_root '5'
</span><span class='line'>        option check_fs '0'
</span><span class='line'>
</span><span class='line'>config mount
</span><span class='line'>        option target '/overlay'
</span><span class='line'>        option  uuid    'f6857dac-a12a-49c9-b567-f05a61100bd7'
</span><span class='line'>        option enabled '1'
</span><span class='line'>        option fstype 'ext4'
</span></code></pre></td></tr></table></div></figure>


<p>Now reboot the router and you got a 2G based storage router:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@OpenWrt:~# df -h
</span><span class='line'>Filesystem                Size      Used Available Use% Mounted on
</span><span class='line'>rootfs                    1.8G     12.6M      1.7G   1% /
</span></code></pre></td></tr></table></div></figure>


<p>You could play happily in this router.  <br/>
<img src="/images/4530Rrouter.jpg" alt="/images/4530Rrouter.jpg" /></p>

<h3>Further Optimization</h3>

<p>Includes:  <br/>
1. Fixed ip address configurations.   <br/>
2. Port forwarding. Router-> Port Forwarding.  <br/>
3. SSH Server Replacement, from dropbear to opensshd.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># opkg update
</span><span class='line'># opkg install openssh-server
</span><span class='line'># uci set dropbear.@dropbear[0].Port=2222
</span><span class='line'># uci commit dropbear
</span><span class='line'># /etc/init.d/dropbear restart
</span><span class='line'># /etc/init.d/sshd enable
</span><span class='line'># /etc/init.d/sshd start
</span><span class='line'># /etc/init.d/dropbear disable
</span><span class='line'># /etc/init.d/dropbear stop
</span><span class='line'># ssh-keygen
</span><span class='line'># opkg install openssh-client
</span></code></pre></td></tr></table></div></figure>


<p>4. Time sync.    <br/>
With the previous installed sshd, you could add yourself to remote server&rsquo;s trusted users. then add files of <code>time.sh</code> for syncing time. <br/>
Refers to local link <code>/blog/2014/02/11/write-local-ntp-sync-server/</code>  <br/>
5. Sharing the mouse between Yosemite and ArchLinux, change the configuration files.</p>

<p>Finally we got all of these done:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@OpenWrt:~/.ssh# uptime
</span><span class='line'> 12:45:31 up 6 min,  load average: 0.22, 0.14, 0.06
</span><span class='line'>root@OpenWrt:~/.ssh# date
</span><span class='line'>Fri Dec 12 12:45:33 CST 2014
</span><span class='line'>root@OpenWrt:~/.ssh# uname -a
</span><span class='line'>Linux OpenWrt 3.10.49 #3 Wed Oct 1 14:00:51 CEST 2014 mips GNU/Linux
</span></code></pre></td></tr></table></div></figure>


<p>Enable ssh WAN access:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>uci add firewall rule
</span><span class='line'>uci set firewall.@rule[-1].src=wan
</span><span class='line'>uci set firewall.@rule[-1].target=ACCEPT
</span><span class='line'>uci set firewall.@rule[-1].proto=tcp
</span><span class='line'>uci set firewall.@rule[-1].dest_port=22
</span><span class='line'>uci commit firewall
</span><span class='line'>/etc/init.d/firewall restart
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/11/ba-wan-panamax/">把玩Panamax</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-11T14:14:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>2:14 pm</span></time>
        
         | <a href="/blog/2014/12/11/ba-wan-panamax/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>前提条件</h3>

<p>在MAC上把玩Panamax前，需要安装Virtualbox, Vagrant, 而后, 用下列命令安装Panamax:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ brew install http://download.panamax.io/installer/brew/panamax.rb
</span><span class='line'>$ panamax init
</span></code></pre></td></tr></table></div></figure>


<p>这将开始下载CoreOS镜像，需要等一段时间。</p>

<p>In fact the panamax could also be installed on ArchLinux rather than only in Ubuntu, simply run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ curl http://download.panamax.io/installer/ubuntu.sh | bash
</span></code></pre></td></tr></table></div></figure>


<h3>Trouble Shooting</h3>

<h4>Init failed</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ panamix init
</span><span class='line'>A different VM with name panamax-vm has been created already. Please re-install or delete panamax-vm VM and try again.
</span></code></pre></td></tr></table></div></figure>


<p>Use following command for listing all of the virtualmachines:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>VBoxManage list vms
</span></code></pre></td></tr></table></div></figure>


<p>Didn&rsquo;t found the panamax related infos.  <br/>
Finally solve the problem via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@~/.vagrant.d]$ pwd
</span><span class='line'>/home/Trusty/.vagrant.d
</span><span class='line'>[Trusty@~/.vagrant.d]$ mv plugins.json plugins.json.back
</span><span class='line'>[Trusty@~/.vagrant.d]$ mv gems gems.back
</span></code></pre></td></tr></table></div></figure>


<h4>Frozen String</h4>

<p>The error code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/opt/vagrant/embedded/gems/gems/vagrant-1.7.0/lib/vagrant/util/subprocess.rb:28:in `encode!': can't modify frozen String (RuntimeError)
</span></code></pre></td></tr></table></div></figure>


<p>Is it because I upgraded to the latest vagrant?</p>

<p>I couldnot roll back to vagrant1.6, so I upgraded to the vagrant-git, its version is 1.7.1, from the yaourt repository, thus I could get the installation continue.</p>

<h3>OpenSuse Way</h3>

<p>First remove the installed virtualbox:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ zypper remove virtualbox
</span><span class='line'>$ zypper in libvncserver0 LibVNCServer-devel
</span></code></pre></td></tr></table></div></figure>


<p>Install the 4.3 version of virtualbox:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget http://download.opensuse.org/repositories/home:/Warhammer40k:/stuff/openSUSE_13.1/x86_64/VirtualBox-custom-4.3-4.3.20-1.1.x86_64.rpm
</span><span class='line'>$ rpm -ivh VirtualBox-custom-4.3-4.3.20-1.1.x86_64.rpm
</span></code></pre></td></tr></table></div></figure>


<p>Now doing the same as we noticed above.   <br/>
But the <code>panamax init</code> got following error messages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>==&gt; panamax-vm: Clearing any previously set network interfaces...
</span><span class='line'>There was an error while executing `VBoxManage`, a CLI used by Vagrant
</span><span class='line'>for controlling VirtualBox. The command and stderr is shown below.
</span><span class='line'>
</span><span class='line'>Command: ["hostonlyif", "create"]
</span><span class='line'>
</span><span class='line'>Stderr: 0%...
</span><span class='line'>Progress state: NS_ERROR_FAILURE
</span><span class='line'>VBoxManage: error: Failed to create the host-only adapter
</span><span class='line'>VBoxManage: error: VBoxNetAdpCtl: Error while adding new interface: failed to open /dev/vboxnetctl: No such file or directory
</span><span class='line'>VBoxManage: error: Details: code NS_ERROR_FAILURE (0x80004005), component HostNetworkInterface, interface IHostNetworkInterface
</span><span class='line'>VBoxManage: error: Context: "int handleCreate(HandlerArg*, int, int*)" at line 66 of file VBoxManageHostonly.cpp
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/10/re-write-weatherapp/">Re-Write WeatherAPP</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-10T11:17:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:17 am</span></time>
        
         | <a href="/blog/2014/12/10/re-write-weatherapp/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Background</h3>

<h3>Building the Environment</h3>

<p>First clone the Vagrant Repo from:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pwd
</span><span class='line'>/media/y/Vagrant/CoreOS
</span><span class='line'>$ git clone https://github.com/coreos/coreos-vagrant.git
</span><span class='line'>$ cd coreos-vagrant
</span><span class='line'>$ cp config.rb.sample config.rb
</span><span class='line'>$ cp user-data.sample user-data
</span></code></pre></td></tr></table></div></figure>


<h4>Cluster Setting</h4>

<p>Edit the config.rb, for configurating the instance and the official CoreOS channel:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Size of the CoreOS cluster created by Vagrant
</span><span class='line'>$num_instances=3
</span><span class='line'># Official CoreOS channel from which updates should be downloaded
</span><span class='line'>$update_channel='stable'
</span></code></pre></td></tr></table></div></figure>


<p>Now start the vagrant and view its status:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant up
</span><span class='line'>$ vagrant status
</span><span class='line'>Current machine states:
</span><span class='line'>
</span><span class='line'>core-01                   running (virtualbox)
</span><span class='line'>core-02                   running (virtualbox)
</span><span class='line'>core-03                   running (virtualbox)
</span><span class='line'>$ vagrant ssh core-1
</span></code></pre></td></tr></table></div></figure>


<p>After you login to the coreOS, you could view the status of this virtual machine. Each of the machine have 1 Core, 1G ram, 20G harddisk.</p>

<h3>Single Machine</h3>

<p>Just comment the following lines of the config.rb:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># $num_instances=3
</span></code></pre></td></tr></table></div></figure>


<p>This will bring one instance of vagrant based CoreOS machine.</p>

<h3>NodeJS</h3>

<p>I want to write my APPs using NodeJS, thus I want to setup the NodeJS dev environment on CoreOS based Docker. Following are the steps:  <br/>
First configure the proxy of docker:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo mkdir /etc/systemd/system/docker.service.d
</span><span class='line'>$ sudo vim http-proxy.conf
</span><span class='line'>[Service]
</span><span class='line'>Environment="HTTP_PROXY=http://proxy.example.com:8080"
</span><span class='line'>To apply the change, reload the unit and restart docker:
</span><span class='line'>$ systemctl daemon-reload
</span><span class='line'>$ systemctl restart docker
</span></code></pre></td></tr></table></div></figure>


<p>Now you could use docker for pulling back some container and run.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker search base
</span><span class='line'>$ docker pull base
</span><span class='line'>$ docker images
</span><span class='line'>$ docker run base /bin/bash -c "ls /"
</span><span class='line'>$ docker run base /bin/bash -c "cat /etc/issue"
</span></code></pre></td></tr></table></div></figure>


<p>
Since the network is not good, I created the droplet on DigitalOcean, and installed CoreOS.</p>

<h3>Dockerized</h3>

<p><a href="http://blogs.aws.amazon.com/application-management/post/Tx1ZLAHMVBEDCOC/Dockerizing-a-Python-Web-App">http://blogs.aws.amazon.com/application-management/post/Tx1ZLAHMVBEDCOC/Dockerizing-a-Python-Web-App</a>   <br/>
Steps is listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone git@github.com:awslabs/eb-py-flask-signup.git
</span><span class='line'>$ cd eb-py-flask-signup
</span><span class='line'>$ git checkout master
</span><span class='line'>$ vim Dockerfile
</span><span class='line'>FROM ubuntu:14.04
</span><span class='line'>
</span><span class='line'># Install Python Setuptools
</span><span class='line'>RUN apt-get install -y python-setuptools
</span><span class='line'>
</span><span class='line'># Install pip
</span><span class='line'>RUN easy_install pip
</span><span class='line'>
</span><span class='line'># Add and install Python modules
</span><span class='line'>ADD requirements.txt /src/requirements.txt
</span><span class='line'>RUN cd /src; pip install -r requirements.txt
</span><span class='line'>
</span><span class='line'># Bundle app source
</span><span class='line'>ADD . /src
</span><span class='line'>
</span><span class='line'># Expose
</span><span class='line'>EXPOSE  5000
</span><span class='line'>
</span><span class='line'># Run
</span><span class='line'>CMD ["python", "/src/application.py"]
</span><span class='line'>$ docker build -t eb-py-sample .
</span><span class='line'>$ docker run -d \
</span><span class='line'>     -e APP_CONFIG=application.config.example \
</span><span class='line'>     -e AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID \
</span><span class='line'>     -e AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY \
</span><span class='line'>     -p 8080:5000 \
</span><span class='line'>     eb-py-sample
</span></code></pre></td></tr></table></div></figure>


<p>Then open <a href="http://localhost:8000">http://localhost:8000</a> to see your own app.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/06/tips-on-30days30skills-5/">Tips on 30Days30Skills(5)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-06T16:26:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:26 pm</span></time>
        
         | <a href="/blog/2014/12/06/tips-on-30days30skills-5/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since the RESTful API is a little bit hard for setup, I ignore the Day10 and Day11, jump to Day 12, OpenCV.</p>

<h3>Day 12 - OpenCV</h3>

<h4>Get the jar file</h4>

<p>First download the opencv from:
<a href="http://sourceforge.net/projects/opencvlibrary/files/latest/download">http://sourceforge.net/projects/opencvlibrary/files/latest/download</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ unzip *.zip
</span><span class='line'>$ cd opencv-2.4.10
</span><span class='line'>$ cmake -G "Unix Makefiles" -D CMAKE_CXX_COMPILER=/usr/bin/g++ -D CMAKE_C_COMPILER=/usr/bin/gcc -D WITH_CUDA=ON .. 
</span><span class='line'>$ make -j4 && make install
</span></code></pre></td></tr></table></div></figure>


<p>Trouble shooting when generating openCV jar file:  <br/>
Correct output should be:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>--   Java:
</span><span class='line'>--     ant:                         /bin/ant (ver 1.9.4)
</span><span class='line'>--     JNI:                         /usr/lib/jvm/java-7-openjdk/include /usr/lib/jvm/java-7-openjdk/include/linux /usr/lib/jvm/java-7-openjdk/include
</span><span class='line'>--     Java tests:                  YES
</span></code></pre></td></tr></table></div></figure>


<p>Add JNi</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export JAVA_HOME=/usr/lib/jvm/java-7-openjdk/
</span></code></pre></td></tr></table></div></figure>


<p>Then build with following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cmake -G "Unix Makefiles" -D CMAKE_CXX_COMPILER=/usr/bin/g++ -D CMAKE_C_COMPILER=/usr/bin/gcc -D WITH_CUDA=ON -D BUILD_SHARED_LIBS=OFF -D BUILD_NEW_PYTHON_SUPPORT=NO .. && make
</span></code></pre></td></tr></table></div></figure>


<p>For MACOS, you should install:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ brew install ant
</span><span class='line'>$ export JAVA_HOME=`/usr/libexec/java_home -v 1.6`
</span></code></pre></td></tr></table></div></figure>


<p>Then re-compile and now you could get the jar file under build/bin/.</p>

<h4>Development on OpenCV</h4>

<p>Using eclipse LUNA.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(venv)[Trusty@~/code/30days/Day12OpenCV/opencv-2.4.10/build/bin]$ pwd
</span><span class='line'>/home/Trusty/code/30days/Day12OpenCV/opencv-2.4.10/build/bin
</span><span class='line'>(venv)[Trusty@~/code/30days/Day12OpenCV/opencv-2.4.10/build/bin]$ ls *.jar
</span><span class='line'>opencv-2410.jar
</span></code></pre></td></tr></table></div></figure>


<p>Add the new User Libraries:</p>

<p><img src="/images/addjavalib.jpg" alt="/images/addjavalib.jpg" /></p>

<p>The detailed configuration steps could be refered to the <a href="http://segmentfault.com/a/1190000000358809">http://segmentfault.com/a/1190000000358809</a>,  After configuration your User Libraries should be looked like this:  <br/>
<img src="/images/javalib2.jpg" alt="/images/javalib2.jpg" /></p>

<p>Add User Libraries thus you could see the configuration of the lib is looked like:  <br/>
<img src="/images/libconfiguration.jpg" alt="/images/libconfiguration.jpg" /></p>

<p>Code is like following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">facedetection</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.opencv.core.Core</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.opencv.core.Mat</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.opencv.core.MatOfRect</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.opencv.core.Point</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.opencv.core.Rect</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.opencv.core.Scalar</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.opencv.highgui.Highgui</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.opencv.objdetect.CascadeClassifier</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyFaceDetectionClass</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="n">Core</span><span class="o">.</span><span class="na">NATIVE_LIBRARY_NAME</span><span class="o">);</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;\nRunning FaceDetector&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">CascadeClassifier</span> <span class="n">faceDetector</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">CascadeClassifier</span><span class="o">(</span><span class="n">MyFaceDetectionClass</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getResource</span><span class="o">(</span><span class="s">&quot;haarcascade_frontalface_alt.xml&quot;</span><span class="o">).</span><span class="na">getPath</span><span class="o">());</span>
</span><span class='line'>        <span class="n">Mat</span> <span class="n">image</span> <span class="o">=</span> <span class="n">Highgui</span>
</span><span class='line'>                <span class="o">.</span><span class="na">imread</span><span class="o">(</span><span class="n">MyFaceDetectionClass</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getResource</span><span class="o">(</span><span class="s">&quot;shekhar.JPG&quot;</span><span class="o">).</span><span class="na">getPath</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">MatOfRect</span> <span class="n">faceDetections</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">MatOfRect</span><span class="o">();</span>
</span><span class='line'>        <span class="n">faceDetector</span><span class="o">.</span><span class="na">detectMultiScale</span><span class="o">(</span><span class="n">image</span><span class="o">,</span> <span class="n">faceDetections</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Detected %s faces&quot;</span><span class="o">,</span> <span class="n">faceDetections</span><span class="o">.</span><span class="na">toArray</span><span class="o">().</span><span class="na">length</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="n">Rect</span> <span class="n">rect</span> <span class="o">:</span> <span class="n">faceDetections</span><span class="o">.</span><span class="na">toArray</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">Core</span><span class="o">.</span><span class="na">rectangle</span><span class="o">(</span><span class="n">image</span><span class="o">,</span> <span class="k">new</span> <span class="nf">Point</span><span class="o">(</span><span class="n">rect</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">rect</span><span class="o">.</span><span class="na">y</span><span class="o">),</span> <span class="k">new</span> <span class="nf">Point</span><span class="o">(</span><span class="n">rect</span><span class="o">.</span><span class="na">x</span> <span class="o">+</span> <span class="n">rect</span><span class="o">.</span><span class="na">width</span><span class="o">,</span> <span class="n">rect</span><span class="o">.</span><span class="na">y</span> <span class="o">+</span> <span class="n">rect</span><span class="o">.</span><span class="na">height</span><span class="o">),</span>
</span><span class='line'>                    <span class="k">new</span> <span class="nf">Scalar</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">255</span><span class="o">,</span> <span class="mi">0</span><span class="o">));</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">String</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;ouput.png&quot;</span><span class="o">;</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Writing %s&quot;</span><span class="o">,</span> <span class="n">filename</span><span class="o">));</span>
</span><span class='line'>        <span class="n">Highgui</span><span class="o">.</span><span class="na">imwrite</span><span class="o">(</span><span class="n">filename</span><span class="o">,</span> <span class="n">image</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then you should place the xml file and the JPG file under the java class, after doing this, run the application, then you will got the png file generate with face detected.</p>

<h3>Day 13 - Dropwizard</h3>

<p>First you should install mondb in ArchLinux:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">$</span> <span class="n">sudo</span> <span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">mongodb</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then in eclipse, create a new Maven project with the template of &ldquo;maven-archetype-quickstart&rdquo;, with the following configuration of Artifact Id and Group id.  <br/>
<img src="/images/blogjava.jpg" alt="/images/blogjava.jpg" /></p>

<p>The default pom.xml should be modified,</p>

<p>Since the network environment is not stable, I created a vncserver at the VPS, and use VPS for developing.  <br/>
In vps:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">eclipse</span>
</span><span class='line'><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">mongodb</span>
</span></code></pre></td></tr></table></div></figure>


<p>then install the maven from: <a href="http://download.eclipse.org/technology/m2e/releases/1.3">http://download.eclipse.org/technology/m2e/releases/1.3</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/06/use-vccw-for-deploying-wp/">Use VCCW for Deploying WP</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-06T12:13:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>12:13 pm</span></time>
        
         | <a href="/blog/2014/12/06/use-vccw-for-deploying-wp/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For deploying differenet versions of Wordpress, I searched various kinds of solutions, includeing docker and vagrant, finally I found VCCW(A Wordpress development environment) is what I want, because I could freely changes the WP versions, so following is the guideline for installing and configurating the whole virtualmachine.</p>

<h3>Install</h3>

<p>The installation steps are listed as:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant plugin install vagrant-hostsupdater
</span><span class='line'>$ wget https://github.com/miya0001/vccw/archive/1.9.1.tar.gz
</span><span class='line'>$ tar xzvf 1.9.1.tar.gz
</span><span class='line'>$ cd vccw-1.9.1
</span><span class='line'>$ vagrant up
</span></code></pre></td></tr></table></div></figure>


<p>This will start downloading and configrating the VM, it will cost sometimes. So just drink a coffee and get back.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant plugin install vagrant-omnibus && vagrant plugin install vagrant-hostsupdater &&  vagrant plugin install vagrant-proxyconf
</span></code></pre></td></tr></table></div></figure>


<p>Configure proxy and chef?</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim Vagrantfile
</span><span class='line'>Vagrant.configure(2) do |config|
</span><span class='line'>  config.proxy.http     = "http://1xx.xx.xx:xxx:2xxx"
</span><span class='line'>  config.proxy.https    = "http://1xx.xx.xx:xxx:2xxx"
</span><span class='line'>  config.proxy.no_proxy = "localhost,127.0.0.1,.example.com"
</span><span class='line'>
</span><span class='line'>config.omnibus.chef_version = :latest
</span><span class='line'>$ VAGRANT_APT_HTTP_PROXY="http://1xx.xx.xx.xxx:2xxxx vagrant up
</span><span class='line'>$ VAGRANT_APT_HTTP_PROXY="http://1xx.xx.xx.xxx:2xxxx vagrant provision
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vagrant halt
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/27">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/25">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/03/12/tips-on-5050rgb/">Tips on 5050RGB</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/11/tips-on-w5100/">Tips on W5100</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/10/pei-zhi-qemude-vdewang-luo/">配置Qemu的VDE网络</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/07/tips-on-v-usb-and-arduino-5/">Tips on V-USB and Arduino(5)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/07/tips-on-v-usb-and-arduino-4/">Tips on V-USB and Arduino(4)</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
