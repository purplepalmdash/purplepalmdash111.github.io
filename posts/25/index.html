
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="First get the installation image from the AppStore, then format a flash-disk more than 8G to following format: Use following commands for creating &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/25">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//fonts.googleapis.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/18/tips-on-installing-yosemite/">Tips on Installing Yosemite</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-18T09:36:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>9:36 am</span></time>
        
         | <a href="/blog/2014/11/18/tips-on-installing-yosemite/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>First get the installation image from the AppStore, then format a flash-disk more than 8G to following format:   <br/>
<img src="/images/macosdisk.jpg" alt="/images/macosdisk.jpg" />   <br/>
Use following commands for creating the installation media:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kkkkkkkktttt-iMac:~ Trusty$ sudo /Applications/Install\ OS\ X\ Yosemite.app/Contents/Resources/createinstallmedia --volume /Volumes/Install --applicationpath /Applications/Install\ OS\ X\ Yosemite.app --nointeraction
</span></code></pre></td></tr></table></div></figure>


<p>Take a coffee, cause this will spend a long time for copying everything you need into the disk.</p>

<p>Install Clover:</p>

<p><img src="/images/clover1.jpg" alt="/images/clover1.jpg" /></p>

<p>Customize Clover installation:  <br/>
<img src="/images/clover2.jpg" alt="/images/clover2.jpg" /></p>

<p><img src="/images/clover3.jpg" alt="/images/clover3.jpg" /></p>

<p>Copy the dsdt &amp; ssdt files to EFI partition:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kkkkkkkktttt-iMac:Dsdt & Ssdt Trusty$ pwd
</span><span class='line'>/Users/Trusty/Desktop/MacOS/SurfacePro/SurfacePro 1° Gen FilesPackage V.0.5.1/Dsdt & Ssdt
</span><span class='line'>kkkkkkkktttt-iMac:Dsdt & Ssdt Trusty$ cp -ar * /Volumes/ESP/EFI/CLOVER/ACPI/patched/
</span></code></pre></td></tr></table></div></figure>


<p>Copy some device driver files into the Clover:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kkkkkkkktttt-iMac:MacOS Trusty$ tar xzvf GenericUSBXHCI_1.2.7.tar.gz 
</span></code></pre></td></tr></table></div></figure>


<p>Copy GenericUSBXHCI.kext to 10.9/ 10.10/ Other/:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kkkkkkkktttt-iMac:kexts Trusty$ pwd
</span><span class='line'>/Volumes/ESP/EFI/CLOVER/kexts
</span><span class='line'>kkkkkkkktttt-iMac:kexts Trusty$ ls -F
</span><span class='line'>10.10/  10.6/   10.7/   10.8/   10.9/   Other/
</span><span class='line'>kkkkkkkktttt-iMac:10.10 Trusty$ sudo cp -r  /Users/Trusty/Desktop/MacOS/GenericUSBXHCI_Yosemite/ /Volumes/ESP/EFI/CLOVER/kexts/10.10/
</span></code></pre></td></tr></table></div></figure>


<p>Also we have to copy the fakesmc.kext should be copied to above folder.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kkkkkkkktttt-iMac:kexts Trusty$ ls *
</span><span class='line'>10.10:
</span><span class='line'>GenericUSBXHCI.kext     fakesmc.kext
</span><span class='line'>
</span><span class='line'>10.6:
</span><span class='line'>
</span><span class='line'>10.7:
</span><span class='line'>
</span><span class='line'>10.8:
</span><span class='line'>
</span><span class='line'>10.9:
</span><span class='line'>GenericUSBXHCI.kext     fakesmc.kext
</span><span class='line'>
</span><span class='line'>Other:
</span><span class='line'>GenericUSBXHCI.kext     fakesmc.kext
</span></code></pre></td></tr></table></div></figure>


<p>Now copy the config.plist into the CLOVER root directory.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kkkkkkkktttt-iMac:SurfacePro 1° Gen FilesPackage V.0.5.1 Trusty$ pwd
</span><span class='line'>/Users/Trusty/Desktop/MacOS/SurfacePro/SurfacePro 1° Gen FilesPackage V.0.5.1
</span><span class='line'>kkkkkkkktttt-iMac:SurfacePro 1° Gen FilesPackage V.0.5.1 Trusty$ ls config.plist 
</span><span class='line'>config.plist
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Now you got your installation disk OK.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/17/forward-x11-via-ssh/">Forward X11 via Ssh</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-17T12:08:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>12:08 pm</span></time>
        
         | <a href="/blog/2014/11/17/forward-x11-via-ssh/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since the 5901 port is forbiddended via administrator of the switch, we have to forward the traffic to remote machine via ssh:</p>

<p>First in our machine type following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh -L 2333:A:5901 A -l Trusty
</span></code></pre></td></tr></table></div></figure>


<p>This will forward the A machines' 5901 to local&rsquo;s 2333 port.   <br/>
Then use a vncviewer software for accessing local machine&rsquo;s 2333 port:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vncviewer localhost:2333
</span></code></pre></td></tr></table></div></figure>


<p>Notice, the virtualbox&rsquo;s is named to vboxgtk in opensuse.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/16/ebc-exercises-on-bbb-pwm/">EBC Exercises on BBB - PWM</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-16T16:44:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:44 pm</span></time>
        
         | <a href="/blog/2014/11/16/ebc-exercises-on-bbb-pwm/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>PWM</h3>

<p>Simply enable the <code>P9_21</code> to PWM, then connect to the LED. The LED connection could refer to <code>EBC Exercises on BBB - Control LED</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SLOTS=/sys/devices/bone_capemgr.*/slots
</span><span class='line'>echo am33xx_pwm &gt; $SLOTS
</span><span class='line'>echo bone_pwm_P9_21 &gt; $SLOTS
</span><span class='line'>cd /sys/devices/ocp.3/pwm_test_P9_21.15/
</span><span class='line'>echo 1000000000 &gt; period
</span><span class='line'>echo  250000000 &gt; duty
</span><span class='line'>echo 1 &gt; run
</span></code></pre></td></tr></table></div></figure>


<p>From now you could see the LED begin to flash. In fact using this pwm we could control servo motor:  <br/>
<a href="http://www.linux.com/learn/tutorials/776799-servo-control-from-the-beaglebone-black/">http://www.linux.com/learn/tutorials/776799-servo-control-from-the-beaglebone-black/</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/16/i2c-and-bbb/">EBC Exercises on BBB -i2c and BBB</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-16T13:21:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:21 pm</span></time>
        
         | <a href="/blog/2014/11/16/i2c-and-bbb/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Connection</h3>

<p>HMC5883L magnetometer runs in 400KHZ I2C bus, it&rsquo;s for measuring the magnetic field vector in 3 dimensions.   <br/>
We use its 4 ports: VCC,GND,SDA, SCL. SDA is for Data, while SCL is for Clock.</p>

<p>Use P9 for connecting the HMC5883L.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>P9_02(GND) &lt;----&gt; GND    
</span><span class='line'>P9_04(VCC) &lt;----&gt; VCC
</span><span class='line'>P9_19(I2C2_SCL) &lt;----&gt; SCL   I2C bus 2(pin 19 on header p9 to SCL) 
</span><span class='line'>P9_20(I2C2_SDA) &lt;----&gt; SDA   
</span></code></pre></td></tr></table></div></figure>


<h3>I2C Detect</h3>

<p>First you should install i2cdetect, then list the avaiable i2c bus via following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~# i2cdetect -l
</span><span class='line'>i2c-0   i2c             OMAP I2C adapter                        I2C adapter
</span><span class='line'>i2c-1   i2c             OMAP I2C adapter                        I2C adapter
</span></code></pre></td></tr></table></div></figure>


<p>We choose i2c bus2, thus the command for detecting the connected device should be:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~# i2cdetect -y -r 1
</span><span class='line'>     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
</span><span class='line'>00:          -- -- -- -- -- -- -- -- -- -- -- -- -- 
</span><span class='line'>10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- 1e -- 
</span><span class='line'>20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
</span><span class='line'>30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
</span><span class='line'>40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
</span><span class='line'>50: -- -- -- -- UU UU UU UU -- -- -- -- -- -- -- -- 
</span><span class='line'>60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
</span><span class='line'>70: -- -- -- -- -- -- -- --     
</span></code></pre></td></tr></table></div></figure>


<p>The address should be 0x1e.</p>

<h3>Communicate with HMC5883L</h3>

<p>The registers are listed as following, notice eavh value for each axis are 16-bits, thus we have to read them seperately and combine them:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Address  Name    Access
</span><span class='line'>00    Configuration Register A    Read/Write
</span><span class='line'>01    Configuration Register B    Read/Write
</span><span class='line'>02    Mode Register   Read/Write
</span><span class='line'>03    Data Output X MSB Register  Read
</span><span class='line'>04    Data Output X LSB Register  Read
</span><span class='line'>05    Data Output Z MSB Register  Read
</span><span class='line'>06    Data Output Z LSB Register  Read
</span><span class='line'>07    Data Output Y MSB Register  Read
</span><span class='line'>08    Data Output Y LSB Register  Read
</span><span class='line'>09    Status Register Read
</span><span class='line'>10    Identification register A   Read
</span><span class='line'>11    Identification register B   Read
</span><span class='line'>12    Identification register C   Read
</span></code></pre></td></tr></table></div></figure>


<p>Thus we could read out the X MSB Restier and X LSB Register via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~# i2cget -y 1 0x1e 3
</span><span class='line'>0xfe
</span><span class='line'>root@arm:~# i2cget -y 1 0x1e 4
</span><span class='line'>0x91
</span></code></pre></td></tr></table></div></figure>


<h4>Different Mode</h4>

<p>Notice Mode Register, this will set the mesurement mode.  <br/>
<img src="/images/moderegister.jpg" alt="/images/moderegister.jpg" /></p>

<p>From the above table, we know for setting the lower 2 bits we could enable the operation mode of HMC5883L.  <br/>
Now we set to single measurement mode, for one-time measure.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># i2cset -y 1 0x1e 2 1
</span></code></pre></td></tr></table></div></figure>


<p>2 means we set the register 2, and its number equals to 01(Single-Measurement Mode). After one-time measurement, it wil fall back to idle Mode.      <br/>
After one-time measurement, get the register mode:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~# i2cget -y 1 0x1e 2
</span><span class='line'>0x03
</span></code></pre></td></tr></table></div></figure>


<p>Get the value of x-axis:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~# i2cget -y 1 0x1e 3
</span><span class='line'>0xfe
</span><span class='line'>root@arm:~# i2cget -y 1 0x1e 4
</span><span class='line'>0x77
</span></code></pre></td></tr></table></div></figure>


<h3>C Code</h3>

<p>Running Result:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~/code/i2c# ./myi2cget 1 30 2
</span><span class='line'>0x03 (3)
</span><span class='line'>root@arm:~/code/i2c# ./myi2cget 1 30 34
</span><span class='line'>0x00 (0)
</span><span class='line'>root@arm:~/code/i2c# ./myi2cget 1 30 4
</span><span class='line'>0x77 (119)
</span></code></pre></td></tr></table></div></figure>


<p>Critical Code:  <br/>
Open the i2c-xxx:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    sprintf(filename, "/dev/i2c-%d", i2cbus);
</span><span class='line'>    file = open(filename, O_RDWR);
</span></code></pre></td></tr></table></div></figure>


<p>ioctl for setting the address:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    if (ioctl(file, I2C_SLAVE, address) &lt; 0) {
</span></code></pre></td></tr></table></div></figure>


<p>Now read the byte from:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    res = i2c_smbus_read_byte_data(file, daddress);
</span></code></pre></td></tr></table></div></figure>


<p>Comparing the official i2cget, myi2cget could print out the human-readable format of data.</p>

<h3>Web Displaying</h3>

<p>Git clone the following project form github.com:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># git clone https://github.com/duganje/ECE497_duganje.git
</span><span class='line'># cd  ECE497_duganje/
</span><span class='line'># ls
</span><span class='line'>MiniProject01  MiniProject02  MiniProject03  MiniProject04  README.md
</span></code></pre></td></tr></table></div></figure>


<p>Upload the project MiniProject04 to the BBB board.  <br/>
Notice change the code in buttonBox.js from <code>i2cset -y 3</code> to <code>i2cset -y 1 and</code>i2cget -y 3<code>to</code>i2cget -y 1`</p>

<p>After modification, run buttonBox.js via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ node buttonBox.js
</span></code></pre></td></tr></table></div></figure>


<p>Now visit the <code>http://xx.xx.xx.xxx:8081/buttonBox.html</code> you could see the data displayed as following:</p>

<p><img src="/images/magnetometer.jpg" alt="/images/magnetometer.jpg" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/16/gpio-via-mmap/">EBC Exercises on BBB -GPIO via Mmap</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-16T11:30:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:30 am</span></time>
        
         | <a href="/blog/2014/11/16/gpio-via-mmap/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Operate On Device Tree</h3>

<p>Turn off the trigger and then shine on the LED USR3 via following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~# cd /sys/class/leds/beaglebone\:green\:usr3
</span><span class='line'>root@arm:/sys/class/leds/beaglebone:green:usr3# ls
</span><span class='line'>brightness  device  max_brightness  power  subsystem  trigger  uevent
</span><span class='line'>root@arm:/sys/class/leds/beaglebone:green:usr3# echo none &gt; trigger 
</span><span class='line'>root@arm:/sys/class/leds/beaglebone:green:usr3# echo 1 &gt; brightness
</span></code></pre></td></tr></table></div></figure>


<p>We could find the gpio is attached to which pin:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ./findGPIO.js USR3                                                                
</span><span class='line'>{ name: 'USR3',                                                                                         
</span><span class='line'> gpio: 56,                                                                                             
</span><span class='line'> led: 'usr3',                                                                                          
</span><span class='line'> mux: 'gpmc_a8',                                                                                       
</span><span class='line'> key: 'USR3',                                                                                          
</span><span class='line'> muxRegOffset: '0x060',                                                                                
</span><span class='line'> options:                                                                                              
</span><span class='line'>  [ 'gpmc_a8',                                                                                         
</span><span class='line'>    'gmii2_rxd3',                                                                                      
</span><span class='line'>    'rgmii2_rd3',                                                                                      
</span><span class='line'>    'mmc2_dat6',                                                                                       
</span><span class='line'>    'gpmc_a24',                                                                                        
</span><span class='line'>    'pr1_mii1_rxd0',                                                                                   
</span><span class='line'>    'mcasp0_aclkx',                                                                                    
</span><span class='line'>    'gpio1_24' ] }
</span><span class='line'>USR3 (gpio 56) mode: 7 (gpio1_24) 0x060 pullup
</span><span class='line'>pin 24 (44e10860): (MUX UNCLAIMED) (GPIO UNCLAIMED)
</span></code></pre></td></tr></table></div></figure>


<p><code>gpio1_24</code> is what we want. Then refer Memory Map table in the Technical Reference Manual, its base address is 0x4804c000.</p>

<h3>devmem2</h3>

<p>An easy way to read the contents of a memory location is with devmem2:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~/code/gpio# devmem2 0x4804c13c
</span><span class='line'>/dev/mem opened.
</span><span class='line'>Memory mapped at address 0xb6fea000.
</span><span class='line'>Value at address 0x4804C13C (0xb6fea13c): 0x9A00000
</span></code></pre></td></tr></table></div></figure>


<p>Light ON the USR3 led:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~/code/gpio# devmem2 0x4804c190 w 0x01000000
</span><span class='line'>/dev/mem opened.
</span><span class='line'>Memory mapped at address 0xb6f52000.
</span><span class='line'>Value at address 0x4804C190 (0xb6f52190): 0x9800000
</span><span class='line'>Written 0x1000000; readback 0x1000000
</span></code></pre></td></tr></table></div></figure>


<p>Light OFF the USR3 led:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~/code/gpio# devmem2 0x4804c194 w 0x01000000
</span><span class='line'>/dev/mem opened.
</span><span class='line'>Memory mapped at address 0xb6f1c000.
</span><span class='line'>Value at address 0x4804C194 (0xb6f1c194): 0x8A00000
</span><span class='line'>Written 0x1000000; readback 0x1000000
</span></code></pre></td></tr></table></div></figure>


<h3>mmap code</h3>

<p>The critical Code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>int fd = open("/dev/mem", O_RDWR);
</span><span class='line'>
</span><span class='line'>gpio_addr = mmap(0, GPIO1_SIZE, PROT_READ | PROT_WRITE, MAP_SHARED, fd, GPIO1_START_ADDR);
</span><span class='line'>
</span><span class='line'>gpio_oe_addr           = gpio_addr + GPIO_OE;
</span><span class='line'>gpio_setdataout_addr   = gpio_addr + GPIO_SETDATAOUT;
</span><span class='line'>gpio_cleardataout_addr = gpio_addr + GPIO_CLEARDATAOUT;
</span><span class='line'>
</span><span class='line'>// Set USR3 to be an output pin
</span><span class='line'>reg = *gpio_oe_addr;
</span><span class='line'>printf("GPIO1 configuration: %X\n", reg);
</span><span class='line'>reg &= ~USR3;       // Set USR3 bit to 0
</span><span class='line'>*gpio_oe_addr = reg;
</span><span class='line'>printf("GPIO1 configuration: %X\n", reg);
</span><span class='line'>
</span><span class='line'>printf("Start blinking LED USR3\n");
</span><span class='line'>while(keepgoing) {
</span><span class='line'>    // printf("ON\n");
</span><span class='line'>    *gpio_setdataout_addr = USR3;
</span><span class='line'>    usleep(250000);
</span><span class='line'>    // printf("OFF\n");
</span><span class='line'>    *gpio_cleardataout_addr = USR3;
</span><span class='line'>    usleep(250000);
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Run the program and see its heartbeat:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ./gpioToggle 
</span><span class='line'>Mapping 4804C000 - 4804E000 (size: 2000)
</span><span class='line'>GPIO mapped to 0xb6f91000
</span><span class='line'>GPIO OE mapped to 0xb6f91134
</span><span class='line'>GPIO SETDATAOUTADDR mapped to 0xb6f91194
</span><span class='line'>GPIO CLEARDATAOUT mapped to 0xb6f91190
</span><span class='line'>GPIO1 configuration: F60FFFFF
</span><span class='line'>GPIO1 configuration: F60FFFFF
</span><span class='line'>Start blinking LED USR3
</span></code></pre></td></tr></table></div></figure>


<h3>gpioThru</h3>

<p>This example need to be clearly written later.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/13/ebc-exercises-on-bbb-device-tree/">EBC Exercises on BBB - Device Tree</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-13T20:30:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:30 pm</span></time>
        
         | <a href="/blog/2014/11/13/ebc-exercises-on-bbb-device-tree/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Install js wrapped bonescript</h3>

<p>For using the javascript wrapped library, first we have to install following packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install nodejs npm nodejs-legacy
</span><span class='line'>$ npm config set proxy http://1xx.xx.xx.xxx:2xxx
</span><span class='line'>$ npm config set https-proxy http://1xx.xx.xx.xx:2xxx
</span><span class='line'>$ npm install bonescript
</span></code></pre></td></tr></table></div></figure>


<p>Because my network environment is under the firewall, so I need to set the proxy, if you directly connect to internet, you could ignore the <code>npm config set</code> commands.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/13/ebc-exercises-on-bbb-read-analog/">EBC Exercises on BBB - Read Analog</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-13T18:49:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>6:49 pm</span></time>
        
         | <a href="/blog/2014/11/13/ebc-exercises-on-bbb-read-analog/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Connection</h3>

<p>The wired connection is listed as following:  <br/>
Pin 34(analog ground) &mdash;> Negative Pin  <br/>
Pin 32(1.8 V) &mdash;> Positive Pin  <br/>
Pin 36(AIN5) &mdash;> Wiper   <br/>
Pin 32: VADC, Pin 34: AGND, Pin36, AIN5.</p>

<h3>Operation</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:/sys/kernel/debug/pinctrl/44e10800.pinmux# cat /sys/devices/bone_capemgr.*/slots
</span><span class='line'> 0: 54:PF--- 
</span><span class='line'> 1: 55:PF--- 
</span><span class='line'> 2: 56:PF--- 
</span><span class='line'> 3: 57:PF--- 
</span><span class='line'> 4: ff:P-O-L Bone-LT-eMMC-2G,00A0,Texas Instrument,BB-BONE-EMMC-2G
</span><span class='line'> 5: ff:P-O-L Bone-Black-HDMI,00A0,Texas Instrument,BB-BONELT-HDMI
</span><span class='line'>root@arm:/sys/kernel/debug/pinctrl/44e10800.pinmux# SLOTS=/sys/devices/bone_capemgr.*/slots
</span><span class='line'>root@arm:/sys/kernel/debug/pinctrl/44e10800.pinmux# PINS=/sys/kernel/debug/pinctrl/44e10800.pinmux/pins
</span><span class='line'>root@arm:/sys/kernel/debug/pinctrl/44e10800.pinmux# echo cape-bone-iio &gt; $SLOTS
</span><span class='line'>root@arm:/sys/kernel/debug/pinctrl/44e10800.pinmux# cat $SLOTS
</span><span class='line'> 0: 54:PF--- 
</span><span class='line'> 1: 55:PF--- 
</span><span class='line'> 2: 56:PF--- 
</span><span class='line'> 3: 57:PF--- 
</span><span class='line'> 4: ff:P-O-L Bone-LT-eMMC-2G,00A0,Texas Instrument,BB-BONE-EMMC-2G
</span><span class='line'> 5: ff:P-O-L Bone-Black-HDMI,00A0,Texas Instrument,BB-BONELT-HDMI
</span><span class='line'> 7: ff:P-O-L Override Board Name,00A0,Override Manuf,cape-bone-iio
</span><span class='line'>root@arm:/sys/kernel/debug/pinctrl/44e10800.pinmux# find /sys -name "*AIN*"
</span><span class='line'>/sys/devices/ocp.3/helper.15/AIN0
</span><span class='line'>/sys/devices/ocp.3/helper.15/AIN1
</span><span class='line'>/sys/devices/ocp.3/helper.15/AIN2
</span><span class='line'>/sys/devices/ocp.3/helper.15/AIN3
</span><span class='line'>/sys/devices/ocp.3/helper.15/AIN4
</span><span class='line'>/sys/devices/ocp.3/helper.15/AIN5
</span><span class='line'>/sys/devices/ocp.3/helper.15/AIN6
</span><span class='line'>/sys/devices/ocp.3/helper.15/AIN7
</span></code></pre></td></tr></table></div></figure>


<p>Now try to read the value out:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cd /sys/devices/ocp.3/helper.15
</span><span class='line'># ls
</span><span class='line'>AIN0  AIN1  AIN2  AIN3  AIN4  AIN5  AIN6  AIN7  driver  modalias  power  subsystem  uevent
</span><span class='line'># cat AIN5
</span><span class='line'>537
</span></code></pre></td></tr></table></div></figure>


<p>In the origin material it said should plus 1, to read AIN5 you have to look at AIN6, but it seems wrong, because the table and the interface all starts from 0.</p>

<p>AIN pins are sampled at 12bits and 100k samples per time. while the input voltage is between 0 and 1.8V.</p>

<p>It&rsquo;s very easy to use anlog read value for controlling some variables, like volumn, brightness, etc.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/13/ebc-exercises-on-bbb-control-led/">EBC Exercises on BBB - Control LED</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-13T16:09:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:09 pm</span></time>
        
         | <a href="/blog/2014/11/13/ebc-exercises-on-bbb-control-led/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Using Sysfs</h3>

<p>The easiest way to do general purpose I/O(gpio) on BBB is through the terminal and shell command.  sysfs is the virtual file system which exposes the drivers for the hardware so you can directly use them.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cd /sys/class/leds
</span><span class='line'># ls
</span><span class='line'># beaglebone:green:usr0  beaglebone:green:usr1  beaglebone:green:usr2  beaglebone:green:usr3
</span><span class='line'># cd beaglebone\:green\:usr0
</span><span class='line'># cat trigger 
</span><span class='line'>none nand-disk mmc0 mmc1 timer oneshot [heartbeat] backlight gpio cpu0 default-on transient 
</span></code></pre></td></tr></table></div></figure>


<p>If you want to disable the heartbeat:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># echo none &gt; trigger
</span><span class='line'># cat trigger 
</span><span class='line'>[none] nand-disk mmc0 mmc1 timer oneshot heartbeat backlight gpio cpu0 default-on transient 
</span></code></pre></td></tr></table></div></figure>


<p>Turn on/off the led via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># echo 1 &gt; brightness
</span><span class='line'># echo 0 &gt; brightness
</span></code></pre></td></tr></table></div></figure>


<p>More trigger options via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># echo timer&gt;trigger 
</span><span class='line'># cat trigger 
</span><span class='line'>none nand-disk mmc0 mmc1 [timer] oneshot heartbeat backlight gpio cpu0 default-on transient 
</span></code></pre></td></tr></table></div></figure>


<p>Set the deplay frequency:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo 100&gt;delay_on
</span><span class='line'>echo 900&gt;delay_off
</span></code></pre></td></tr></table></div></figure>


<h3>Adding Own LED</h3>

<p>Add the connection of LED.   <br/>
P9 Pin1 &ndash;> 220 ohm  &ndash;> LED Negative Pin
P9 Pin 12 -> Led Positive Pin</p>

<p>Pin 12 in the table is shown in table as GPIO1_28. Bank of 32 each, so find the gpio number via:      <br/>
1*32+28=60.</p>

<p>We have to turn this pin on.</p>

<h4>Turn it ON</h4>

<p>export/unexport, turn on/off of the LED via following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd /sys/class/gpio/
</span><span class='line'>$ echo 60 &gt; export
</span><span class='line'>$ cd gpio60/
</span><span class='line'>$ echo out &gt; direction
</span><span class='line'>$ echo 1 &gt; value
</span><span class='line'>$ echo 0 &gt; value
</span><span class='line'>$ cd ..
</span><span class='line'>$ ls
</span><span class='line'>export  gpio60  gpiochip0  gpiochip32  gpiochip64  gpiochip96  unexport
</span><span class='line'>$ echo 60 &gt; unexport
</span><span class='line'>$ ls -F
</span><span class='line'>export  gpiochip0@  gpiochip32@  gpiochip64@  gpiochip96@  unexport
</span></code></pre></td></tr></table></div></figure>


<h3>Add Own Key</h3>

<p>Connection for the key:  <br/>
P9 Pin 3(3.3V) &ndash;>220 ohm &ndash;> Key 1  <br/>
P9 Pin 42 &ndash;> Key 2  <br/>
Pin 42 is GPIO0_7, then the actual gpio number is Just 7.</p>

<h4>Read Value</h4>

<p>export/unexport, read value via following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cd /sys/class/gpio/
</span><span class='line'># echo 7 &gt; export
</span><span class='line'># cd gpio7/
</span><span class='line'># echo in &gt; direction
</span><span class='line'># cat value
</span><span class='line'># cat value 
</span><span class='line'>0
</span><span class='line'>Hold down the button and see the result: 
</span><span class='line'># cat value 
</span><span class='line'>1
</span></code></pre></td></tr></table></div></figure>


<p>
The script for reading the gpio value:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ./readgpio.sh 7
</span><span class='line'>sh: echo: I/O error
</span><span class='line'>trap: SIGINT: bad trap
</span><span class='line'>__________________________|^^^^^^^^^^^^^^^^^^^^^^^|__________|^^^^^^^^^^|___
</span><span class='line'>___|^^^^^^^|______|^^^^^^^|______|^^^^^^^|______|^^^^^^^|______|^^^^^^^|______|^^^^
</span><span class='line'>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^|____|^^^^^^^^|____|^^|__|^^|_|^^^^^^|___|^^
</span><span class='line'>|__|^|__|^|__|^|__|^^|___|^|_|^|___|^|_|^|_|^|_|^^|_|^|_|^|_|^^|_|^^^^^^^^^^^^^|______|^^^^^^^^^^^^^^^
</span><span class='line'>^^^^^^^^^^^^^^^^^^^^^^^^|____|^^^^^^^^^^^|_____|^^^^^^^^^^^^^^|____|^^^^^^^^^^
</span><span class='line'>^^^|___|^^^^^^^^^^^^|____|^^^^^^^^^^^^|__|^^^^^^^^^^|__|^^^^^^^^|__|^^^^^^^|___|^^^^
</span><span class='line'>^|_____|^^^^^|____|^^^^^^^^^^^^^^^^^^^^^^^|___|^^^^^^^^^^^^^^^^^|___|^^^^^^^^^^^
</span><span class='line'>|_^C
</span></code></pre></td></tr></table></div></figure>


<p>This seems like a little game.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/13/ebc-exercises-on-bbb/">EBC Exercises on BBB</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-13T09:29:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>9:29 am</span></time>
        
         | <a href="/blog/2014/11/13/ebc-exercises-on-bbb/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Tips on Building Kenrel</h3>

<p>Via following commands you could build the 3.8 kernel for BBB:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone git://github.com/RobertCNelson/linux-dev.git
</span><span class='line'>$ cd linux-dev
</span><span class='line'>$ git checkout origin/am33x-v3.8 -b am33x-v3.8
</span><span class='line'>$ time git clone git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git
</span><span class='line'>$ cp system.sh.sample system.sh
</span><span class='line'>$ diff system.sh*
</span><span class='line'>15c15
</span><span class='line'>&lt; CC=arm-linux-gnueabi-
</span><span class='line'>---
</span><span class='line'>&gt; #CC=arm-linux-gnueabi-
</span><span class='line'>21c21
</span><span class='line'>&lt; LINUX_GIT=~/BeagleBoard/linux-stable/
</span><span class='line'>---
</span><span class='line'>&gt; #LINUX_GIT=/home/user/linux-stable/
</span><span class='line'>31c31
</span><span class='line'>&lt; ZRELADDR=0x80008000
</span><span class='line'>---
</span><span class='line'>&gt; #ZRELADDR=0x80008000
</span><span class='line'>$ ./build_kernel.sh
</span></code></pre></td></tr></table></div></figure>


<h3>U-boot Cross-compile</h3>

<p>Download the U-boot and cross-compile it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># git clone git://git.denx.de/u-boot.git
</span><span class='line'># cd u-boot/
</span><span class='line'># git checkout v2013.07 -b tmp
</span><span class='line'># wget https://raw.github.com/eewiki/u-boot-patches/master/v2013.07/0001-am335x_evm-uEnv.txt-bootz-n-fixes.patch
</span><span class='line'># patch -p1 &lt; 0001-am335x_evm-uEnv.txt-bootz-n-fixes.patch
</span><span class='line'># setpogo # For setting my cross-compiler to arm-linux-gnueabi-
</span><span class='line'># export ARCH=arm
</span><span class='line'># export CROSS_COMPILE=arm-linux-gnueabi-
</span><span class='line'># make
</span></code></pre></td></tr></table></div></figure>


<p>After building you will get MLO and u-boot.img.</p>

<h3>Test on NFS</h3>

<p>Prepare the NFS File System.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir dtbs
</span><span class='line'>tar xzvf 3.8.13-bone53-dtbs.tar.gz -C ./dtbs
</span><span class='line'>cp dtbs/am335x-boneblack.dtb /srv/tftp/
</span><span class='line'>cp 3.8.13-bone53.zImage /srv/tftp/
</span><span class='line'>mkimage -A arm -O linux -T kernel -C none -a 0x80008000 -e 0x80008000 -n "Linux" -d /srv/tftp/3.8.13-bone53.zImage  /srv/tftp/uImage
</span><span class='line'>tar xJvf ubuntu-14.04-console-armhf-2014-08-13.tar.xz -C /srv/nfs4/
</span><span class='line'>cd /srv/nfs4/ubuntu-14.04-console-armhf-2014-08-13
</span><span class='line'>tar xvf armhf-rootfs-ubuntu-trusty.tar -C ../Ubuntu_fs/
</span><span class='line'>chmod 777 -R Ubuntu_fs/
</span></code></pre></td></tr></table></div></figure>


<p>Then boot the system from U-boot Via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>setenv ipaddr 192.168.1.16
</span><span class='line'>setenv serverip 192.168.1.221
</span><span class='line'>tftpboot ${fdtaddr} am335x-boneblack.dtb
</span><span class='line'>tftpboot ${kloadaddr} uImage
</span><span class='line'>setenv bootargs console=ttyO0,115200n8 root=/dev/nfs rootfstype=nfs rw nfsroot=192.168.1.221:/srv/nfs4/Ubuntu_fs ip=192.168.1.1 
</span><span class='line'>bootm ${kloadaddr} - ${fdtaddr}
</span></code></pre></td></tr></table></div></figure>


<p>Now boot the BBB and we got the ssh enabled, via ssh ubuntu@192.168.1.1, password is temppwd.</p>

<p>Sometimes you will meet sudo problem, just chown and chmod is OK</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># chmod 4755 some_related_file
</span><span class='line'># chown root some_related_file
</span></code></pre></td></tr></table></div></figure>


<p>
Since NFS gonna the write priviledge error, go back for SD card.</p>

<h3>SD Card</h3>

<p>FileSystem Preparation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ export DISK=/dev/mmcblk0
</span><span class='line'>$ dd if=/dev/zero of=${DISK} bs=1M count=10
</span><span class='line'>$ dd if=./u-boot/MLO of=${DISK} count=1 seek=1 conv=notrunc bs=128k
</span><span class='line'>$ dd if=./u-boot/u-boot.img of=${DISK} count=2 seek=1 conv=notrunc bs=384k
</span><span class='line'> sfdisk --in-order --Linux --unit M ${DISK} &lt;&lt;-__EOF__
</span><span class='line'>1,,0x83,*
</span><span class='line'>__EOF__
</span><span class='line'>$ mkfs.ext4 /dev/mmcblk0p1 -L rootfs
</span></code></pre></td></tr></table></div></figure>


<p>Copy the Operating system into the sd card partition 1, later we will use /mnt for mounting the partition 1:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># mount /dev/mmcblk0p1 /mnt
</span><span class='line'># cd ubuntu-14.04.1-console-armhf-2014-10-29
</span><span class='line'># tar xvf armhf-rootfs-ubuntu-trusty.tar -C /mnt/
</span><span class='line'># sync
</span></code></pre></td></tr></table></div></figure>


<p>Now install the kernel image into the ubuntu system. Imagine your SD is mount to /mnt/</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cp /media/y/embedded/BBB/EBC/3.8Kernel/linux-dev/deploy/3.8.13-bone53.zImage /mnt/boot/vmlinuz-3.8.13-bone53
</span><span class='line'>tar xzvf /media/y/embedded/BBB/EBC/3.8Kernel/linux-dev/deploy/3.8.13-bone53-dtbs.tar.gz -C /mnt/boot/dtbs/
</span></code></pre></td></tr></table></div></figure>


<p>Now create the following uEnv.txt located in /mnt/boot/ and /mnt/:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>##This will work with: Angstrom's 2013.06.20 u-boot.
</span><span class='line'> 
</span><span class='line'>loadaddr=0x82000000
</span><span class='line'>fdtaddr=0x88000000
</span><span class='line'>rdaddr=0x88080000
</span><span class='line'> 
</span><span class='line'>initrd_high=0xffffffff
</span><span class='line'>fdt_high=0xffffffff
</span><span class='line'>
</span><span class='line'>console=ttyO0,115200n8
</span><span class='line'>mmcroot=/dev/mmcblk0p1 ro
</span><span class='line'> 
</span><span class='line'>loadximage=load mmc 0:1 ${loadaddr} /boot/vmlinuz-3.8.13-bone53
</span><span class='line'>loadxfdt=load mmc 0:1 ${fdtaddr} /boot/dtbs/3.8.13-bone53/am335x-boneblack.dtb
</span><span class='line'>loadxrd=load mmc 0:1 ${rdaddr} /boot/initrd.img-${uname_r}; setenv rdsize ${filesize}
</span><span class='line'>loaduEnvtxt=load mmc 0:1 ${loadaddr} /boot/uEnv.txt ; env import -t ${loadaddr} ${filesize};
</span><span class='line'>loadall=run loaduEnvtxt; run loadximage; run loadxfdt;
</span><span class='line'> 
</span><span class='line'>mmcargs=setenv bootargs console=tty0 console=${console} ${optargs} ${cape_disable} ${cape_enable} root=${mmcroot} rootfstype=${mmcrootfstype} ${cmdline}
</span><span class='line'> 
</span><span class='line'>uenvcmd=run loadall; run mmcargs; bootz ${loadaddr} - ${fdtaddr};
</span><span class='line'>optargs="debug"
</span></code></pre></td></tr></table></div></figure>


<p>Enable the dhcp, /mnt/etc/network/interfaces:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>auto lo
</span><span class='line'>iface lo inet loopback
</span><span class='line'> 
</span><span class='line'>auto eth0
</span><span class='line'>iface eth0 inet dhcp
</span></code></pre></td></tr></table></div></figure>


<p>Enable the serial port:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo vim /mnt/etc/init/serial.conf
</span><span class='line'>start on stopped rc RUNLEVEL=[2345]
</span><span class='line'>stop on runlevel [!2345]
</span><span class='line'> 
</span><span class='line'>respawn
</span><span class='line'>exec /sbin/getty 115200 ttyO0
</span></code></pre></td></tr></table></div></figure>


<p>Now restart and you got the 3.8 kernel enabled, so next time if you want to change the kernel, simply change the uEnv.txt file is OK.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ubuntu@arm:/boot$ uname -a
</span><span class='line'>Linux arm 3.8.13-bone53 #1 SMP Tue Nov 11 18:40:19 CST 2014 armv7l armv7l armv7l GNU/Linux
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/12/server-performance/">Server Performance</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-12T12:28:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>12:28 pm</span></time>
        
         | <a href="/blog/2014/11/12/server-performance/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Get the UnixBench and run</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget http://byte-unixbench.googlecode.com/files/UnixBench5.1.3.tgz
</span><span class='line'>tar xvf UnixBench5.1.3.tgz 
</span><span class='line'>cd UnixBench
</span><span class='line'>./Run
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>Result:</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/26">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/24">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/12/15/yong-graphitecheng-xian-yan-zhou-kong-qi-zhi-liang/">用Graphite呈现广州空气质量</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/12/ba-wan-tl-sg108e/">把玩TL-SG108E</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/10/openvswitch-on-ubuntu14-dot-04/">OpenVswitch on Ubuntu14.04</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/08/tessera-how-to/">Tessera How-to</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/07/rundeck-tips/">Rundeck Tips</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
