
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="背景 最近在过一个《30天学习30种新技术》，过到第10天用Phonegap开发APP的时候，发现作者提供的API不可用，所以费心研究了一下Restful API, 顺利构建出了环境写完了那个APP，下面是一些摘要。 我用的Tutorial来自这里： http://blog. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/25">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//fonts.googleapis.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/03/yong-flaskda-jian-ni-zi-ji-de-restful-api/">用Flask搭建你自己的Restful API</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-03T16:35:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>4:35 pm</span></time>
        
         | <a href="/blog/2014/12/03/yong-flaskda-jian-ni-zi-ji-de-restful-api/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>背景</h3>

<p>最近在过一个《30天学习30种新技术》，过到第10天用Phonegap开发APP的时候，发现作者提供的API不可用，所以费心研究了一下Restful API, 顺利构建出了环境写完了那个APP，下面是一些摘要。  <br/>
我用的Tutorial来自这里：  <br/>
<a href="http://blog.miguelgrinberg.com/post/designing-a-restful-api-with-python-and-flask">http://blog.miguelgrinberg.com/post/designing-a-restful-api-with-python-and-flask</a>   <br/>
开发环境是ArchLinux.</p>

<h3>Hello Flask</h3>

<p>原Tutorial中给出的是一个关于todo-list的实现，我们从最简单的"Hello Flask"开始：  <br/>
首先安装python虚拟环境和flask，注意因为Arch默认的python版本是3，所以这里我们使用了virtualenv2来创建python虚拟运行环境。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir todo-api
</span><span class='line'>$ cd todo-api
</span><span class='line'>$ virtualenv2 flask
</span><span class='line'>$ source flask/bin/activate
</span><span class='line'>(flask) $ pip install flask
</span></code></pre></td></tr></table></div></figure>


<p>在当前目录下建立<code>app.py</code>文件， 输入以下内容：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="c">#!flask/bin/python</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
</span><span class='line'>
</span><span class='line'><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="s">&quot;Hello, Flask!&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在改变文件属性，运行之:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="err">$</span> <span class="n">chmod</span> <span class="n">a</span><span class="o">+</span><span class="n">x</span> <span class="n">app</span><span class="o">.</span><span class="n">py</span>
</span><span class='line'><span class="err">$</span> <span class="o">./</span><span class="n">app</span><span class="o">.</span><span class="n">py</span>
</span></code></pre></td></tr></table></div></figure>


<p>打开浏览器访问<code>http://127.0.0.1:5000</code>,，我们可以看到Hello Flask已经出现在浏览器里了。</p>

<h3>实现最简单的Restful API</h3>

<p>Flask本身支持很多插件，可以用于实现Restful API，由于我们这里只是做DEMO使用，需求比较简单，我们抛弃那些繁琐的插件，手动来写。  <br/>
这里我们也不会引入数据库等内容，我们将task任务列表直接保存在内存中，所以一旦断电这些数据就将消失。在实际的生产环境中，我们是需要引入不同的数据库来存储这些数据的。   <br/>
在上面生成的<code>app.py</code>中添加以下内容:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="c">#!flask/bin/python</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>
</span><span class='line'>
</span><span class='line'><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">u&#39;Buy groceries&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">u&#39;Milk, Cheese, Pizza, Fruit, Tylenol&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;done&#39;</span><span class="p">:</span> <span class="bp">False</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">u&#39;Learn Python&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">u&#39;Need to find a good Python tutorial on the web&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;done&#39;</span><span class="p">:</span> <span class="bp">False</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/todo/api/v1.0/tasks&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">get_tasks</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;tasks&#39;</span><span class="p">:</span> <span class="n">tasks</span><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在打开终端，用curl就可以访问到我们新添加的API了:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>curl -i http://127.0.0.1:5000/todo/api/v1.0/tasks
</span><span class='line'>HTTP/1.0 <span class="m">200</span> OK
</span><span class='line'>Content-Type: application/json
</span><span class='line'>Content-Length: 316
</span><span class='line'>Server: Werkzeug/0.9.6 Python/2.7.8
</span><span class='line'>Date: Wed, <span class="m">03</span> Dec <span class="m">2014</span> 08:59:55 GMT
</span><span class='line'>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  <span class="s2">&quot;tasks&quot;</span>: <span class="o">[</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="s2">&quot;description&quot;</span>: <span class="s2">&quot;Milk, Cheese, Pizza, Fruit, Tylenol&quot;</span>,
</span><span class='line'>      <span class="s2">&quot;done&quot;</span>: <span class="nb">false</span>,
</span><span class='line'>      <span class="s2">&quot;id&quot;</span>: 1,
</span><span class='line'>      <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;Buy groceries&quot;</span>
</span><span class='line'>    <span class="o">}</span>,
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="s2">&quot;description&quot;</span>: <span class="s2">&quot;Need to find a good Python tutorial on the web&quot;</span>,
</span><span class='line'>      <span class="s2">&quot;done&quot;</span>: <span class="nb">false</span>,
</span><span class='line'>      <span class="s2">&quot;id&quot;</span>: 2,
</span><span class='line'>      <span class="s2">&quot;title&quot;</span>: <span class="s2">&quot;Learn Python&quot;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">]</span>
</span><span class='line'><span class="o">}</span>%
</span></code></pre></td></tr></table></div></figure>


<p>第一个Restful的API就这样创建成功了。</p>

<h3>添加第二个RESTful API</h3>

<p>我们接着来添加第二个RESTful API, 加入下列代码到已有的<code>app.py</code>中:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">abort</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/todo/api/v1.0/tasks/&lt;int:task_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
</span><span class='line'><span class="k">def</span> <span class="nf">get_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">):</span>
</span><span class='line'>    <span class="n">task</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">task_id</span><span class="p">,</span> <span class="n">tasks</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">task</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>        <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;task&#39;</span><span class="p">:</span> <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在用curl来测试，结果应该是这样的:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="p">(</span><span class="n">flask</span><span class="p">)[</span><span class="n">Trusty</span><span class="err">@</span><span class="o">~/</span><span class="n">code</span><span class="o">/</span><span class="mi">30</span><span class="n">days</span><span class="o">/</span><span class="n">todo</span><span class="o">-</span><span class="n">api</span><span class="p">]</span><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span><span class="o">/</span><span class="mi">2</span>
</span><span class='line'><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">151</span>
</span><span class='line'><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">0.9</span><span class="o">.</span><span class="mi">6</span> <span class="n">Python</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">8</span>
</span><span class='line'><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mo">03</span> <span class="n">Dec</span> <span class="mi">2014</span> <span class="mi">09</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">25</span> <span class="n">GMT</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;task&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;Need to find a good Python tutorial on the web&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;done&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Learn Python&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="o">%</span>                                                                                                                                                   <span class="p">(</span><span class="n">flask</span><span class="p">)[</span><span class="n">Trusty</span><span class="err">@</span><span class="o">~/</span><span class="n">code</span><span class="o">/</span><span class="mi">30</span><span class="n">days</span><span class="o">/</span><span class="n">todo</span><span class="o">-</span><span class="n">api</span><span class="p">]</span><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span><span class="o">/</span><span class="mi">3</span>
</span><span class='line'><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">404</span> <span class="n">NOT</span> <span class="n">FOUND</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">233</span>
</span><span class='line'><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">0.9</span><span class="o">.</span><span class="mi">6</span> <span class="n">Python</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">8</span>
</span><span class='line'><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mo">03</span> <span class="n">Dec</span> <span class="mi">2014</span> <span class="mi">09</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">27</span> <span class="n">GMT</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">HTML</span> <span class="n">PUBLIC</span> <span class="s">&quot;-//W3C//DTD HTML 3.2 Final//EN&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="mi">404</span> <span class="n">Not</span> <span class="n">Found</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Not</span> <span class="n">Found</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">The</span> <span class="n">requested</span> <span class="n">URL</span> <span class="n">was</span> <span class="ow">not</span> <span class="n">found</span> <span class="n">on</span> <span class="n">the</span> <span class="n">server</span><span class="o">.</span>  <span class="n">If</span> <span class="n">you</span> <span class="n">entered</span> <span class="n">the</span> <span class="n">URL</span> <span class="n">manually</span> <span class="n">please</span> <span class="n">check</span> <span class="n">your</span> <span class="n">spelling</span> <span class="ow">and</span> <span class="k">try</span> <span class="n">again</span><span class="o">.&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>由于我们引用了abort方法，所以当我们给出的task id错误时，将弹出404错误。</p>

<h3>错误提示JSON化</h3>

<p>通过引入<code>make_response</code>模块我们可以把404返回错误JSON化，添加以下代码到app.py中：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">make_response</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@app.errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">not_found</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">make_response</span><span class="p">(</span><span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;error&#39;</span><span class="p">:</span> <span class="s">&#39;Not found&#39;</span><span class="p">}),</span> <span class="mi">404</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在访问一个不存在的task id将返回如下结果：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="p">(</span><span class="n">flask</span><span class="p">)[</span><span class="n">Trusty</span><span class="err">@</span><span class="o">~/</span><span class="n">code</span><span class="o">/</span><span class="mi">30</span><span class="n">days</span><span class="o">/</span><span class="n">todo</span><span class="o">-</span><span class="n">api</span><span class="p">]</span><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span><span class="o">/</span><span class="mi">3</span>
</span><span class='line'><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">404</span> <span class="n">NOT</span> <span class="n">FOUND</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">26</span>
</span><span class='line'><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">0.9</span><span class="o">.</span><span class="mi">6</span> <span class="n">Python</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">8</span>
</span><span class='line'><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mo">03</span> <span class="n">Dec</span> <span class="mi">2014</span> <span class="mi">09</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">50</span> <span class="n">GMT</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;error&quot;</span><span class="p">:</span> <span class="s">&quot;Not found&quot;</span>
</span><span class='line'><span class="p">}</span><span class="o">%</span>
</span></code></pre></td></tr></table></div></figure>


<h3>实现POST方法</h3>

<p>添加以下代码以实现POST方法:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/todo/api/v1.0/tasks&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;POST&#39;</span><span class="p">])</span>
</span><span class='line'><span class="k">def</span> <span class="nf">create_task</span><span class="p">():</span>
</span><span class='line'>    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">or</span> <span class="ow">not</span> <span class="s">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">:</span>
</span><span class='line'>        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
</span><span class='line'>    <span class="n">task</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="n">tasks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">],</span>
</span><span class='line'>        <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
</span><span class='line'>        <span class="s">&#39;done&#39;</span><span class="p">:</span> <span class="bp">False</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;task&#39;</span><span class="p">:</span> <span class="n">task</span><span class="p">}),</span> <span class="mi">201</span>
</span></code></pre></td></tr></table></div></figure>


<p>用curl测试的结果如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="p">(</span><span class="n">flask</span><span class="p">)[</span><span class="n">Trusty</span><span class="err">@</span><span class="o">~/</span><span class="n">code</span><span class="o">/</span><span class="mi">30</span><span class="n">days</span><span class="o">/</span><span class="n">todo</span><span class="o">-</span><span class="n">api</span><span class="p">]</span><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">H</span> <span class="s">&quot;Content-Type: application/json&quot;</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="o">-</span><span class="n">d</span> <span class="s">&#39;{&quot;title&quot;:&quot;Read a book&quot;}&#39;</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span>
</span><span class='line'><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">201</span> <span class="n">CREATED</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">104</span>
</span><span class='line'><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">0.9</span><span class="o">.</span><span class="mi">6</span> <span class="n">Python</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">8</span>
</span><span class='line'><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mo">03</span> <span class="n">Dec</span> <span class="mi">2014</span> <span class="mi">09</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">55</span> <span class="n">GMT</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;task&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;done&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Read a book&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="o">%</span>
</span><span class='line'> <span class="p">(</span><span class="n">flask</span><span class="p">)[</span><span class="n">Trusty</span><span class="err">@</span><span class="o">~/</span><span class="n">code</span><span class="o">/</span><span class="mi">30</span><span class="n">days</span><span class="o">/</span><span class="n">todo</span><span class="o">-</span><span class="n">api</span><span class="p">]</span><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span>
</span><span class='line'><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">423</span>
</span><span class='line'><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">0.9</span><span class="o">.</span><span class="mi">6</span> <span class="n">Python</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">8</span>
</span><span class='line'><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mo">03</span> <span class="n">Dec</span> <span class="mi">2014</span> <span class="mi">09</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">24</span> <span class="n">GMT</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;tasks&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;Milk, Cheese, Pizza, Fruit, Tylenol&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;done&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Buy groceries&quot;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;Need to find a good Python tutorial on the web&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;done&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Learn Python&quot;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;done&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Read a book&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">]</span>
</span><span class='line'><span class="p">}</span><span class="o">%</span>
</span></code></pre></td></tr></table></div></figure>


<p>从上面的测试中我们可以看到一个新的任务被添加到了task列表中。</p>

<h3>最后两个RESTful API</h3>

<p>最后的两个RESTful API代码如下:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/todo/api/v1.0/tasks/&lt;int:task_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;PUT&#39;</span><span class="p">])</span>
</span><span class='line'><span class="k">def</span> <span class="nf">update_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">):</span>
</span><span class='line'>    <span class="n">task</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">task_id</span><span class="p">,</span> <span class="n">tasks</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">task</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>        <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">:</span>
</span><span class='line'>        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="s">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">unicode</span><span class="p">:</span>
</span><span class='line'>        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="s">&#39;description&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;description&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">unicode</span><span class="p">:</span>
</span><span class='line'>        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="s">&#39;done&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;done&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">:</span>
</span><span class='line'>        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
</span><span class='line'>    <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;title&#39;</span><span class="p">])</span>
</span><span class='line'>    <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;description&#39;</span><span class="p">])</span>
</span><span class='line'>    <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;done&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;done&#39;</span><span class="p">,</span> <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;done&#39;</span><span class="p">])</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;task&#39;</span><span class="p">:</span> <span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/todo/api/v1.0/tasks/&lt;int:task_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;DELETE&#39;</span><span class="p">])</span>
</span><span class='line'><span class="k">def</span> <span class="nf">delete_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">):</span>
</span><span class='line'>    <span class="n">task</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">task_id</span><span class="p">,</span> <span class="n">tasks</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">task</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>        <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</span><span class='line'>    <span class="n">tasks</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;result&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>测试代码如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">H</span> <span class="s">&quot;Content-Type: application/json&quot;</span> <span class="o">-</span><span class="n">X</span> <span class="n">PUT</span> <span class="o">-</span><span class="n">d</span> <span class="s">&#39;{&quot;done&quot;:true}&#39;</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span><span class="o">/</span><span class="mi">2</span>
</span></code></pre></td></tr></table></div></figure>


<p>运行上面的命令可以将第2条记录里的done字段由false改成true.</p>

<h3>改进接口</h3>

<p>加入以下代码后，我们调用tasks方法将不再返回id,而是返回URIs，这样取回来就能用了。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">url_for</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">make_public_task</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
</span><span class='line'>    <span class="n">new_task</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">task</span><span class="p">:</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">field</span> <span class="o">==</span> <span class="s">&#39;id&#39;</span><span class="p">:</span>
</span><span class='line'>            <span class="n">new_task</span><span class="p">[</span><span class="s">&#39;uri&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s">&#39;get_task&#39;</span><span class="p">,</span> <span class="n">task_id</span><span class="o">=</span><span class="n">task</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">_external</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">new_task</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="n">field</span><span class="p">]</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">new_task</span>
</span></code></pre></td></tr></table></div></figure>


<p>同时我们重写以下方法:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/todo/api/v1.0/tasks&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
</span><span class='line'><span class="k">def</span> <span class="nf">get_tasks</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;tasks&#39;</span><span class="p">:</span> <span class="nb">map</span><span class="p">(</span><span class="n">make_public_task</span><span class="p">,</span> <span class="n">tasks</span><span class="p">)})</span>
</span></code></pre></td></tr></table></div></figure>


<p>测试结果如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span>
</span><span class='line'><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">406</span>
</span><span class='line'><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">0.9</span><span class="o">.</span><span class="mi">6</span> <span class="n">Python</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">8</span>
</span><span class='line'><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mo">03</span> <span class="n">Dec</span> <span class="mi">2014</span> <span class="mi">09</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mi">12</span> <span class="n">GMT</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;tasks&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;Milk, Cheese, Pizza, Fruit, Tylenol&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;done&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Buy groceries&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;uri&quot;</span><span class="p">:</span> <span class="s">&quot;http://127.0.0.1:5000/todo/api/v1.0/tasks/1&quot;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;Need to find a good Python tutorial on the web&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;done&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Learn Python&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;uri&quot;</span><span class="p">:</span> <span class="s">&quot;http://127.0.0.1:5000/todo/api/v1.0/tasks/2&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">]</span>
</span><span class='line'><span class="p">}</span><span class="o">%</span>
</span></code></pre></td></tr></table></div></figure>


<h3>加密RESTful网络接口</h3>

<p>好了，我们的RESTful接口搭建完毕了，但是由于接口对所有人都是开放的，为了考虑安全因素，我们会采用简单加密。   <br/>
首先安装flask-httpauth模块:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="err">$</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">flask</span><span class="o">-</span><span class="n">httpauth</span>
</span></code></pre></td></tr></table></div></figure>


<p>而后添加以下代码：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="kn">from</span> <span class="nn">flask.ext.httpauth</span> <span class="kn">import</span> <span class="n">HTTPBasicAuth</span>
</span><span class='line'><span class="n">auth</span> <span class="o">=</span> <span class="n">HTTPBasicAuth</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@auth.get_password</span>
</span><span class='line'><span class="k">def</span> <span class="nf">get_password</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">username</span> <span class="o">==</span> <span class="s">&#39;miguel&#39;</span><span class="p">:</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&#39;python&#39;</span>
</span><span class='line'>    <span class="k">return</span> <span class="bp">None</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@auth.error_handler</span>
</span><span class='line'><span class="k">def</span> <span class="nf">unauthorized</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">make_response</span><span class="p">(</span><span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;error&#39;</span><span class="p">:</span> <span class="s">&#39;Unauthorized access&#39;</span><span class="p">}),</span> <span class="mi">401</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>加密路由实现如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/todo/api/v1.0/tasks&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
</span><span class='line'><span class="nd">@auth.login_required</span>
</span><span class='line'><span class="k">def</span> <span class="nf">get_tasks</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;tasks&#39;</span><span class="p">:</span> <span class="n">tasks</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>测试结果如下, 未通过授权时:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">i</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span>
</span><span class='line'><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">401</span> <span class="n">UNAUTHORIZED</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">36</span>
</span><span class='line'><span class="n">WWW</span><span class="o">-</span><span class="n">Authenticate</span><span class="p">:</span> <span class="n">Basic</span> <span class="n">realm</span><span class="o">=</span><span class="s">&quot;Authentication Required&quot;</span>
</span><span class='line'><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">0.9</span><span class="o">.</span><span class="mi">6</span> <span class="n">Python</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">8</span>
</span><span class='line'><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mo">03</span> <span class="n">Dec</span> <span class="mi">2014</span> <span class="mi">09</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mo">02</span> <span class="n">GMT</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;error&quot;</span><span class="p">:</span> <span class="s">&quot;Unauthorized access&quot;</span>
</span><span class='line'><span class="p">}</span><span class="o">%</span>
</span></code></pre></td></tr></table></div></figure>


<p>通过授权时:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="err">$</span> <span class="n">curl</span> <span class="o">-</span><span class="n">u</span> <span class="n">miguel</span><span class="p">:</span><span class="n">python</span> <span class="o">-</span><span class="n">i</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">todo</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">tasks</span>
</span><span class='line'><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
</span><span class='line'><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">406</span>
</span><span class='line'><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">0.9</span><span class="o">.</span><span class="mi">6</span> <span class="n">Python</span><span class="o">/</span><span class="mf">2.7</span><span class="o">.</span><span class="mi">8</span>
</span><span class='line'><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mo">03</span> <span class="n">Dec</span> <span class="mi">2014</span> <span class="mi">09</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">24</span> <span class="n">GMT</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s">&quot;tasks&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;Milk, Cheese, Pizza, Fruit, Tylenol&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;done&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Buy groceries&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;uri&quot;</span><span class="p">:</span> <span class="s">&quot;http://localhost:5000/todo/api/v1.0/tasks/1&quot;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'><span class="o">.....</span>
</span></code></pre></td></tr></table></div></figure>


<p>我们可以把出错时返回的错误号从401改变为403,这样返回的就是forbidden错误。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/03/enable-timestamp-in-new-octopress-theme/">Enable Timestamp in New Octopress Theme</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-03T10:40:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>10:40 am</span></time>
        
         | <a href="/blog/2014/12/03/enable-timestamp-in-new-octopress-theme/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>After installing the flattern theme of octopress, I found the post date missed. Following is the steps for catching it back.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake install['flatten']
</span></code></pre></td></tr></table></div></figure>


<p>Modify the following file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat .themes/flatten/source/_includes/post/date.html
</span></code></pre></td></tr></table></div></figure>


<p>Then in <code>.themes/flatten/source/_layouts/post.html</code>, modify the following lines:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;p class="meta"&gt;
</span><span class='line'>//.....//
</span><span class='line'>&lt;/p&gt;
</span></code></pre></td></tr></table></div></figure>


<p>After modification, you would see the time is displayed before the comment numbers.  <br/>
Notice, the modification is not visible in codeblocks because the embedded symbol could not be resolved thus will cause build error, so the detailed code would be only fetched from my github repository but remains blank codeblocks here in this article.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/01/virtual-node-environment-for-phonegap-development/">Virtual Node Environment for PhoneGap Development</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-01T12:18:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2014</span></span> <span class='time'>12:18 pm</span></time>
        
         | <a href="/blog/2014/12/01/virtual-node-environment-for-phonegap-development/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Background</h3>

<p>I met some tutorials which were write one or two years ago, while at that time the corresponding plugins are in an old version, so I need to find a whole &ldquo;virtual&rdquo; environment for developing these tutorials.</p>

<h3>Install Nodeenv</h3>

<p>&ldquo;Node.js virtual environment builder&rdquo; &mdash; is the introduction for Nodeenv.  <br/>
Install it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ virtualenv2 venv
</span><span class='line'>source venv/bin/activate
</span><span class='line'>(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ 
</span><span class='line'>$ pip install nodeenv
</span><span class='line'>(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ which nodeenv
</span><span class='line'>/home/Trusty/code/30days/PhoneGap2.9.0/venv/bin/nodeenv
</span><span class='line'>(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ nodeenv --version
</span><span class='line'>0.11.1
</span></code></pre></td></tr></table></div></figure>


<p>With this nodeenv we could setup all kinds of the dev environments.</p>

<h3>Wrok With Nodeenv</h3>

<p>Install the node.js first, this may cause long time:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ nodeenv nodeenv 
</span><span class='line'> * Install node.js (0.10.33 
</span><span class='line'>[Trusty@~/code/30days/PhoneGap2.9.0]$ du -hs *
</span><span class='line'>170M    nodeenv
</span><span class='line'>8.9M    venv
</span><span class='line'>(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ ls
</span><span class='line'>nodeenv  npm-debug.log  venv
</span><span class='line'>(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ . nodeenv/bin/activate 
</span><span class='line'>(nodeenv)(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ which npm
</span><span class='line'>/home/Trusty/code/30days/PhoneGap2.9.0/nodeenv/bin/npm
</span><span class='line'>(nodeenv)(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ which node
</span><span class='line'>/home/Trusty/code/30days/PhoneGap2.9.0/nodeenv/bin/node
</span></code></pre></td></tr></table></div></figure>


<p>Now we could install the specified version of PhoneGap, first we should find the specified versions:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ npm view phonegap
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>This will returns the specified versions of all of the phonegap.   <br/>
Choose whichever you want.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ npm install phonegap@2.9.0-rc1-0.12.2
</span></code></pre></td></tr></table></div></figure>


<p>This will install the phonegap around Dec,2013, which should be fit well to the tutorial.      <br/>
Then re-activate , or manually modify the PATH as:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ export PATH=/home/Trusty/code/30days/PhoneGap2.9.0/nodeenv/bin:$PATH
</span><span class='line'>(nodeenv)(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ phonegap -v
</span><span class='line'>2.9.0-rc1-0.12.2
</span></code></pre></td></tr></table></div></figure>


<h3>Run Tutorial</h3>

<h4>Create Apps</h4>

<p>Create the app via following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(nodeenv)(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ npm config set https_proxy http://1xx.x.xx.xxx:2xxxx
</span><span class='line'>(nodeenv)(venv)[Trusty@~/code/30days/PhoneGap2.9.0]$ npm config set proxy http://1xx.x.xx.xxx:2xxx
</span><span class='line'>$ phonegap create audero-feed-reade com.audero.free.utility.auderofeedreader "Audero Feed Reader"
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/28/setup-dev-env-on-do/">Setup Dev Env on DO</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-28T10:14:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:14 am</span></time>
        
         | <a href="/blog/2014/11/28/setup-dev-env-on-do/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Prepare</h3>

<p>Install the following packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install python-virtualenv
</span><span class='line'>$ sudo apt-get install ruby-full ruby
</span><span class='line'>$ sudo gem install rhc
</span></code></pre></td></tr></table></div></figure>


<p>Since DO&rsquo;s network is pretty good, so it&rsquo;s very swift for developing on it.</p>

<h3>TextBlob</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ virtualenv venv --python=python2.7
</span><span class='line'>$ . venv/bin/activate
</span><span class='line'>$ pip install textblob
</span><span class='line'>$ python -m textblob.download_corpora
</span><span class='line'>$ pip install flask
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/27/apache-parameter-adjust/">Apache Parameter Adjust</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-27T21:46:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>9:46 pm</span></time>
        
         | <a href="/blog/2014/11/27/apache-parameter-adjust/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Background</h3>

<p>A wordpress machine runs on DigitalOcean often sudden the mysqld database lost error.</p>

<h3>Analyze</h3>

<p>This is because the memory is exhausted in DO, so first I enable the swap for machine. This method solved the problem for a long time.   <br/>
But later it seems the robots who sent the rubbish comments continue to attack the system, causing the mysqld halt again, this time, I modified the apahce2&rsquo;s works:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ grep -Ri MaxRequestWorkers /etc/apache2/
</span><span class='line'>/etc/apache2/mods-enabled/mpm_prefork.conf:# MaxRequestWorkers: maximum number of server processes allowed to start
</span><span class='line'>/etc/apache2/mods-enabled/mpm_prefork.conf:     MaxRequestWorkers         150
</span><span class='line'>/etc/apache2/mods-available/mpm_prefork.conf:# MaxRequestWorkers: maximum number of server processes allowed to start
</span><span class='line'>/etc/apache2/mods-available/mpm_prefork.conf:   MaxRequestWorkers         150
</span><span class='line'>$ vim /etc/apache2/mods-available/mpm_prefork.conf
</span><span class='line'>$ vim /etc/apache2/mods-available/mpm_worker.conf
</span><span class='line'>$ vim /etc/apache2/mods-available/mpm_itk.conf
</span><span class='line'>$ vim /etc/apache2/mods-available/mpm_event.conf
</span><span class='line'>$ service apache2 restart
</span></code></pre></td></tr></table></div></figure>


<p>The vim command is changing the MaxRequestWorkers from 150 to 10, hope this will solve the problem.</p>

<h3>TBD</h3>

<p>If the mysql runs into death again, then we must limit its connection towards apache2.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/27/tips-on-30days30skills-4/">Tips on 30Days30Skills(4)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-27T16:49:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:49 pm</span></time>
        
         | <a href="/blog/2014/11/27/tips-on-30days30skills-4/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Day 9 - TextBlob</h3>

<p>Installation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Yosemite:TextBlob Trusty$ mkdir myapp
</span><span class='line'>Yosemite:TextBlob Trusty$ cd myapp/
</span><span class='line'>Yosemite:myapp Trusty$ virtualenv venv --python=python2.7
</span><span class='line'>Running virtualenv with interpreter /usr/bin/python2.7
</span><span class='line'>New python executable in venv/bin/python
</span><span class='line'>Installing setuptools, pip...done.
</span><span class='line'>Yosemite:myapp Trusty$ . venv/bin/activate
</span><span class='line'>(venv)Yosemite:myapp Trusty$ pip install textblob
</span><span class='line'>$ pip install -U textblob
</span><span class='line'>$ python -m textblob.download_corpora
</span></code></pre></td></tr></table></div></figure>


<p>After adding the textblob, create flask:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pip install flask
</span><span class='line'>$ vim app.py
</span><span class='line'>$ mkdir templates
</span><span class='line'>$ touch templates/index.html
</span></code></pre></td></tr></table></div></figure>


<p>Modify the app.py for listening on all of the ip addresses:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>if __name__ == "__main__":
</span><span class='line'>    app.run(host='0.0.0.0',debug=True)
</span></code></pre></td></tr></table></div></figure>


<p>Then <code>python app.py</code> could get you to the website and run your apps.</p>

<p>The analyze code is listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>        $.get('/api/v1/sentiment/'+input,function(result){
</span><span class='line'>
</span><span class='line'>            if(result.polarity &lt; 0.0){
</span><span class='line'>
</span><span class='line'>                $('#result').addClass("alert alert-danger")   .text(input);
</span><span class='line'>            } else if( result.polarity &gt;= 0.0 && result.polarity &lt;= 0.5){
</span><span class='line'>                $('#result').addClass("alert alert-warning").text(input);
</span><span class='line'>            }else{
</span><span class='line'>                $('#result').addClass("alert alert-success").text(input);
</span><span class='line'>            }
</span><span class='line'>
</span><span class='line'>        })
</span></code></pre></td></tr></table></div></figure>


<p>You could easily update the apps to your rhc.</p>

<h3>Day 10 - PhoneGap</h3>

<h4>Android</h4>

<p>Install steps:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo npm install -g phonegap
</span><span class='line'>$ sudo npm install -g cordova
</span><span class='line'>$ phonegap create reader --id io.reader --name Reader30
</span><span class='line'>$ sudo android
</span></code></pre></td></tr></table></div></figure>


<p><code>sudo android</code> is for installing the android SDK, we have to select revision 19 for phonegap currently support 19.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cordova platform add android
</span><span class='line'>$ sudo pacman -S apache-ant
</span><span class='line'>$ phonegap run android
</span></code></pre></td></tr></table></div></figure>


<p>Now you could see a screen which displayed &ldquo;Device Ready&rdquo;.   <br/>
Install some plugins for accessing the equipment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cordova plugin add org.apache.cordova.geolocation
</span><span class='line'>cordova plugin add org.apache.cordova.dialogs
</span></code></pre></td></tr></table></div></figure>


<p>Edit steps:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vim www/index.html     # Add front page
</span><span class='line'>$ rm -f www/js/index.js
</span><span class='line'>$ cp -r ../example/30technologies30days-mobile-app/www/js/vendor ./www/js
</span><span class='line'>$ cp -r ../example/30technologies30days-mobile-app/www/css/vendor ./www/css
</span><span class='line'>$ vim www/js/app.js
</span><span class='line'>$ vim www/index.html  # Add form
</span><span class='line'>$ vim www/js/app.js
</span></code></pre></td></tr></table></div></figure>


<p>Now run <code>phonegap run android</code> you could see the app runs on your android emulator.</p>

<h4>IOS</h4>

<p>In ios, we could use following command for installing the ios specified resources.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(venv)Yosemite:PhoneGap Trusty$ cd reader/
</span><span class='line'>(venv)Yosemite:reader Trusty$ cordova platform add ios
</span><span class='line'>$ sudo npm install -g ios-deploy
</span><span class='line'>$ sudo npm install -g ios-sim
</span><span class='line'>$ phonegap run ios
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/27/tips-on-30days30skills-3/">Tips on 30Days30Skills(3)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-27T15:46:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>3:46 pm</span></time>
        
         | <a href="/blog/2014/11/27/tips-on-30days30skills-3/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Day 7 - GruntJS(2)</h3>

<h4>GruntJS Markdown Plugin</h4>

<p>First download the source file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/shekhargulati/day7-gruntjs-livereload-example.git
</span><span class='line'>$ cd day7-gruntjs-livereload-example
</span><span class='line'>$ sudo npm install -g grunt
</span><span class='line'>$ grunt $ cd day7-gruntjs-livereload-example
</span><span class='line'>$ sudo npm install -g grunt
</span><span class='line'>$ npm init
</span><span class='line'>$ npm install grunt
</span><span class='line'>$ sudo npm install grunt-contrib-uglify grunt-markdown grunt-contrib-watch -g
</span><span class='line'>$ grunt
</span><span class='line'>&gt;&gt; Local Npm module "grunt-contrib-watch" not found. Is it installed?
</span><span class='line'>
</span><span class='line'>Running "uglify:build" (uglify) task
</span><span class='line'>&gt;&gt; 1 file created.
</span><span class='line'>
</span><span class='line'>Running "markdown:all" (markdown) task
</span><span class='line'>File "docs/html/day1.html" created.
</span><span class='line'>
</span><span class='line'>Done, without errors.
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div id="main" class="container"&gt;
</span><span class='line'>  &lt;%=content%&gt;
</span><span class='line'>&lt;/div&gt;
</span></code></pre></td></tr></table></div></figure>


<p>After grunt, the generated html file is listed as :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div id="main" class="container"&gt;
</span><span class='line'>  &lt;p&gt;Today is the fourth day of my challenge to learn 30 technologies in 30 days. So far I am enjoying it and getting good response from fellow developers. I am more than motivated to do it for full 30 days. In this blog, I will cover how we can very easily build b
</span><span class='line'>.....
</span><span class='line'>&lt;/div&gt;
</span></code></pre></td></tr></table></div></figure>


<h4>grunt-contrib-watch</h4>

<p>Following command will install grunt-contrib-watch and update the package.json:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ npm install grunt-contrib-watch --save-dev
</span></code></pre></td></tr></table></div></figure>


<p>Add following code into grunt&rsquo;s initConfig method, these code ensure that if file changes, grunt will run uglify and markdown task:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>watch :{
</span><span class='line'>    scripts :{
</span><span class='line'>      files : ['js/app.js','*.md','css/*.css'],
</span><span class='line'>      tasks : ['uglify','markdown']
</span><span class='line'>    }
</span><span class='line'>  }
</span></code></pre></td></tr></table></div></figure>


<p>Add following line to Gruntfile for watch task:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grunt.loadNpmTasks('grunt-contrib-watch');
</span></code></pre></td></tr></table></div></figure>


<p>Now run <code>grunt watch</code>, then modify some files, like <code>app.js</code> under <code>js</code> folder, then detect if the generated files are modified or not.</p>

<p>Now run <code>grunt watch</code>, then modify some files, like <code>app.js</code> under <code>js</code> folder, then detect if the generated files are modified or not.</p>

<h4>livereload</h4>

<p>Edit the watch&rsquo;s configuration, enable the livereload, this will enable the service in 35729 port. Or you could modify the service port by yourself.  <br/>
Add content into the templates/index.html:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;script src="http://localhost:9090/livereload.js"&gt;&lt;/script&gt;
</span></code></pre></td></tr></table></div></figure>


<p>
Now every single modification will let you see the final result immediately.</p>

<h3>Day 8 Harp.JS</h3>

<p>Install the Harp.JS via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo npm install -g harp
</span></code></pre></td></tr></table></div></figure>


<p>Then initiate the blog via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ harp init blog
</span></code></pre></td></tr></table></div></figure>


<p>This step won&rsquo;t be continue because the program will complain that <code>Template not found</code>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/26/tips-on-30days30skills-2/">Tips on 30Days30Skills(2)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-26T16:46:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:46 pm</span></time>
        
         | <a href="/blog/2014/11/26/tips-on-30days30skills-2/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Day 5 - GruntJS</h3>

<p>Install via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo npm install grunt-cli -g
</span></code></pre></td></tr></table></div></figure>


<p>After running you could see grunt is avaiable:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ which grunt
</span><span class='line'>/usr/local/bin/grunt
</span></code></pre></td></tr></table></div></figure>


<p>Automatically create the package.json via npm init.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Yosemite:GruntJS Trusty$ mkdir blog
</span><span class='line'>Yosemite:GruntJS Trusty$ cd blog
</span><span class='line'>Yosemite:blog Trusty$ npm init
</span><span class='line'>This utility will walk you through creating a package.json file.
</span><span class='line'>It only covers the most common items, and tries to guess sane defaults.
</span><span class='line'>
</span><span class='line'>See `npm help json` for definitive documentation on these fields
</span><span class='line'>and exactly what they do.
</span><span class='line'>
</span><span class='line'>Use `npm install &lt;pkg&gt; --save` afterwards to install a package and
</span><span class='line'>save it as a dependency in the package.json file.
</span><span class='line'>
</span><span class='line'>Press ^C at any time to quit.
</span><span class='line'>name: (blog)
</span><span class='line'>version: (1.0.0)
</span><span class='line'>description: My awesome blog
</span><span class='line'>entry point: (index.js)
</span><span class='line'>test command:
</span><span class='line'>git repository:
</span><span class='line'>keywords:
</span><span class='line'>author:
</span><span class='line'>license: (ISC)
</span><span class='line'>About to write to /Users/Trusty/Code/30Days/GruntJS/blog/package.json:
</span><span class='line'>
</span><span class='line'>{
</span><span class='line'>  "name": "blog",
</span><span class='line'>  "version": "1.0.0",
</span><span class='line'>  "description": "My awesome blog",
</span><span class='line'>  "main": "index.js",
</span><span class='line'>  "scripts": {
</span><span class='line'>    "test": "echo \"Error: no test specified\" && exit 1"
</span><span class='line'>  },
</span><span class='line'>  "author": "",
</span><span class='line'>  "license": "ISC"
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Is this ok? (yes) yes
</span><span class='line'>Yosemite:blog Trusty$ cat package.json
</span><span class='line'>{
</span><span class='line'>  "name": "blog",
</span><span class='line'>  "version": "1.0.0",
</span><span class='line'>  "description": "My awesome blog",
</span><span class='line'>  "main": "index.js",
</span><span class='line'>  "scripts": {
</span><span class='line'>    "test": "echo \"Error: no test specified\" && exit 1"
</span><span class='line'>  },
</span><span class='line'>  "author": "",
</span><span class='line'>  "license": "ISC"
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Run following command will install grunt locally and also update the dependencies, also update the package.json:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Yosemite:blog Trusty$ sudo npm install grunt --save-dev
</span><span class='line'>Yosemite:blog Trusty$ cat package.json
</span><span class='line'>{
</span><span class='line'>  "name": "blog",
</span><span class='line'>  "version": "1.0.0",
</span><span class='line'>  "description": "My awesome blog",
</span><span class='line'>  "main": "index.js",
</span><span class='line'>  "scripts": {
</span><span class='line'>    "test": "echo \"Error: no test specified\" && exit 1"
</span><span class='line'>  },
</span><span class='line'>  "author": "",
</span><span class='line'>  "license": "ISC",
</span><span class='line'>  "devDependencies": {
</span><span class='line'>    "grunt": "^0.4.5"
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>`
</span><span class='line'>
</span><span class='line'>Yosemite:blog Trusty$ cat package.json
</span><span class='line'>{
</span><span class='line'>  "name": "blog",
</span><span class='line'>  "version": "1.0.0",
</span><span class='line'>  "description": "My awesome blog",
</span><span class='line'>  "main": "index.js",
</span><span class='line'>  "scripts": {
</span><span class='line'>    "test": "echo \"Error: no test specified\" && exit 1"
</span><span class='line'>  },
</span><span class='line'>  "author": "",
</span><span class='line'>  "license": "ISC",
</span><span class='line'>  "devDependencies": {
</span><span class='line'>    "grunt": "^0.4.5"
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>Yosemite:blog Trusty$ cat package.json
</span><span class='line'>{
</span><span class='line'>  "name": "blog",
</span><span class='line'>  "version": "1.0.0",
</span><span class='line'>  "description": "My awesome blog",
</span><span class='line'>  "main": "index.js",
</span><span class='line'>  "scripts": {
</span><span class='line'>    "test": "echo \"Error: no test specified\" && exit 1"
</span><span class='line'>  },
</span><span class='line'>  "author": "",
</span><span class='line'>  "license": "ISC",
</span><span class='line'>  "devDependencies": {
</span><span class='line'>    "grunt": "^0.4.5"
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>Yosemite:blog Trusty$ cat package.json
</span><span class='line'>{
</span><span class='line'>  "name": "blog",
</span><span class='line'>  "version": "1.0.0",
</span><span class='line'>  "description": "My awesome blog",
</span><span class='line'>  "main": "index.js",
</span><span class='line'>  "scripts": {
</span><span class='line'>    "test": "echo \"Error: no test specified\" && exit 1"
</span><span class='line'>  },
</span><span class='line'>  "author": "",
</span><span class='line'>  "license": "ISC",
</span><span class='line'>  "devDependencies": {
</span><span class='line'>    "grunt": "^0.4.5"
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>Yosemite:blog Trusty$ cat package.json
</span><span class='line'>{
</span><span class='line'>  "name": "blog",
</span><span class='line'>  "version": "1.0.0",
</span><span class='line'>  "description": "My awesome blog",
</span><span class='line'>  "main": "index.js",
</span><span class='line'>  "scripts": {
</span><span class='line'>    "test": "echo \"Error: no test specified\" && exit 1"
</span><span class='line'>  },
</span><span class='line'>  "author": "",
</span><span class='line'>  "license": "ISC",
</span><span class='line'>  "devDependencies": {
</span><span class='line'>    "grunt": "^0.4.5"
</span><span class='line'>  }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Yosemite:blog Trusty$ grunt
</span><span class='line'>A valid Gruntfile could not be found. Please see the getting started guide for
</span><span class='line'>more information on how to configure grunt: http://gruntjs.com/getting-started
</span><span class='line'>Fatal error: Unable to find Gruntfile.
</span><span class='line'>Yosemite:blog Trusty$ vim Gruntfile.js
</span><span class='line'>Yosemite:blog Trusty$ mkdir js
</span><span class='line'>Yosemite:blog Trusty$ cd js/
</span><span class='line'>Yosemite:js Trusty$ touch app.js
</span><span class='line'>Yosemite:js Trusty$ vim app.js
</span><span class='line'>function hello(name) {
</span><span class='line'>  return "Hello, " + name;
</span><span class='line'>}
</span><span class='line'>function bye(name) {
</span><span class='line'>  return "Bye, " + name;
</span><span class='line'>}
</span><span class='line'>Yosemite:js Trusty$ vim ../
</span><span class='line'>Gruntfile.js   Gruntfile.js~  js/            node_modules/  package.json
</span><span class='line'>Yosemite:js Trusty$ vim ../Gruntfile.js
</span><span class='line'>module.exports = function(grunt) {
</span><span class='line'>  grunt.initConfig({
</span><span class='line'>      uglify: {
</span><span class='line'>              build: {
</span><span class='line'>                         src: ['js/app.js'],
</span><span class='line'>                         dest: 'js/app.min.js'
</span><span class='line'>                     }
</span><span class='line'>          }
</span><span class='line'>  });
</span><span class='line'>
</span><span class='line'>  grunt.loadNpmTasks('grunt-contrib-uglify');
</span><span class='line'>  grunt.registerTask('default', ['uglify']);
</span><span class='line'>};
</span><span class='line'>Yosemite:js Trusty$ cd ..
</span><span class='line'>Yosemite:blog Trusty$ ls
</span><span class='line'>Gruntfile.js  Gruntfile.js~   js      node_modules    package.json
</span><span class='line'>Yosemite:blog Trusty$ grunt
</span><span class='line'>&gt;&gt; Local Npm module "grunt-contrib-uglify" not found. Is it installed?
</span><span class='line'>Warning: Task "uglify" not found. Use --force to continue.
</span><span class='line'>
</span><span class='line'>Aborted due to warnings.
</span><span class='line'>Yosemite:blog Trusty$ sudo grunt
</span><span class='line'>&gt;&gt; Local Npm module "grunt-contrib-uglify" not found. Is it installed?
</span><span class='line'>Warning: Task "uglify" not found. Use --force to continue.
</span><span class='line'>
</span><span class='line'>Aborted due to warnings.
</span><span class='line'>Yosemite:blog Trusty$ sudo npm install grunt-contrib-uglify --save-dev
</span><span class='line'>npm WARN package.json blog@1.0.0 No repository field.
</span><span class='line'>npm WARN package.json blog@1.0.0 No README data
</span><span class='line'>grunt-contrib-uglify@0.6.0 node_modules/grunt-contrib-uglify
</span><span class='line'>├── uri-path@0.0.2
</span><span class='line'>├── loTrusty@2.4.1
</span><span class='line'>├── chalk@0.5.1 (escape-string-regexp@1.0.2, ansi-styles@1.1.0, supports-color@0.2.0, has-ansi@0.1.0, strip-ansi@0.3.0)
</span><span class='line'>├── uglify-js@2.4.15 (uglify-to-browserify@1.0.2, async@0.2.10, optimist@0.3.7, source-map@0.1.34)
</span><span class='line'>└── maxmin@1.0.0 (figures@1.3.5, pretty-bytes@1.0.1, gzip-size@1.0.0)
</span><span class='line'>Yosemite:blog Trusty$ grunt
</span><span class='line'>Running "uglify:build" (uglify) task
</span><span class='line'>&gt;&gt; 1 file created.
</span><span class='line'>
</span><span class='line'>Done, without errors.
</span><span class='line'>Yosemite:blog Trusty$ cat js/app.min.js
</span><span class='line'>function hello(a){return"Hello, "+a}function bye(a){return"Bye, "+a}Yosemite:blog Trusty$
</span></code></pre></td></tr></table></div></figure>


<p>See, grunt will doing the boring tasks for us without any errors.</p>

<h3>Day 6 - Grails</h3>

<h4>ArchLinux Setting</h4>

<p>Install grails under ArchLinux:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo pacman -S grails
</span></code></pre></td></tr></table></div></figure>


<p>Then in eclipse, search Help > Eclipse Marketplace for &ldquo;Grails&rdquo; , it will hint you for installing grails.</p>

<p>File -> New -> Project -> Grails Project. First time it will ask you for setting the grails home directory.</p>

<p><img src="/images/grailshome.jpg" alt="/images/grailshome.jpg" /></p>

<p>Set the project like:  <br/>
<img src="/images/grailsproject.jpg" alt="/images/grailsproject.jpg" /></p>

<p>Choose Grails perspective.</p>

<h4>MAC Setting</h4>

<p>Download the eclipse from:  <br/>
<a href="https://eclipse.org/downloads/">https://eclipse.org/downloads/</a>   <br/>
Download the Java SE from: <br/>
<a href="http://support.apple.com/kb/DL1572">http://support.apple.com/kb/DL1572</a>  <br/>
After installation, search the Marketplace for &ldquo;Grails&rdquo; install the grails for eclipse Luna.      <br/>
Install Grails:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ brew install grails
</span><span class='line'>$ which grails
</span><span class='line'>/usr/local/bin/grails
</span></code></pre></td></tr></table></div></figure>


<p>When configure the Grails project for the first time, the installation is <code>/usr/local/Cellar/grails/2.4.4/libexec</code>, then create a new project named &ldquo;linkbin&rdquo;.</p>

<p>Create new &ldquo;domain class&rdquo; named &ldquo;User&rdquo; and &ldquo;Story&rdquo;  <br/>
Replace the class User via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class User {
</span><span class='line'>  String email
</span><span class='line'>  String fullName
</span><span class='line'>  static constraints = {
</span><span class='line'>      email unique:true , blank : false , email:true
</span><span class='line'>      fullName size:5..100  , blank : false
</span><span class='line'>  }
</span><span class='line'>  
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Replace the class Story via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package linkbin
</span><span class='line'>
</span><span class='line'>class Story {
</span><span class='line'>  String link
</span><span class='line'>  String description
</span><span class='line'>  Date submittedOn
</span><span class='line'>
</span><span class='line'>  static constraints = {
</span><span class='line'>      link url : true , blank : false ,unique : true
</span><span class='line'>      description size : 10..1000 , blank : false
</span><span class='line'>  }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Connect the User and Story Class, first modify the Story and User Class:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package linkbin
</span><span class='line'>class Story {
</span><span class='line'>    String link
</span><span class='line'>    String description
</span><span class='line'>    Date submittedOn  
</span><span class='line'>    static belongsTo = [user : User]
</span><span class='line'>    static constraints = {
</span><span class='line'>        link url : true , blank : false ,unique : true 
</span><span class='line'>        description size : 10..1000 , blank : false 
</span><span class='line'>    }
</span><span class='line'>    static mapping = {
</span><span class='line'>        table 'stories'
</span><span class='line'>    }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>User Class:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package linkbin
</span><span class='line'>class User {
</span><span class='line'>  String email
</span><span class='line'>  String fullName
</span><span class='line'>  static hasMany = [stories : Story]
</span><span class='line'>  static constraints = {
</span><span class='line'>      email unique:true , blank : false , email:true
</span><span class='line'>      fullName size:5..100  , blank : false
</span><span class='line'>  }
</span><span class='line'>  static mapping = {
</span><span class='line'>      table 'users'
</span><span class='line'>  }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Then generate the Controller and view:   <br/>
domain-> linkbin-> User.groovy-> Grails Tools -> Grails Command Wizard, input linkbin.User and click &ldquo;Finish&rdquo;. The same steps are the same for Story.</p>

<p>Now the CRUD controller and viewpoint will be generated.</p>

<p>Right-click the project and &ldquo;Run as Grails App&rdquo;, then you could</p>

<p>Now create the openshift app via following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rhc create -app linkbin tomcat-7 postgresql-9.2
</span></code></pre></td></tr></table></div></figure>


<p>This will automatically create the apps on openshift, and hit you like:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Your application 'linkbin' is now available.
</span><span class='line'>
</span><span class='line'>  URL:        http://linkbin-kkkkkkktttt.rhcloud.com/
</span><span class='line'>  SSH to:     xxxxxxxxxxxx@linkbin-kkkkkkktttt.rhcloud.com
</span><span class='line'>  Git remote: ssh://xxxxxxxx@linkbin-kkkkkkktttt.rhcloud.com/~/git/linkbin.git/
</span><span class='line'>  Cloned to:  /Users/Trusty/Documents/workspace/linkbin/linkbin
</span><span class='line'>
</span><span class='line'>Run 'rhc show-app linkbin' for more details about your app.
</span></code></pre></td></tr></table></div></figure>


<p>And go to the linkbin folder:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git rm -rf src/ pom.xml
</span><span class='line'>git commit -am "deleted default source code"
</span></code></pre></td></tr></table></div></figure>


<p>Modify the conf/Datasource.groovy file&rsquo;s configuration:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> production {
</span><span class='line'>      dataSource {
</span><span class='line'>          dbCreate = "update"
</span><span class='line'>          driverClassName = "org.postgresql.Driver"
</span><span class='line'>          dialect = org.hibernate.dialect.PostgreSQLDialect
</span><span class='line'>      uri = new URI(System.env.OPENSHIFT_POSTGRESQL_DB_URL)
</span><span class='line'>      url = "jdbc:postgresql://"+uri.host+uri.path+"/"+System.env.OPENSHIFT_APP_NAME
</span><span class='line'>          username = System.env.OPENSHIFT_POSTGRESQL_DB_USERNAME
</span><span class='line'>          password = System.env.OPENSHIFT_POSTGRESQL_DB_PASSWORD
</span><span class='line'>      }
</span><span class='line'>  }
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>Generate the war file via:  <br/>
&ldquo;Grails Command Wizard&rdquo;, use &ldquo;war&rdquo; command, the name of its generation is &ldquo; target/ROOT.war&rdquo;, then the ROOT.war will be generated, copy it to the webapps under linkbin:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git add .
</span><span class='line'>$ git commit -am "linkbin app deployed to cloud"
</span><span class='line'>$ git push
</span></code></pre></td></tr></table></div></figure>


<p>After push we could visit the above url for visiting the apps.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/25/octopress-tips/">Octopress Tips</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-25T14:39:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>2:39 pm</span></time>
        
         | <a href="/blog/2014/11/25/octopress-tips/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Hide AsideBar</h3>

<p>Add following lines into your <code>_config.yml</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sidebar: collapse
</span></code></pre></td></tr></table></div></figure>


<p>Then regenerate the whole website.</p>

<h3>Changing Navigation</h3>

<p>Add &ldquo;About Me&rdquo; navigation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat source/_includes/custom/navigation.html
</span><span class='line'>&lt;ul class="main-navigation"&gt;
</span><span class='line'>  &lt;li&gt;&lt;a href="/"&gt;Blog&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>  &lt;li&gt;&lt;a href="/blog/archives"&gt;Archives&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>  &lt;li&gt;&lt;a href="/about"&gt;About Me&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>&lt;/ul&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Add customized tags:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  &lt;li&gt;&lt;a href="/blog/categories/linux/"&gt;Linux&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>  &lt;li&gt;&lt;a href="/blog/categories/embedded/"&gt;Embedded&lt;/a&gt;&lt;/li&gt;
</span></code></pre></td></tr></table></div></figure>


<h3>Add Customized Background</h3>

<p>Edit the <code>sass/cumstom/_style.css</code>, change following content:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>html {
</span><span class='line'>  background: #555555 url("/images/pagebackground.jpg");
</span><span class='line'>  //background: #555555;
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Now regenerate the website, ten you got the modified background website.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/24/upgrade-openwrt-on-mw151rm3g/">Upgrade OpenWRT on MW151RM3G</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-24T13:54:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:54 pm</span></time>
        
         | <a href="/blog/2014/11/24/upgrade-openwrt-on-mw151rm3g/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Prepare</h3>

<p>First go to <a href="http://downloads.openwrt.org/barrier_breaker/14.07/ar71xx/generic/">http://downloads.openwrt.org/barrier_breaker/14.07/ar71xx/generic/</a>, find the &ldquo;wr703n&rdquo;, download the 2 files.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls -l openwrt*
</span><span class='line'>-rw-r----- 1 Trusty root 3932160 Nov 24 13:50 openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-factory.bin
</span><span class='line'>-rw-r----- 1 Trusty root 3342340 Nov 24 13:50 openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-sysupgrade.bin
</span></code></pre></td></tr></table></div></figure>


<p>sysupgrade.bin is for upgrading.</p>

<h3>Upgrade</h3>

<p>System-> Backup/Flash Firmware.   <br/>
Flash New firmware image, choose File. Select the sysupgrade.bin, Upgrade.</p>

<p>Tehn you have to wait for the changes to be applied, around half a miniutes, then everything will be OK.</p>

<h3>Use Flash Disk For Booting</h3>

<p>Cause the inner storage is only 4M-BYTE, we have to enlarge it via adding the external flash disk .</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ opkg update
</span><span class='line'>$ opkg install block-mount kmod-usb-storage fdisk
</span></code></pre></td></tr></table></div></figure>


<p>Comparing to Attitude Adjustment, the kmod-fs-ext4 couldn&rsquo;t be installed, thus we have to formt the flash disk into ext3 format.</p>

<p>Cause we won&rsquo;t installed the kmod-fs-ext4, so the external system couldn&rsquo;t be used, this time just flash back the Attitude Adjustment.</p>

<h3>Rootfs on External Storage</h3>

<p>Copy the filesystem into the external disk:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@OpenWrt:/mnt/sda2# tar -C /overlay -cvf - . | tar -C /mnt/sda2 -xf -
</span><span class='line'>root@OpenWrt:/mnt/sda2# ls
</span><span class='line'>etc         lib         lost+found  mnt         sbin        usr
</span></code></pre></td></tr></table></div></figure>


<p>Configure the /etc/config/fstab:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config mount
</span><span class='line'>        option target   /overlay
</span><span class='line'>        option device   /dev/sda2
</span><span class='line'>        option fstype   ext3
</span><span class='line'>        option options  rw,sync
</span><span class='line'>        option enabled  1
</span><span class='line'>        option enabled_fsck 0
</span></code></pre></td></tr></table></div></figure>


<p>Reboot and you got 8G rootfs enabled router.</p>

<h3>Wireless-> Wired.</h3>

<p>First set the wireless port to client mode:   <br/>
<img src="/images/wireless_client.jpg" alt="/images/wireless_client.jpg" /></p>

<p>Then set the wired port to static address:  <br/>
<img src="/images/wired_config.jpg" alt="/images/wired_config.jpg" /></p>

<p>Now reset  your router and connect the ethernet port with a line, the equipments who only have ethernet could use router&rsquo;s wireless signal for accessing the network.  <br/>
Later when I study in the library, this router could easily transfer the signal from wireless to wired and let surfacePro work properly.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/26">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/24">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/01/18/tips-on-setup-mesos-cluster/">Tips on Setup Mesos Cluster</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/15/linux-tips-4/">Linux Tips(4)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/15/vlan-experiment/">Vlan Experiment</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/14/cloudstackshi-yong-lxcyao-dian/">CloudStack使用LXC要点</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/11/install-cloudstack-mgmt-server-on-centos7/">Install CloudStack Mgmt Server on CentOS7</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
