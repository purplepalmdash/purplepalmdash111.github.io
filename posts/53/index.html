
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="For those code files which contains gb2312 or gbk format, we can use following scripts for automatically convert them to UTF-8 conpatiable format &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/53">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//fonts.googleapis.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/27/auto-convert-source-code-to-utf-8-compatiable/">Auto Convert Source Code to UTF-8 Compatiable</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-27T17:46:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>5:46 pm</span></time>
        
         | <a href="/blog/2013/11/27/auto-convert-source-code-to-utf-8-compatiable/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For those code files which contains gb2312 or gbk format, we can use following scripts for automatically convert them to UTF-8 conpatiable format files.</p>

<figure class='code'><figcaption><span>autochinese.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'><span class="nb">export </span><span class="nv">LANG</span><span class="o">=</span><span class="s2">&quot;zh_CN.utf8&quot;</span>
</span><span class='line'><span class="nb">export </span><span class="nv">LC_ALL</span><span class="o">=</span><span class="s2">&quot;zh_CN.utf8&quot;</span>
</span><span class='line'><span class="c">#for file in `find . -name &quot;*.h&quot;`</span>
</span><span class='line'><span class="k">for</span> file in <span class="sb">`</span>find . -name <span class="s2">&quot;*.c&quot;</span><span class="sb">`</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="nv">$file</span>
</span><span class='line'>  enca -L zh_CN -x UTF-8 <span class="nv">$file</span>
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/26/add-vlan-to-existing-machine/">Add Vlan to Existing Machine</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-26T13:51:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>1:51 pm</span></time>
        
         | <a href="/blog/2013/11/26/add-vlan-to-existing-machine/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>增加一个VLAN设备：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ip link add link eth0 name eth0.100 type vlan id 100
</span></code></pre></td></tr></table></div></figure>


<p>查看增加的VLAN设备详情：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ip -d link show eth0.100
</span></code></pre></td></tr></table></div></figure>


<p>增加一个IPV4地址：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ip addr add 192.168.100.1/24 brd 192.168.100.255 dev eth0.100
</span><span class='line'>$ ip link set dev eth0.100 up
</span></code></pre></td></tr></table></div></figure>


<p>关闭一个VLAN设备：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ip link set dev eth0.100 down
</span></code></pre></td></tr></table></div></figure>


<p>移除一个VLAN设备:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ip link delete eth0.100
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/25/how-to-setup-stm32-project-in-eclipse/">How to Setup STM32 Project in Eclipse</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-25T15:27:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>3:27 pm</span></time>
        
         | <a href="/blog/2013/11/25/how-to-setup-stm32-project-in-eclipse/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Preparation</h3>

<h4>STM Standard Peripheral Lib</h4>

<p>Download Link for STSW-STM32054STM32F10x standard peripheral library :    <br/>
<a href="http://www.st.com/web/catalog/tools/FM147/CL1794/SC961/SS1743/PF257890">http://www.st.com/web/catalog/tools/FM147/CL1794/SC961/SS1743/PF257890</a>  <br/>
Unsip the downloaded library and you will get several folders, the Libraries folder is the pure libs.</p>

<h4>Cross-Compiler for STM32</h4>

<p>Download the cross-compiler from CodeSourcery ARM EABI toolchain - Mentor Graphics:  <br/>
<a href="https://sourcery.mentor.com/sgpp/lite/arm/portal/subscription?@template=lite">https://sourcery.mentor.com/sgpp/lite/arm/portal/subscription?@template=lite</a>  <br/>
You have to choose EABI version. Download and install it, you will get &ldquo;arm-none-eabi-&rdquo; prefixed cross-compiler.</p>

<h4>Eclipse plugins</h4>

<p>Help-> Install New Software, Add the URL for gnuarm:   <br/>
<a href="http://gnuarmeclipse.sourceforge.net/updates">http://gnuarmeclipse.sourceforge.net/updates</a>   <br/>
Then Install CDT GNU Cross Development Tools , after install the plugin, you will asked to reboot, just reboot. Now your preparation is OK.</p>

<h3>Create a new project</h3>

<p> In Eclipse, Click File->New->C project, choose &ldquo;ARM Cross Target Applcation (End of life)&rdquo;, choose &ldquo;Empty Project&rdquo; &ldquo;ARM Linux GCC(Sourcery Lite Bare), give the Project name and click Next Button, then click Finish. you will see the newly created project in the Project Explorer.</p>

<p>   <img src="/images/eclipse1.jpg" alt="eclipse1.jpg" /></p>

<p>Copy the Library files into your own project, take &ldquo;stmExample&rdquo; project for example:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@DashArch STM32F10x_StdPeriph_Lib_V3.5.0]$ pwd
</span><span class='line'>/media/y/embedded/stm32/dev/lib/STM32F10x_StdPeriph_Lib_V3.5.0
</span><span class='line'>[Trusty@DashArch STM32F10x_StdPeriph_Lib_V3.5.0]$ cp -r  Libraries/ ~/workspace/stmExample/    
</span></code></pre></td></tr></table></div></figure>


<p>Your project should seem like this:</p>

<p>   <img src="/images/eclipse2.jpg" alt="eclipse2.jpg" /></p>

<p>Now you have to prepare your startup file, notice you have to use &ldquo;S&rdquo; suffixed file name, and you have to remove the remaining directory except the .S file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@DashArch startup]$ pwd
</span><span class='line'>/home/Trusty/workspace/stmExample/Libraries/CMSIS/CM3/DeviceSupport/ST/STM32F10x/startup
</span><span class='line'>[Trusty@DashArch startup]$ ls
</span><span class='line'>arm  gcc_ride7  iar  TrueSTUDIO
</span><span class='line'>[Trusty@DashArch startup]$ cp TrueSTUDIO/startup_stm32f10x_hd.s ./startup_stm32f10x_hd.S
</span><span class='line'>[Trusty@DashArch startup]$ ls
</span><span class='line'>arm  gcc_ride7  iar  startup_stm32f10x_hd.S  TrueSTUDIO
</span><span class='line'>[Trusty@DashArch startup]$ rm -rf TrueSTUDIO/ iar/ gcc_ride7/ arm/
</span><span class='line'>[Trusty@DashArch startup]$ ls
</span><span class='line'>startup_stm32f10x_hd.S
</span></code></pre></td></tr></table></div></figure>


<p>Create a directory named src to contains your own project files.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@DashArch stmExample]$ mkdir src
</span><span class='line'>[Trusty@DashArch stmExample]$ pwd
</span><span class='line'>/home/Trusty/workspace/stmExample
</span><span class='line'>[Trusty@DashArch stmExample]$ ls
</span><span class='line'>Libraries  src
</span></code></pre></td></tr></table></div></figure>


<p>Copy the project files into &ldquo;src&rdquo; directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@DashArch STM32F10x_StdPeriph_Template]$ ls
</span><span class='line'>EWARM  HiTOP  main.c  MDK-ARM  Release_Notes.html  RIDE  stm32f10x_conf.h  stm32f10x_it.c  stm32f10x_it.h  system_stm32f10x.c  TrueSTUDIO
</span><span class='line'>[Trusty@DashArch STM32F10x_StdPeriph_Template]$ cp stm32f10x_* ~/workspace/stmExample/src/
</span><span class='line'>[Trusty@DashArch STM32F10x_StdPeriph_Template]$ pwd
</span><span class='line'>/media/y/embedded/stm32/dev/lib/STM32F10x_StdPeriph_Lib_V3.5.0/Project/STM32F10x_StdPeriph_Template
</span><span class='line'>Copy the link script to root directory of your project:
</span><span class='line'>[Trusty@DashArch STM32100B-EVAL]$ pwd
</span><span class='line'>/media/y/embedded/stm32/dev/lib/STM32F10x_StdPeriph_Lib_V3.5.0/Project/STM32F10x_StdPeriph_Template/TrueSTUDIO/STM32100B-EVAL
</span><span class='line'>[Trusty@DashArch STM32100B-EVAL]$ cp stm32_flash.ld  ~/workspace/stmExample/
</span></code></pre></td></tr></table></div></figure>


<p>You have to modify the link script according to your own flash layout and memory layout, My CPU is STM32F103VC, which has 48K RAM and 256K Flash, so the configuration is listed as:</p>

<figure class='code'><figcaption><span>stm32_flash.ld</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>/*
</span><span class='line'>Linker subscript <span class="k">for</span> STM32F051 definitions with 64K Flash and 8K RAM
</span><span class='line'>Copyright RAISONANCE 2007
</span><span class='line'>!!! This file is automatically generated by RIDE !!!
</span><span class='line'>Do not modify it, as it will be erased at every link.
</span><span class='line'>You can use, copy and distribute this file freely, but without any warranty.
</span><span class='line'>*/
</span><span class='line'>
</span><span class='line'>/* Memory Spaces Definitions */
</span><span class='line'>
</span><span class='line'>ENTRY<span class="o">(</span>Reset_Handler<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>MEMORY
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  FLASH <span class="o">(</span>rx<span class="o">)</span> : <span class="nv">ORIGIN</span> <span class="o">=</span> 0x08000000, <span class="nv">LENGTH</span> <span class="o">=</span> 256K
</span><span class='line'>  RAM  <span class="o">(</span>xrw<span class="o">)</span> : <span class="nv">ORIGIN</span> <span class="o">=</span> 0x20000000, <span class="nv">LENGTH</span> <span class="o">=</span> 48K
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>/* highest address of the user mode stack */
</span><span class='line'><span class="nv">_estack</span> <span class="o">=</span> 0x2000c000<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>/*
</span><span class='line'>Common part of the linker scripts <span class="k">for</span> STR71x devices in FLASH mode
</span><span class='line'><span class="o">(</span>that is, the FLASH is seen at 0<span class="o">)</span>
</span><span class='line'>Copyright RAISONANCE 2005
</span><span class='line'>You can use, modify and distribute this file freely, but without any warranty.
</span><span class='line'>*/
</span><span class='line'>
</span><span class='line'>/* Sections Definitions */
</span><span class='line'>
</span><span class='line'>SECTIONS
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    /* <span class="k">for</span> Cortex devices, the beginning of the startup code is stored in the .isr_vector section, which goes to FLASH */
</span><span class='line'>    .isr_vector :
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>  . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span><span class="p">;</span>
</span><span class='line'>        KEEP<span class="o">(</span>*<span class="o">(</span>.isr_vector<span class="o">))</span>            /* Startup code */
</span><span class='line'>  . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span> &gt;FLASH
</span><span class='line'>
</span><span class='line'>    /* the program code is stored in the .text section, which goes to Flash */
</span><span class='line'>    .text :
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>      . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>        *<span class="o">(</span>.text<span class="o">)</span>                   /* normal code */
</span><span class='line'>        *<span class="o">(</span>.text.*<span class="o">)</span>                 /* -ffunction-sections code */
</span><span class='line'>        *<span class="o">(</span>.rodata<span class="o">)</span>                 /* <span class="nb">read</span>-only data <span class="o">(</span>constants<span class="o">)</span> */
</span><span class='line'>        *<span class="o">(</span>.rodata*<span class="o">)</span>                /* -fdata-sections <span class="nb">read </span>only data */
</span><span class='line'>        *<span class="o">(</span>.glue_7<span class="o">)</span>                 /* TBD - needed ? */
</span><span class='line'>        *<span class="o">(</span>.glue_7t<span class="o">)</span>                /* TBD - needed ? */
</span><span class='line'>
</span><span class='line'>  /* Necessary KEEP sections <span class="o">(</span>see http://sourceware.org/ml/newlib/2005/msg00255.html<span class="o">)</span> */
</span><span class='line'>  KEEP <span class="o">(</span>*<span class="o">(</span>.init<span class="o">))</span>
</span><span class='line'>  KEEP <span class="o">(</span>*<span class="o">(</span>.fini<span class="o">))</span>
</span><span class='line'>  
</span><span class='line'>      . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">_etext</span> <span class="o">=</span> .<span class="p">;</span>
</span><span class='line'>      /* This is used by the startup in order to initialize the .data section */
</span><span class='line'>        <span class="nv">_sidata</span> <span class="o">=</span> _etext<span class="p">;</span>
</span><span class='line'>    <span class="o">}</span> &gt;FLASH
</span><span class='line'>
</span><span class='line'>    /* This is the initialized data section
</span><span class='line'>    The program executes knowing that the data is in the RAM
</span><span class='line'>    but the loader puts the initial values in the FLASH <span class="o">(</span>inidata<span class="o">)</span>.
</span><span class='line'>    It is one task of the startup to copy the initial values from FLASH to RAM. */
</span><span class='line'>    .data  : AT <span class="o">(</span> _sidata <span class="o">)</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>      . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span><span class="p">;</span>
</span><span class='line'>        /* This is used by the startup in order to initialize the .data secion */
</span><span class='line'>        <span class="nv">_sdata</span> <span class="o">=</span> . <span class="p">;</span>
</span><span class='line'>        <span class="nv">_data</span> <span class="o">=</span> . <span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        *<span class="o">(</span>.data<span class="o">)</span>
</span><span class='line'>        *<span class="o">(</span>.data.*<span class="o">)</span>
</span><span class='line'>        *<span class="o">(</span>.RAMtext<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>      . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span><span class="p">;</span>
</span><span class='line'>      /* This is used by the startup in order to initialize the .data secion */
</span><span class='line'>          <span class="nv">_edata</span> <span class="o">=</span> . <span class="p">;</span>
</span><span class='line'>    <span class="o">}</span> &gt;RAM
</span><span class='line'>
</span><span class='line'>    /* This is the uninitialized data section */
</span><span class='line'>    .bss :
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>      . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span><span class="p">;</span>
</span><span class='line'>        /* This is used by the startup in order to initialize the .bss secion */
</span><span class='line'>        <span class="nv">_sbss</span> <span class="o">=</span> .<span class="p">;</span>
</span><span class='line'>        <span class="nv">_bss</span> <span class="o">=</span> .<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        *<span class="o">(</span>.bss<span class="o">)</span>
</span><span class='line'>        *<span class="o">(</span>.bss.*<span class="o">)</span> /* patched by elias - allows the use of -fdata-sections */
</span><span class='line'>        *<span class="o">(</span>COMMON<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>      . <span class="o">=</span> ALIGN<span class="o">(</span>4<span class="o">)</span><span class="p">;</span>
</span><span class='line'>      /* This is used by the startup in order to initialize the .bss secion */
</span><span class='line'>       <span class="nv">_ebss</span> <span class="o">=</span> . <span class="p">;</span>
</span><span class='line'>    <span class="o">}</span> &gt;RAM
</span><span class='line'>
</span><span class='line'>    PROVIDE <span class="o">(</span> <span class="nv">end</span> <span class="o">=</span> _ebss <span class="o">)</span><span class="p">;</span>
</span><span class='line'>    PROVIDE <span class="o">(</span> <span class="nv">_end</span> <span class="o">=</span> _ebss <span class="o">)</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">__exidx_start</span> <span class="o">=</span> .<span class="p">;</span>
</span><span class='line'>    <span class="nv">__exidx_end</span> <span class="o">=</span> .<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    /* after that it<span class="err">&#39;</span>s only debugging information. */
</span><span class='line'>
</span><span class='line'>    /* remove the debugging information from the standard libraries */
</span><span class='line'>    /DISCARD/ :
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>     libc.a <span class="o">(</span> * <span class="o">)</span>
</span><span class='line'>     libm.a <span class="o">(</span> * <span class="o">)</span>
</span><span class='line'>     libgcc.a <span class="o">(</span> * <span class="o">)</span>
</span><span class='line'>     <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    /* Stabs debugging sections.  */
</span><span class='line'>    .stab          <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.stab<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .stabstr       <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.stabstr<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .stab.excl     <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.stab.excl<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .stab.exclstr  <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.stab.exclstr<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .stab.index    <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.stab.index<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .stab.indexstr <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.stab.indexstr<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .comment       <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.comment<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    /* DWARF debug sections.
</span><span class='line'>       Symbols in the DWARF debugging sections are relative to the beginning
</span><span class='line'>       of the section so we begin them at 0.  */
</span><span class='line'>    /* DWARF <span class="m">1</span> */
</span><span class='line'>    .debug          <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .line           <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.line<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    /* GNU DWARF <span class="m">1</span> extensions */
</span><span class='line'>    .debug_srcinfo  <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_srcinfo<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_sfnames  <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_sfnames<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    /* DWARF 1.1 and DWARF <span class="m">2</span> */
</span><span class='line'>    .debug_aranges  <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_aranges<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_pubnames <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_pubnames<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    /* DWARF <span class="m">2</span> */
</span><span class='line'>    .debug_info     <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_info .gnu.linkonce.wi.*<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_abbrev   <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_abbrev<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_line     <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_line<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_frame    <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_frame<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_str      <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_str<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_loc      <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_loc<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_macinfo  <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_macinfo<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    /* SGI/MIPS DWARF <span class="m">2</span> extensions */
</span><span class='line'>    .debug_weaknames <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_weaknames<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_funcnames <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_funcnames<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_typenames <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_typenames<span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    .debug_varnames  <span class="m">0</span> : <span class="o">{</span> *<span class="o">(</span>.debug_varnames<span class="o">)</span> <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now create a sample main.c under the src directory and input your source code.</p>

<h3>Configure the project</h3>

<p>Right click your project, select Properties, C/C++ Build -> Settings, ARM Linux GCC Assembler(Sourcery Lite Bare)/Preprocessor, add a Defined symbols(-D), also you have to add this into ARM Linux GCC Compiler(Sourcery Lite Bare):</p>

<figure class='code'><figcaption><span>stm32_flash.ld</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>STM32F10X_HD
</span><span class='line'>USE_STDPERIPH_DRIVER
</span></code></pre></td></tr></table></div></figure>


<p>In ARM Linux GCC C Compiler(Sourcery Lite Bare)-> Directories, add Include paths(-i) add following:</p>

<p>   <img src="/images/eclipse3.jpg" alt="eclipse3.jpg" /></p>

<p>Specify the link script:   <br/>
ARM Linux GCC CLinker(Sourcery Lite Bare) -> General, Script file(-T)
    /home/Trusty/workspace/stm32archlinux/stm32_flash.ld</p>

<h3>Build and Debug</h3>

<p>Right click the project and click &ldquo;Build project&rdquo;, then you got your project compiling and linking, finally you got your Binary named stmExample.elf.   <br/>
Now we can use OpenOCD for writing the image into the flash and debugging it.</p>

<p>Run->Debug Configuration, you will see Zylin Embedded debug(Native) is available, right click and choose &ldquo;Create new&rdquo;, create a new debug item.   <br/>
Choose the Main:</p>

<p>   <img src="/images/eclipse4.jpg" alt="eclipse4.jpg" /></p>

<p>Choose the Debugger:</p>

<p>   <img src="/images/eclipse5.jpg" alt="eclipse5.jpg" /></p>

<p>Choose Commands:</p>

<p>   <img src="/images/eclipse6.jpg" alt="eclipse6.jpg" /></p>

<p>The configuration file is :</p>

<figure class='code'><figcaption><span>stm32_flash.ld</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>target remote localhost:3333
</span><span class='line'>monitor reset
</span><span class='line'>monitor halt
</span><span class='line'>monitor flash protect <span class="m">0</span> <span class="m">0</span> <span class="m">11</span> off
</span><span class='line'>monitor flash write_image erase /home/Trusty/workspace/stm32archlinux/Debug/stm32archlinux.hex <span class="m">0</span> ihex
</span><span class='line'>disconnect
</span><span class='line'>target remote localhost:3333
</span><span class='line'>monitor reset
</span><span class='line'>monitor halt
</span></code></pre></td></tr></table></div></figure>


<p>Open your own openocd, and then using eclipse to connect the gdb. Remember &ldquo;toggle breakpoint&rdquo; and you will get a hardware breakpoint. Enjoy the debugging.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/25/solution-on-joggler/">Solution on Joggler</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-25T09:30:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>9:30 am</span></time>
        
         | <a href="/blog/2013/11/25/solution-on-joggler/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Hardware</h3>

<p>Joggler   <br/>
Intel&reg; Atom&trade; CPU Z520   @ 1.33GHz  Dual Core  <br/>
MemTotal:         504480 kB   <br/>
Harddisk: 500G External USB.</p>

<h3>System and Software</h3>

<p>Download the Ubuntu Base/Server 12.04 LTS (Precise) (Joggler Image v1.4 - 09/04/2013) from the   <br/>
<a href="http://joggler.exotica.org.uk/ubuntu/">http://joggler.exotica.org.uk/ubuntu/</a>
From the ubuntu website we know 12.04 LTS will supported to 2017, I think that fits my needs.   <br/>
Unzip the download image:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gunzip ubuntu_base_12.04-v1.4-ext4.img.gz
</span><span class='line'>dd if=./ubuntu_base_12.04-v1.4-ext4.img of=/dev/sdc bs=1M
</span></code></pre></td></tr></table></div></figure>


<p>The use this external usb disk for booting up the joggler. After joggler has been booted up, install coresponding packages.</p>

<h3>Prevent Hard disk from hiberating</h3>

<p>Add following lines to crontab -e</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>*/4 * * * * fdisk -l /dev/uba&gt;/dev/null && echo abc&gt;/root/done.txt
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/22/openocd-configuration/">openOCD Configuration</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-22T20:37:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2013</span></span> <span class='time'>8:37 pm</span></time>
        
         | <a href="/blog/2013/11/22/openocd-configuration/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>OpenOCD Device Scan</h3>

<p>Install and view the OpenOCD:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pacman -S openocd
</span><span class='line'>[Trusty@XXXyyy debian_octopress]$ openocd -v
</span><span class='line'>Open On-Chip Debugger 0.7.0 (2013-11-02-01:53)
</span><span class='line'>Licensed under GNU GPL v2
</span><span class='line'>For bug reports, read
</span><span class='line'>  http://openocd.sourceforge.net/doc/doxygen/bugs.html
</span></code></pre></td></tr></table></div></figure>


<p>Insert your openJTAG debug board, and view its connection:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@XXXyyy debian_octopress]$ lsusb
</span><span class='line'>Bus 001 Device 016: ID 1457:5118 First International Computer, Inc. OpenMoko Neo1973 Debug board (V2+)
</span></code></pre></td></tr></table></div></figure>


<p>From the dmesg information:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[15767.673553] usb 1-1: new full-speed USB device number 11 using xhci_hcd
</span><span class='line'>[15767.695990] usb 1-1: Device not responding to set address.
</span><span class='line'>[15767.938262] usb 1-1: Device not responding to set address.
</span><span class='line'>[15768.140725] usb 1-1: device not accepting address 11, error -71
</span><span class='line'>[15768.421057] usb 1-1: new full-speed USB device number 13 using xhci_hcd
</span><span class='line'>[15769.015800] usbcore: registered new interface driver usbserial
</span><span class='line'>[15769.016012] usbcore: registered new interface driver usbserial_generic
</span><span class='line'>[15769.016075] usbserial: USB Serial support registered for generic
</span><span class='line'>[15769.020028] usbcore: registered new interface driver ftdi_sio
</span><span class='line'>[15769.020050] usbserial: USB Serial support registered for FTDI USB Serial Device
</span><span class='line'>[15769.020458] usb 1-1: Ignoring serial port reserved for JTAG
</span><span class='line'>[15769.020499] ftdi_sio 1-1:1.1: FTDI USB Serial Device converter detected
</span><span class='line'>[15769.020544] usb 1-1: Detected FT2232C
</span><span class='line'>[15769.020548] usb 1-1: Number of endpoints 2
</span><span class='line'>[15769.020550] usb 1-1: Endpoint 1 MaxPacketSize 64
</span><span class='line'>[15769.020553] usb 1-1: Endpoint 2 MaxPacketSize 64
</span><span class='line'>[15769.020555] usb 1-1: Setting MaxPacketSize 64
</span><span class='line'>[15769.026647] usb 1-1: FTDI USB Serial Device converter now attached to ttyUSB0
</span><span class='line'>[15975.012193] usb 1-1: USB disconnect, device number 13
</span><span class='line'>[15975.012449] ftdi_sio ttyUSB0: FTDI USB Serial Device converter now disconnected from ttyUSB0
</span><span class='line'>[15975.012465] ftdi_sio 1-1:1.1: device disconnected
</span><span class='line'>[15975.270658] usb 1-1: new full-speed USB device number 14 using xhci_hcd
</span><span class='line'>[15975.355869] usb 1-1: Ignoring serial port reserved for JTAG
</span><span class='line'>[15975.366867] ftdi_sio 1-1:1.1: FTDI USB Serial Device converter detected
</span><span class='line'>[15975.366902] usb 1-1: Detected FT2232C
</span><span class='line'>[15975.366904] usb 1-1: Number of endpoints 2
</span><span class='line'>[15975.366906] usb 1-1: Endpoint 1 MaxPacketSize 64
</span><span class='line'>[15975.366908] usb 1-1: Endpoint 2 MaxPacketSize 64
</span><span class='line'>[15975.366909] usb 1-1: Setting MaxPacketSize 64
</span><span class='line'>[15975.371933] usb 1-1: FTDI USB Serial Device converter now attached to ttyUSB0
</span><span class='line'>[16608.914153] usb 1-1: USB disconnect, device number 14
</span><span class='line'>[16608.914371] ftdi_sio ttyUSB0: FTDI USB Serial Device converter now disconnected from ttyUSB0
</span><span class='line'>[16608.914402] ftdi_sio 1-1:1.1: device disconnected
</span><span class='line'>[16609.394763] usb 1-1: new full-speed USB device number 15 using xhci_hcd
</span><span class='line'>[16609.395097] usb 1-1: Device not responding to set address.
</span><span class='line'>[16609.598734] usb 1-1: Device not responding to set address.
</span><span class='line'>[16609.801899] usb 1-1: device not accepting address 15, error -71
</span><span class='line'>[16609.962045] usb 1-1: new full-speed USB device number 16 using xhci_hcd
</span><span class='line'>[16609.962371] usb 1-1: Device not responding to set address.
</span><span class='line'>[16610.250376] usb 1-1: Ignoring serial port reserved for JTAG
</span><span class='line'>[16610.261380] ftdi_sio 1-1:1.1: FTDI USB Serial Device converter detected
</span><span class='line'>[16610.261428] usb 1-1: Detected FT2232C
</span><span class='line'>[16610.261431] usb 1-1: Number of endpoints 2
</span><span class='line'>[16610.261433] usb 1-1: Endpoint 1 MaxPacketSize 64
</span><span class='line'>[16610.261435] usb 1-1: Endpoint 2 MaxPacketSize 64
</span><span class='line'>[16610.261437] usb 1-1: Setting MaxPacketSize 64
</span><span class='line'>[16610.266397] usb 1-1: FTDI USB Serial Device converter now attached to ttyUSB0
</span></code></pre></td></tr></table></div></figure>


<p>From the above information we could know, Now we have a new Serial port named ttyUSB0, and also a FT2232C debug port. Currently we don&rsquo;t use Serial Port, FT2232 is all we want to configure.</p>

<h3>OpenOCD Configuration</h3>

<p>We have to make a cfg file for OpenOCD to use. There are some pre-defined configuration files for us to refer under the directory of &ldquo;/usr/share/openocd/scripts/&rdquo;, since we know the debug board information and we know exactly the development board info, we can easily write our own OpenOCD startup scripts. <br/>
Get the interface definition via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@XXXyyy interface]$ pwd
</span><span class='line'>/usr/share/openocd/scripts/interface
</span><span class='line'>[Trusty@XXXyyy interface]$ grep "1457" ./ -r
</span><span class='line'>./neodb.cfg:ft2232_vid_pid 0x1457 0x5118
</span><span class='line'>./ftdi/neodb.cfg:ftdi_vid_pid 0x1457 0x5118
</span></code></pre></td></tr></table></div></figure>


<p>So we directly copy the neodb.cfg to our openocd.cfg under our home directory. But the usb name of our OpenOCD is changed,</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ft2232_device_desc "USB&lt;=&gt;JTAG&RS232
</span></code></pre></td></tr></table></div></figure>


<p>The definition is taken from the output of &ldquo;lsusb -v -d 1457:5118&rdquo;</p>

<p>We also want to define the port for telnet and gdb connection</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#########daemon configuration####
</span><span class='line'>telnet_port 4444
</span><span class='line'>gdb_port 3333
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>The Target configuration is taken from the /usr/share/openocd/scripts/target/stm32f1x.cfg, which is the definition of the stm32f1x. Copy them directly to your own config file.</p>

<p>Finally your configuration file should be listed as:</p>

<figure class='code'><figcaption><span>openocd.cfg</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
</pre></td><td class='code'><pre><code class='linux-config'><span class='line'><span class="c1">#########daemon configuration####</span>
</span><span class='line'>telnet_port <span class="mi">4444</span>
</span><span class='line'>gdb_port <span class="mi">3333</span>
</span><span class='line'>
</span><span class='line'><span class="c1">########Interface Info###########</span>
</span><span class='line'><span class="c1">################################################</span>
</span><span class='line'><span class="c1"># Since our board takes the same vid_pid</span>
</span><span class='line'><span class="c1"># We directly use openmoko&#39;s definition.</span>
</span><span class='line'><span class="c1">################################################</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># Openmoko USB JTAG/RS232 adapter</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># http://wiki.openmoko.org/wiki/Debug_Board_v3</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'>interface ft2232
</span><span class='line'>ft2232_device_desc <span class="s2">&quot;USB&lt;=&gt;JTAG&amp;RS232&quot;</span>
</span><span class='line'>ft2232_layout jtagkey
</span><span class='line'>ft2232_vid_pid <span class="mi">0</span>x1457 <span class="mi">0</span>x5118
</span><span class='line'>
</span><span class='line'><span class="c1">########Board Info###########</span>
</span><span class='line'><span class="c1"># Adjust Work-area size (RAM size) according to MCU in use:</span>
</span><span class='line'><span class="c1">#STM32F103VC --&gt; 48KB</span>
</span><span class='line'><span class="c1">#STM32F103RB --&gt; 20KB</span>
</span><span class='line'><span class="c1">#set WORKAREASIZE 0x5000</span>
</span><span class='line'><span class="c1"># STM32F103RE --&gt; 64KB</span>
</span><span class='line'><span class="c1"># set WORKAREASIZE 0x10000</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># reset_config parameter (see OpenOCD manual):</span>
</span><span class='line'><span class="c1"># none --&gt; srst and trst of MCU not connected to JTAG device</span>
</span><span class='line'><span class="c1"># srst_only --&gt; only srst of MCU connected to JTAG device</span>
</span><span class='line'><span class="c1"># trst_only --&gt; only trst of MCU connected to JTAG device</span>
</span><span class='line'><span class="c1"># srst_and_trst --&gt; srst and trst of MCU connected to JTAG device</span>
</span><span class='line'><span class="c1"># default setting: &quot;reset_config none&quot; will produce a single reset via SYSRESETREQ (JTAG commands) at reset pin of MCU</span>
</span><span class='line'><span class="c1">#reset_config none</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">#script for stm32f1x family</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> { [info exists CHIPNAME] } {
</span><span class='line'>   set _CHIPNAME $CHIPNAME
</span><span class='line'>} else {
</span><span class='line'>   set _CHIPNAME stm32f1x
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'><span class="k">if</span> { [info exists ENDIAN] } {
</span><span class='line'>   set _ENDIAN $ENDIAN
</span><span class='line'>} else {
</span><span class='line'>   set _ENDIAN little
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'><span class="c1"># Work-area is a space in RAM used for flash programming</span>
</span><span class='line'><span class="c1"># By default use 16kB</span>
</span><span class='line'><span class="k">if</span> { [info exists WORKAREASIZE] } {
</span><span class='line'>   set _WORKAREASIZE $WORKAREASIZE
</span><span class='line'>} else {
</span><span class='line'>   set _WORKAREASIZE <span class="mi">0</span>x4000
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'><span class="c1"># JTAG speed should be &lt;= F_CPU/6. F_CPU after reset is 8MHz, so use F_JTAG = 1MHz</span>
</span><span class='line'>adapter_khz <span class="mi">1000</span>
</span><span class='line'>
</span><span class='line'>adapter_nsrst_delay <span class="mi">100</span>
</span><span class='line'>jtag_ntrst_delay <span class="mi">100</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#jtag scan chain</span>
</span><span class='line'><span class="k">if</span> { [info exists CPUTAPID] } {
</span><span class='line'>   set _CPUTAPID $CPUTAPID
</span><span class='line'>} else {
</span><span class='line'>  <span class="c1"># See STM Document RM0008</span>
</span><span class='line'>  <span class="c1"># Section 26.6.3</span>
</span><span class='line'>   set _CPUTAPID <span class="mi">0</span>x3ba00477
</span><span class='line'>}
</span><span class='line'>jtag newtap $_CHIPNAME cpu -irlen <span class="mi">4</span> -ircapture <span class="mi">0</span>x1 -irmask <span class="mi">0</span>xf -expected-id $_CPUTAPID
</span><span class='line'>
</span><span class='line'><span class="k">if</span> { [info exists BSTAPID] } {
</span><span class='line'>   <span class="c1"># FIXME this never gets used to override defaults...</span>
</span><span class='line'>   set _BSTAPID $BSTAPID
</span><span class='line'>} else {
</span><span class='line'>  <span class="c1"># See STM Document RM0008</span>
</span><span class='line'>  <span class="c1"># Section 29.6.2</span>
</span><span class='line'>  <span class="c1"># Low density devices, Rev A</span>
</span><span class='line'>  set _BSTAPID1 <span class="mi">0</span>x06412041
</span><span class='line'>  <span class="c1"># Medium density devices, Rev A</span>
</span><span class='line'>  set _BSTAPID2 <span class="mi">0</span>x06410041
</span><span class='line'>  <span class="c1"># Medium density devices, Rev B and Rev Z</span>
</span><span class='line'>  set _BSTAPID3 <span class="mi">0</span>x16410041
</span><span class='line'>  set _BSTAPID4 <span class="mi">0</span>x06420041
</span><span class='line'>  <span class="c1"># High density devices, Rev A</span>
</span><span class='line'>  set _BSTAPID5 <span class="mi">0</span>x06414041
</span><span class='line'>  <span class="c1"># Connectivity line devices, Rev A and Rev Z</span>
</span><span class='line'>  set _BSTAPID6 <span class="mi">0</span>x06418041
</span><span class='line'>  <span class="c1"># XL line devices, Rev A</span>
</span><span class='line'>  set _BSTAPID7 <span class="mi">0</span>x06430041
</span><span class='line'>  <span class="c1"># VL line devices, Rev A and Z In medium-density and high-density value line devices</span>
</span><span class='line'>  set _BSTAPID8 <span class="mi">0</span>x06420041
</span><span class='line'>  <span class="c1"># VL line devices, Rev A</span>
</span><span class='line'>  set _BSTAPID9 <span class="mi">0</span>x06428041
</span><span class='line'>
</span><span class='line'>}
</span><span class='line'>jtag newtap $_CHIPNAME bs -irlen <span class="mi">5</span> -expected-id $_BSTAPID1 \
</span><span class='line'>  -expected-id $_BSTAPID2 -expected-id $_BSTAPID3 \
</span><span class='line'>  -expected-id $_BSTAPID4 -expected-id $_BSTAPID5 \
</span><span class='line'>  -expected-id $_BSTAPID6 -expected-id $_BSTAPID7 \
</span><span class='line'>  -expected-id $_BSTAPID8 -expected-id $_BSTAPID9
</span><span class='line'>
</span><span class='line'>set _TARGETNAME $_CHIPNAME.cpu
</span><span class='line'>target create $_TARGETNAME cortex_m -endian $_ENDIAN -chain-position $_TARGETNAME
</span><span class='line'>
</span><span class='line'>$_TARGETNAME configure -work-area-phys <span class="mi">0</span>x20000000 -work-area-size $_WORKAREASIZE -work-area-backup <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># flash size will be probed</span>
</span><span class='line'>set _FLASHNAME $_CHIPNAME.flash
</span><span class='line'>flash bank $_FLASHNAME stm32f1x <span class="mi">0</span>x08000000 <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> $_TARGETNAME
</span><span class='line'>
</span><span class='line'><span class="c1"># if srst is not fitted use SYSRESETREQ to</span>
</span><span class='line'><span class="c1"># perform a soft reset</span>
</span><span class='line'>cortex_m reset_config sysresetreq
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>openocd.cfg</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='linux-config'><span class='line'>[root@XXXyyy target]# openocd -f /media/y/embedded/stm32/dev/openocd.cfg -f ./stm32f1x.cfg
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/22/conky-customization/">Conky Customization</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-22T15:08:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2013</span></span> <span class='time'>3:08 pm</span></time>
        
         | <a href="/blog/2013/11/22/conky-customization/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Add existing user to specified group</h3>

<p>The problem is : why I can&rsquo;t use hddtemp? This is because hddtemp need priviledge for accessing the disk related equipment.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@XXXyyy ~]$ whoami
</span><span class='line'>Trusty
</span><span class='line'>[Trusty@XXXyyy ~]$ groups
</span><span class='line'>root log kvm users vboxusers
</span><span class='line'>[Trusty@XXXyyy ~]$ su root
</span><span class='line'>Password: 
</span><span class='line'>[root@XXXyyy Trusty]# groups
</span><span class='line'>root bin daemon sys adm disk wheel log
</span></code></pre></td></tr></table></div></figure>


<p>But this didn&rsquo;t solve the problem, I have to add prividge in /etc/sudoes,</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># visudo
</span><span class='line'>Trusty ALL = NOPASSWD: /usr/bin/hddtemp
</span></code></pre></td></tr></table></div></figure>


<p>Therefore in the configuration file of conky I need to replace the hddtemp with &ldquo;sudo hddtemp&rdquo;, everything will be displayed.</p>

<h3>Now testing the Conky</h3>

<p>After you have installed conky, the first thing for you to do is to edit its configuration file, to decide what to display on your own widget, my configuration file is listed as following:</p>

<figure class='code'><figcaption><span>conkyrc.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>alignment top_right
</span><span class='line'>background yes
</span><span class='line'>border_width 1
</span><span class='line'>cpu_avg_samples 2
</span><span class='line'>default_color black
</span><span class='line'>default_outline_color blue
</span><span class='line'>default_shade_color blue
</span><span class='line'>draw_borders no
</span><span class='line'>draw_graph_borders yes
</span><span class='line'>draw_outline no
</span><span class='line'>draw_shades no
</span><span class='line'>use_xft yes
</span><span class='line'>xftfont AR PL KaitiM GB:size=12
</span><span class='line'>gap_x 5
</span><span class='line'>gap_y 30
</span><span class='line'>minimum_size 280 5
</span><span class='line'>net_avg_samples 2
</span><span class='line'>no_buffers yes
</span><span class='line'>out_to_console no
</span><span class='line'>out_to_stderr no
</span><span class='line'>extra_newline no
</span><span class='line'>own_window yes
</span><span class='line'>own_window_class Conky
</span><span class='line'>own_window_type override
</span><span class='line'>##设置conky的默认背景色
</span><span class='line'>##own_window_colour 573049
</span><span class='line'>##很重要，只有启用argb才能透明，但是如果窗口属性如果设置为override，可能无法生效
</span><span class='line'>#own_window_argb_visual yes
</span><span class='line'>##设置透明的alpha值0-255，0为透明，255不透明
</span><span class='line'>#own_window_argb_value 0
</span><span class='line'>##own_window_argb_visual true
</span><span class='line'>##own_window_argb_value 120
</span><span class='line'>own_window_transparent yes
</span><span class='line'>double_buffer yes
</span><span class='line'>stippled_borders 0
</span><span class='line'>update_interval 1
</span><span class='line'>uppercase no
</span><span class='line'>use_spacer none
</span><span class='line'>show_graph_scale no
</span><span class='line'>show_graph_range no
</span><span class='line'>
</span><span class='line'>TEXT
</span><span class='line'>#${color red}${font AR PL KaitiM GB:style=Blod:size=17}    ${time %Y.%m.%d %H:%M:%S}
</span><span class='line'>#${font AR PL KaitiM GB:style=Blod:size=12}
</span><span class='line'>#${font AR PL KaitiM GB:style=Blod:size=12}${scroll 16 $nodename - $sysname $kernel on $machine}
</span><span class='line'>#$hr
</span><span class='line'>#${font AR PL KaitiM GB:style=Blod:size=14}${color green}${exec cal}
</span><span class='line'>#$hr
</span><span class='line'>${font AR PL KaitiM GB:style=Blod:size=12}${color purple}Uptime:$color $uptime
</span><span class='line'>${color purple}Frequency (in MHz):$color $freq
</span><span class='line'>#${color purple}Frequency (in GHz):$color $freq_g
</span><span class='line'>${color purple}RAM: $color$mem/$memmax - $memperc% ${membar 4}
</span><span class='line'>${color purple}Swap: $color$swap/$swapmax - $swapperc% ${swapbar 4}
</span><span class='line'>${color purple}CPU1: $color${cpu cpu1}% ${cpubar 4}
</span><span class='line'>${color purple}CPU2: $color${cpu cpu2}% ${cpubar 4}
</span><span class='line'>${color purple}CPU3: $color${cpu cpu3}% ${cpubar 4}
</span><span class='line'>${color purple}CPU4: $color${cpu cpu4}% ${cpubar 4}
</span><span class='line'>${color purple}Processes: $color $processes  ${color red}Running:$color $running_processes
</span><span class='line'>$hr
</span><span class='line'>#${color red}Temp:
</span><span class='line'>${color purple}CPU1 Temp: ${color red}${exec sensors | grep &#39;Core 0&#39; | awk {&#39;print $3&#39;}}
</span><span class='line'>${color purple}CPU2 Temp: ${color red}${exec sensors | grep &#39;Core 1&#39; | awk {&#39;print $3&#39;}}
</span><span class='line'>${color purple}System Temp: ${color red}${exec sensors | grep &#39;temp1&#39; | tail -1 | awk {&#39;print $2&#39;}}
</span><span class='line'>${color purple}Hard Temp: ${color red}${exec sudo hddtemp /dev/sda -n -u=C}°C
</span><span class='line'>$hr
</span><span class='line'>#${color red}File systems:
</span><span class='line'>${color black}${exec df -h | grep /dev/sda3 | awk {&#39;print $3&#39;}} / $color${fs_used /}/${fs_size /} ${fs_bar 6 /}
</span><span class='line'>${exec df -h | grep /dev/sda2 | awk {&#39;print $3&#39;}} x $color${exec df -h | grep /dev/sda2 | awk {&#39;print $3&#39;}}/138GB ${fs_bar 6 /media/ubuntu}
</span><span class='line'>#${exec df -h | grep /dev/sda8 | cut -c40-43} /boot $color${fs_used /boot}/${fs_size /boot} ${fs_bar 6 /boot}
</span><span class='line'>$hr
</span><span class='line'>#${color red}Networking:
</span><span class='line'>#${color red}eth0:
</span><span class='line'>#Up:$color ${upspeed eth0} ${color red} - Down:$color ${downspeed eth0}
</span><span class='line'>${color red}br0:
</span><span class='line'>Up:$color ${upspeed br0} ${color red} - Down:$color ${downspeed eth0}
</span><span class='line'>#${color red}ppp0:
</span><span class='line'>#${color red}Up:$color ${upspeed ppp0} ${color red} - Down:$color ${downspeed ppp0}
</span><span class='line'>$hr
</span><span class='line'>${color red}Name              PID   CPU%   MEM%
</span><span class='line'>${color black} ${top name 1} ${top pid 1} ${top cpu 1} ${top mem 1}
</span><span class='line'>${color black} ${top name 2} ${top pid 2} ${top cpu 2} ${top mem 2}
</span><span class='line'>${color black} ${top name 3} ${top pid 3} ${top cpu 3} ${top mem 3}
</span><span class='line'>${color purple} ${top name 4} ${top pid 4} ${top cpu 4} ${top mem 4}
</span><span class='line'>${color purple} ${top name 5} ${top pid 5} ${top cpu 5} ${top mem 5}
</span></code></pre></td></tr></table></div></figure>


<p>In fact I didn&rsquo;t finished the Translucent, so I use the Transparent, a little bit ugly, but it&rsquo;s OK.</p>

<h3>Add it into awesome</h3>

<p>Simply add one line in your ~/.config/awesome/rc.lua could solve the problem:</p>

<figure class='code'><figcaption><span>conkyrc.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>awful.util.spawn(&quot;conky&quot;)
</span></code></pre></td></tr></table></div></figure>


<p>Now you can enjoy your Conky.</p>

<p><img src="/images/conky.jpg" alt="conky.jpg" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/21/setup-an-embedded-development-enviroment-for-stm32/">Setup an Embedded Development Enviroment for STM32</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-21T20:50:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>8:50 pm</span></time>
        
         | <a href="/blog/2013/11/21/setup-an-embedded-development-enviroment-for-stm32/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Download the toolchain</h3>

<p>We should download the toolchain from the ARM employee maintained website, the download address is located at: <a href="https://launchpad.net/gcc-arm-embedded">https://launchpad.net/gcc-arm-embedded</a>, use following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget https://launchpad.net/gcc-arm-embedded/4.7/4.7-2013-q3-update/+download/gcc-arm-none-eabi-4_7-2013q3-20130916-linux.tar.bz2
</span></code></pre></td></tr></table></div></figure>


<p>untar the downloaded package and then add it to your system path, my solution is directly add some alias into ~/.bashrc:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>### Add Cross_Compiler for eclipse based stm32
</span><span class='line'>#export PATH="/media/y/embedded/cortex/gcc-arm-none-eabi-4_7-2013q3/bin:$PATH"
</span><span class='line'>alias setstm='export PATH="/media/y/embedded/cortex/gcc-arm-none-eabi-4_7-2013q3/bin:$PATH"'
</span></code></pre></td></tr></table></div></figure>


<h3>Eclipse Configuration</h3>

<p>We have to install zylin for flashing the stm32 board. After installation, eclipse will be rebooted.</p>

<p><img src="/images/eclipseinstall.jpg" alt="images/eclipseinstall.jpg" /></p>

<h3>OpenOCD</h3>

<p>OpenOCD is a open-source hardware debugger.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>community/openocd 0.7.0-2
</span><span class='line'>    Debugging, in-system programming and boundary-scan testing for embedded target devices
</span><span class='line'>[root@XXXyyy capscr]# pacman -S openocd
</span></code></pre></td></tr></table></div></figure>


<h3>Template prepration</h3>

<p>Download the template from :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/JorgeAparicio/bareCortexM.git
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/21/two-tips-for-setting/">Two Tips for Setting</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-21T18:49:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>6:49 pm</span></time>
        
         | <a href="/blog/2013/11/21/two-tips-for-setting/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Disable the vim wraping</h3>

<p>There is a line in ~/.vimrc:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>autocmd FileType text setlocal textwidth=78
</span></code></pre></td></tr></table></div></figure>


<p>comment this line then everything goes OK.</p>

<h3>Change Awesome theme and change the titlebar width</h3>

<p>Download the 3rd party themes from <a href="https://github.com/Morley93/awesome-themes-3.5">https://github.com/Morley93/awesome-themes-3.5</a>, then copy them to your own theme location, normally under the &ldquo;/usr/share/awesome/themes/&rdquo;, Choose whatever you want, and edit the ~/.config/awesome/default.rc.lua:</p>

<figure class='code'><figcaption><span>rc.lua</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='lua'><span class='line'><span class="n">beautiful</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">/usr/share/awesome/themes/wabbit/theme.lua&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Save and exit then you got the new theme.  <br/>
How to change the title bar? <br/>
In /usr/share/awesome/themes/wabbit/theme.lua, edit the following lines:</p>

<figure class='code'><figcaption><span>theme.lua</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='lua'><span class='line'><span class="c1">--theme.font          = &quot;MonteCarlo medium 11&quot;</span>
</span><span class='line'><span class="n">theme</span><span class="p">.</span><span class="n">font</span>          <span class="o">=</span> <span class="s2">&quot;</span><span class="s">MonteCarlo medium 9&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>I think 9 is good for me, but change this to 11 or bigger will make old men happy.   <br/>
You can change this number into a very big or very small number, then some funny things will happen :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/21/using-ir-remote-for-controlling-xbmc/">Using IR-remote for Controlling XBMC</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-21T15:57:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>3:57 pm</span></time>
        
         | <a href="/blog/2013/11/21/using-ir-remote-for-controlling-xbmc/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Wiring</h3>

<p>The Wiring is listed as following Picture, You got your IR receiver&rsquo;s pins to corresponding pins on raspberry PI. Positive to Pin1(3.3v), negative to Pin6(GND), the signal pins to Pin12(GPIO 18).</p>

<p><img src="/images/rasp1.jpg" alt="rasp1.jpg" /></p>

<h3>Check the Kernel information</h3>

<p>Log on to the raspberry PI, then input dmesg to view the startup information, we can see the lirc has been added to kernel.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ dmesg
</span><span class='line'>[    4.976752] systemd-udevd[822]: starting version 208
</span><span class='line'>[    7.121052] lirc_dev: IR Remote Control driver registered, major 248 
</span><span class='line'>[    7.187858] lirc_rpi: module is from the staging directory, the quality is unknown, you have been warned.
</span><span class='line'>[    7.234864] lirc_rpi lirc_rpi.0: lirc_dev: driver lirc_rpi registered at minor = 0
</span><span class='line'>[    7.234894] lirc_rpi: driver registered!
</span><span class='line'>[    8.191460] lirc_rpi: auto-detected active low receiver on GPIO pin 18
</span><span class='line'>[    8.981462] input: lircd as /devices/virtual/input/input3
</span></code></pre></td></tr></table></div></figure>


<p>Now Let&rsquo;s check the GPIO status:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>OpenELEC:~ # cat /sys/kernel/debug/gpio 
</span><span class='line'>GPIOs 0-53, bcm2708_gpio:
</span><span class='line'> gpio-16  (led0                ) out hi
</span><span class='line'> gpio-17  (lirc_rpi ir/out     ) in  lo
</span><span class='line'> gpio-18  (lirc_rpi ir/in      ) in  hi
</span></code></pre></td></tr></table></div></figure>


<p>If it didn&rsquo;t appear, using:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>modprobe lirc_rpi gpio_in_pin=18 gpio_out_pin=1
</span></code></pre></td></tr></table></div></figure>


<h3>Getting your own remote controller&rsquo;s codes</h3>

<p>Now let&rsquo;s kill all of the lircd related process, then use mode2 to detect the infra-red remote input.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>OpenELEC:~ # ps -ef | grep lirc
</span><span class='line'>1016 root       0:00 eventlircd --evmap=/etc/eventlircd.d --socket=/var/run/lirc/lircd --release=_UP
</span><span class='line'>1035 root       0:00 /usr/sbin/lircd --driver=default --device=/dev/lirc0 --uinput --output=/var/run/lirc/lircd-lirc0 --pidfile=/var/run/lirc/lircd-lirc0.pid /etc/lirc/lircd.conf.rpi
</span><span class='line'>1070 root      16:02 /usr/lib/xbmc/xbmc.bin --standalone -fs --lircdev /var/run/lirc/lircd
</span><span class='line'>1146 root       0:00 grep lirc
</span><span class='line'>OpenELEC:~ # killall lirc
</span><span class='line'>What is mode2?  
</span><span class='line'>Trusty@SomethingMissing:~$ apt-cache search mode2
</span><span class='line'>lirc-x - infra-red remote control support - X utilities
</span></code></pre></td></tr></table></div></figure>


<p>Then Let&rsquo;s listen the infra_remote&rsquo;s input.The input is quite strange:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>space 4501241
</span><span class='line'>pulse 8917
</span><span class='line'>space 4415
</span><span class='line'>pulse 577
</span></code></pre></td></tr></table></div></figure>


<h3>Catching the code using irrecord</h3>

<p>The next step is turns these message into some code.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>OpenELEC:~/.config # pwd
</span><span class='line'>/storage/.config
</span><span class='line'>OpenELEC:~/.config # ls
</span><span class='line'>aacs                 samba.conf.sample    vpn-config
</span><span class='line'>hosts.conf           sysctl.conf.sample
</span><span class='line'>remote.conf          udev.rules.d.sample
</span></code></pre></td></tr></table></div></figure>


<p>Use irrecord for recording some signals and transform them into code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NAME
</span><span class='line'>       irrecord - application for recording IR-codes for usage with LIRC
</span><span class='line'>
</span><span class='line'>OpenELEC:~/.config # irrecord -d /dev/lirc0 lircd.conf
</span></code></pre></td></tr></table></div></figure>


<p>The method is, first long-press some keys, the result on screen will be several dots, then the program will change to another line, this time when you press some key, it only has one dot. Keep pressing keys until the irrecord tells you successful. Then you should input make some keys meaningful to the following images, when you feel satisfied, press enter to endup the program.</p>

<p><img src="/images/LIRCMAP.png" alt="LIRCMAP.png" /></p>

<p>Now your lircd.conf file is generated, let see what&rsquo;s in it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat lircd.conf
</span><span class='line'>begin remote
</span><span class='line'>
</span><span class='line'>  name  lircd.conf
</span><span class='line'>  flags RAW_CODES|CONST_LENGTH
</span><span class='line'>  eps            30
</span><span class='line'>  aeps          100
</span><span class='line'>
</span><span class='line'>  gap          106707
</span><span class='line'>
</span><span class='line'>      begin raw_codes
</span><span class='line'>
</span><span class='line'>          name KEY_UP
</span><span class='line'>             8953    4401     581     527     595     503
</span><span class='line'>              613     506     588     539     581     510
</span></code></pre></td></tr></table></div></figure>


<p>If you want to use the pre-defined files, simply go to the  <a href="http://lirc.sourceforge.net/remotes">lirc.sourceforge.net/remotes</a> you can find almost all of the remote control information.</p>

<h3>Using the infra-remote for controlling</h3>

<p>Now call irw, but irw stunned with doing nothing. This command will show you all of the input signal</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>OpenELEC:~ # irw
</span><span class='line'>6a 0 KEY_RIGHT devinput
</span><span class='line'>6a 0 KEY_RIGHT_UP devinput
</span><span class='line'>69 0 KEY_LEFT devinput
</span><span class='line'>69 0 KEY_LEFT_UP devinput
</span><span class='line'>6c 0 KEY_DOWN devinput
</span><span class='line'>6c 0 KEY_DOWN_UP devinput
</span></code></pre></td></tr></table></div></figure>


<p>Now in your XBMC window, you will see you can navigate and select something using your remote control.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/20/generate-your-own-epub-book/">Generate Your Own Epub Book</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-20T22:22:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>10:22 pm</span></time>
        
         | <a href="/blog/2013/11/20/generate-your-own-epub-book/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Using Wget to fetching the webpages</h3>

<p>wget could be used to fetch the webpages from a specified website, using following command could fetch all of the wiki related 1st layer pages from &ldquo;awesome Wiki&rdquo;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget -r -l 1 http://awesome.naquadah.org/wiki/Main_Page
</span></code></pre></td></tr></table></div></figure>


<p>After wget finished, you will found the 1st layer webpatges under your directory.</p>

<h3>Decide which you want for generating the book</h3>

<p>There are some rubbish pages in downloaed pages, thus we have to write a script for fetching the valuable ones, my script is listed as following:</p>

<figure class='code'><figcaption><span>custom.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>Trusty@DashArch wget<span class="o">]</span><span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/home/Trusty/wget
</span><span class='line'><span class="o">[</span>Trusty@DashArch wget<span class="o">]</span><span class="nv">$ </span><span class="nb">cd </span>awesome.naquadah.org/
</span><span class='line'><span class="o">[</span>Trusty@DashArch awesome.naquadah.org<span class="o">]</span><span class="nv">$ </span>ls
</span><span class='line'>doc  download  images  index.html  robots.txt  wiki
</span><span class='line'><span class="o">[</span>Trusty@DashArch awesome.naquadah.org<span class="o">]</span><span class="nv">$ </span><span class="nb">cd </span>wiki
</span><span class='line'><span class="o">[</span>Trusty@DashArch wiki<span class="o">]</span><span class="nv">$ </span>cat listitem.sh
</span><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'><span class="k">for</span> file in <span class="sb">`</span>ls <span class="sb">`</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'>  <span class="c">#echo $file</span>
</span><span class='line'>  <span class="nb">type</span><span class="o">=</span><span class="sb">`</span>file <span class="nv">$file</span> <span class="p">|</span> awk <span class="o">{</span><span class="s1">&#39;print $2&#39;</span><span class="o">}</span><span class="sb">`</span>
</span><span class='line'>  <span class="c">#echo $type</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$type&quot;</span> <span class="o">=</span> <span class="s2">&quot;HTML&quot;</span> <span class="o">]</span>
</span><span class='line'>  <span class="k">then</span>
</span><span class='line'>      <span class="c">#echo $file</span>
</span><span class='line'>      <span class="c">#echo $type</span>
</span><span class='line'>      <span class="nb">echo</span> <span class="s2">&quot;&lt;a href=\&quot;$file\&quot;&gt;$file&lt;/a&gt;&lt;br/&gt;&quot;</span>
</span><span class='line'>  <span class="k">fi</span>
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<p>simply run  listitem.sh, we will get the file list tables like following:</p>

<figure class='code'><figcaption><span>allfiles.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;Automounting&quot;</span><span class="nt">&gt;</span>Automounting<span class="nt">&lt;/a&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;Autostart&quot;</span><span class="nt">&gt;</span>Autostart<span class="nt">&lt;/a&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;Autostart_with_consolekit&quot;</span><span class="nt">&gt;</span>Autostart_with_consolekit<span class="nt">&lt;/a&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;Autostop&quot;</span><span class="nt">&gt;</span>Autostop<span class="nt">&lt;/a&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;Awesome_3.0_to_3.1&quot;</span><span class="nt">&gt;</span>Awesome_3.0_to_3.1<span class="nt">&lt;/a&gt;&lt;br/&gt;</span>
</span><span class='line'>..........................................
</span></code></pre></td></tr></table></div></figure>


<p>Add them into the html like:</p>

<figure class='code'><figcaption><span>index.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>   <span class="nt">&lt;body&gt;</span>
</span><span class='line'>     <span class="nt">&lt;h1&gt;</span>Table of Contents<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>     <span class="nt">&lt;p</span> <span class="na">style=</span><span class="s">&quot;text-indent:0pt&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;Automounting&quot;</span><span class="nt">&gt;</span>Automounting<span class="nt">&lt;/a&gt;&lt;br/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;Autostart&quot;</span><span class="nt">&gt;</span>Autostart<span class="nt">&lt;/a&gt;&lt;br/&gt;</span>
</span><span class='line'>......
</span><span class='line'>  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;XRandR_Screen_Table&quot;</span><span class="nt">&gt;</span>XRandR_Screen_Table<span class="nt">&lt;/a&gt;&lt;br/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;Xscreensaver&quot;</span><span class="nt">&gt;</span>Xscreensaver<span class="nt">&lt;/a&gt;&lt;br/&gt;</span>
</span><span class='line'>     <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>   <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Generate the ebook</h3>

<p>Use Calibre, click &ldquo;Add Book&rdquo;, navigate to your directory which contains &ldquo;index.html&rdquo;, choose it, and now you can do whatever you want to generate epub, mobi, or 6 inch pdf. Just enjoy your ebook!!!</p>

<figure class='code'><figcaption><span>index.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>[Trusty@DashArch Awesome (5)]$ ls -l -h
</span><span class='line'>total 4.5M
</span><span class='line'>-rw-r--r-- 1 Trusty root 887K Nov 20 21:07 Awesome - Dash.epub
</span><span class='line'>-rw-r--r-- 1 Trusty root 511K Nov 20 21:19 Awesome - Dash.mobi
</span><span class='line'>-rw-r--r-- 1 Trusty root 2.6M Nov 20 21:10 Awesome - Dash.pdf
</span><span class='line'>-rw-r--r-- 1 Trusty root 560K Nov 20 21:06 Awesome - Dash.zip
</span><span class='line'>-rw-r--r-- 1 Trusty root 1.1K Nov 20 21:18 metadata.opf
</span></code></pre></td></tr></table></div></figure>


<p>Depending on your settings, your generated ebook could be read on NOOK, Kindle, or other mobile equipment.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/54">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/52">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/03/23/setup-vagrant-libvirt-env-on-ubuntu15-dot-04/">Setup Vagrant-libvirt Env on Ubuntu15.04</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/21/use-vagrant-to-manage-xenserver/">Use Vagrant to Manage XenServer</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/17/tips-on-5050rgb-2/">Tips on 5050RGB(2)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/16/vagrant-libvirt-playing/">Vagrant-libvirt Playing</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/15/ba-wan-ebuddy-4/">把玩ebuddy(4)</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
