
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="I&rsquo;ve been using octopress for writing blogs for nearly half of a year. The website is hosted on my family computer, which is a arm-based &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/51">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//fonts.googleapis.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/14/deploy-your-octopress-website-on-heroku/">Deploy Your Octopress Website on Heroku</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-14T09:48:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>9:48 am</span></time>
        
         | <a href="/blog/2013/12/14/deploy-your-octopress-website-on-heroku/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;ve been using octopress for writing blogs for nearly half of a year. The website is hosted on my family computer, which is a arm-based machine, runs Debian Linux. But such machine can sometimes be powered off by accident. That&rsquo;s while I want to put my webpages onto a stable server. Most of the people put their website on github, but github may be banned in china, so I choose heroku, I think it may be much more safer.</p>

<h3>Preparation</h3>

<p>First you have to register the heroku, and then create a new App, you will got a pop-up window which contains following message:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Your app, XXXX, has been Created.
</span><span class='line'>App URL:   http://XXXX.herokuapp.com/
</span><span class='line'>Git URL: git@heroku.com:XXXX.git
</span><span class='line'>Use the following code to set up your app for local development
</span><span class='line'>git clone git@heroku.com:XXXX.git -o heroku
</span></code></pre></td></tr></table></div></figure>


<p>You have to remember these messages, for later we will use them to upload our own website.</p>

<h3>Local Modification</h3>

<p>Clone your remote app to local directory</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git@heroku.com:XXXX.git -o heroku
</span><span class='line'>cd heroku
</span></code></pre></td></tr></table></div></figure>


<p>Copy your existing octopress to local directory, be sure to remove the existing .git directory in your octopress directory.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cp Source_Directory ./
</span></code></pre></td></tr></table></div></figure>


<p>Remove some files</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rm Gemfile.lock README.markdown CHANGELOG.markdown
</span></code></pre></td></tr></table></div></figure>


<p>Clear out the .slugignore file</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&gt;.slugignore
</span></code></pre></td></tr></table></div></figure>


<p>Update your gemfile:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>source "https://rubygems.org"
</span><span class='line'>
</span><span class='line'>group :development do
</span><span class='line'>  gem 'rake', '~&gt; 0.9'
</span><span class='line'>  gem 'jekyll', '~&gt; 0.12'
</span><span class='line'>  gem 'rdiscount', '~&gt; 1.6.8'
</span><span class='line'>  gem 'pygments.rb', '~&gt; 0.3.4'
</span><span class='line'>  gem 'RedCloth', '~&gt; 4.2.9'
</span><span class='line'>  gem 'haml', '~&gt; 3.1.7'
</span><span class='line'>  gem 'compass', '~&gt; 0.12.2'
</span><span class='line'>  gem 'sass', '~&gt; 3.2'
</span><span class='line'>  gem 'sass-globbing', '~&gt; 1.0.0'
</span><span class='line'>  gem 'rubypants', '~&gt; 0.2.0'
</span><span class='line'>  gem 'rb-fsevent', '~&gt; 0.9'
</span><span class='line'>  gem 'stringex', '~&gt; 1.4.0'
</span><span class='line'>  gem 'liquid', '~&gt; 2.3.0'
</span><span class='line'>  gem 'directory_watcher', '1.4.1'
</span><span class='line'>end
</span><span class='line'>gem 'rake', '~&gt; 0.9'
</span><span class='line'>gem 'jekyll', '~&gt; 0.12'
</span><span class='line'>gem 'rdiscount', '~&gt; 1.6.8'
</span><span class='line'>gem 'pygments.rb', '~&gt; 0.3.4'
</span><span class='line'>gem 'RedCloth', '~&gt; 4.2.9'
</span><span class='line'>gem 'haml', '~&gt; 3.1.7'
</span><span class='line'>gem 'compass', '~&gt; 0.12.2'
</span><span class='line'>gem 'sass-globbing', '~&gt; 1.0.0'
</span><span class='line'>gem 'rubypants', '~&gt; 0.2.0'
</span><span class='line'>gem 'stringex', '~&gt; 1.4.0'
</span><span class='line'>gem 'liquid', '~&gt; 2.3.0'
</span><span class='line'>gem 'sinatra', '~&gt; 1.4.2'
</span></code></pre></td></tr></table></div></figure>


<p>Since we use the rdiscount version is 1.6.8, when generate pages, this will cause failure, we also have to update one line in &ldquo;_config.yml&rdquo;:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>markdown: rdiscount
</span><span class='line'>rdiscount:
</span><span class='line'>  extensions:
</span><span class='line'>    - autolink
</span><span class='line'>      #- footnotes
</span><span class='line'>    - smart
</span></code></pre></td></tr></table></div></figure>


<h3>Setup</h3>

<p>Install the dependencies:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bundle install
</span></code></pre></td></tr></table></div></figure>


<p>Also you want to notice the rvm information, for example I use 1.9.3 for octopress, then my configuration is listed as:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat .rvmrc
</span><span class='line'>rvm use 1.9.3
</span><span class='line'>$ cat ~/.bashrc | grep rvm
</span><span class='line'>PATH=$PATH:$HOME/.rvm/bin # Add RVM to PATH for scripting
</span></code></pre></td></tr></table></div></figure>


<h3>Testing</h3>

<p>Generate the website:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake generate
</span></code></pre></td></tr></table></div></figure>


<p>Preview the website:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake preview
</span></code></pre></td></tr></table></div></figure>


<p>Open <a href="http://127.0.0.1:4000">http://127.0.0.1:4000</a> to view the preview result.</p>

<h3>Deploy</h3>

<p>Add all of the files in current directory to git</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git add .
</span></code></pre></td></tr></table></div></figure>


<p>Commit all of the changes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git commit -m 'site initialized'
</span></code></pre></td></tr></table></div></figure>


<p>Push your changes to heroku</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git push heroku master
</span></code></pre></td></tr></table></div></figure>


<p>View your website:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>heroku open
</span></code></pre></td></tr></table></div></figure>


<h3>Ignore some tmp files</h3>

<p>Create a .gitignore file under the current directory</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.bundle
</span><span class='line'>.DS_Store
</span><span class='line'>.sass-cache
</span><span class='line'>.gist-cache
</span><span class='line'>.pygments-cache
</span><span class='line'>_deploy
</span><span class='line'>public
</span><span class='line'>sass.old
</span><span class='line'>source.old
</span><span class='line'>source/_stash
</span><span class='line'>source/stylesheets/screen.css
</span><span class='line'>vendor
</span><span class='line'>node_modules
</span><span class='line'>*~
</span></code></pre></td></tr></table></div></figure>


<p>Update the cache via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git rm -r --cached .
</span><span class='line'>git add .
</span><span class='line'>git commit -m "fixed untracked files"
</span></code></pre></td></tr></table></div></figure>


<p>Push again:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git push heroku master
</span></code></pre></td></tr></table></div></figure>


<p>Unfortunately, the .gitignore couldn&rsquo;t remove public, so the final file only contains:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>*~
</span></code></pre></td></tr></table></div></figure>


<h3>Future Modification</h3>

<p>Add new blogs:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake new_post["Your_Article_Name"]
</span></code></pre></td></tr></table></div></figure>


<p>Generate locally:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake generate 
</span></code></pre></td></tr></table></div></figure>


<p>Add changes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git commit -a 
</span></code></pre></td></tr></table></div></figure>


<p>Push to heroku:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git push heroku master
</span></code></pre></td></tr></table></div></figure>


<p>Now you have a stable and swift website on heroku, enjoy it.</p>

<h3>Modify theme</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://github.com/lucaslew/whitespace .themes/Whitespace
</span><span class='line'>rake install['Whitespace']
</span><span class='line'>rake generate
</span></code></pre></td></tr></table></div></figure>


<p>More themes could be found at <a href="https://github.com/imathis/octopress/wiki/3rd-Party-Octopress-Themes">https://github.com/imathis/octopress/wiki/3rd-Party-Octopress-Themes</a>.   <br/>
You can preview these themes at <a href="http://opthemes.com/">http://opthemes.com/</a>.</p>

<h3>Change Colorscheme</h3>

<p>Since our theme locates under the .themes/Whitespace folder, simply change the following files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pwd
</span><span class='line'>/home/Trusty/code/octo/heroku/Tomcat/.themes/Whitespace/sass/base
</span><span class='line'>[Trusty@~/code/octo/heroku/Tomcat/.themes/Whitespace/sass/base]$ cat _solarized.scss
</span><span class='line'>//$solarized: dark !default;
</span><span class='line'>$solarized: light !default;
</span></code></pre></td></tr></table></div></figure>


<p>Now your blog should have the light theme of solarized.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/13/ssh-with-no-password-for-github/">Ssh With No Password for Github</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-13T17:07:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>5:07 pm</span></time>
        
         | <a href="/blog/2013/12/13/ssh-with-no-password-for-github/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Github Account Setting</h3>

<p>Steps for settingup in your github accounting:  <br/>
Go to your Settings.   <br/>
Click &ldquo;SSH Keys&rdquo; in the left sidebar  <br/>
Click &ldquo;Add SSH key&rdquo;   <br/>
Paste your key into the &ldquo;Key&rdquo; field   <br/>
Click &ldquo;Add key&rdquo;   <br/>
Confirm the action by entering your GitHub password</p>

<p>The public key could be got via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ xclip -sel clip &lt; ~/.ssh/id_rsa.pub
</span></code></pre></td></tr></table></div></figure>


<p>Then see if you were authorized by github:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@XXXyyy debian_octopress]$ ssh -T git@github.com
</span><span class='line'>Hi geogueo! You've successfully authenticated, but GitHub does not provide shell access.
</span></code></pre></td></tr></table></div></figure>


<h3>Setting for repository</h3>

<p>Add the remote url for local repository</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@XXXyyy debian_octopress]$ git remote set-url origin git@github.com:geogueo/debian_octopress.git
</span></code></pre></td></tr></table></div></figure>


<p>Now you can use the following command for swiftly commit your code</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@XXXyyy debian_octopress]$ unset SSH_ASKPASS
</span><span class='line'>[Trusty@XXXyyy debian_octopress]$ git push origin master
</span><span class='line'>Warning: Permanently added the RSA host key for IP address '192.30.252.129' to the list of known hosts.
</span><span class='line'>Everything up-to-date
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/13/write-blogger-in-linux/">Write Blogger in Linux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-13T14:52:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>2:52 pm</span></time>
        
         | <a href="/blog/2013/12/13/write-blogger-in-linux/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>blogtk</h3>

<p>Install it via &ldquo;yaourt -S blogtk&rdquo;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/12/western-digits-green-disk-on-ubuntu/">Western Digital Green Disk on Ubuntu</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-12T18:55:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>6:55 pm</span></time>
        
         | <a href="/blog/2013/12/12/western-digits-green-disk-on-ubuntu/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The WD20EARS (and other sizes include 1.0 and 1.5 TB driver in the series) will attempt to park the read heads once every 8 seconds FOR THE LIFE OF THE HDD which is just horrible! To see if you are affected use the smartctl command (part of smartmontools). If the last column changes rapidly, this section applies to your drive.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># smartctl /dev/sdb -a | grep Load_Cycle
</span><span class='line'>193 Load_Cycle_Count        0x0032   001   001   000    Old_age   Always       -       597115 
</span></code></pre></td></tr></table></div></figure>


<p>We have to disable this feature. Add lines to /etc/rc.local</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>hdparam -S 242 /dev/sda
</span><span class='line'>exit 0
</span></code></pre></td></tr></table></div></figure>


<p>The effect for upper comand is listed as:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># hdparm -S 242 /dev/sda
</span><span class='line'>/dev/sda:
</span><span class='line'> setting standby to 242 (1 hours)
</span></code></pre></td></tr></table></div></figure>


<p>By default the disk will standby when 1 hours reached, that will avoid our disk from broken.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/12/kali-linux-in-qemu/">KALI Linux in Qemu</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-12T17:32:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>5:32 pm</span></time>
        
         | <a href="/blog/2013/12/12/kali-linux-in-qemu/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Download the iso from kali website<a href="http://www.kali.org/downloads/">http://www.kali.org/downloads/</a>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget http://cdimage.kali.org/kali-images/kali-1.0.5/kali-linux-1.0.5-i386.iso
</span></code></pre></td></tr></table></div></figure>


<p>Create qemu img file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ qemu-img create -f qcow2 kali.qcow2 30G
</span><span class='line'>Formatting 'kali.qcow2', fmt=qcow2 size=32212254720 encryption=off cluster_size=65536 lazy_refcounts=off 
</span><span class='line'>Run installation. Here we use the run-qemu script which has been generated before under the same directory:
</span><span class='line'>[Trusty@DashArch kali]$ ./run-qemu -hda ./kali.qcow2 -boot d -cdrom /media/nfs/iso/kali-linux-1.0.5-i386.iso  -m 1024 -enable-kvm -usb
</span></code></pre></td></tr></table></div></figure>


<p>Choose &ldquo;Graphic Install&rdquo; because currently we are not familiar with this brand new distribution.   <br/>
Command for startup the sytem is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@DashArch kali]$ ./run-qemu -hda ./kali.qcow2 -boot d -cdrom /media/nfs/iso/kali-linux-1.0.5-i386.iso  -m 1024 -enable-kvm -usb
</span></code></pre></td></tr></table></div></figure>


<p>After installation finished, run &ldquo;sudo apt-get update&rdquo; and &ldquo;sudo apt-get upgrade&rdquo; to update your system to the newest version.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/12/ntp-in-lan-based-on-openwrt/">NTP in LAN Based on OPENWRT</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-12T14:13:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>2:13 pm</span></time>
        
         | <a href="/blog/2013/12/12/ntp-in-lan-based-on-openwrt/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Package Installation</h3>

<p>Disable the system default ntp server and install ntpd, this ntpd is the real ntpd package, not busybox-ntpd</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>opkg update
</span><span class='line'>opkg install ntpd
</span><span class='line'>/etc/init.d/sysntpd disable
</span><span class='line'>/etc/init.d/ntpd enable
</span><span class='line'>/etc/init.d/ntpd start
</span><span class='line'>netstat -l | grep ntp
</span></code></pre></td></tr></table></div></figure>


<p>The client installation, on debian:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>apt-get install ntp
</span></code></pre></td></tr></table></div></figure>


<h3>Server Configuration</h3>

<p>Comment all of the possible reference server, use local time source.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@OpenWrt:~# cat /etc/ntp.conf 
</span><span class='line'># use a random selection of 4 public stratum 2 servers
</span><span class='line'># see http://twiki.ntp.org/bin/view/Servers/NTPPoolServers
</span><span class='line'>
</span><span class='line'>restrict default nomodify notrap noquery
</span><span class='line'>#restrict default noquery
</span><span class='line'>
</span><span class='line'>#restrict 127.0.0.1
</span><span class='line'>restrict 10.0.0.0 mask 255.255.255.0 nomodify notrap
</span><span class='line'>
</span><span class='line'>server 127.127.1.0    # LOCAL CLOCK
</span><span class='line'>fudge 127.127.1.0 stratum 0
</span><span class='line'>
</span><span class='line'>driftfile  /var/lib/ntp/ntp.drift
</span></code></pre></td></tr></table></div></figure>


<p>Then restart the service. Your ntp server is available.</p>

<h3>Client Configuration</h3>

<p>Enable saned to enable ntp client on beaglebone:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># error message
</span><span class='line'>[....] Starting NTP server: ntpdsaned disabled; edit /etc/default/saned
</span><span class='line'>vim /etc/default/saned 
</span><span class='line'># Set to yes to start saned
</span><span class='line'>RUN=yes
</span></code></pre></td></tr></table></div></figure>


<p>Then we have to enable the ntp client&rsquo;s configuration:   <br/>
For Client manually synchornize</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~# ntpdate 10.0.0.1
</span><span class='line'> 1 Jan 05:18:55 ntpdate[2243]: the NTP socket is in use, exiting
</span><span class='line'>root@arm:~# ps -ef | grep ntp
</span><span class='line'>ntp       1805     1  0 04:30 ?        00:00:00 /usr/sbin/ntpd -p /var/run/ntpd.pid -g -u 107:112
</span><span class='line'>root      2245  2127  0 05:19 pts/0    00:00:00 grep ntp
</span><span class='line'>root@arm:~# kill 1805
</span><span class='line'>root@arm:~# date
</span><span class='line'>Sat Jan  1 05:19:05 UTC 2000
</span><span class='line'>root@arm:~# ntpdate 10.0.0.1
</span><span class='line'>12 Dec 07:38:44 ntpdate[2247]: step time server 10.0.0.1 offset 440129967.397166 sec
</span><span class='line'>root@arm:~# date
</span><span class='line'>Thu Dec 12 07:38:46 UTC 2013
</span></code></pre></td></tr></table></div></figure>


<p>The client configuration for ntp, remove all of the possible server, use LAN server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>server 10.0.0.1
</span></code></pre></td></tr></table></div></figure>


<p>tzselect will set the timezone of the equipment. The result is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>TZ='Asia/Shanghai'; export TZ
</span></code></pre></td></tr></table></div></figure>


<p>Add it into the ~/.profile, then your time will be adjusted to Shanghai Time.</p>

<h3>Update time via http</h3>

<p>Since I located in UMT+8, I will use following commands for sync the time</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>date $(wget -O - "http://www.timeapi.org/utc/in+eight+hours" 2&gt;/dev/null | sed s/[-T:+]/\ /g | awk '{print $2,$3,$4,$5,".",$6}' | tr -d " " )
</span></code></pre></td></tr></table></div></figure>


<p>Then add it to crontab</p>

<figure class='code'><figcaption><span>time.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>root@OpenWrt:~# cat /bin/time.sh
</span><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'><span class="c">#echo $http_proxy</span>
</span><span class='line'><span class="c">#echo $https_proxy</span>
</span><span class='line'>date <span class="k">$(</span>wget -O - <span class="s2">&quot;http://www.timeapi.org/utc/in+eight+hours&quot;</span> 2&gt;/dev/null <span class="p">|</span> sed s/<span class="o">[</span>-T:+<span class="o">]</span>/<span class="se">\ </span>/g <span class="p">|</span> awk <span class="s1">&#39;{print $2,$3,$4,$5,&quot;.&quot;,$6}&#39;</span> <span class="p">|</span> tr -d <span class="s2">&quot; &quot;</span> <span class="k">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The crontab -e should like following:</p>

<figure class='code'><figcaption><span>time.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>* */3 * * * /bin/time.sh
</span></code></pre></td></tr></table></div></figure>


<p>This means every 3 hours the script will be called for synchronizing the time.   <br/>
Now we can enjoy the precise time from the internet and make it availale for the service on LAN.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/11/bbblackbian-yi-jiao-ben-jie-xi/">BBBlack编译脚本解析</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-11T19:14:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>7:14 pm</span></time>
        
         | <a href="/blog/2013/12/11/bbblackbian-yi-jiao-ben-jie-xi/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Preparation</h3>

<p>Download the &ldquo;linux-dev&rdquo; repository from github:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://github.com/RobertCNelson/linux-dev.git
</span></code></pre></td></tr></table></div></figure>


<p>View the downloaded packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@XXXyyy mykernel]$ du -hs linux-dev/
</span><span class='line'>19M   linux-dev/
</span><span class='line'>[Trusty@XXXyyy linux-dev]$ ls
</span><span class='line'>build_deb.sh  build_kernel.sh  build_mainline.sh  LICENSE  patches  patch.sh  README  repo_maintenance  scripts  system.sh.sample  tools  version.sh
</span></code></pre></td></tr></table></div></figure>


<p>Switch to the 3.12 Branch:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git checkout origin/am33x-v3.12 -b tmp
</span><span class='line'>[Trusty@XXXyyy linux-dev]$ ls
</span><span class='line'>build_deb.sh  build_kernel.sh  LICENSE  patches  patch.sh  README  repo_maintenance  scripts  system.sh.sample  tools  version.sh
</span></code></pre></td></tr></table></div></figure>


<h3>Walk by lines</h3>

<p>Since we call ./build_kernel.sh will initialize the building, we will first see what&rsquo;s in this file  <br/>
a. Create the deploy directory, Line 23-Line 25</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">DIR</span><span class="o">=</span><span class="nv">$PWD</span>
</span><span class='line'>mkdir -p <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/deploy/
</span></code></pre></td></tr></table></div></figure>


<p>Then the code goes to line 189, since all of the code between 25-189 are functions.</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>/bin/sh -e <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/tools/host_det.sh <span class="o">||</span> <span class="o">{</span> <span class="nb">exit </span><span class="m">1</span> <span class="p">;</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This line will call tools/host_det.sh to detect the host, the result is listed:</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>Trusty@XXXyyy linux-dev<span class="o">]</span><span class="nv">$ </span>tools/host_det.sh
</span><span class='line'>which: no lsb_release in <span class="o">(</span>/home/Trusty/.rvm/gems/ruby-1.9.3-p448/bin:/home/Trusty/.rvm/gems/ruby-1.9.3-p448@global/bin:/home/Trusty/.rvm/rubies/ruby-1.9.3-p448/bin:/home/Trusty/.rvm/bin:/media/y/embedded/cortex/gcc-arm-none-eabi-4_7-2013q3/bin:/home/Trusty/perl5/bin:/opt/cross/bin:/media/y/u-boot/4.3.2/bin/:/usr/local/sbin:/usr/local/bin:/usr/bin:/opt/android-sdk/platform-tools:/opt/android-sdk/tools:/usr/bin/site_perl:/usr/bin/core_perl<span class="o">)</span>
</span><span class='line'>+ Detected build host <span class="o">[]</span>
</span><span class='line'>+ host: <span class="o">[</span>x86_64<span class="o">]</span>
</span><span class='line'>+ git HEAD commit: <span class="o">[</span>858e7dbdedcb5d85d0e3b84323c5a6bfe6bd3b5e<span class="o">]</span>
</span><span class='line'>In host_det.sh, the code lines between 6~381 are all functions, till line 381.
</span><span class='line'><span class="k">if</span> <span class="o">[</span> <span class="k">$(</span>which lsb_release<span class="k">)</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
</span><span class='line'>         info <span class="s2">&quot;Detected build host [`lsb_release -sd`]&quot;</span>
</span><span class='line'>Following is the lsb_relase result, lsb_release is the linux standard base base package, which will provide enough infomations of the installed linux system.
</span><span class='line'><span class="nv">$ </span>lsb_release
</span><span class='line'>LSB Version:  :core-3.1-ia32:core-3.1-noarch:graphics-3.1-ia32:graphics-3.1-noarch
</span><span class='line'><span class="o">[</span>Tomcat@MisteryPlace:  <span class="o">[]</span> /opt/home/Tomcat<span class="o">]</span>                                                                                        <span class="nv">$ </span>lsb_release -sd
</span><span class='line'><span class="s2">&quot;Scientific Linux SL release 5.5 (Boron)&quot;</span>
</span><span class='line'><span class="o">[</span>Tomcat@MisteryPlace:  <span class="o">[]</span> /opt/home/Tomcat<span class="o">]</span>                                                                                        <span class="nv">$ </span>uname -m
</span><span class='line'>i686
</span></code></pre></td></tr></table></div></figure>


<p>Testing the host and the git head commit</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>info <span class="s2">&quot;host: [`uname -m`]&quot;</span>
</span><span class='line'>info <span class="s2">&quot;git HEAD commit: [`git rev-parse HEAD`]&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This script is for testing the known hosts which runs redhat/debian/suse, and verify if you have installed all of the package need to support kernel build.</p>

<p>Copy the system.sh.sample to current directory</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="k">if</span> <span class="o">[</span> ! -f <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/system.sh <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
</span><span class='line'>  cp <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/system.sh.sample <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/system.sh
</span></code></pre></td></tr></table></div></figure>


<p>Next lines from 199 to 218 is to detect if the branches.list and branch.expired exists, if exists then some testing will be done.</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="k">if</span> <span class="o">[</span> -f <span class="s2">&quot;${DIR}/branches.list&quot;</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;-----------------------------&quot;</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;Please checkout one of the active branches:&quot;</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;-----------------------------&quot;</span>
</span><span class='line'>  cat <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/branches.list <span class="p">|</span> grep -v INACTIVE
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;-----------------------------&quot;</span>
</span><span class='line'>  <span class="nb">exit</span>
</span><span class='line'><span class="k">fi</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then go to line 220 and 221, unset 2 system variable</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">unset </span>CC
</span><span class='line'><span class="nb">unset </span>LINUX_GIT
</span></code></pre></td></tr></table></div></figure>


<p>Then run system.sh</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>. <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/system.sh
</span></code></pre></td></tr></table></div></figure>


<p>Then we will prepare the gcc.</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>/bin/sh -e <span class="s2">&quot;${DIR}/scripts/gcc.sh&quot;</span> <span class="o">||</span> <span class="o">{</span> <span class="nb">exit </span><span class="m">1</span> <span class="p">;</span> <span class="o">}</span>
</span><span class='line'>Switching to scripts/gcc.sh, the following lines will <span class="nb">set </span>the system variables, which will be used to choose the suitable linaro toolchain.
</span><span class='line'>. <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/system.sh
</span><span class='line'>
</span><span class='line'><span class="c">#For:</span>
</span><span class='line'><span class="c">#linaro_toolchain</span>
</span><span class='line'>. <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/version.sh
</span><span class='line'>Test the CC existence, <span class="k">if</span> not <span class="k">then</span> start building:
</span><span class='line'><span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;x${CC}&quot;</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">&quot;x${ARCH}&quot;</span> !<span class="o">=</span> <span class="s2">&quot;xarmv7l&quot;</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
</span><span class='line'>  gcc_linaro_toolchain
</span><span class='line'><span class="k">fi</span>
</span></code></pre></td></tr></table></div></figure>


<p>The code are funny, because echo x${CC} is actually x , so the gcc_linaro_toolchain will surely be called.</p>

<figure class='code'><figcaption><span>build_kernel.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="k">${</span><span class="nv">linaro_toolchain</span><span class="k">}</span>
</span><span class='line'>cortex_gcc_4_8
</span></code></pre></td></tr></table></div></figure>


<p>The variable {linaro_toolchain} is set via . version.sh, then the corresponding code lines will be called</p>

<figure class='code'><figcaption><span>gcc.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>   cortex_gcc_4_8<span class="o">)</span>
</span><span class='line'>      <span class="c">#https://launchpad.net/linaro-toolchain-binaries/+download</span>
</span><span class='line'>      <span class="c">#https://launchpad.net/linaro-toolchain-binaries/trunk/2013.10/+download/gcc-linaro-arm-linux-gnueabihf-4.8-2013.10_linux.tar.xz</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">gcc_version</span><span class="o">=</span><span class="s2">&quot;4.8&quot;</span>
</span><span class='line'>      <span class="nv">release</span><span class="o">=</span><span class="s2">&quot;2013.10&quot;</span>
</span><span class='line'>      <span class="nv">toolchain_name</span><span class="o">=</span><span class="s2">&quot;gcc-linaro-arm-linux-gnueabihf&quot;</span>
</span><span class='line'>      <span class="nv">site</span><span class="o">=</span><span class="s2">&quot;https://launchpad.net/linaro-toolchain-binaries&quot;</span>
</span><span class='line'>      <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;trunk/${release}&quot;</span>
</span><span class='line'>      <span class="nv">directory</span><span class="o">=</span><span class="s2">&quot;${toolchain_name}-${gcc_version}-${release}_linux&quot;</span>
</span><span class='line'>      <span class="nv">filename</span><span class="o">=</span><span class="s2">&quot;${directory}.tar.xz&quot;</span>
</span><span class='line'>      <span class="nv">datestamp</span><span class="o">=</span><span class="s2">&quot;${release}-${toolchain_name}&quot;</span>
</span><span class='line'>      <span class="nv">untar</span><span class="o">=</span><span class="s2">&quot;tar -xJf&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">binary</span><span class="o">=</span><span class="s2">&quot;bin/arm-linux-gnueabihf-&quot;</span>
</span><span class='line'>      <span class="p">;;</span>
</span><span class='line'>  *<span class="o">)</span>
</span><span class='line'>      <span class="nb">echo</span> <span class="s2">&quot;bug: maintainer forgot to set:&quot;</span>
</span><span class='line'>      <span class="nb">echo</span> <span class="s2">&quot;linaro_toolchain=\&quot;xzy\&quot; in version.sh&quot;</span>
</span><span class='line'>      <span class="nb">exit </span>1
</span><span class='line'>      <span class="p">;;</span>
</span></code></pre></td></tr></table></div></figure>


<p>
dl_gcc_generic will be called. download the corresponding packages from the linaro website.</p>

<p>After set the cross-compiler, we can get the kernel using git.sh, the git.sh is listed in scripts/git.sh</p>

<figure class='code'><figcaption><span>gcc.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>/bin/sh -e <span class="s2">&quot;${DIR}/scripts/git.sh&quot;</span> <span class="o">||</span> <span class="o">{</span> <span class="nb">exit </span><span class="m">1</span> <span class="p">;</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In git.sh, detect the user&rsquo;s email and user&rsquo;s name:</p>

<figure class='code'><figcaption><span>git.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">unset </span>git_config_user_email
</span><span class='line'><span class="nv">git_config_user_email</span><span class="o">=</span><span class="k">$(</span>git config --get user.email <span class="o">||</span> <span class="nb">true</span><span class="k">)</span>
</span><span class='line'>
</span><span class='line'><span class="nb">unset </span>git_config_user_name
</span><span class='line'><span class="nv">git_config_user_name</span><span class="o">=</span><span class="k">$(</span>git config --get user.name <span class="o">||</span> <span class="nb">true</span><span class="k">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then set using http or git, call git_kernel to git clone the corresponding resources from github.  <br/>
git_kernel will call check_and_or_clone() to get the source code from the github.</p>

<figure class='code'><figcaption><span>git.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git clone <span class="k">${</span><span class="nv">torvalds_linux</span><span class="k">}</span> <span class="k">${</span><span class="nv">DIR</span><span class="k">}</span>/ignore/linux-src
</span></code></pre></td></tr></table></div></figure>


<p>and set the LINUX_GIT variable to</p>

<figure class='code'><figcaption><span>git.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">LINUX_GIT</span><span class="o">=</span><span class="s2">&quot;${DIR}/ignore/linux-src&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The downloaded packages are so large, that it occupies 1.4G disk space.</p>

<figure class='code'><figcaption><span>git.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>Trusty@XXXyyy ignore<span class="o">]</span><span class="nv">$ </span>du -hs *
</span><span class='line'>1.4G  linux-src
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/11/debian-on-nfs/">Debian on NFS</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-11T17:25:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>5:25 pm</span></time>
        
         | <a href="/blog/2013/12/11/debian-on-nfs/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Install some packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ apt-get install usbutils alsa-base
</span></code></pre></td></tr></table></div></figure>


<p>Use lsusb to view the installed usb equipments:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Bus 001 Device 006: ID 0e5c:6441 Bitland Information Technology Co., Ltd C-Media Sound Device
</span></code></pre></td></tr></table></div></figure>


<p>Install modules to the filesystem, since our newly-installed filesytem doesn&rsquo;t contains the necessary modules:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pwd
</span><span class='line'>/media/x/bbBlack/38/linux-dev/deploy
</span></code></pre></td></tr></table></div></figure>


<p>Copy the firmware tar package and modules tar package to the nfs root directory</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ tar xzvf 3.8.13-bone30-modules.tar.gz  -C ./
</span><span class='line'>$ tar xzvf ./3.8.13-bone30-firmware.tar.gz -C  ./lib/firmware/
</span></code></pre></td></tr></table></div></figure>


<p>Reboot and Use aplay to view the installed sound card:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:/# aplay -l
</span><span class='line'>**** List of PLAYBACK Hardware Devices ****
</span><span class='line'>card 0: Black [TI BeagleBone Black], device 0: HDMI nxp-hdmi-hifi-0 []
</span><span class='line'>  Subdevices: 1/1
</span><span class='line'>  Subdevice #0: subdevice #0
</span><span class='line'>card 1: U0xe5c0x6441 [USB Device 0xe5c:0x6441], device 0: USB Audio [USB Audio]
</span><span class='line'>  Subdevices: 0/1
</span><span class='line'>  Subdevice #0: subdevice #0
</span></code></pre></td></tr></table></div></figure>


<p>Edit a new asound.conf, which will enable the system to use the usb audio as the default sound card:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:/# cat /etc/asound.conf
</span><span class='line'>pcm.!default { 
</span><span class='line'>type hw 
</span><span class='line'>card 1
</span><span class='line'>#device 0 
</span><span class='line'>}
</span><span class='line'>ctl.!default { 
</span><span class='line'>type hw 
</span><span class='line'>card  1
</span><span class='line'>#device 0 
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Now you can use the mplayer to enjoy the sound from the console.      <br/>
If you want to grant the right to the ordinary user, Just use acl:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> setfacl -m u:debian:rw /dev/snd/*
</span></code></pre></td></tr></table></div></figure>


<p>Now the user &ldquo;debian&rdquo; could also listen the music from the console.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/11/nfs-of-beaglebone/">NFS of Beaglebone</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-11T09:32:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>9:32 am</span></time>
        
         | <a href="/blog/2013/12/11/nfs-of-beaglebone/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Serial Preparation</h3>

<p>The serial port image is as following:
<img src="/images/serial1.jpg" alt="serial1.jpg" /></p>

<p><img src="/images/serial2.jpg" alt="serial2.jpg" /></p>

<h3>Failure information</h3>

<p>The bootup failure information is listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Running uenvcmd ...
</span><span class='line'>reading zImage
</span><span class='line'>3345240 bytes read in 383 ms (8.3 MiB/s)
</span><span class='line'>reading /dtbs/am335x-boneblack.dtb
</span><span class='line'>24884 bytes read in 10 ms (2.4 MiB/s)
</span><span class='line'>
</span><span class='line'>Starting kernel ...
</span><span class='line'>
</span><span class='line'>Uncompressing Linux... done, booting the kernel.
</span><span class='line'>
</span><span class='line'>Error: unrecognized/unsupported machine ID (r1 = 0x00000e05).
</span><span class='line'>
</span><span class='line'>Available machine support:
</span><span class='line'>
</span><span class='line'>ID (hex)        NAME
</span><span class='line'>ffffffff        Generic OMAP4 (Flattened Device Tree)
</span><span class='line'>ffffffff        Generic AM33XX (Flattened Device Tree)
</span><span class='line'>ffffffff        Generic OMAP3-GP (Flattened Device Tree)
</span><span class='line'>ffffffff        Generic OMAP3 (Flattened Device Tree)
</span><span class='line'>0000060a        OMAP3 Beagle Board
</span><span class='line'>00000a9d        IGEP OMAP3 module
</span><span class='line'>00000928        IGEP v2 board
</span><span class='line'>00000ae7        OMAP4 Panda board
</span><span class='line'>
</span><span class='line'>Please check your kernel config and/or bootloader.
</span></code></pre></td></tr></table></div></figure>


<p>This is because the configuration file of the uEnv.txt is not right, the right one should be listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kernel_file=zImage
</span><span class='line'>initrd_file=uInitrd
</span><span class='line'>serverip=10.0.0.11
</span><span class='line'>ipaddr=10.0.0.122
</span><span class='line'>rootpath=/media/debianroot
</span><span class='line'>console=ttyO0,115200n8
</span><span class='line'>
</span><span class='line'>loadzimage=load mmc ${mmcdev}:${mmcpart} ${loadaddr} ${kernel_file}
</span><span class='line'>loadinitrd=load mmc ${mmcdev}:${mmcpart} 0x81000000 ${initrd_file}; setenv initrd_size ${filesize}
</span><span class='line'>loadfdt=load mmc ${mmcdev}:${mmcpart} ${fdtaddr} /dtbs/${fdtfile}
</span><span class='line'>
</span><span class='line'>netargs=setenv bootargs console=${console} ${optargs} root=/dev/nfs nfsroot=${serverip}:${rootpath},vers=3 rw ip=${ipaddr}
</span><span class='line'>#mmcargs=setenv bootargs console=${console} root=${mmcroot} rootfstype=${mmcrootfstype} ${optargs}
</span><span class='line'>
</span><span class='line'>#mmc uenvcmd
</span><span class='line'>#uenvcmd=run loadzimage; run loadfdt; run mmcargs; bootz ${loadaddr} - ${fdtaddr}
</span><span class='line'>
</span><span class='line'>#just zImage
</span><span class='line'>boot_ftd=run loadzimage; run loadfdt
</span><span class='line'>uenvcmd=run boot_ftd; run netargs; bootz ${loadaddr} - ${fdtaddr}
</span></code></pre></td></tr></table></div></figure>


<p>And remember to modify some files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@arm:~# cat /etc/network/interfaces
</span><span class='line'># interfaces(5) file used by ifup(8) and ifdown(8)
</span><span class='line'>auto lo
</span><span class='line'>iface lo inet loopback
</span><span class='line'>
</span><span class='line'>auto eth0
</span><span class='line'>iface eth0 inet static
</span><span class='line'>address 10.0.0.122
</span><span class='line'>netmask 255.255.255.0
</span><span class='line'>gateway 10.0.0.1
</span></code></pre></td></tr></table></div></figure>


<p>Add following lines in /etc/inittab:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>T0:23:respawn:/sbin/getty -L ttyO0 115200 vt102
</span></code></pre></td></tr></table></div></figure>


<p>Next time when you boot up the beaglebone, it will use the NFS files.</p>

<p>Tips: when your ownership of su is not right, you will meet"set uid failed" The solution is by Changing the ownership of the su used file;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chmod 4755 /bin/su
</span></code></pre></td></tr></table></div></figure>


<h3>NFS Server items</h3>

<p>/etc/exports file items:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/media/debianroot 10.0.0.1/24(rw,sync,no_subtree_check,no_root_squash) 10.0.0.11(rw,sync,no_subtree_check,no_root_squash)
</span></code></pre></td></tr></table></div></figure>


<p>Restart the nfs server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/etc/init.d/nfs-kernel-server
</span><span class='line'>#or
</span><span class='line'>service nfs-kernel-server restart
</span></code></pre></td></tr></table></div></figure>


<p>tar files into your directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tar xvfp /media/nfs/beaglebone/debian-7.1-bare-armhf-2013-08-25/armhf-rootfs-debian-wheezy.tar  -C /media/debianroot/
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/10/beaglebone-boot-from-nfs/">BeagleBone Boot From NFS</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-10T09:10:00+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>9:10 am</span></time>
        
         | <a href="/blog/2013/12/10/beaglebone-boot-from-nfs/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Building Preparation</h3>

<p>Create a new directory for stroing all of the items related to beaglebone.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /media/nfs/
</span><span class='line'>mkdir beaglebone
</span><span class='line'>cd beaglebone/
</span></code></pre></td></tr></table></div></figure>


<p>Download the cross-compiler from linaro toolchain binary website. And add it to the environment variables.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget -c https://launchpad.net/linaro-toolchain-binaries/trunk/2013.10/+download/gcc-linaro-arm-linux-gnueabihf-4.8-2013.10_linux.tar.xz
</span><span class='line'>tar xJf gcc-linaro-arm-linux-gnueabihf-4.8-2013.10_linux.tar.xz
</span><span class='line'>export CC=`pwd`/gcc-linaro-arm-linux-gnueabihf-4.8-2013.10_linux/bin/arm-linux-gnueabihf-
</span><span class='line'># Test the cross-compiler
</span><span class='line'>${CC}gcc --version
</span></code></pre></td></tr></table></div></figure>


<p>Checkout the U-boot:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://git.denx.de/u-boot.git
</span><span class='line'>cd u-boot/
</span><span class='line'>git checkout v2013.10 -b tmp
</span></code></pre></td></tr></table></div></figure>


<p>Patching U-boot:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget https://raw.github.com/eewiki/u-boot-patches/master/v2013.10/0001-am335x_evm-uEnv.txt-bootz-n-fixes.patch
</span><span class='line'>patch -p1 &lt; 0001-am335x_evm-uEnv.txt-bootz-n-fixes.patch
</span></code></pre></td></tr></table></div></figure>


<p>Configure and compile the U-boot:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>make ARCH=arm CROSS_COMPILE=${CC} distclean
</span><span class='line'>make ARCH=arm CROSS_COMPILE=${CC} am335x_evm_config
</span><span class='line'>make ARCH=arm CROSS_COMPILE=${CC}
</span></code></pre></td></tr></table></div></figure>


<p>Checkout the kernel:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://github.com/RobertCNelson/linux-dev.git
</span><span class='line'>cd linux-dev
</span><span class='line'>git checkout origin/am33x-v3.12 -b tmp
</span></code></pre></td></tr></table></div></figure>


<p>Now we got our kernel and U-boot available. The next step is to build a filesystem:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget -c https://rcn-ee.net/deb/minfs/raring/ubuntu-13.04-minimal-armhf-2013-08-25.tar.xz
</span></code></pre></td></tr></table></div></figure>


<p>Prepare the mmc card.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export DISK=/dev/mmcblk0
</span><span class='line'>[Trusty@XXXyyy beaglebone]$ sudo dd if=/dev/zero of=${DISK} bs=1M count=16
</span><span class='line'>16+0 records in
</span><span class='line'>16+0 records out
</span><span class='line'>16777216 bytes (17 MB) copied, 4.84877 s, 3.5 MB/s 
</span></code></pre></td></tr></table></div></figure>


<p>Use sfdisk for creating the partition layout.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo sfdisk --in-order --Linux --unit M ${DISK} &lt;&lt;-__EOF__
</span><span class='line'>1,48,0xE,*
</span><span class='line'>,,,-
</span><span class='line'>__EOF__
</span></code></pre></td></tr></table></div></figure>


<p>Format Partitions:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo mkfs.vfat -F 16 ${DISK}p1 -n boot
</span><span class='line'>sudo mkfs.ext4 ${DISK}p2 -L rootfs
</span></code></pre></td></tr></table></div></figure>


<p>Install Bootloader to the 1st partition of mmc card.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@XXXyyy beaglebone]$ sudo mkdir -p /media/boot/
</span><span class='line'>[Trusty@XXXyyy beaglebone]$ sudo mkdir -p /media/rootfs/
</span><span class='line'>[Trusty@XXXyyy beaglebone]$ sudo mount ${DISK}p1 /media/boot/
</span><span class='line'>[Trusty@XXXyyy beaglebone]$ sudo mount ${DISK}p2 /media/rootfs/
</span><span class='line'>[Trusty@XXXyyy beaglebone]$ sudo cp -v ./u-boot/MLO /media/boot/
</span><span class='line'>‘./u-boot/MLO’ -&gt; ‘/media/boot/MLO’
</span><span class='line'>[Trusty@XXXyyy beaglebone]$ sudo cp -v ./u-boot/u-boot.img /media/boot/
</span><span class='line'>‘./u-boot/u-boot.img’ -&gt; ‘/media/boot/u-boot.img’
</span><span class='line'>
</span><span class='line'>[Trusty@XXXyyy linux-dev]$ vim uEnv.txt
</span><span class='line'>[Trusty@XXXyyy linux-dev]$ sudo cp -v ./uEnv.txt /media/boot/
</span><span class='line'>‘./uEnv.txt’ -&gt; ‘/media/boot/uEnv.txt’
</span></code></pre></td></tr></table></div></figure>


<p>Copy Kernel:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@XXXyyy beaglebone]$ sudo cp -v ./linux-dev/deploy/3.12.4-bone9.zImage /media/boot/zImage
</span><span class='line'>‘./linux-dev/deploy/3.12.4-bone9.zImage’ -&gt; ‘/media/boot/zImage’
</span></code></pre></td></tr></table></div></figure>


<p>Copy Root File System:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo tar xfvp ./ubuntu-13.04-minimal-armhf-2013-08-25/armhf-rootfs-ubuntu-raring.tar -C /media/rootfs/
</span><span class='line'>Installation of kernel and configuration of the filesystem.
</span><span class='line'>sudo cp -v ./linux-dev/deploy/3.12.4-bone9.zImage /media/boot/zImage
</span><span class='line'>sudo mkdir -p /media/boot/dtbs/
</span><span class='line'>sudo tar xfov ./linux-dev/deploy/3.12.4-bone9-dtbs.tar.gz -C /media/boot/dtbs/
</span><span class='line'>sudo tar xfv ./linux-dev/deploy/3.12.4-bone9-firmware.tar.gz  -C /media/rootfs/lib/firmware/
</span><span class='line'>sudo tar xfv ./linux-dev/deploy/3.12.4-bone9-modules.tar.gz -C /media/rootfs/
</span><span class='line'>sudo vim /media/rootfs/etc/fstab
</span><span class='line'>sudo vim /media/rootfs/etc/network/interfaces 
</span><span class='line'>sudo vim /media/rootfs/etc/udev/rules.d/70-persistent-net.rules
</span><span class='line'>sudo vim /media/rootfs/etc/inittab
</span><span class='line'>sudo vim /media/rootfs/etc/init/serial.conf
</span><span class='line'>sudo umount /media/rootfs/
</span><span class='line'>sudo umount /media/boot/
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/52">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/50">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/04/01/nodemcu-and-1602i2c-1/">NodeMCU and 1602I2C(1)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/31/nodemcu-and-1602i2c/">NodeMCU and 1602I2C</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/29/tips-on-shrinking-vhd-file/">Tips on Shrinking VHD File</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/29/monitoring-xenserver/">Monitoring XenServer</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/29/use-debmirror-for-setup-local-repository/">Use Debmirror for Setup Local Repository</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
