
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dash</title>
  <meta name="author" content="Dash">

  
  <meta name="description" content="Since I Moved the city and changed the job, my laptop had to be returned to company, so I bought another HP 8460P which is almost the same as my old &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://purplepalmdash.github.io/posts/11">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/purplepalmdash/atom.xml" rel="alternate" title="Dash" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.useso.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Dash</a></h1>
  
    <h2>Get busy living, or get busy dying.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/purplepalmdash/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:purplepalmdash.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/16/switch-back-to-arch/">Switch Back to Arch</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-16T08:19:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:19 am</span></time>
        
         | <a href="/blog/2015/02/16/switch-back-to-arch/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since I Moved the city and changed the job, my laptop had to be returned to company, so I bought another HP 8460P which is almost the same as my old one. But this one got i7 4 core CPU and more powerful.  <br/>
First I installed Ubuntu and start playing virtualization on it, after successfully installed OpenStack and OpenContrail I started to think change back to my archLinux, so following is the steps.</p>

<h3>grub</h3>

<p>Use update-grub2 in Install Ubuntu, it will automatically scan all of the disks, cause I installed the archLinux in the second harddisk, it will add a new item in menu.lst, use this item we could reached ArchLinux.</p>

<h3>Libvirt</h3>

<p>Enable the libvirtd.service via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo systemctl enable libvirtd.service
</span></code></pre></td></tr></table></div></figure>


<p>Then restart the system.</p>

<h3>Nested Virtualization</h3>

<p>Manually we could do via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># modprobe -r kvm_intel
</span><span class='line'># modprobe kvm_intel nested=1
</span></code></pre></td></tr></table></div></figure>


<p>Then check it via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ systool -m kvm_intel -v | grep nested
</span><span class='line'>    nested              = "Y"
</span></code></pre></td></tr></table></div></figure>


<p>Add it to automatically loaded kernel module:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /etc/modprobe.d/modprobe.conf
</span><span class='line'>options kvm_intel nested=1
</span></code></pre></td></tr></table></div></figure>


<p>Then next time it boots up, will enter the nested mode.</p>

<p>Didn&rsquo;t solved, fuck!!!!!!!</p>

<h3>Mount LVM Partitions</h3>

<p>The steps is listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Trusty@~]$ sudo vgscan
</span><span class='line'>  Reading all physical volumes.  This may take a while...
</span><span class='line'>  Found volume group "DashUbuntu-vg" using metadata type lvm2
</span><span class='line'>[Trusty@~]$ sudo vgchange -ay DashUbuntu-vg
</span><span class='line'>  2 logical volume(s) in volume group "DashUbuntu-vg" now active
</span><span class='line'>[Trusty@~]$ sudo lvscan
</span><span class='line'>  ACTIVE            '/dev/DashUbuntu-vg/root' [690.48 GiB] inherit
</span><span class='line'>  ACTIVE            '/dev/DashUbuntu-vg/swap_1' [7.91 GiB] inherit
</span><span class='line'>[Trusty@~]$ sudo mount /dev/DashUbuntu-vg/root /mnt
</span><span class='line'>[Trusty@~]$ ls /mnt
</span><span class='line'>bin   etc         initrd.img.old  lost+found  opt   run   sys  var
</span><span class='line'>boot  home        lib             media       proc  sbin  tmp  vmlinuz
</span><span class='line'>dev   initrd.img  lib64           mnt         root  srv   usr  vmlinuz.old
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/15/libvirt-network-configuration/">Libvirt Network Configuration</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-15T22:52:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:52 pm</span></time>
        
         | <a href="/blog/2015/02/15/libvirt-network-configuration/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since I want to use bridge network in libvirt, while the standard bridge networking is not available for me to use, so following tips is for creating and managing the networking.</p>

<h3>Enable Bridge</h3>

<p>In host machine(OpenSuse), create bridge via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo brctl addbr br0
</span><span class='line'>$ sudo brctl addif br0 eth0 
</span></code></pre></td></tr></table></div></figure>


<p>This will add eth0 to bridge 0, while in startup file of OpenSuse we will do following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># pwd
</span><span class='line'>/etc/sysconfig/network
</span><span class='line'># cat ifcfg-eth0 
</span><span class='line'>BOOTPROTO='static'
</span><span class='line'>STARTMODE='ifplugd'
</span><span class='line'>IFPLUGD_PRIORITY='1'
</span><span class='line'>NAME='RTL8111/8168B PCI Express Gigabit Ethernet controller'
</span><span class='line'>USERCONTROL='no' 
</span><span class='line'># cat ifcfg-br0 
</span><span class='line'>BOOTPROTO='static'
</span><span class='line'>STARTMODE='auto'
</span><span class='line'>IPADDR='192.168.0.xxx/24'
</span><span class='line'>NAME='Bridge For Virtualization'
</span><span class='line'>BRIDGE='yes'
</span><span class='line'>BRIDGE_PORTS='eth0'
</span><span class='line'>BRIDGE_FORWARDDELAY='0'
</span></code></pre></td></tr></table></div></figure>


<p>So next time reboot you will see br0 hold the address of <code>192.168.0.xxx</code>, this is the bridge port we have.</p>

<h3>Virtual Machine Configuration</h3>

<p>First list all of the virtual machine we have</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo virsh list --all
</span><span class='line'> Id    Name                           State
</span><span class='line'>----------------------------------------------------
</span><span class='line'> 2     Ubuntu12043                    running
</span><span class='line'> -     OpenContrail                   shut off
</span></code></pre></td></tr></table></div></figure>


<p>Edit the one we want to edit via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo virsh edit Ubuntu12043
</span><span class='line'>    &lt;interface type='bridge'&gt;
</span><span class='line'>      &lt;mac address='24:42:53:21:52:49'/&gt;
</span><span class='line'>      &lt;source bridge='br0'/&gt;
</span><span class='line'>      &lt;model type='virtio'/&gt;
</span><span class='line'>      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;
</span><span class='line'>    &lt;/interface&gt;
</span></code></pre></td></tr></table></div></figure>


<p>So next time when you boot-up the machine, it will have the physical network which connecting to br0.</p>

<h3>Configure route</h3>

<p>In virtual machine, give the fixed ip address via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo ifconfig eth0 192.168.188.188
</span><span class='line'>$ sudo ip route add 192.168.0.0/24 dev eth0
</span><span class='line'>$ sudo route add default gw 192.168.0.xxx
</span><span class='line'>$ sudo route -n
</span><span class='line'>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface                                                                 
</span><span class='line'>0.0.0.0         192.168.0.119   0.0.0.0         UG    0      0        0 eth0                                                                  
</span><span class='line'>192.168.0.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0                                                                  
</span><span class='line'>192.168.188.0   0.0.0.0         255.255.255.0   U     0      0        0 eth0   
</span></code></pre></td></tr></table></div></figure>


<p>We want make it permanent via:  <br/>
First make the permanent ip address:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat /etc/network/interfaces 
</span><span class='line'># This file describes the network interfaces available on your system
</span><span class='line'># and how to activate them. For more information, see interfaces(5).
</span><span class='line'>
</span><span class='line'># The loopback network interface
</span><span class='line'>auto lo
</span><span class='line'>iface lo inet loopback
</span><span class='line'>
</span><span class='line'># The primary network interface
</span><span class='line'>auto eth0
</span><span class='line'>iface eth0 inet static
</span><span class='line'>        address 192.168.188.188
</span><span class='line'>        netmask 255.255.255.0
</span></code></pre></td></tr></table></div></figure>


<p>Second we want to configure the route:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ tail  /etc/rc.local
</span><span class='line'>ip route add 192.168.0.0/24 dev eth0
</span><span class='line'>route add default gw 192.168.0.xxx
</span><span class='line'>echo "nameserver 114.114.114.114"&gt;&gt;/etc/resolv.conf
</span></code></pre></td></tr></table></div></figure>


<p>This will set the route and the default gateway of your device, also the nameserver will be set.   <br/>
But while in the host machine, you will add following iptables rules:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ip route add 192.168.188.0/24 dev br0
</span><span class='line'># iptables -t nat -A POSTROUTING -s 192.168.188.0/24 -j SNAT --to 192.168.0.xxx
</span><span class='line'># iptables -A FORWARD -s 192.168.188.188 -j ACCEPT
</span></code></pre></td></tr></table></div></figure>


<p>The iptables rules should be saved via <code>iptables-save</code>, while the route rules should be added into following file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$  cat /etc/rc.d/after.local 
</span><span class='line'>ip route add 192.168.188.0/24 dev br0                
</span></code></pre></td></tr></table></div></figure>


<p>Now reboot the host machine, you route configuration will be saved.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/13/libvirt-on-opensuse/">Libvirt on OpenSuse</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-13T03:48:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:48 am</span></time>
        
         | <a href="/blog/2015/02/13/libvirt-on-opensuse/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In order to try OpenContrail, I installed it on Virtualbox based, but it got failed, I think maybe it&rsquo;s because virtualbox&rsquo;s nested virtualization is not OK. So that&rsquo;s why I have to try libvirt.</p>

<h3>Installation</h3>

<p>Install the virt-manager related software via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo zypper install kvm libvirt libvirt-python qemu virt-manager
</span><span class='line'>$ sudo zypper in patterns-openSUSE-kvm_server
</span></code></pre></td></tr></table></div></figure>


<p>Now if you directly call virt-manager you will got the following hint:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> error: authentication failed: Authorization requires authentication but no agent is available.
</span><span class='line'>    error: failed to connect to the hypervisor
</span></code></pre></td></tr></table></div></figure>


<p>Or if you run <code>virsh -c qemu:///system</code> you will got the same hint message.   <br/>
Solution is we have to enable the polkit service, add following script:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo vim /usr/bin/polkitexec
</span><span class='line'>#! /bin/bash
</span><span class='line'>
</span><span class='line'>prg=$1
</span><span class='line'>
</span><span class='line'>[ "$prg" ] || exec echo "missing argument"
</span><span class='line'>[ -x "$prg" ] || which $prg &&gt;/dev/null || exec echo "program not found: $1"
</span><span class='line'>
</span><span class='line'>shift
</span><span class='line'>args=$*
</span><span class='line'>
</span><span class='line'>[ `id -u` -eq 0 ] && exec $prg $args
</span><span class='line'>
</span><span class='line'>uname -m | grep -q 64 && lib=/usr/lib64 || lib=/usr/lib
</span><span class='line'>
</span><span class='line'>if [ "$DESKTOP_SESSION" = "kde" ]; then 
</span><span class='line'>        pga=polkit-kde-authentication-agent-1
</span><span class='line'>        lpga=/usr/$lib/kde4/libexec/$pka
</span><span class='line'>else
</span><span class='line'>        pga=polkit-gnome-authentication-agent-1
</span><span class='line'>        lpga=/usr/lib/$pga
</span><span class='line'>fi
</span><span class='line'>
</span><span class='line'>case $DESKTOP_SESSION in
</span><span class='line'>        gnome|gnome-shell|cinnamon*) exec $prg $args ;;
</span><span class='line'>        *) ps nc -C $pga &&gt;/dev/null && exec $prg $args || { [ ! -x $lpga ] && exec echo "program not found: $lpga" || $lpga & $prg $args ;} ;;
</span><span class='line'>esac
</span><span class='line'>$ sudo chmod 777 /sur/bin/polkitexec
</span><span class='line'>$ vim ~/.zshrc
</span><span class='line'># Wrap virt-manager with polkitexec. 
</span><span class='line'>alias virt-manager='polkitexec virt-manager'
</span></code></pre></td></tr></table></div></figure>


<p>Now the virt-manager could be run correctly.</p>

<h3>Trouble-Shooting</h3>

<p>If you met following error, add root to your kvm.conf is OK.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Could not access KVM kernel module: Permission denied
</span><span class='line'>failed to initialize KVM: Permission denied
</span><span class='line'>No accelerator found!
</span></code></pre></td></tr></table></div></figure>


<p>First change the priviledge:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#chown root:kvm /dev/kvm
</span></code></pre></td></tr></table></div></figure>


<p>Then modify the /etc/libvirt/qemu.conf:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#user="root"
</span><span class='line'>user="root"
</span><span class='line'>#group="root"
</span><span class='line'>group="root"
</span></code></pre></td></tr></table></div></figure>


<p>Restart the libvirtd and restart the virt-manager:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#service libvirtd restart
</span></code></pre></td></tr></table></div></figure>


<p>Now continue to install OpenContrail.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/10/build-opencontrail-on-centos7-local/">Build OpenContrail on CentOS7(Local)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-10T05:06:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>5:06 am</span></time>
        
         | <a href="/blog/2015/02/10/build-opencontrail-on-centos7-local/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Fresh steps.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo yum update
</span><span class='line'>$ sudo yum install vim
</span><span class='line'>$ sudo yum install net-tools
</span><span class='line'>$ sudo yum install -y scons git python-lxml wget gcc patch make unzip flex bison gcc-c++ openssl-devel autoconf automake vim python-devel python-setuptools protobuf protobuf-devel protobuf-compiler net-snmp-python libtool kernel-devel bzip2 boost-devel tbb-devel libcurl-devel libxml2-devel scons protobuf protobuf-devel protobuf-compiler
</span><span class='line'>$ sudo yum install -y https://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-5.noarch.rpm
</span><span class='line'>$ sudo sed -i -e 's/enabled=1/enabled=0/' /etc/yum.repos.d/epel.repo
</span><span class='line'>$ sudo yum install -y --disablerepo="*" --enablerepo="epel" scons protobuf protobuf-devel protobuf-compiler 
</span><span class='line'>$ sudo yum install -y bzip2 boost-devel tbb-devel libcurl-devel libxml2-devel 
</span></code></pre></td></tr></table></div></figure>


<p>As root, Add repositories:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># wget -q -O - http://www.atomicorp.com/installers/atomic | sh
</span><span class='line'># yum update
</span><span class='line'># yum install dpkg dpkg-devel
</span></code></pre></td></tr></table></div></figure>


<p>Missing fakeroot, so can&rsquo;t be continue.</p>

<p>Change back to CentOS 6.6.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo yum install vim net-tools
</span><span class='line'>$ wget https://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
</span><span class='line'>$ sudo rpm -ivh epel-release-6-8.noarch.rpm 
</span><span class='line'>$ sudo yum install -y scons git python-lxml wget gcc patch make unzip flex bison gcc-c++ openssl-devel autoconf automake vim python-devel python-setuptools protobuf protobuf-devel protobuf-compiler net-snmp-python libtool kernel-devel bzip2 boost-devel tbb-devel libcurl-devel libxml2-devel scons protobuf protobuf-devel protobuf-compiler
</span><span class='line'>$ sed -i -e 's/enabled=1/enabled=0/' /etc/yum.repos.d/epel.repo
</span><span class='line'>$ yum install -y --disablerepo="*" --enablerepo="epel" scons protobuf protobuf-devel protobuf-compiler  bzip2 boost-devel tbb-devel libcurl-devel libxml2-devel xz
</span></code></pre></td></tr></table></div></figure>


<p>Install git:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel gcc perl-ExtUtils-MakeMaker
</span><span class='line'>$ wget https://www.kernel.org/pub/software/scm/git/git-1.9.4.tar.gz
</span><span class='line'>$ sudo yum install expat-devel tar
</span><span class='line'>$ make prefix=/usr install
</span><span class='line'>$ which git
</span><span class='line'>git version 1.9.4
</span></code></pre></td></tr></table></div></figure>


<p>Using repo sync:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ repo init -u git@github.com:Juniper/contrail-vnc
</span><span class='line'>$ repo sync
</span></code></pre></td></tr></table></div></figure>


<p>Install argparse:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ yum install python-argparse
</span><span class='line'>$ declare -x USER="root"
</span></code></pre></td></tr></table></div></figure>


<p>We should upgrade some packages to let python could fetch back the packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget http://ftp.gnu.org/gnu/autoconf/autoconf-latest.tar.gz
</span><span class='line'>$ tar xzvf autoconf-latest.tar.gz
</span><span class='line'>$ cd autoconf-2.69/
</span><span class='line'>$ ./configure --prefix=/usr && make && sudo make install
</span><span class='line'>$ sudo yum install libtool
</span></code></pre></td></tr></table></div></figure>


<p>Fetch the 3rd_party packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ python third_party/fetch_package.py
</span></code></pre></td></tr></table></div></figure>


<p>Then tar and export it to the host machine.</p>

<p>When Building, we have to install libipfix:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget http://sourceforge.net/projects/libipfix/files/libipfix/libipfix_110209.tgz/download
</span><span class='line'>$ # build it.   
</span></code></pre></td></tr></table></div></figure>


<p>Enable the epel repository and install dpkg and dpkg-devel:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo sed -i -e 's/enabled=0/enabled=1/' /etc/yum.repos.d/epel.repo
</span><span class='line'>$ sudo yum update && sudo yum install -y dpkg dpkg-devel
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/09/play-docker-6-using-docker-for-building/">Play Docker(6) -- Using Docker for Building</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-09T23:16:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:16 pm</span></time>
        
         | <a href="/blog/2015/02/09/play-docker-6-using-docker-for-building/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The steps is for Ubuntu12.04, the purpose of this documentation is for swiftly get the source code and fetch it to local repository.</p>

<h3>Preparation</h3>

<p>Pull back the Ubuntu12.04:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker pull ubuntu12.04
</span></code></pre></td></tr></table></div></figure>


<p>Then run into the ubuntu12.04 via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker run -it ubuntu12.04 /bin/bash
</span><span class='line'>root@7b30cc924bb0:~ #
</span></code></pre></td></tr></table></div></figure>


<p>Install following packages in Ubuntu 12.04 container:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get install python-software-properties
</span><span class='line'># apt-get install curl
</span><span class='line'># curl https://storage.googleapis.com/git-repo-downloads/repo &gt; /bin/repo
</span><span class='line'># chmod 777 /bin/repo
</span><span class='line'># apt-get update
</span><span class='line'># apt-get install python-pip
</span><span class='line'># apt-get install git
</span><span class='line'># git config --global user.email kkkttt@gmail.com
</span><span class='line'># git config --global user.name kkkttt
</span><span class='line'># ssh -T git@github.com
</span><span class='line'># repo init -u git@github.com:Juniper/contrail-vnc
</span><span class='line'># repo sync
</span><span class='line'># declare -x USER="root"
</span><span class='line'># apt-get install python-lxml autoconf bzip2 libtool unzip wget 
</span><span class='line'># python third_party/fetch_packages.py
</span></code></pre></td></tr></table></div></figure>


<p>Install nginx:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm
</span><span class='line'>$ sudo rpm -ivh nginx
</span></code></pre></td></tr></table></div></figure>


<p>Change nginx&rsquo;s listenning directory to <code>/var/www/</code>, tar the directory and put it under this folder, then use firefox for downloading it.</p>

<h3>Compile Local</h3>

<p>Referes to :   <br/>
<a href="http://kkkttt.github.io/blog/2015/01/29/build-contrial-source-code/">http://kkkttt.github.io/blog/2015/01/29/build-contrial-source-code/</a>  <br/>
Plus:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install libglib2.0-dev libglib2.0
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/09/tips-for-building-opencontrail-on-ubuntu14-dot-04/">Tips for Building Opencontrail on Ubuntu14.04</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-09T01:58:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:58 am</span></time>
        
         | <a href="/blog/2015/02/09/tips-for-building-opencontrail-on-ubuntu14-dot-04/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Dependencies</h3>

<p>Install the following packages to make <code>scons</code> getting through:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install -y scons git python-lxml wget gcc patch make unzip flex bison g++ libssl-dev autoconf automake libtool pkg-config vim python-dev python-setuptools libprotobuf-dev protobuf-compiler libsnmp-python libboost-dev libboost-chrono-dev libboost-date-time-dev libboost-filesystem-dev libboost-program-options-dev libboost-python-dev libboost-regex-dev libboost-system-dev libcurl4-openssl-dev google-mock libgoogle-perftools-dev liblog4cplus-dev libtbb-dev libhttp-parser-dev libxml2-dev libicu-dev
</span><span class='line'>$  sudo apt-get install libxml2-dev
</span><span class='line'>$  sudo apt-get install libboost-dev
</span><span class='line'>$  sudo apt-get install libboost-filesystem-dev
</span><span class='line'>$  sudo apt-get install libboost-program-options-dev
</span><span class='line'>$  sudo apt-get install libboost-system-dev libboost-regex-dev libboost-python-dev libboost-chrono-dev libtbb-dev
</span></code></pre></td></tr></table></div></figure>


<p>Then the linking should be OK.</p>

<h3>Making Packages</h3>

<p>Install following packages for meeting the requirements of deb packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install libcurl4-openssl-dev libboost-date-time-dev libboost-thread-dev google-mock libgoogle-perftools-dev libhttp-parser-dev
</span></code></pre></td></tr></table></div></figure>


<p>Then <code>make -f packages.make</code> you could get the generated deb files.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/07/play-docker-5/">Play Docker(5)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-07T04:22:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>4:22 am</span></time>
        
         | <a href="/blog/2015/02/07/play-docker-5/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since I enabled OpenSuse, later all of the docker related operation could be operated on OpenSuse13.2.</p>

<h3>Installation</h3>

<p>Install docker via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo zypper in docker
</span><span class='line'>$ which docker
</span><span class='line'>/usr/bin/docker
</span></code></pre></td></tr></table></div></figure>


<h3>Specify Storage Location</h3>

<p>The /var directory has the limitation, thus we have to specify the storage locateion in /etc/sysconfig/docker:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pwd
</span><span class='line'>/etc/sysconfig
</span><span class='line'>$  cat docker 
</span><span class='line'>
</span><span class='line'>## Path           : System/Management
</span><span class='line'>## Description    : Extra cli switches for docker daemon
</span><span class='line'>## Type           : string
</span><span class='line'>## Default        : ""
</span><span class='line'>## ServiceRestart : docker
</span><span class='line'>#
</span><span class='line'>DOCKER_OPTS="-g /home/xxxxxx/Code/Virtualization/Docker/docker/"
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>Now we could use the nearly 2T Size /home partition for storing docker images..</p>

<h3>Use China Resources</h3>

<p>The default dockhub is banned by GFW, so we have to use replacement repository in China. <br/>
Add the options to /ec/sysconfig/docker:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>DOCKER_OPTS="-g /home/clouder/Code/Virtualization/Docker/docker/ --insecure-registry dl.dockerpool.com:5000"
</span></code></pre></td></tr></table></div></figure>


<p>Then restart the docker via <code>systemctl restart docker</code>, after them we could use following command for pull back images:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker pull dl.dockerpool.com:5000/ubuntu:14.04
</span></code></pre></td></tr></table></div></figure>


<p>After pull back ,check the name of our fetched back ubuntu:14.04 is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker images
</span><span class='line'>dl.dockerpool.com:5000/ubuntu            14.04               5506de2b643b        3 months ago        197.8 MB
</span><span class='line'>dl.dockerpool.com:5000/ubuntu            latest              5506de2b643b        3 months ago        197.8 MB
</span></code></pre></td></tr></table></div></figure>


<p>Change to a differenet tag name:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo docker tag dl.dockerpool.com:5000/ubuntu:14.04 ubuntu:14.04
</span></code></pre></td></tr></table></div></figure>


<p>Now check again and you will find the long and hard-to-remember name has been changed to <code>ubuntu:14.04</code>.  <br/>
Our version of docker runs on OpenSuse is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker --version
</span><span class='line'>Docker version 1.4.1, build 5bc2ff8
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/06/build-pidgin-and-webqq/">Build Pidgin and WebQQ</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-06T20:35:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:35 pm</span></time>
        
         | <a href="/blog/2015/02/06/build-pidgin-and-webqq/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Strangely my OpenSuse&rsquo;s official installation version&rsquo;s pidgin doesn&rsquo;t support webqq plugins. So I have to build from source and let it run as a webQQ&rsquo;s version of pidgin.</p>

<h3>Getting Source.</h3>

<p>First download the source code from:  <br/>
<a href="http://sourceforge.net/projects/pidgin/files/Pidgin/2.10.11/pidgin-2.10.11.tar.bz2/download?accel_key=62%3A1423272982%3Ahttp%253A//www.pidgin.im/download/source/%3A20b420a2%24f93cd8a6095e965a3448df4a97a1c4786bf0a085&amp;click_id=b8d33c98-ae69-11e4-8d6d-0200ac1d1d8d&amp;source=accel">http://sourceforge.net/projects/pidgin/files/Pidgin/2.10.11/pidgin-2.10.11.tar.bz2/download?accel_key=62%3A1423272982%3Ahttp%253A//www.pidgin.im/download/source/%3A20b420a2%24f93cd8a6095e965a3448df4a97a1c4786bf0a085&amp;click_id=b8d33c98-ae69-11e4-8d6d-0200ac1d1d8d&amp;source=accel</a>  <br/>
Install related packages:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo zypper in intltool
</span><span class='line'>$ sudo zypper in gtk3-devel
</span><span class='line'>$ sudo zypper in gtk2-devel
</span><span class='line'>$ sudo zypper in gstreamer-devel
</span><span class='line'>$ sudo zypper in libidn-devel
</span><span class='line'>$ sudo zypper in meanwhile-devel
</span><span class='line'>$ sudo zypepr in libavahi-devel
</span><span class='line'>$ sudo zypper in libavahi-glib-devel
</span><span class='line'>$ sudo zypper in libgnutls-openssl-devel
</span><span class='line'>$ sudo zypper in tcl-devel 
</span><span class='line'>$ sudo zypper in tk-devel 
</span><span class='line'>$ sudo zypper in gtkspell-devel
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>Configure pidign via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./configure --prefix=/home/Trusty/bin --disable-screensaver  --disable-gstreamer --disable-vv
</span></code></pre></td></tr></table></div></figure>


<p>Notice here I disable the screensave support and gstreamer support.</p>

<h3>Make</h3>

<p>Via <code>make</code> and <code>make install</code> we could let it run. <br/>
Make install the corresponding plugins, and now your webqq is OK.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/04/deploy-vagrant/">Deploy Vagrant</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-04T02:49:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:49 am</span></time>
        
         | <a href="/blog/2015/02/04/deploy-vagrant/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Installation</h3>

<p>Couldn&rsquo;t install the vagrant via rubygems, so we directly download packages in vagrantup.com, rpm for OpenSuse.  <br/>
<a href="https://www.vagrantup.com/downloads.html">https://www.vagrantup.com/downloads.html</a>  <br/>
<a href="https://dl.bintray.com/mitchellh/vagrant/vagrant_1.7.2_x86_64.rpm">https://dl.bintray.com/mitchellh/vagrant/vagrant_1.7.2_x86_64.rpm</a>  <br/>
Install it via <code>rpm -ivh xxxx.rpm</code>.</p>

<h3></h3>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/03/install-gitlab-and-gogs/">Install GitLab and Gogs</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-03T22:23:00+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>10:23 pm</span></time>
        
         | <a href="/blog/2015/02/03/install-gitlab-and-gogs/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For sharing the git managed codes, we need setup the online repositories, we got two options, one is for gitlab, the other is for gogs.</p>

<h3>Gitlab</h3>

<p>The reference URL is listed as in:  <br/>
<a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-gitlab-as-your-very-own-private-github-clone">https://www.digitalocean.com/community/tutorials/how-to-set-up-gitlab-as-your-very-own-private-github-clone</a>  <br/>
But following the tutorial you will met the problem, following records the solution:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo -u git -H bundle install --deployment --without development test postgres
</span><span class='line'>   Could not find modernizr-2.6.2 in any of the sources
</span><span class='line'>$ cd /home/git/gitlab
</span><span class='line'>$ wget http://rubygems.org/downloads/modernizr-2.6.2.gem
</span><span class='line'>$ sudo gem install modernizr
</span><span class='line'>$ vim Gemfile
</span><span class='line'>gem "modernizr"    "2.6.2"   ===&gt; gem "modernizr-rails",        "2.7.1"
</span><span class='line'>$ vim Gemfile.lock
</span><span class='line'>modernizr  (2.6.2)   ===&gt;     modernizr-rails (2.7.1)
</span><span class='line'>modernizr  (2.6.2)   ===&gt;     modernizr-rails (= 2.7.1)
</span><span class='line'>$ sudo -u git -H bundle install --deployment --without development test postgres 
</span></code></pre></td></tr></table></div></figure>


<h3>Gogs</h3>

<p>We use docker for installing Gogs, the command listed as following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># sh -c "wget -qO- https://get.docker.io/gpg | apt-key add -"
</span><span class='line'># sh -c "echo deb http://get.docker.io/ubuntu docker main\
</span><span class='line'>&gt; /etc/apt/sources.list.d/docker.list"
</span><span class='line'># apt-get update
</span><span class='line'># apt-get install lxc-docker
</span><span class='line'># proxychains4 docker pull codeskyblue/docker-gogs
</span></code></pre></td></tr></table></div></figure>


<p>This pull back the <code>docker-gogs</code> image, later you could run the gogs server via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir /var/gogs
</span><span class='line'>$ docker run -d -p 2223:22 -p 3000:3000 -v /var/gogs:/data codeskyblue/docker-gogs
</span></code></pre></td></tr></table></div></figure>


<p>Then visit <code>http://1xx.xx.xx.xxx:3000</code> you will got the installation webpage, simply install it.  <br/>
Everytime you run into error case, you could remove the <code>/var/gogs</code> directory and let everything happen from zero.</p>

<h3>Using Gogs</h3>

<p>Create Repository, then <code>git clone</code>, then add your own files, <code>git add .</code>, <code>git commit -m</code>, <code>git push origin master</code>, the same as you did in github.</p>

<p>Some problems happens&hellip;. We changed to OpenSuse for installing.  <br/>
Remove all of the .git directory in sub-directories via following command, then problem won&rsquo;t happen.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>find ./* -name ".git" | xargs rm -rf
</span></code></pre></td></tr></table></div></figure>


<p>Now git push all of the changes to the remote repository and you got everything works well.  <br/>
Add the running command into <code>/etc/rc.local</code> thus the docker runs together with the system startup.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/12">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/10">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/07/17/iscsi-installed-debian-jessie/">ISCSI Installed Debian Jessie</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/14/wh-worktips-12/">WH Worktips(12)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/13/wh-worktips-11/">WH Worktips(11)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/12/wh-worktips-10/">WH Worktips(10)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/10/wh-worktips-9/">WH Worktips(9)</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Dash -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dashsagittariussglory';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
