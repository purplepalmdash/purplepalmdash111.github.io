<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Virtualbox on Dash</title>
    <link>http://purplepalmdash.github.io/categories/virtualbox/</link>
    <description>Recent content in Virtualbox on Dash</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Wed, 13 Aug 2014 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://purplepalmdash.github.io/categories/virtualbox/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Virtualbox Modprobe Problem</title>
      <link>http://purplepalmdash.github.io/2014/08/13/virtualbox-modprobe-problem/</link>
      <pubDate>Wed, 13 Aug 2014 00:00:00 +0000</pubDate>
      
      <guid>http://purplepalmdash.github.io/2014/08/13/virtualbox-modprobe-problem/</guid>
      <description>

&lt;p&gt;After upgrading the Linux Kernel, my virtualbox cannot automatically load the kernel modules for virtualbox. Following is the steps for finding out the problems and solving them.&lt;/p&gt;

&lt;h3 id=&#34;locating-problem&#34;&gt;Locating Problem&lt;/h3&gt;

&lt;p&gt;I could manually modprobe the virtualbox driver, but failed to load at boot, so I first check the status of the systemd&amp;rsquo;s output.&lt;br /&gt;
Checking the systemd&amp;rsquo;s modules load service status:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# systemctl status systemd-modules-load.service
● systemd-modules-load.service - Load Kernel Modules
   Loaded: loaded (/usr/lib/systemd/system/systemd-modules-load.service; static)
   Active: failed (Result: exit-code) since Wed 2014-08-13 13:32:34 CST; 1h 24min ago
     Docs: man:systemd-modules-load.service(8)
           man:modules-load.d(5)
  Process: 142 ExecStart=/usr/lib/systemd/systemd-modules-load (code=exited, status=1/FAILURE)
 Main PID: 142 (code=exited, status=1/FAILURE)

Aug 13 13:32:34 XXXyyy systemd[1]: systemd-modules-load.service: main process exited, code=exited, status=1/FAILURE
Aug 13 13:32:34 XXXyyy systemd[1]: Failed to start Load Kernel Modules.
Aug 13 13:32:34 XXXyyy systemd[1]: Unit systemd-modules-load.service entered failed state.
Warning: Journal has been rotated since unit was started. Log output is incomplete or unavailable.

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Manually reload this service and check the status:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@XXXyyy Trusty]# systemctl restart systemd-modules-load
Job for systemd-modules-load.service failed. See &#39;systemctl status systemd-modules-load.service&#39; and &#39;journalctl -xn&#39; for details.
[root@XXXyyy Trusty]# systemctl status systemd-modules-load
● systemd-modules-load.service - Load Kernel Modules
   Loaded: loaded (/usr/lib/systemd/system/systemd-modules-load.service; static)
   Active: failed (Result: exit-code) since Wed 2014-08-13 14:59:31 CST; 13s ago
     Docs: man:systemd-modules-load.service(8)
           man:modules-load.d(5)
  Process: 21364 ExecStart=/usr/lib/systemd/systemd-modules-load (code=exited, status=1/FAILURE)
 Main PID: 21364 (code=exited, status=1/FAILURE)

Aug 13 14:59:31 XXXyyy systemd[1]: systemd-modules-load.service: main process exited, code=exited, status=1/FAILURE
Aug 13 14:59:31 XXXyyy systemd[1]: Failed to start Load Kernel Modules.
Aug 13 14:59:31 XXXyyy systemd[1]: Unit systemd-modules-load.service entered failed state.

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Use journalctl to view the PID&amp;rsquo;s logs:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@XXXyyy Trusty]# journalctl -b _PID=21364
-- Logs begin at Thu 2014-07-31 16:07:13 CST, end at Wed 2014-08-13 15:00:02 CST. --
Aug 13 14:59:31 XXXyyy systemd-modules-load[21364]: Failed to find module &#39;vboxdrv vboxnetflt vboxnetadp&#39;
[root@XXXyyy Trusty]# systemctl status dkms.service 
● dkms.service - Dynamic Kernel Modules System
   Loaded: loaded (/usr/lib/systemd/system/dkms.service; disabled)
   Active: inactive (dead)

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;So the problem is quite clear: Failed to find module, and dkms service is not enabled.&lt;/p&gt;

&lt;h3 id=&#34;solving-problem&#34;&gt;Solving Problem&lt;/h3&gt;

&lt;p&gt;First enable the dkms.service via:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# systemctl enable dkms.service
Created symlink from /etc/systemd/system/multi-user.target.wants/dkms.service to /usr/lib/systemd/system/dkms.service.

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Install vboxhost-hook, this will add the hook to compile the virtualbox host modules:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# yaourt -S vboxhost-hook

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Add vboxhost into the /etc/mkinitcpio.conf:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;HOOKS=&amp;quot;base udev autodetect modconf block filesystems keyboard fsck vboxhost&amp;quot;

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now recompile the initramfs via:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mkinitcpio -p linux

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;dkms should also be installed:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;pacman -S linux-headers virtualbox-host-dkms viftualbox-guest-dkms
dkms install vboxhost/4.3.14
dkms install vboxguest/4.3.14

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Finally I found the reason:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# cat /etc/modules-load.d/virtualbox.conf
# Load virtualbox related modules at startup
vboxdrv
vboxnetflt
vboxnetadp

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;But previously I let them in one line!!!!!!!!!!!!!OMG&amp;hellip;&amp;hellip;.&lt;br /&gt;
Reboot and examine the result via &lt;code&gt;lsmod | grep vbox&lt;/code&gt;.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>