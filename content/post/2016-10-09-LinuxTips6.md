+++
categories = ["Linux"]
date = "2016-10-09T17:24:03+08:00"
description = "Linux Tips"
keywords = ["Tips"]
title = "LinuxTips6"

+++
### 1.  Working tips for remove dulipcate chars
[http://codereview.stackexchange.com/questions/5441/removing-any-duplicate-characters-in-a-string](http://codereview.stackexchange.com/questions/5441/removing-any-duplicate-characters-in-a-string)    

### 2. pip reinstallation
Uninstall all of the pip installed packages:    

```
# pip freeze | xargs pip uninstall -y
```
### 3. ipython notebook
Install on ArchLinux via:    

```
$  sudo pip install "ipython[all]"
```
Be sure to make your internet connection stable.    

Run it via:    

```
$ ipython notebook
```
ipython2 installation issue:    

```
$ python2 -m pip install ipykernel
$ python2 -m ipykernel install --user
$ python2 -m pip  install "ipython[all]"
$ ipython3 notebook
```
Now you could create python2&python3 notebooks.    

### 4. wkhtmltoimage
wkhtmltoimage could convert webpage into image files, like following command:    

```
$ wkhtmltoimage http://purplepalmdash.github.io dash.jpg
```

### 5. Synergyc
Add following into `~/.config/awesome/rc.lua`, then you could let synergyc auto-login
into another server:    

```
"synergyc 192.168.0.219",
```

### 6. vromerc
vromerc configuration:    

```
set userletters=0
```

### 7. Docker Registry
[https://www.digitalocean.com/community/tutorials/how-to-set-up-a-private-docker-registry-on-ubuntu-14-04](https://www.digitalocean.com/community/tutorials/how-to-set-up-a-private-docker-registry-on-ubuntu-14-04)     

### 8. Trouble-Shooting In Libvirt
After installing archlinux, the virsh list will be failed with following message:    

```
[root@Arch8G ~]# virsh list
error: failed to connect to the hypervisor
error: Failed to connect socket to '/var/run/libvirt/libvirt-sock': No such file or
directory
```
Solved via:    

```
# systemctl enable libvirtd.service
# systemctl enable virtlogd.service
# systemctl restart libvirtd.service
# systemctl restart virtlogd.service
```
Now `virsh list` will be OK.    

For user, you should add polkit related items, see:    

[https://wiki.archlinux.org/index.php/Libvirt#Using_polkit](https://wiki.archlinux.org/index.php/Libvirt#Using_polkit)    

also remember add yourself into the group `kvm`.    

```
$ sudo usermod -a -G kvm dash
$ sudo usermod -a -G libvirtd dash
```

### 9. Docker using daocloud registry
Edit following file(Or you could edit it via: `sudo systemctl edit docker.service`):    

```
# vim /etc/systemd/system/docker.service.d/override.conf 
[Service]
ExecStart=
ExecStart=/usr/bin/dockerd --registry-mirror=http://1a653205.m.daocloud.io -H fd://
```
Now reload the service and restart docker.service via:    

```
# systemctl daemon-reload
# systemctl restart docker.service
```
Now your docker pulling will from the daocloud website.    

### 10. DEB Local Repository How-TO
In a ubuntu system, generate package repository metadatas:    

```
# sudo apt-get install -y dpkg-dev
# dpkg-scanpackages . /dev/null | gzip -9c > Packages.gz
```
Now copy the directory into a webserver, like in `192.168.177.11`, visit your
webpage, you will see `http://192.168.177.11/xxxx` contains all of the
packages and their metadata.    

In the systems which you want to use this repository, do following:    

```
$ sudo vim /etc/apt/sources.list.d/docker.list 
deb http://192.168.177.11/ubuntu1604dockerrepo/	/
$ sudo apt-get update
```
Now examine the package `docker-engine` which in the private repository:    

```
# apt-cache policy docker-engine
docker-engine:
  Installed: 1.12.3-0~xenial
  Candidate: 1.12.3-0~xenial
  Version table:
 *** 1.12.3-0~xenial 500
        500 http://192.168.177.11/ubuntu1604dockerrepo  Packages
        100 /var/lib/dpkg/status
```
Install this package via:    

```
$ sudo apt-get install -y docker-engine --allow-unauthenticated
```
### 11. vagrant initial scripts for setting docker
Create the initial.sh under the vagrant folder:     

```
# Use apt-cacher server
echo 'Acquire::http::Proxy "http://192.168.177.11:3142";'>/etc/apt/apt.conf.d/01proxy
# Added the primary repository
echo 'deb http://192.168.177.11/ubuntu1604dockerrepo/    /'>/etc/apt/sources.list.d/dockerrepo.list
apt-get update
apt-get -y install vim
apt-get install -y docker-engine --allow-unauthenticated
```
Using local docker registry:    

```
# Use apt-cacher server
echo 'Acquire::http::Proxy
"http://192.168.177.11:3142";'>/etc/apt/apt.conf.d/01proxy
# Added the primary repository
echo 'deb http://192.168.177.11/ubuntu1604dockerrepo/
/'>/etc/apt/sources.list.d/dockerrepo.list
apt-get update
apt-get -y install vim
apt-get install -y docker-engine --allow-unauthenticated
# Added local docker registry
sed -i 's#fd://#fd:// --registry-mirror http://192.168.177.11:5000
--insecure-registry 192.168.177.11:5000#' /lib/systemd/system/docker.service
systemctl daemon-reload
systemctl restart docker
```
### 12. nginx docker way
Run via:    

```
$ sudo docker run --name docker-nginx -p 80:80 -d -v ~/serve:/usr/share/nginx/html
nginx
```
With auto-index:    

```
$ sudo docker run --name docker-nginx -p 80:80 -d -v ~/serve:/usr/share/nginx/html
jrelva/nginx-autoindex
```

### 13. Combine Pictures
fotowall could genrate photo wall:    

```
$ yaourt -S fotowall
```
Hugin could generate full-view pictures.    

```
$ sudo pacman -S hugin
```

### 14. Docker Swarm How-to
[http://www.lxy520.net/2016/07/02/shi-yong-docker-1-12-da-jian-duo-zhu-ji-docker-swarmji-qun/](http://www.lxy520.net/2016/07/02/shi-yong-docker-1-12-da-jian-duo-zhu-ji-docker-swarmji-qun/)    

[https://www.linux.com/learn/how-use-docker-machine-create-swarm-cluster](https://www.linux.com/learn/how-use-docker-machine-create-swarm-cluster)    

### 15. Linux 性能监控专题
[https://linux.cn/topic-linux-system-performance-monitoring.html](https://linux.cn/topic-linux-system-performance-monitoring.html)    

### 16. docker-compose in swarm
Install experimental version via:    

```
## 测试版
curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/test/internet | sh
curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/test/intranet | sh

## 实验版
curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/experimental/internet | sh
curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/experimental/intranet | sh
```

[https://docs.docker.com/compose/swarm/](https://docs.docker.com/compose/swarm/)   

### 17. kubernetes
[https://coreos.com/kubernetes/docs/latest/kubernetes-on-vagrant.html](https://coreos.com/kubernetes/docs/latest/kubernetes-on-vagrant.html)   
[http://andrewmichaelsmith.com/2016/05/my-kubernetes-setup/](http://andrewmichaelsmith.com/2016/05/my-kubernetes-setup/)   
[http://www.codeceo.com/article/kubernetes-guide.html](http://www.codeceo.com/article/kubernetes-guide.html)    

### 18. Changing disks
After changing disk(switch them) in archlinux, the efi menu should be
rewritten into:    

```
$ sudo cat /boot/loader/entries/arch.conf 
title	ArchLinux
linux	/vmlinuz-linux
initrd	/initramfs-linux.img
options	root=/dev/sdb2 rw
```
Becareful of `root=/dev/sda2` changing to `root=/dev/sdb2`.   

### 17. Vagrant IP Setting
If your vagrant's ip address won't set properly, for example, eth1's
configuration is added into eth0, then you should install the following
package:    

```
$ sudo pacman -S community/virtualbox-guest-utils
```

### 18. badblocks checking in ArchLinux
Check the sda5 and sda3 of the disk via:    

```
$ sudo badblocks -v /dev/sda5>badsectors5.txt && sudo badblocks -v
/dev/sda3>badsectors3.txt
```
smartmontools for checking disk healthy:    

```
$ sudo pacman -S smartmontools
$ sudo smartctl -s on /dev/sda
$ sudo smartctl -H /dev/sda1
$ sudo smartctl -H /dev/sda
```

### 19. Manually build wordpress
[https://www.sitepoint.com/how-to-manually-build-docker-containers-for-wordpress/](https://www.sitepoint.com/how-to-manually-build-docker-containers-for-wordpress/)    

### 20. XenServer Get rrd data
Write a py file on XenServer, and run it:    

```
import pprint, time, sys, os
import XenAPI
session = XenAPI.xapi_local()
session.xenapi.login_with_password("root", "xxxxx")
session_id=session._session
print session_id
wget_rrd_url="wget http://%s/host_rrd\?session_id\=%s" %("192.168.10.187", session._session)
print wget_rrd_url
os.system(wget_rrd_url)
session.logout()
```

### 21. Xen In Ubuntu
In ubuntu16.04, use xen hypervisor:    

```
$ sudo apt-get update && sudo apt-get upgrade -y && sudo apt-get dist-upgrade -y
$ sudo apt-get install -y xen-hypervisor-amd64
$ sudo apt-get install -y virtinst virt-manager
```
Edit the grub for enabling the xen hypervisor:    

```
$ sudo vim /etc/default/grub
GRUB_CMDLINE_LINUX_DEFAULT="Xen 4.1-amd64"
GRUB_CMDLINE_XEN="dom0_mem=1024M,max:1024M dom0_max_vcpus=2"
$ sudo update-grub
$ sudo reboot
```
Examine the usage:    

```
$ sudo xl list
Name                                        ID   Mem VCPUs	State	Time(s)
Domain-0                                     0  1024     2     r-----      28.7
```
### 22. pv or hvm
Decided via:    

```
$ sudo xl list --long CentOS69
```
Examine the result of the output:    

![/images/2016_11_23_15_39_44_682x316.jpg](/images/2016_11_23_15_39_44_682x316.jpg)    

in our example, this machine is hvm, not pv.    

### 23. vboxsf
Problem:    

```
sudo mount -t vboxsf Shared_Folder ~/SF/
```

Gave following result:

```
VirtualBox: mount.vboxsf: mounting failed with the error: No such device
```

The solution for me was to stop vboxadd and do a setup after that:

```
cd /opt/VBoxGuestAdditions-*/init  
sudo ./vboxadd setup
```

Then, you could also modprobe following:    

```
$ sudo modprobe -a vboxguest vboxsf
$ sudo mount -t vboxsf -o uid=1000,gid=1000 vagrant /vagrant
```
