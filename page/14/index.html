<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
	<meta name="generator" content="Hugo 0.17-DEV" />
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Dash &middot; Dash</title>

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/poole.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde-a.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/custom-additions.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/highlight/googlecode.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124">
  <link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel="icon">

  
  
  
  <link href="http://purplepalmdash.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Dash &middot; Dash" />

  <meta name="description" content="Get busy living, or get busy dying.">
  <meta name="keywords" content="unix,virtualization,embedded,linux">
  <link rel="author" href="http://plus.google.com/106572959364703833986">
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-42175003-1', 'auto');
      ga('send', 'pageview');
  </script>

</head>
<body class="theme-base-0c">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <img src="https://www.gravatar.com/avatar/49381c0004d32c0a4296b92dff0c0ae5?s=200" alt="gravatar">
      <h1><a href="http://purplepalmdash.github.io/">Get busy living, or get busy dying.</a></h1>
      <a href="http://purplepalmdash.github.io/"><p>Dash</p></a>
    </div>

    <ul class="sidebar-nav">
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/">First Page</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/post/">All Posts</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/linux/">Linux</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/embedded/">Embedded System</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/virtualization">Virtualization</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/purplepalmdash"><i class="fa fa-github-square fa-3x"></i></a>
      
      <a href="https://cn.linkedin.com/in/yang-feipeng-1b909319"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="https://plus.google.com/u/0/106572959364703833986"><i class="fa fa-google-plus-square fa-3x"></i></a>
      <a href="https://www.facebook.com/yang.feipeng"><i class="fa fa-facebook-square fa-3x"></i></a>
      <a href="https://twitter.com/dashwillfly"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      <a href="http://purplepalmdash.github.io/index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
    </ul>

    

  </div>
</div>


<div class="content container">
  <div class="posts">
    
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2016/01/15/linux-tips-4/">Linux Tips(4)</a>
      </h1>
      <span class="post-date">Jan 15, 2016  &middot; <a href="http://purplepalmdash.github.io/2016/01/15/linux-tips-4/#disqus_thread">Comments</a>
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/linux">Linux</a>
        
      </span>
      
      

<h3 id="1-run-ansible-commands">1. Run ansible commands</h3>

<p>Run commands in all hosts:</p>

<pre><code># ansible all -i inventory.ini -m command -u root --args &quot;uptime&quot;
</code></pre>

<h3 id="2-mesos-introduction">2. mesos introduction</h3>

<p><a href="http://www.infoq.com/cn/articles/analyse-mesos-part-02">http://www.infoq.com/cn/articles/analyse-mesos-part-02</a></p>

<h3 id="3-limit-ansible-run-hosts">3. Limit ansible run hosts</h3>

<pre><code># ansible-playbook -i inventory_mesos_cluster changehostname.yml -u root -k
-vvvv --list-hosts

playbook: changehostname.yml

  play #1 (master1): host count=1
    10.47.58.31

#  ansible-playbook -i
inventory_mesos_cluster changehostname.yml -u root -k -vvvv --limit=&quot;master1&quot;

</code></pre>

<h3 id="4-configure-the-dhcp-configuration-of-libvirtd">4. Configure the dhcp configuration of libvirtd</h3>

<p>First edit the net configuration:</p>

<pre><code># virsh net-edit xxxxx
</code></pre>

<p><img src="/images/2016_01_16_20_23_08_715x270.jpg" alt="/images/2016_01_16_20_23_08_715x270.jpg" /></p>

<h3 id="5-copy-items-into-clipboard-in-vim">5. Copy items into clipboard in vim</h3>

<p>Hit <code>Ctrl+v</code> to visual model, then select the items you want to copy, after select
them, click <code>&quot;*y</code> will copy whatever you selected into your clipbard.</p>

<p>Copy from clipboard&mdash;- simply hit <code>p</code> in command mode.</p>

<h3 id="6-mesos-cli">6. mesos.cli</h3>

<p>When you meet <code>no module named mesos</code>, install it via pip:</p>

<pre><code>$ pip install mesos.cli
</code></pre>

<h3 id="7-startdict-in-command-line">7. Startdict In Command Line</h3>

<pre><code>$ sudo apt-get install -y sdcv
$ wget
https://web.archive.org/web/20140917131745/http://abloz.com/huzheng/stardict-dic/dict.org/stardict-dictd_www.dict.org_gcide-2.4.2.tar.bz2
$ sudo mkdir -p /usr/share/stardict/dic/
$ sudo tar xjvf stardict-dictd_www.dict.org_gcide-2.4.2.tar.bz2 -C /usr/share/stardict/dic 

</code></pre>

<h3 id="8-golden-dict">8. Golden Dict</h3>

<p>Golden Dict.</p>

<h3 id="9-latest-info-on-openstack">9. Latest Info On OpenStack</h3>

<p><a href="https://mp.weixin.qq.com/s?__biz=MzA3MjkwMDY5OA==&amp;mid=404253985&amp;idx=1&amp;sn=0d6c544dfb129e35bde7d19a0de8887b&amp;scene=1&amp;srcid=01267Etq7arAdYaFqbUG5BNa&amp;pass_ticket=qT7Nk3zsTIegBKqnPTUL%2FTtS%2FMNDH%2F07Fz%2Bfua9RcTwSHVO5OLo5wDpfeb%2FBLCEH#rd">https://mp.weixin.qq.com/s?__biz=MzA3MjkwMDY5OA==&amp;mid=404253985&amp;idx=1&amp;sn=0d6c544dfb129e35bde7d19a0de8887b&amp;scene=1&amp;srcid=01267Etq7arAdYaFqbUG5BNa&amp;pass_ticket=qT7Nk3zsTIegBKqnPTUL%2FTtS%2FMNDH%2F07Fz%2Bfua9RcTwSHVO5OLo5wDpfeb%2FBLCEH#rd</a></p>

<h3 id="10-quickly-configure-vagrant-machine">10. Quickly Configure vagrant machine</h3>

<p>Via following you could get outside world:</p>

<pre><code>ip route del default gw 10.0.2.2 dev enp0s3
ip a del 192.168.10.199/24 dev enp0s8
ip a add 192.168.10.199/16 dev enp0s8
ip route add default via 192.168.0.79 dev enp0s8
</code></pre>

<h3 id="11-change-the-default-gateway-on-centos-7">11. Change the default gateway On CentOS 7</h3>

<p>Default gateway should go here:</p>

<pre><code>$ cat /etc/sysconfig/network
# Created by anaconda
GATEWAY=192.168.0.79
</code></pre>

<p>And remove the origin default gateway by adding following definitions :</p>

<pre><code>$ cat /etc/sysconfig/network-scripts/ifcfg-enp0s3 
# Generated by dracut initrd
NAME=&quot;enp0s3&quot;
DEVICE=&quot;enp0s3&quot;
BOOTPROTO=dhcp
# This one is not the default gw
DEFROUTE=no
# Do not override the dns
PEERDNS=no
</code></pre>

<p>Thus the default gateway won&rsquo;t go from enp0s3, but from enp0s8, won&rsquo;t configure the dns
address to 10.0.x.x.</p>

<h3 id="12-on-vpns">12. On VPNs</h3>

<pre><code>http://linsir.org/post/how_to_install_IPSec_IKEV2_base_on_strongswan_with_CentOS7
https://quericy.me/blog/512
https://quericy.me/blog/699
http://lifehacker.io/post/108814979111/%E5%9C%A8%E6%90%AC%E7%93%A6%E5%B7%A5%E7%9A%84centos7%E4%B8%8B%E6%90%AD%E5%BB%BAstrongswan%E5%AE%9E%E7%8E%B0%E5%9C%A8ios%E4%B8%8A%E6%8C%89%E9%9C%80%E8%BF%9E%E6%8E%A5vpn
https://raymii.org/s/tutorials/IPSEC_vpn_with_CentOS_7.html
https://linux.cn/article-5938-weibo.html
</code></pre>

<p>MMC snap-in:<br />
<a href="https://technet.microsoft.com/en-us/library/cc722035.aspx">https://technet.microsoft.com/en-us/library/cc722035.aspx</a></p>

<h3 id="13-use-iptables-on-centos7">13. Use iptables On CentOS7</h3>

<p>Use  following steps for disable firewalld and use iptables.</p>

<pre><code>$ systemctl stop firewalld
$ systemctl mask firewalld
$ yum install iptables-services
$ systemctl enable iptables
$ systemctl start iptables

</code></pre>

<h3 id="14-quickly-goes-kernel-configuration">14. Quickly Goes kernel configuration</h3>

<p>When you want to configure the newer kernel source tree using your old kernel
configuration, simply do following:</p>

<pre><code># yes &quot;&quot; | make oldconfig
</code></pre>

<h3 id="15-iptables-problem">15. iptables problem</h3>

<p>After installing the newest kernel, I cannot use iptables, showing <code>can't initialize iptables : table does not exist</code>.</p>

<p>Solution: compile the modules again, select nat.</p>

<p><img src="/images/2016_01_28_16_05_52_496x361.jpg" alt="/images/2016_01_28_16_05_52_496x361.jpg" /></p>

<p>Selecting from:<br />
Networking Support<br />
Network Options<br />
Network packet filtering framework(Netfilter)<br />
IP: Netfilter Configuration</p>

<p>Then you should <code>make modules_install</code> under your kernel source building directory.</p>

<h3 id="16-distcc-for-building-kernel-deb">16. DistCC For Building Kernel DEB</h3>

<p>On configurating distcc:<br />
<a href="http://linuxdeveloper.blogspot.tw/2012/03/distributed-kernel-compilation-in.html">http://linuxdeveloper.blogspot.tw/2012/03/distributed-kernel-compilation-in.html</a></p>

<p>On building Linux kernel deb files:</p>

<p><a href="http://www.cyberciti.biz/faq/debian-ubuntu-building-installing-a-custom-linux-kernel/">http://www.cyberciti.biz/faq/debian-ubuntu-building-installing-a-custom-linux-kernel/</a></p>

<p>And:</p>

<p><a href="https://help.ubuntu.com/community/Kernel/Compile">https://help.ubuntu.com/community/Kernel/Compile</a></p>

<p>Actual command:</p>

<pre><code>$ time sudo make -j12 CC=distcc
$ sudo MAKEFLAGS=&quot;CC=distcc&quot; make-kpkg --rootcmd fakeroot --initrd --append-to-version=-suspend2 kernel-image kernel-headers kernel-source -j16
</code></pre>

<p>Really takes long time for building the kernel out, but the iptables won&rsquo;t works.</p>

<h3 id="17-dmenu-on-ubuntu">17. dmenu On Ubuntu</h3>

<p>dmenu is in the package of suckless-tools.</p>

<pre><code>$ sudo apt-get install suckless-tools
</code></pre>

<h3 id="18-virtio-gpu-how-to">18. Virtio-GPU How-to</h3>

<p><a href="https://www.kraxel.org/blog/2015/06/virtio-gpu-on-the-way-upstream/">https://www.kraxel.org/blog/2015/06/virtio-gpu-on-the-way-upstream/</a></p>

<h3 id="20-use-latest-dev-kernel-on-fedora">20. Use Latest Dev Kernel On Fedora</h3>

<p>Refers to
<a href="http://fedoraproject.org/wiki/Kernel_Vanilla_Repositories">http://fedoraproject.org/wiki/Kernel_Vanilla_Repositories</a></p>

<pre><code>$ curl -s https://repos.fedorapeople.org/repos/thl/kernel-vanilla.repo | sudo tee /etc/yum.repos.d/kernel-vanilla.repo
$ sudo dnf --enablerepo=kernel-vanilla-mainline update
</code></pre>

<p>Fall back to the stable one:</p>

<pre><code>$ sudo dnf --enablerepo=kernel-vanilla-stable update
</code></pre>

<h3 id="21-install-grub-on-usb-disk-archlinux">21. Install grub on usb disk/ArchLinux</h3>

<pre><code># chattr -i /boot/grub/i386-pc/core.img 
# grub-install --target=i386-pc --recheck --debug --force /dev/sdb
# chattr +i /boot/grub/i386-pc/core.img 
</code></pre>

<h3 id="22-fcitx-gtk3">22. fcitx-gtk3</h3>

<p>Since now firefox using gtk3, so if you want to input chinese in firefox, simply install <code>fcitx-gtk3</code> then you get fcitx working.</p>

<h3 id="23-polkit-and-virt-manager">23. Polkit And Virt-manager</h3>

<p>Problem:</p>

<pre><code>$ virsh -c qemu:///system
error: failed to connect to the hypervisor
error: authentication failed: no agent is available to authenticate
</code></pre>

<p>Add the configuration for the polkit and restart the service:</p>

<pre><code>$ sudo vim /etc/polkit-1/rules.d/49-org.libvirt.unix.manager.rules
polkit.addRule(function(action, subject) {
    if (action.id == &quot;org.libvirt.unix.manage&quot; &amp;&amp;
        subject.isInGroup(&quot;kvm&quot;)) {
            return polkit.Result.YES;
        }
});
</code></pre>

<p>And also you have to add your current user into the group of <code>kvm</code>:</p>

<pre><code>$ sudo usermod -a -G kvm &lt;user name&gt;
</code></pre>

<p>Restar the polkit service via:</p>

<pre><code>$ sudo systemctl restart polkit.service
</code></pre>

<h3 id="24-running-tasks-in-byobu">24. Running tasks in byobu</h3>

<p><a href="http://superuser.com/questions/623432/transfer-current-command-to-a-detachable-session-tmux-screen">http://superuser.com/questions/623432/transfer-current-command-to-a-detachable-session-tmux-screen</a></p>

<h3 id="25-gpu-pass-through">25. GPU Pass-Through</h3>

<p><a href="http://www.gitztalk.com/posts/2014/06/30/gaming-in-a-vm/">http://www.gitztalk.com/posts/2014/06/30/gaming-in-a-vm/</a></p>

<h3 id="26-yaourt-build-error">26. yaourt build error</h3>

<p>Reason: gpg checking error, solution is:</p>

<pre><code>$ proxychains4 gpg --recv-key  79BE3E4300411886
</code></pre>

<h3 id="27-libvirtd-and-polkit">27. libvirtd and polkit</h3>

<p>Bypass the password prompt:</p>

<p><a href="https://wiki.archlinux.org/index.php/Polkit#Bypass_password_prompt">https://wiki.archlinux.org/index.php/Polkit#Bypass_password_prompt</a></p>

<h3 id="28-virgl-repository">28. virgl repository</h3>

<p><a href="https://www.kraxel.org/repos/">https://www.kraxel.org/repos/</a></p>

<h3 id="29-pass-through-howto">29. pass-through howto</h3>

<p><a href="http://vfio.blogspot.com.au/2015/05/vfio-gpu-how-to-series-part-3-host.html">http://vfio.blogspot.com.au/2015/05/vfio-gpu-how-to-series-part-3-host.html</a></p>

<h3 id="30-control-the-usb-port-power">30. Control the USB port power</h3>

<p><a href="http://stackoverflow.com/questions/4702216/controlling-a-usb-power-supply-on-off-with-linux">http://stackoverflow.com/questions/4702216/controlling-a-usb-power-supply-on-off-with-linux</a></p>

<h3 id="31-on-how-to-reverse-usb-device">31. On how to reverse usb device</h3>

<p><a href="http://www.linuxjournal.com/article/7353?page=0,0">http://www.linuxjournal.com/article/7353?page=0,0</a><br />
<a href="https://www.reddit.com/r/linuxmasterrace/comments/2zveiw/question_about_wine/">https://www.reddit.com/r/linuxmasterrace/comments/2zveiw/question_about_wine/</a></p>

<h3 id="32-set-unset-keyboard-led">32. Set/Unset keyboard LED</h3>

<p>Turn on/off the Scroll LED of the keyboard(USB):</p>

<pre><code>xset led 3
xset -led 3
</code></pre>

<h3 id="33-usb-in-a-nutshell">33. USB In a NutShell</h3>

<p><a href="http://www.beyondlogic.org/usbnutshell/usb1.shtml">http://www.beyondlogic.org/usbnutshell/usb1.shtml</a></p>

<h3 id="34-arduino-usb-tutorial">34. Arduino USB Tutorial</h3>

<p><a href="http://codeandlife.com/2012/01/22/avr-attiny-usb-tutorial-part-1/">http://codeandlife.com/2012/01/22/avr-attiny-usb-tutorial-part-1/</a></p>

<h3 id="35-auduino-usb-project">35. Auduino USB Project</h3>

<p><a href="https://www.obdev.at/products/vusb/projects.html">https://www.obdev.at/products/vusb/projects.html</a></p>

<h3 id="36-detecting-mouse-events">36. Detecting mouse events</h3>

<p>Using evtest for detecting mouse events:</p>

<pre><code>$ sudo apt-get install evtest
$ sudo evtest
</code></pre>

<h3 id="37-steelseries-mouse-raw-demo">37. SteelSeries Mouse (RAW) DEMO</h3>

<p><a href="https://www.youtube.com/watch?v=yvvybR6oyvs">https://www.youtube.com/watch?v=yvvybR6oyvs</a></p>

<h3 id="38-usb-device-driver">38. USB Device Driver</h3>

<p><a href="http://blog.chinaunix.net/uid-20587912-id-2984380.html">http://blog.chinaunix.net/uid-20587912-id-2984380.html</a></p>

<p><a href="http://www.wzona.info/2012/10/usb-duomenu-perdavimas-atmega.html">http://www.wzona.info/2012/10/usb-duomenu-perdavimas-atmega.html</a></p>

<h3 id="39-reverse-usb-device-driver">39. Reverse usb device driver</h3>

<p><a href="http://phoeagon.byethost15.com/2012/05/05/%e7%bb%99%e6%9d%82%e7%89%8c%e5%b9%bb%e7%81%af%e7%89%87usb%e9%81%a5%e6%8e%a7%e5%86%99linux%e9%a9%b1%e5%8a%a8-%e4%b8%8a/">http://phoeagon.byethost15.com/2012/05/05/%e7%bb%99%e6%9d%82%e7%89%8c%e5%b9%bb%e7%81%af%e7%89%87usb%e9%81%a5%e6%8e%a7%e5%86%99linux%e9%a9%b1%e5%8a%a8-%e4%b8%8a/</a></p>

<p><a href="http://www.phoronix.com/scan.php?page=news_item&amp;px=MTEzODU">http://www.phoronix.com/scan.php?page=news_item&amp;px=MTEzODU</a></p>

<p><a href="https://bbs.archlinux.org/viewtopic.php?id=187995">https://bbs.archlinux.org/viewtopic.php?id=187995</a></p>

<p><a href="https://www.youtube.com/watch?v=GdvmsWnZkyc">https://www.youtube.com/watch?v=GdvmsWnZkyc</a></p>

<p><a href="https://learn.adafruit.com/hacking-the-kinect/more-kinect-information">https://learn.adafruit.com/hacking-the-kinect/more-kinect-information</a></p>

<p><a href="https://www.linuxvoice.com/drive-it-yourself-usb-car-6/">https://www.linuxvoice.com/drive-it-yourself-usb-car-6/</a></p>

<p>Total Phase USB:</p>

<p><a href="http://www.totalphase.com/products/beagle-usb12/">http://www.totalphase.com/products/beagle-usb12/</a></p>

<p><a href="https://github.com/dmage/co2mon">https://github.com/dmage/co2mon</a></p>

<h3 id="40-v-usb-tutorial">40. v-usb tutorial</h3>

<p><a href="http://www.workinprogress.ca/v-usb-tutorial-software-only-usb-for-mega-tiny/">http://www.workinprogress.ca/v-usb-tutorial-software-only-usb-for-mega-tiny/</a></p>

<h3 id="41-v-usb-and-arduino">41. v-usb and Arduino</h3>

<p><a href="https://www.hackster.io/rayburne/arduino-to-excel-using-v-usb-cbf701">https://www.hackster.io/rayburne/arduino-to-excel-using-v-usb-cbf701</a></p>

<p><a href="http://www.geek-workshop.com/forum.php?mod=viewthread&amp;tid=8578&amp;highlight=v-usb">http://www.geek-workshop.com/forum.php?mod=viewthread&amp;tid=8578&amp;highlight=v-usb</a></p>

<p><a href="http://coopermaa2nd.blogspot.tw/2011/10/v-usb-examples-for-arduino.html">http://coopermaa2nd.blogspot.tw/2011/10/v-usb-examples-for-arduino.html</a></p>

<p><a href="http://www.geek-workshop.com/thread-1137-1-1.html">http://www.geek-workshop.com/thread-1137-1-1.html</a></p>

<p><a href="http://www.geek-workshop.com/forum.php?mod=viewthread&amp;tid=15114&amp;highlight=v-usb">http://www.geek-workshop.com/forum.php?mod=viewthread&amp;tid=15114&amp;highlight=v-usb</a></p>

<h3 id="42-set-timezone-of-the-archlinux">42.Set Timezone of the ArchLinux</h3>

<p>Change from UTC to Asia/Shanghai:</p>

<pre><code>$ timedatectl set-timezone Asia/Shanghai
</code></pre>

<h3 id="43-empty-all-of-the-bash-history">43. Empty all of the bash history</h3>

<p>Empty the bash history via:</p>

<pre><code>$ rm -f ~/.bash_history
</code></pre>

<h3 id="44-specify-qemu-binary-in-packer-io">44. Specify qemu-binary in Packer.io</h3>

<p>Edit the json files:</p>

<pre><code>&quot;builders&quot;:
[
{
&quot;type&quot;: &quot;qemu&quot;,
&quot;qemu_binary&quot; : &quot;/usr/libexec/qemu-kvm.sh&quot;,
</code></pre>

<h3 id="45-apprmor-d">45. apprmor.d</h3>

<pre><code>I modified /etc/apparmor.d/abstractions/libvirt-qemu to include the
backing store directory
</code></pre>

<h3 id="46-recover-uefi-bootloader">46. Recover UEFI bootloader</h3>

<p>After remove the mainline linux kernel, the archlinux is using the default kernel, but
the UEFI bootloader didn&rsquo;t notice this, following are the steps for recover the UEFI
bootloader.</p>

<pre><code>grub-install --target=x86_64-efi --efi-directory=/boot/EFI   --bootloader-id=arch_grub --recheck
cat ./EFI/loader/entries/arch.conf
</code></pre>

<p>Change the items into <code>initramfs-linux</code>.</p>

<p>If you cannot login to the system, you could start the machine via USB disk or
installation media, using <code>arch-chroot /mnt/ /bin/bash</code> for login to the chroot system,
then do the above operations.</p>

<h3 id="47-bonding">47. bonding</h3>

<p><a href="http://sanswers.com/tube/wotC5GZ2FV0/bonding-eth0-and-wlan0-on-arch-linux">http://sanswers.com/tube/wotC5GZ2FV0/bonding-eth0-and-wlan0-on-arch-linux</a></p>

<h3 id="48-fix-currpted-zsh-history">48. Fix currpted zsh history</h3>

<p>history corrupted.</p>

<pre><code>$ mv .zsh_history .zsh_history_bad
$ strings .zsh_history_bad &gt; .zsh_history
$ fc -R .zsh_history
</code></pre>

<h3 id="49-pulp">49. pulp</h3>

<p>Using pulp for managing the repositories of RPM/Docker, etc.</p>

<h3 id="50-chromium-flash">50. Chromium flash</h3>

<p>Install chromium-pepper-flash in aur.</p>

<h3 id="51-install-xfce4-on-centos">51. Install xfce4 on CentOS</h3>

<p>Install xfce in epel repository via:</p>

<pre><code># yum --enablerepo=epel -y groups install &quot;Xfce&quot; 
</code></pre>

<h3 id="52-led-controller">52. LED controller</h3>

<p><a href="http://www.seeedstudio.com/recipe/402-smart-power-outlet.html">http://www.seeedstudio.com/recipe/402-smart-power-outlet.html</a></p>

<h3 id="53-build-php-envs">53. Build php envs</h3>

<p><a href="https://medium.com/dev-tricks/apache-and-php-on-docker-44faef716150#.c8bguolj0">https://medium.com/dev-tricks/apache-and-php-on-docker-44faef716150#.c8bguolj0</a></p>

<h3 id="54-handle-docker-changes">54. handle docker changes</h3>

<p><a href="http://dbaron.org/linux/handle-dock-change.py">http://dbaron.org/linux/handle-dock-change.py</a></p>

<h3 id="55-python-detection-of-usb-storage">55. python detection of usb storage</h3>

<p><a href="https://linuxmeerkat.wordpress.com/2014/11/12/python-detection-of-usb-storage-device/">https://linuxmeerkat.wordpress.com/2014/11/12/python-detection-of-usb-storage-device/</a><br />
d-feet for debugging of dbus..</p>

<h3 id="56-libmtp-related">56. libmtp related</h3>

<p>Install <code>gvfp-mtp</code>, then you could get your nautillus have the mtp device
support.</p>

<p>Using <code>mtp-detect</code> for detecting the equipments and <code>mtp-connect</code> for
connecting the device.</p>

<h3 id="57-virtualbox-driver-issue">57. Virtualbox Driver Issue</h3>

<p>After upgrading the system, the virtualbox won&rsquo;t start the machine, this is because we
didn&rsquo;t install the kernel header, thus the dkms won&rsquo;t be run after system upgrading.
Install kernel-headers:</p>

<pre><code>$ sudo pacman -S linux-headers
$ sudo /sbin/rcvboxdrv setup
</code></pre>

<h3 id="58-creation-tools">58. Creation tools</h3>

<p><a href="https://linux.cn/article-7072-1.html">https://linux.cn/article-7072-1.html</a></p>

<h3 id="59-rvm-reinstall-issue">59. rvm reinstall issue</h3>

<p>openssl load error:</p>

<pre><code>$ rvm pkg install openssl
$ rvm install 2.2.1  --with-openssl-dir=$HOME/.rvm/usr
$ proxychains4 gem update bundler
</code></pre>

<p>Then you can continue to use your octopress.</p>

<h3 id="60-install-go-on-archlinux">60 Install go on ArchLinux</h3>

<pre><code>$ sudo pacman -S go
$ mkdir ~/go
$ vim ~/.zshrc
export GOPATH=~/go
export PATH=$PATH:~/go/bin
</code></pre>

<h3 id="61-packer-development-version">61. Packer Development Version</h3>

<p>The steps on building packer on Ubuntu:</p>

<pre><code>$ sudo add-apt-repository ppa:ubuntu-lxc/lxd-stable
$ sudo apt-get update
$ sudo apt-get install golang
$ mkdir -p $HOME/Documents/golang
$ export GOPATH=$HOME/Documents/golang
$ export GO15VENDOREXPERIMENT=1
$ export PATH=$PATH:$GOPATH/bin
$ go get github.com/mitchellh/packer
$ cd $GOPATH/src/github.com/mitchellh/packer
$ sudo chown -R dash /home/dash/
$ make
</code></pre>

<p>bitnami</p>

<h3 id="62-install-add-apt-repository-command">62. Install add-apt-repository command</h3>

<p>add-apt-repository missing:</p>

<pre><code>$ sudo apt-get install software-properties-common
</code></pre>

<h3 id="63-git-checkout-specified-tags">63. git checkout specified tags</h3>

<p>For checkout specified tag:</p>

<pre><code>$ git tag -l
.....
.....
xxyy
$ git checkout tags/xxyy -b xxyy_local
</code></pre>

<h3 id="64-nested-kvm-on-archlinux">64. Nested kvm On ArchLinux</h3>

<p>Enable the nested kvm for ArchLinux via following steps:</p>

<pre><code>➜  ~ systool -m kvm_intel -v | grep nested
    nested              = &quot;N&quot;
➜  ~ modprobe -r kvm_intel
modprobe: ERROR: could not remove 'kvm_intel': Operation not permitted
➜  ~ sudo modprobe -r kvm_intel
➜  ~ sudo modprobe kvm_intel nested=1
➜  ~ sudo vim /etc/modprobe.d/modprobe.conf
options kvm_intel nested=1
➜  ~ systool -m kvm_intel -v | grep nested
    nested              = &quot;Y&quot;
</code></pre>

<h3 id="65-failed-to-build-rubygem">65. Failed to build rubygem</h3>

<p>Issue:</p>

<pre><code>Unable to install gem - Failed to build gem native extension - cannot load
such file — mkmf (LoadError)
</code></pre>

<p>Solved by: <code>sudo apt-get install -y ruby-dev</code>.</p>

<h3 id="66-xe-tools-location">66. xe-tools location</h3>

<p>Loation for finding xe-tools:</p>

<pre><code># pwd
/opt/xensource/packages/iso
# ls
XenCenter.iso  xs-tools-6.5.0-20001.iso  xs-tools-6.5.0.iso
</code></pre>

<h3 id="67-qemu-tunnel-types">67. Qemu Tunnel Types</h3>

<p><a href="http://linuxsimba.com/qemu-tunnel-types/">http://linuxsimba.com/qemu-tunnel-types/</a></p>

<h3 id="68-zsh-history">68. zsh history</h3>

<p>Error message is <code>zsh: corrupt history file /home/myusername/.zsh_history</code>.</p>

<p>Solved by:</p>

<pre><code>➜  ~ mv .zsh_history .zsh_history_bad
➜  ~ strings .zsh_history_bad &gt; .zsh_history
➜  ~ fc -R .zsh_history
</code></pre>

<h3 id="69-virsh-priviledge-in-ubuntu">69. virsh priviledge In Ubuntu</h3>

<p>When met following issue, solved via add current user to <code>libvirtd</code> and <code>kvm</code>, relogin
again then issue would be solved:</p>

<pre><code>Error while connecting to libvirt: Error making a connection to libvirt URI
qemu:///system?no_verify=1&amp;keyfile=/home/dash/.ssh/id_rsa:
Call to virConnectOpen failed: Failed to connect socket to
'/var/run/libvirt/libvirt-sock': Permission denied
</code></pre>

<p>Solution :</p>

<pre><code>$ sudo usermod -a -G kvm dash
$ sudo usermod -a -G libvirtd dash
</code></pre>

<h3 id="70-vagrant-ext-vars">70. Vagrant ext vars</h3>

<p><a href="http://stackoverflow.com/questions/23008367/ansible-with-vagrant-read-inventory-from-vagrantfile-extra-vars">http://stackoverflow.com/questions/23008367/ansible-with-vagrant-read-inventory-from-vagrantfile-extra-vars</a></p>

<h3 id="71-rootpasswd-in-kickstart">71. rootpasswd in Kickstart</h3>

<p>Formats, and to generate the encrypted format.</p>

<pre><code>rootpw &quot;password here&quot;
rootpw --iscrypted password_hash
$ openssl passwd -1 &quot;password here&quot;
</code></pre>

<h3 id="72-on-vagrant-xenserver">72. On Vagrant Xenserver</h3>

<p>To build Xenserver vagrant box in packer:<br />
<a href="https://github.com/imduffy15/packer-xenserver">https://github.com/imduffy15/packer-xenserver</a></p>

<p>Possible usable vagrant box(For Xenserver):<br />
<a href="https://vagrantcloud.com/duffy/boxes/xenserver">https://vagrantcloud.com/duffy/boxes/xenserver</a></p>

<p>Remote provisioning to a xenserver hypervisor:<br />
<a href="http://serverfault.com/questions/631837/remote-automated-provisioning-to-a-xenserver-hypervisor">http://serverfault.com/questions/631837/remote-automated-provisioning-to-a-xenserver-hypervisor</a></p>

<p>Ansible and Xen:<br />
<a href="http://sharknet.us/2013/12/13/276/">http://sharknet.us/2013/12/13/276/</a></p>

<p>Vagrant and XenServer:<br />
<a href="https://github.com/jonludlam/vagrant-xenserver">https://github.com/jonludlam/vagrant-xenserver</a></p>

<h3 id="73-tips-on-xenserver-in-vagrant">73. Tips on Xenserver In Vagrant</h3>

<p>Mac address:</p>

<pre><code># vim /etc/sysconfig/network-scripts/interface-rename-data/static-rules.conf
eth0:mac = &quot;xxxxxxxxx&quot;
# interface-rename --dry-run --reset-to-install
</code></pre>

<p>Then  you could reset all of your configuration into the initial status.</p>

<h3 id="74-oh-my-vagrant">74. oh-my-vagrant</h3>

<p><a href="https://github.com/purpleidea/oh-my-vagrant">https://github.com/purpleidea/oh-my-vagrant</a></p>

<h3 id="75-detect-system">75. Detect System</h3>

<p><a href="http://unix.stackexchange.com/questions/89714/easy-way-to-determine-virtualization-technology">http://unix.stackexchange.com/questions/89714/easy-way-to-determine-virtualization-technology</a></p>

<p>Use dmidecode.</p>

<h3 id="76-git-remove-untracked-files">76. git remove untracked files</h3>

<p>Following commands will remove the untracked files in .gitignore.</p>

<pre><code>$  git rm --cached .vagrant
$  git rm --cached -r .vagrant
$  git rm -r --cached . 
$  git add .
$  git commit -m &quot;Added with gitignored&quot;
$  git push origin master
</code></pre>

<h3 id="77-node-mcu-good-example">77. node mcu good example</h3>

<p><a href="http://bbs.nodemcu.com/t/nodemcu/1147">http://bbs.nodemcu.com/t/nodemcu/1147</a></p>

<h3 id="78-8723ae-issue">78. 8723ae issue</h3>

<p>Do following to make the rtl8723awe working more effeciently.</p>

<pre><code>$ vim  /etc/modprobe.d/rtl8723ae.conf
options rtl8723ae fwlps=0
</code></pre>

<h3 id="79-pdf-chinese">79. PDF Chinese</h3>

<p>Poppler-data will enable chinese support.</p>

<pre><code>$ sudo pacman -S poppler-data
</code></pre>

<h3 id="80-join-multiple-lines-with-comma">80. Join multiple lines with comma</h3>

<p>abc.txt should remove the end enter and replaced with comma.</p>

<pre><code>$ cat abc.txt | tr '\n' ','
</code></pre>

<p>Refers to:<br />
<a href="http://blog.irreverence.co.uk/?p=209">http://blog.irreverence.co.uk/?p=209</a></p>

<h3 id="81-shrink-vhd-file">81. Shrink vhd file</h3>

<p>In XenServer vms:</p>

<pre><code>$ cat /dev/zero &gt; zero.dat ; sync ; sleep 1 ; sync ; rm zero.dat
</code></pre>

<h3 id="82-vhd-file-compact">82. VHD File Compact</h3>

<p>shirinking the vhd file via:</p>

<pre><code>$ VBoxManage clonehd target.vhd cloned.vhd
$ VBoxManage modifyhd cloned.vhd --compact
</code></pre>

<h3 id="83-1602-and-rpi">83. 1602 And RPI</h3>

<p><a href="http://www.raspberrypi-spy.co.uk/2015/05/using-an-i2c-enabled-lcd-screen-with-the-raspberry-pi/">http://www.raspberrypi-spy.co.uk/2015/05/using-an-i2c-enabled-lcd-screen-with-the-raspberry-pi/</a><br />
<a href="http://raspberrypi.stackexchange.com/questions/28991/how-can-i-use-a-lcd-display-with-a-i2c-adapter">http://raspberrypi.stackexchange.com/questions/28991/how-can-i-use-a-lcd-display-with-a-i2c-adapter</a></p>

<h3 id="84-cpu-frequency">84. CPU Frequency</h3>

<p>Install and enable the service of cpupower via:</p>

<pre><code>$ sudo pacman -S cpupower
$ sudo systemctl enable cpupower.service
$ sudo systemctl start cpupower.service
</code></pre>

<p>configure the cpupower parameters via:</p>

<pre><code>$  cat /etc/default/cpupower   
# Define CPUs governor
# valid governors: ondemand, performance, powersave, conservative, userspace.
governor='performance'
</code></pre>

<p>Some useful commands should be like:</p>

<pre><code>$ sudo cpupower frequency-set -f  3.06
$ cpupower frequency-info
$ watch grep \&quot;cpu MHz\&quot; /proc/cpuinfo
</code></pre>

<h3 id="85-gmail-mutt">85. Gmail Mutt</h3>

<p><a href="https://www.linux.com/community/blogs/133-general-linux/850945-setup-mutt-with-gmail-on-centos-and-ubuntu">https://www.linux.com/community/blogs/133-general-linux/850945-setup-mutt-with-gmail-on-centos-and-ubuntu</a></p>

<h3 id="86-fake-video">86. Fake Video</h3>

<p><a href="http://www.atechnote.com/2014/11/create-fake-webcam.html">http://www.atechnote.com/2014/11/create-fake-webcam.html</a><br />
<a href="https://developer.ubuntu.com/en/snappy/start/">https://developer.ubuntu.com/en/snappy/start/</a></p>

<h3 id="87-way-of-snappy-extend">87. Way Of Snappy Extend</h3>

<p><a href="http://askubuntu.com/questions/577105/is-there-a-way-to-add-repo-to-snappy-ubuntu-core">http://askubuntu.com/questions/577105/is-there-a-way-to-add-repo-to-snappy-ubuntu-core</a></p>

<h3 id="88-pl2802-driver">88. pl2802 driver</h3>

<p>You probably have a counterfeit adapter. It won&rsquo;t work with the updated driver. You
need to find the 3.2.0.0 driver and use it instead. You can find it here
<a href="http://www.miklor.com/COM/UV_Drivers.php">http://www.miklor.com/COM/UV_Drivers.php</a></p>

<h3 id="83-collectd-on-archlinux">83. collectd On ArchLinux</h3>

<p>Install collectd via:</p>

<pre><code>$ sudo pacman -S rrdtool net-snmp liboping collectd
</code></pre>

<h3 id="84-gem-path">84. gem path</h3>

<p>Use <code>gem env</code> for detecting the system variables, some variables should be added into
system path.</p>

<h3 id="85-vagrant-and-packer-io">85. Vagrant and packer.io</h3>

<p><a href="http://boxupp.com/">http://boxupp.com/</a><br />
<a href="http://phansible.com/">http://phansible.com/</a><br />
<a href="https://puphpet.com/#">https://puphpet.com/#</a><br />
<a href="getprotobox.com/">getprotobox.com/</a><br />
<a href="http://www.sitepoint.com/5-easy-ways-getting-started-php-vagrant/">http://www.sitepoint.com/5-easy-ways-getting-started-php-vagrant/</a><br />
<a href="http://rove.io/">http://rove.io/</a></p>

<h3 id="86-install-latest-ansible">86 Install latest ansible</h3>

<p>Install the latest ansible on Ubuntu:</p>

<pre><code>$ sudo apt-get update
$ sudo apt-get install software-properties-common
$ sudo apt-add-repository ppa:ansible/ansible
</code></pre>

<h3 id="87-packer-and-ansible">87. Packer And Ansible</h3>

<p><a href="http://www.jeffgeerling.com/blog/server-vm-images-ansible-and-packer">http://www.jeffgeerling.com/blog/server-vm-images-ansible-and-packer</a></p>

<h3 id="88-vagrant-issue">88. Vagrant issue</h3>

<p>Problem is:</p>

<pre><code>sudo vagrant up
Bringing machine 'tunirserver' up with 'libvirt' provider...
/usr/share/gems/gems/fog-1.23.0/lib/fog/libvirt/requests/compute/list_volumes.rb:32:in `info': Call to virStorageVolGetInfo failed: Storage volume not found: no storage vol with matching path '/tmp/orbit-kdas' (Libvirt::RetrieveError)
</code></pre>

<p>Solved by:</p>

<pre><code>$  sudo virsh pool-list
 Name                 State      Autostart 
-------------------------------------------
 default              active     yes       
 tmp                  active     yes 
Then refreshing each pool manually.

$  sudo virsh pool-refresh tmp
Pool tmp refreshed
$  sudo virsh pool-refresh default
Pool default refreshed
</code></pre>

<h3 id="89-apicv-tips">89. apicv tips.</h3>

<p>View and modify the parameters.</p>

<pre><code>options kvm_intel nested=1
options kvm_intel enable_shadow_vmcs=1
options kvm_intel enable_apicv=1
options kvm_intel ept=1

By setting enable_apicv=0 the messages are gone
cat /sys/module/kvm_intel/parameters/enable_apicv
N 
</code></pre>

<h3 id="90-disable-apic-in-xenserver">90. Disable apic in XenServer</h3>

<p><a href="http://discussions.citrix.com/topic/350144-xen62-turn-off-acpi-without-grubconfmenulst/">http://discussions.citrix.com/topic/350144-xen62-turn-off-acpi-without-grubconfmenulst/</a></p>

<pre><code>if you look into the /boot/extlinux.conf the safe mode uses acpi=off params  as

label safe
  # XenServer in Safe Mode
  kernel mboot.c32
  append /boot/xen.gz nosmp noreboot noirqbalance acpi=off noapic mem=1024G dom0_max_vcpus=4 dom0_mem=752M,max:752M com1=115200,8n1 console=com1,vga --- /boot/vmlinuz-2.6-xen nousb root=LABEL=root-fxfyhkuc ro console=tty0 xencons=hvc console=hvc0 --- /boot/initrd-2.6-xen.img
</code></pre>

<h3 id="91-quickly-devstack">91. Quickly devstack</h3>

<p>Clone the repository from:</p>

<pre><code>git clone http://github.com/openstack-dev/devstack
cd devstack/
</code></pre>

<p>Edit localrc via:</p>

<pre><code>For Git Clone

 git clone http://git.trystack.cn/openstack/nova.git 

For DevStack

Add GIT_BASE, NOVNC_REPO and SPICE_REPO variables to local.conf file.

[[local|localrc]]

# use TryStack git mirror
GIT_BASE=http://git.trystack.cn
NOVNC_REPO=http://git.trystack.cn/kanaka/noVNC.git
SPICE_REPO=http://git.trystack.cn/git/spice/spice-html5.git

</code></pre>

<p>Here you could go on with devstack.sh</p>

<h3 id="92-find-and-replace-string-in-one-directory">92. find and replace string in one directory</h3>

<p>Be sure to use /bin/bash without any colors.</p>

<pre><code>grep -rli '192.168.1.69' | xargs -i@ sed -i 's/192.168.1.69/192.168.0.121:8080/g' @
</code></pre>

<h3 id="93-two-ides">93. Two IDES</h3>

<p>Startup the cloud9 and eclise-orion via:</p>

<pre><code>$ sudo docker run -it -d -p 8888:80 kdelfour/cloud9-docker
$ sudo docker run -it -d -p 8889:8080 fabric8/eclipse-orion  
</code></pre>

<h3 id="94-raspberrypi-and-webtop">94. RaspberryPI And WebTop</h3>

<p><a href="http://www.instructables.com/id/Raspberry-PI-Motorola-Lapdock/step7/References/">http://www.instructables.com/id/Raspberry-PI-Motorola-Lapdock/step7/References/</a></p>

<h3 id="95-npm-china">95. npm china</h3>

<p>Use following command for using cnpm for replacing the npm:</p>

<pre><code>$ npm install -g cnpm --registry=https://registry.npm.taobao.org
</code></pre>

<h3 id="96-opera-vimemperator-issue">96. Opera Vimemperator issue</h3>

<pre><code>1) Install opera extension which allows you to install Google Chrome Web Store
extensions -
https://addons.opera.com/en/extensions/details/download-chrome-extension-9/

2) Install the Vimium extension at
https://chrome.google.com/webstore/detail/vimium/dbepggeogbaibhgnhhndojpepiihcmeb?hl=en

You now have a a great looking Vimium extension working in Opera.
</code></pre>

<h3 id="97-openstack-issue">97. OpenStack Issue</h3>

<p><a href="http://kingsoo1983.github.io/blog/2016/04/14/about-openstack/">http://kingsoo1983.github.io/blog/2016/04/14/about-openstack/</a></p>

<p>For using devstack:</p>

<pre><code>$cd devstack/
$source openrc admin admin # for admin rights
or
$source openrc demo demo # for demo user
</code></pre>

<h3 id="98-tcpdump-no-buffer">98. tcpdump no buffer</h3>

<p>with <code>tcpdump -l</code>, tcpdump will show real-time.</p>

<h3 id="99-detach-runnning-process">99. Detach runnning process</h3>

<p><a href="http://superuser.com/questions/732503/redirect-stdout-stderr-of-a-background-job-from-console-to-a-log-file">http://superuser.com/questions/732503/redirect-stdout-stderr-of-a-background-job-from-console-to-a-log-file</a></p>

<h3 id="100-mirantis-issue">100. Mirantis Issue</h3>

<p><a href="https://docs.mirantis.com/openstack/fuel/fuel-master/reference-architecture.html#fuel-repository-mirroring">https://docs.mirantis.com/openstack/fuel/fuel-master/reference-architecture.html#fuel-repository-mirroring</a></p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2016/01/15/vlan-experiment/">Vlan Experiment</a>
      </h1>
      <span class="post-date">Jan 15, 2016  &middot; <a href="http://purplepalmdash.github.io/2016/01/15/vlan-experiment/#disqus_thread">Comments</a>
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/networking">networking</a>
        
      </span>
      
      

<p>Recently I am busy with configurating the LXC networking in Cloudstack, so following is
how I understanding the vlan experiment on how to understand the
public/private/management networking in CloudStack.</p>

<h3 id="prerequisite">Prerequisite</h3>

<p>Prepare 2 virtual machine of CentOS6.7, each connected to a seperated networking.<br />
Machine 1, dhcp, got 10.47.58.203. Named vlan1.<br />
Machine 2, dhcp, got 10.47.58.214. Named vlan2.</p>

<h3 id="install-software">Install Software</h3>

<p>For easily configure 802.1Q vlan tagging networking in CentOS7, install following packages.</p>

<pre><code>$ yum install vconfig
</code></pre>

<h3 id="vlan-configurating">Vlan Configurating</h3>

<p>Configure like following:</p>

<pre><code>[root@localhost ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0
DEVICE=&quot;eth0&quot;
#BOOTPROTO=&quot;dhcp&quot;
BOOTPROTO=&quot;none&quot;
NM_CONTROLLED=&quot;yes&quot;
ONBOOT=&quot;yes&quot;
TYPE=&quot;Ethernet&quot;
[root@localhost ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0.100 
DEVICE=eth0.100
ONBOOT=yes
HOTPLUG=no
BOOTPROTO=none
TYPE=Ethernet
VLAN=yes
IPADDR=192.168.42.11
NETMASK=255.255.255.0
</code></pre>

<p>In another machine, configure the eth0.100 as <code>192.168.42.12</code>, after reboot, they could
be reached via this vlan tagging 100 address.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2016/01/14/cloudstackshi-yong-lxcyao-dian/">CloudStack使用LXC要点</a>
      </h1>
      <span class="post-date">Jan 14, 2016  &middot; <a href="http://purplepalmdash.github.io/2016/01/14/cloudstackshi-yong-lxcyao-dian/#disqus_thread">Comments</a>
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/virtualization">Virtualization</a>
        
      </span>
      
      

<h3 id="先决条件">先决条件</h3>

<p>Cloudstack 4.6.0, Management Server搭建完毕, Agent包安装完毕.<br />
具体的步骤可以参考KVM的安装.</p>

<h3 id="agent机器">Agent机器</h3>

<p>设置hypervisor的类型为LXC模式:</p>

<pre><code>$ vim /etc/cloudstack/agent/agent.properties
 hypervisor.type=lxc
$ service cloudstack-agent restart
</code></pre>

<h3 id="lxc系统虚拟机模板安装">LXC系统虚拟机模板安装</h3>

<p>在CloudStack Management节点上,运行以下命令安装系统虚拟机模板:</p>

<pre><code>$ /usr/share/cloudstack-common/scripts/storage/secondary/cloud-install-sys-tmplt -m /mnt1 -u http://192.168.177.13/systemvm64template-4.6.0-kvm.qcow2.bz2 -h lxc -F
</code></pre>

<p>注意替换以上命令里的镜像下载地址及安装目录.</p>

<h3 id="添加zone">添加Zone</h3>

<p>先添加一个基本的Zone,注意选择hypervisor为LXC.<br />
添加一级/二级存储.<br />
添加完毕后, enable zone后, 下载模板, 注意不要选择HVM的选项.</p>

<p>到这里就可以开始创建实例了.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2016/01/11/install-cloudstack-mgmt-server-on-centos7/">Install CloudStack Mgmt Server On CentOS7</a>
      </h1>
      <span class="post-date">Jan 11, 2016  &middot; <a href="http://purplepalmdash.github.io/2016/01/11/install-cloudstack-mgmt-server-on-centos7/#disqus_thread">Comments</a>
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/virtualization">virtualization</a>
        
      </span>
      
      

<h3 id="steps">Steps</h3>

<p>Disable selinux:</p>

<pre><code># setenforce permissive
# vim /etc/selinux/config 
SELINUX=permissive
</code></pre>

<p>Edit the hostname and hosts file:</p>

<pre><code>[root@csman ~]# cat /etc/hostname 
csman
[root@csman ~]# cat /etc/hosts
127.0.0.1 localhost localhost.cstack.local
192.168.56.12 csman.cstack.local csman
192.168.56.101 xenserver.cstack.local xenserver
</code></pre>

<p>Enable the ntp server:</p>

<pre><code># yum install -y ntp
# chkconfig ntpd on
# service ntpd start
</code></pre>

<p>Configure the nfs sharing:</p>

<pre><code># mkdir /exports
# mkdir -p /exports/primary
# mkdir -p /exports/secondary
# chmod 777 -R /exports
# echo &quot;/exports/primary 10.10.100.0/24(rw,async,no_root_squash)&quot; &gt; /etc/exports
# echo &quot;/exports/secondary 10.10.101.0/24(rw,async,no_root_squash)&quot; &gt;&gt; /etc/exports
# exportfs -a
</code></pre>

<p>Configure the nfs ruls:</p>

<pre><code># sed -i -e '/#MOUNTD_NFS_V3=&quot;no&quot;/ c\MOUNTD_NFS_V3=&quot;yes&quot;' -e '/#RQUOTAD_PORT=875/ c\RQUOTAD_PORT=875' -e '/#LOCKD_TCPPORT=32803/ c\LOCKD_TCPPORT=32803' -e '/#LOCKD_UDPPORT=32769/ c\LOCKD_UDPPORT=32769' -e '/#MOUNTD_PORT=892/ c\MOUNTD_PORT=892' -e '/#STATD_PORT=662/ c\STATD_PORT=662' -e '/#STATD_OUTGOING_PORT=2020/ c\STATD_OUTGOING_PORT=2020' /etc/sysconfig/nfs
# sed -i -e &quot;/:OUTPUT/ a\-A INPUT -p tcp -m tcp --dport 111 -j ACCEPT&quot; /etc/sysconfig/iptables
# sed -i -e &quot;/:OUTPUT/ a\-A INPUT -p udp -m udp --dport 111 -j ACCEPT&quot; /etc/sysconfig/iptables
# sed -i -e &quot;/:OUTPUT/ a\-A INPUT -p tcp -m tcp --dport 2049 -j ACCEPT&quot; /etc/sysconfig/iptables
# sed -i -e &quot;/:OUTPUT/ a\-A INPUT -p udp -m udp --dport 2049 -j ACCEPT&quot; /etc/sysconfig/iptables
# sed -i -e &quot;/:OUTPUT/ a\-A INPUT -p tcp -m tcp --dport 2020 -j ACCEPT&quot; /etc/sysconfig/iptables
# sed -i -e &quot;/:OUTPUT/ a\-A INPUT -p tcp -m tcp --dport 32803 -j ACCEPT&quot; /etc/sysconfig/iptables
# sed -i -e &quot;/:OUTPUT/ a\-A INPUT -p udp -m udp --dport 32769 -j ACCEPT&quot; /etc/sysconfig/iptables
# sed -i -e &quot;/:OUTPUT/ a\-A INPUT -p tcp -m tcp --dport 892 -j ACCEPT&quot; /etc/sysconfig/iptables
# sed -i -e &quot;/:OUTPUT/ a\-A INPUT -p udp -m udp --dport 892 -j ACCEPT&quot; /etc/sysconfig/iptables
# sed -i -e &quot;/:OUTPUT/ a\-A INPUT -p tcp -m tcp --dport 875 -j ACCEPT&quot; /etc/sysconfig/iptables
# sed -i -e &quot;/:OUTPUT/ a\-A INPUT -p udp -m udp --dport 875 -j ACCEPT&quot; /etc/sysconfig/iptables
# sed -i -e &quot;/:OUTPUT/ a\-A INPUT -p tcp -m tcp --dport 662 -j ACCEPT&quot; /etc/sysconfig/iptables
# sed -i -e &quot;/:OUTPUT/ a\-A INPUT -p udp -m udp --dport 662 -j ACCEPT&quot; /etc/sysconfig/iptables
# service iptables restart
# chkconfig nfs on
# service nfs restart
</code></pre>

<p>Install the packages:</p>

<pre><code># yum install -y cloudstack-management
# yum -y install mariadb-server mariadb
</code></pre>

<p>Configure the mariadb:</p>

<pre><code># sed -i -e '/datadir/ a\innodb_rollback_on_timeout=1' -e '/datadir/ a\innodb_lock_wait_timeout=600' -e '/datadir/ a\max_connections=350' -e '/datadir/ a\log-bin=mysql-bin' -e &quot;/datadir/ a\binlog-format = 'ROW'&quot; -e &quot;/datadir/ a\bind-address = 0.0.0.0&quot; /etc/my.cnf
# systemctl enable mariadb
# systemctl start mariadb
# systemctl start mariadb.service
# mysql_secure_installation
</code></pre>

<p>Setup the privileges:</p>

<pre><code>[root@csman system]# mysql -u root -pengine123
MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION;
MariaDB [(none)]&gt; quit
</code></pre>

<p>Setup the management database and setup the managment server:</p>

<pre><code># cloudstack-setup-databases cloud:&lt;password&gt;@127.0.0.1 --deploy-as=root:&lt;password&gt;
# cloudstack-setup-management --tomcat7
# service cloudstack-management start
# /bin/systemctl enable  cloudstack-management.service
</code></pre>

<p>Nginx:</p>

<pre><code># echo &quot;[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/centos/\$releasever/\$basearch/
gpgcheck=0
enabled=1&quot; &gt; /etc/yum.repos.d/nginx.repo
# yum install nginx -y
# cd /usr/share/nginx/html
# wget -nc http://download.cloud.com/templates/builtin/centos56-x86_64.vhd.bz2
# sed -i -e &quot;/:OUTPUT/ a\-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT&quot; /etc/sysconfig/iptables
# service iptables restart
</code></pre>

<p>vhd-utils:</p>

<pre><code># cd /usr/share/cloudstack-common/scripts/vm/hypervisor/xenserver/
# wget http://download.cloud.com.s3.amazonaws.com/tools/vhd-util
# chmod 755 /usr/share/cloudstack-common/scripts/vm/hypervisor/xenserver/vhd-util
</code></pre>

<p>SystemVM Template:</p>

<pre><code># /usr/share/cloudstack-common/scripts/storage/secondary/cloud-install-sys-tmplt -m /exports/secondary -u http://xxxxxxxxxxxxx -h xenserver -F
</code></pre>

<p>CloudStack usage server:</p>

<pre><code># yum install cloudstack-usage -y
# service cloudstack-usage start
</code></pre>

<p>Mysql related:</p>

<pre><code># mysql -p&lt;password&gt; cloud -e \ &quot;INSERT INTO cloud.configuration (category, instance, component, name, value, description) VALUES ('Advanced', 'DEFAULT', 'management-server', 'xen.check.hvm', 'false', 'Shoud we allow only the XenServers support HVM');&quot;

</code></pre>

<h3 id="if-kvm">If KVM</h3>

<p>Install bridge-utils:</p>

<pre><code># yum install -y bridge-utils
</code></pre>

<p>Edit the bridge connections:</p>

<pre><code># cat /etc/sysconfig/network-scripts/ifcfg-eth0 
DEVICE=&quot;eth0&quot;
ONBOOT=&quot;yes&quot;
BOOTPROTO=none
NM_CONTROLLED=&quot;no&quot;
BRIDGE=&quot;cloudbr0&quot;
TYPE=Ethernet
# cat /etc/sysconfig/network-scripts/ifcfg-cloudbr0
DEVICE=&quot;cloudbr0&quot;
ONBOOT=&quot;yes&quot;
NM_CONTROLLED=yes
TYPE=&quot;Bridge&quot;
BOOTPROTO=static
IPADDR=10.47.58.11
NETMASK=255.255.255.0
GATEWAY=10.47.58.1
DNS1=223.5.5.5
DEFROUTE=yes
</code></pre>

<h3 id="building-4-5-2-4-5-1-for-centos-7">Building 4.5.<sup>2</sup>&frasl;<sub>4</sub>.5.1 For CentOS 7</h3>

<p>Key-Step:</p>

<p><a href="http://zooi.widodh.nl/cloudstack/build-dep/cloud-manageontap.jar">http://zooi.widodh.nl/cloudstack/build-dep/cloud-manageontap.jar</a></p>

<h3 id="centos7-isuse-on-cloudstack4-5-2">CentOS7 Isuse On CloudStack4.5.2</h3>

<p>Could not start the service of cloudstack-management, then you should manually add one
line in definition of the service file:</p>

<pre><code>[root@csmgmt ~]# vim /usr/lib/systemd/system/cloudstack-management.service
[Service]
+ PermissionsStartOnly=true
[root@csmgmt ~]# systemctl daemon-reload
[root@csmgmt ~]# service cloudstack-management start
Redirecting to /bin/systemctl start  cloudstack-management.service
[root@csmgmt ~]# netstat -anp | grep 8080
tcp6       0      0 :::8080                 :::*                    LISTEN
5665/java  
</code></pre>

<p>Another issue:</p>

<pre><code>Could not load org.apache.commons.pool.impl.CursorableLinkedList$Cursor
</code></pre>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2016/01/04/purge-cloudstack-env/">Purge CloudStack Env</a>
      </h1>
      <span class="post-date">Jan 4, 2016  &middot; <a href="http://purplepalmdash.github.io/2016/01/04/purge-cloudstack-env/#disqus_thread">Comments</a>
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/virtualization">Virtualization</a>
        
      </span>
      
      <p>For totally reset the configured cloudstack environment, do following commands:</p>

<pre><code># service cloudstack-management stop
# mysql -pengine123 -e 'drop database cloud'
# mysql -pengine123 -e 'drop database cloud_usage'
# cloudstack-setup-databases cloud:engine123@localhost --deploy-as=root:engine123
# rm -rf /var/log/cloud/management/*
# cloudstack-setup-management 
# service cloudstack-management start
</code></pre>

      
    </div>
    
    
    
    <ul class="pagination">
        
        <li>
            <a href="/" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
        </li>
        
        <li
        >
        <a href="/page/13/" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
        </li>
        
        <li
        ><a href="/">1</a></li>
        
        <li
        ><a href="/page/2/">2</a></li>
        
        <li
        ><a href="/page/3/">3</a></li>
        
        <li
        ><a href="/page/4/">4</a></li>
        
        <li
        ><a href="/page/5/">5</a></li>
        
        <li
        ><a href="/page/6/">6</a></li>
        
        <li
        ><a href="/page/7/">7</a></li>
        
        <li
        ><a href="/page/8/">8</a></li>
        
        <li
        ><a href="/page/9/">9</a></li>
        
        <li
        ><a href="/page/10/">10</a></li>
        
        <li
        ><a href="/page/11/">11</a></li>
        
        <li
        ><a href="/page/12/">12</a></li>
        
        <li
        ><a href="/page/13/">13</a></li>
        
        <li
        class="active"><a href="/page/14/">14</a></li>
        
        <li
        ><a href="/page/15/">15</a></li>
        
        <li
        ><a href="/page/16/">16</a></li>
        
        <li
        ><a href="/page/17/">17</a></li>
        
        <li
        ><a href="/page/18/">18</a></li>
        
        <li
        ><a href="/page/19/">19</a></li>
        
        <li
        ><a href="/page/20/">20</a></li>
        
        <li
        ><a href="/page/21/">21</a></li>
        
        <li
        ><a href="/page/22/">22</a></li>
        
        <li
        ><a href="/page/23/">23</a></li>
        
        <li
        ><a href="/page/24/">24</a></li>
        
        <li
        ><a href="/page/25/">25</a></li>
        
        <li
        ><a href="/page/26/">26</a></li>
        
        <li
        ><a href="/page/27/">27</a></li>
        
        <li
        ><a href="/page/28/">28</a></li>
        
        <li
        ><a href="/page/29/">29</a></li>
        
        <li
        ><a href="/page/30/">30</a></li>
        
        <li
        ><a href="/page/31/">31</a></li>
        
        <li
        ><a href="/page/32/">32</a></li>
        
        <li
        ><a href="/page/33/">33</a></li>
        
        <li
        ><a href="/page/34/">34</a></li>
        
        <li
        ><a href="/page/35/">35</a></li>
        
        <li
        ><a href="/page/36/">36</a></li>
        
        <li
        ><a href="/page/37/">37</a></li>
        
        <li
        ><a href="/page/38/">38</a></li>
        
        <li
        ><a href="/page/39/">39</a></li>
        
        <li
        ><a href="/page/40/">40</a></li>
        
        <li
        ><a href="/page/41/">41</a></li>
        
        <li
        ><a href="/page/42/">42</a></li>
        
        <li
        ><a href="/page/43/">43</a></li>
        
        <li
        ><a href="/page/44/">44</a></li>
        
        <li
        ><a href="/page/45/">45</a></li>
        
        <li
        ><a href="/page/46/">46</a></li>
        
        <li
        ><a href="/page/47/">47</a></li>
        
        <li
        ><a href="/page/48/">48</a></li>
        
        <li
        ><a href="/page/49/">49</a></li>
        
        <li
        ><a href="/page/50/">50</a></li>
        
        <li
        ><a href="/page/51/">51</a></li>
        
        <li
        ><a href="/page/52/">52</a></li>
        
        <li
        ><a href="/page/53/">53</a></li>
        
        <li
        ><a href="/page/54/">54</a></li>
        
        <li
        ><a href="/page/55/">55</a></li>
        
        <li
        ><a href="/page/56/">56</a></li>
        
        <li
        ><a href="/page/57/">57</a></li>
        
        <li
        ><a href="/page/58/">58</a></li>
        
        <li
        ><a href="/page/59/">59</a></li>
        
        <li
        ><a href="/page/60/">60</a></li>
        
        <li
        ><a href="/page/61/">61</a></li>
        
        <li
        ><a href="/page/62/">62</a></li>
        
        <li
        ><a href="/page/63/">63</a></li>
        
        <li
        ><a href="/page/64/">64</a></li>
        
        <li
        ><a href="/page/65/">65</a></li>
        
        <li
        ><a href="/page/66/">66</a></li>
        
        <li
        ><a href="/page/67/">67</a></li>
        
        <li
        ><a href="/page/68/">68</a></li>
        
        <li
        ><a href="/page/69/">69</a></li>
        
        <li
        ><a href="/page/70/">70</a></li>
        
        <li
        ><a href="/page/71/">71</a></li>
        
        <li
        ><a href="/page/72/">72</a></li>
        
        <li
        ><a href="/page/73/">73</a></li>
        
        <li
        ><a href="/page/74/">74</a></li>
        
        <li
        ><a href="/page/75/">75</a></li>
        
        <li
        ><a href="/page/76/">76</a></li>
        
        <li
        ><a href="/page/77/">77</a></li>
        
        <li
        ><a href="/page/78/">78</a></li>
        
        <li
        ><a href="/page/79/">79</a></li>
        
        <li
        ><a href="/page/80/">80</a></li>
        
        <li
        ><a href="/page/81/">81</a></li>
        
        <li
        ><a href="/page/82/">82</a></li>
        
        <li
        ><a href="/page/83/">83</a></li>
        
        <li
        ><a href="/page/84/">84</a></li>
        
        <li
        ><a href="/page/85/">85</a></li>
        
        <li
        ><a href="/page/86/">86</a></li>
        
        <li
        ><a href="/page/87/">87</a></li>
        
        <li
        ><a href="/page/88/">88</a></li>
        
        <li
        ><a href="/page/89/">89</a></li>
        
        <li
        ><a href="/page/90/">90</a></li>
        
        <li
        ><a href="/page/91/">91</a></li>
        
        <li
        ><a href="/page/92/">92</a></li>
        
        <li
        ><a href="/page/93/">93</a></li>
        
        <li
        ><a href="/page/94/">94</a></li>
        
        <li
        ><a href="/page/95/">95</a></li>
        
        <li
        ><a href="/page/96/">96</a></li>
        
        <li
        ><a href="/page/97/">97</a></li>
        
        <li
        ><a href="/page/98/">98</a></li>
        
        <li
        ><a href="/page/99/">99</a></li>
        
        <li
        ><a href="/page/100/">100</a></li>
        
        <li
        ><a href="/page/101/">101</a></li>
        
        <li
        ><a href="/page/102/">102</a></li>
        
        <li
        ><a href="/page/103/">103</a></li>
        
        <li
        ><a href="/page/104/">104</a></li>
        
        <li
        ><a href="/page/105/">105</a></li>
        
        <li
        ><a href="/page/106/">106</a></li>
        
        <li
        ><a href="/page/107/">107</a></li>
        
        <li
        ><a href="/page/108/">108</a></li>
        
        <li
        ><a href="/page/109/">109</a></li>
        
        <li
        ><a href="/page/110/">110</a></li>
        
        <li
        ><a href="/page/111/">111</a></li>
        
        <li
        ><a href="/page/112/">112</a></li>
        
        <li
        ><a href="/page/113/">113</a></li>
        
        <li
        ><a href="/page/114/">114</a></li>
        
        <li
        ><a href="/page/115/">115</a></li>
        
        <li
        ><a href="/page/116/">116</a></li>
        
        <li
        ><a href="/page/117/">117</a></li>
        
        <li
        ><a href="/page/118/">118</a></li>
        
        <li
        ><a href="/page/119/">119</a></li>
        
        <li
        ><a href="/page/120/">120</a></li>
        
        <li
        ><a href="/page/121/">121</a></li>
        
        <li
        ><a href="/page/122/">122</a></li>
        
        <li
        ><a href="/page/123/">123</a></li>
        
        <li
        ><a href="/page/124/">124</a></li>
        
        <li
        ><a href="/page/125/">125</a></li>
        
        <li
        ><a href="/page/126/">126</a></li>
        
        <li
        ><a href="/page/127/">127</a></li>
        
        <li
        ><a href="/page/128/">128</a></li>
        
        <li
        ><a href="/page/129/">129</a></li>
        
        <li
        ><a href="/page/130/">130</a></li>
        
        <li
        ><a href="/page/131/">131</a></li>
        
        <li
        ><a href="/page/132/">132</a></li>
        
        <li
        ><a href="/page/133/">133</a></li>
        
        <li
        >
        <a href="/page/15/" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
        </li>
        
        <li>
            <a href="/page/133/" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
        </li>
        
    </ul>
    
  </div>
</div>


<script type="text/javascript">
var disqus_shortname = "dashsagittariussglory";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>

<script src="http://purplepalmdash.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

