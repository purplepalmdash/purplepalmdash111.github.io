<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
	<meta name="generator" content="Hugo 0.32-DEV" />
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Dash &middot; Dash</title>

  
  <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/poole.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde-a.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/custom-additions.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/highlight/googlecode.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/8.5/styles/docco.min.css">
  <script type="text/javascript" src="//cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
  <script type="text/javascript" src="/js/html2canvas.js"></script>
  <script type='text/javascript'>
  function genPostShot() { 
          var rightNow = new Date();
          var imageName = rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");
          imageName += '.jpg'
          html2canvas(document.getElementsByClassName('post'), {
              background :'#FFFFFF',
              onrendered: function(canvas) {
  		
          	$('#test').attr('href', canvas.toDataURL("image/jpeg"));
          	$('#test').attr('download',imageName);
          	$('#test')[0].click();
              }
          });
  }; 
  
  </script>
  <script src="//cdn.bootcss.com/highlight.js/8.5/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124">
  <link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel="icon">

  
  
  
  <link href="http://purplepalmdash.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Dash &middot; Dash" />

  <meta name="description" content="Get busy living, or get busy dying.">
  <meta name="keywords" content="unix,virtualization,embedded,linux">
  
  
</head>
<body class="theme-base-0c">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <img src="http://purplepalmdash.github.io/images/mylogo.jpeg" alt="gravatar">
      <h1><a href="http://purplepalmdash.github.io/">Get busy living, or get busy dying.</a></h1>
      <a href="http://purplepalmdash.github.io/"><p>Dash</p></a>
    </div>

    <ul class="sidebar-nav">
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/">First Page</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/post/">All Posts</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/linux/">Linux</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/embedded/">Embedded System</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/virtualization">Virtualization</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/purplepalmdash"><i class="fa fa-github-square fa-3x"></i></a>
      
      <a href="https://cn.linkedin.com/in/yang-feipeng-1b909319"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="https://plus.google.com/u/0/106572959364703833986"><i class="fa fa-google-plus-square fa-3x"></i></a>
      <a href="https://www.facebook.com/yang.feipeng"><i class="fa fa-facebook-square fa-3x"></i></a>
      <a href="https://twitter.com/dashwillfly"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      <a href="http://purplepalmdash.github.io/index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
    </ul>

    

  </div>
</div>


<div class="content container">
  <div class="posts">
    
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2016/05/09/working-tips-on-mesos-slash-ansible/">Working Tips On Mesos/Ansible</a>
      </h1>
      <span class="post-date">May 9, 2016 
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/virtualization">Virtualization</a>
        
      </span>
      
      

<h3 id="package-prepare">Package Prepare</h3>

<p>We have the default vagrant box generated by bento, listed it via:</p>

<pre><code>➜  mesos vagrant box list | grep -i centos | grep -i virtualbox
centos72                                     (virtualbox, 0)
</code></pre>

<p>Now we want to generate a new box from it, and added our own configuration:</p>

<pre><code>$ vagrant init centos72
$ vagrant up
$ vagrant ssh
</code></pre>

<p>Edit for keeping the cache:</p>

<pre><code>$ cat /etc/yum.conf  | more
[main]
cachedir=/home/vagrant/rpms/$basearch/$releasever
#keepcache=0
keepcache=1
</code></pre>

<p>Now poweroff the machine and export it to the new box:</p>

<pre><code>$ vagrant package --output centoslocalrpm.box
$ vagrant box add centoslocalrpm centoslocalrpm.box
</code></pre>

<p>Using the new box, the rpm packages could be saved into the folder
<code>/home/vagrant/rpms</code>.</p>

<h3 id="deploy-using-ansible">Deploy Using Ansible</h3>

<p>Refers to<br />
<a href="https://open.mesosphere.com/advanced-course/recreating-the-cluster-using-ansible/">https://open.mesosphere.com/advanced-course/recreating-the-cluster-using-ansible/</a></p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2016/05/06/working-tips-on-ansible-cobbler-2/">Working Tips on Ansible-cobbler(2)</a>
      </h1>
      <span class="post-date">May 6, 2016 
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/virtualization">virtualization</a>
        
      </span>
      
      

<h3 id="aim">AIM</h3>

<p>Change the vagrant box to libvirt, and let this libvirt machine working properly.</p>

<h3 id="image-transformation">Image Transformation</h3>

<p>Transform the image via following command:</p>

<pre><code>$ VBoxManage clonehd /home/dash/VirtualBox\ VMs/ansible-cobbler_cobbler-ubuntu_1462410925173_15793/packer-virtualbox-iso-1454031074-disk1.vmdk /home/dash/output.img --format raw &amp;&amp; qemu-img convert -f raw /home/dash/output.img -O qcow2 /home/dash/ansible-cobbler.qcow2
0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%
Clone medium created in format 'raw'. UUID: 6fbb99be-8004-43b5-831b-ec794a001c10
</code></pre>

<h3 id="qemu-virtual-machine">Qemu Virtual Machine</h3>

<p>Create a new machine, then configure the networking, edit the cobbler setting/dhcp setting, then <code>cobbler sync</code>, now the cobbler is adjusting to new environment.</p>

<p>More detailed info could be seen in:</p>

<p><a href="http://purplepalmdash.github.io/blog/2015/07/10/wh-worktips-9/">http://purplepalmdash.github.io/blog/2015/07/10/wh-worktips-9/</a></p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2016/05/04/linux-tips-5/">Linux Tips(5)</a>
      </h1>
      <span class="post-date">May 4, 2016 
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/linux">Linux</a>
        
      </span>
      
      

<h3 id="1-detach-running-tasks">1. Detach Running Tasks</h3>

<p><code>Ctrl+Z</code> for suspend the tasks, then <code>bg</code> it, now you could use <code>disown %1</code> for
detaching the running process.</p>

<p>Next time you login, you will see this background task is also running.</p>

<h3 id="2-installation-of-cobbler">2. Installation of Cobbler</h3>

<p>Shell Scripts:</p>

<p><a href="https://gist.github.com/luisbolson/1d0dc42976d2468171d0">https://gist.github.com/luisbolson/1d0dc42976d2468171d0</a></p>

<h3 id="3-yum-groups">3. yum groups</h3>

<p><a href="http://ramblings.narrabilis.com/creating-a-yum-repository-repo-and-creating-a-yum-group-to-install-kickstart">http://ramblings.narrabilis.com/creating-a-yum-repository-repo-and-creating-a-yum-group-to-install-kickstart</a></p>

<h3 id="4-rvm-issue">4. rvm issue</h3>

<p>rvm met <code>openssl.so (LoadError)</code>, could be solved via following steps.</p>

<pre><code>$  curl https://github.com/ruby/ruby/commit/801e1fe46d83c856844ba18ae4751478c59af0d1.diff &gt; openssl.patch\n
$  rvm install 1.9.3 --with-openssl-dir=$HOME/.rvm/usr --patch ./openssl.patch 
</code></pre>

<h3 id="5-get-the-name-of-rpm-packages">5. Get the name of rpm packages</h3>

<p>Only print the name of the rpm package:</p>

<pre><code># rpm -qp --queryformat '%{NAME}\n' *.rpm&gt;package.list
</code></pre>

<h3 id="6-xargs-tips">6. xargs tips</h3>

<p>Example:</p>

<pre><code># find . -type f -exec grep -ilR &quot;MY PATTERN&quot; {} \; | xargs -I % cp % /dest/dir/
</code></pre>

<p>For me, I find out all of the packges in cache file, and copy them to another position:</p>

<pre><code>$ find . | \grep rpm$ | xargs -I % cp % /home/dash/rpms
</code></pre>

<h3 id="7-make-local-repo">7. Make local repo</h3>

<p>From the stackoverflow answers.</p>

<pre><code>Yes as you've described it, it sounds doable. I think I would be inclined to do the
following steps.

Setup directories
$ mkdir {Desktop,Desktop_Platform,X_Window_System,Fonts}
Download RPMs
Then run these types of commands to download the RPMs for the given groups:

$ repoquery --qf=%{name} -g --list --grouppkgs=all &quot;Fonts&quot; | \
     xargs -I{} repotrack -a x86_64 -p Fonts/ {}
You can wrap it in a for loop too:

$ for i in &quot;Desktop&quot; &quot;Desktop_Platform&quot; &quot;X_Window_System&quot; &quot;Fonts&quot;;do  
    repoquery --qf=%{name} -g --list --grouppkgs=all &quot;$i&quot; | \
       xargs -I{} repotrack -a x86_64 -p $i/ {}; 
  done
This will go through each group and download the packages into their respective
directories.

Re-installation
Then use the command as you've described:

$ yum --nogpgcheck localinstall {Desktop,Desktop_Platform,X_Window_System,Fonts}/*.rpm
</code></pre>

<h3 id="8-simple-screen-recorder">8. Simple Screen Recorder</h3>

<p>Ubuntu:</p>

<pre><code>sudo add-apt-repository ppa:maarten-baert/simplescreenrecorder
sudo apt-get update
sudo apt-get install simplescreenrecorder
# if you want to record 32-bit OpenGL applications on a 64-bit system:
sudo apt-get install simplescreenrecorder-lib:i386
</code></pre>

<p>ArchLinux:</p>

<pre><code>$ sudo pacman -S simplescreenrecorder
</code></pre>

<h3 id="9-convert-virtualbox-hd-to-qcow2">9. Convert virtualbox hd to qcow2</h3>

<pre><code>VBoxManage clonehd /home/dash/VirtualBox\ VMs/ansible-cobbler_cobbler-ubuntu_1462410925173_15793/packer-virtualbox-iso-1454031074-disk1.vmdk /home/dash/output.img --format raw &amp;&amp; qemu-img convert -f raw /home/dash/output.img -O qcow2 /home/dash/ansible-cobbler.qcow2
</code></pre>

<h3 id="10-ansible-issue">10. Ansible issue</h3>

<p>The isssue is:</p>

<pre><code>ansible: ERROR: become is not a legal parameter in an Ansible Playbook
</code></pre>

<p>Solved via upgrading to the newest version of ansible:</p>

<pre><code>$ sudo apt-get install software-properties-common
$ sudo apt-add-repository ppa:ansible/ansible
$ sudo apt-get update
$ sudo apt-get install ansible
</code></pre>

<p>Using the newest ansible you could aoid this error.</p>

<h3 id="11-create-customized-lxc-image">11. Create customized lxc image</h3>

<pre><code>http://unix.stackexchange.com/questions/186638/how-to-make-a-local-template-for-a-linux-container-and-point-to-that
</code></pre>

<p><a href="https://insights.ubuntu.com/2015/03/20/installing-lxd-and-the-command-line-tool/">https://insights.ubuntu.com/2015/03/20/installing-lxd-and-the-command-line-tool/</a></p>

<p><a href="https://www.stgraber.org/2016/03/30/lxd-2-0-image-management-512/">https://www.stgraber.org/2016/03/30/lxd-2-0-image-management-512/</a></p>

<p><a href="https://insights.ubuntu.com/2016/04/01/lxd-2-0-image-management-512/">https://insights.ubuntu.com/2016/04/01/lxd-2-0-image-management-512/</a></p>

<h3 id="12-changing-to-eth0-in-ubuntu">12. Changing to eth0 in Ubuntu</h3>

<p>Modify the name of <code>enps*</code> to <code>eth0/1/2/3/4/</code>, via following steps:</p>

<pre><code>try this: Edit your /etc/default/grub. Change the line from

GRUB_CMDLINE_LINUX=&quot;&quot;
to

GRUB_CMDLINE_LINUX=&quot;net.ifnames=0 biosdevname=0&quot;
and, finally run:

# update-grub
</code></pre>

<p>If you runs the CentOS/RHEL Systems, you could use following commands for
updating your grub configuration:</p>

<pre><code># grub2-mkconfig -o /boot/grub2/grub.cfg

</code></pre>

<h3 id="13-maas-syncing-pxe-file">13. MAAS Syncing PXE File</h3>

<p><a href="https://maas.ubuntu.com/docs/sstreams-mirror.html">https://maas.ubuntu.com/docs/sstreams-mirror.html</a><br />
<a href="http://ytooyama.hatenadiary.jp/entry/2016/05/11/002532">http://ytooyama.hatenadiary.jp/entry/2016/05/11/002532</a></p>

<p>For building our own MAAS image:</p>

<p><a href="http://askubuntu.com/questions/744966/how-do-you-install-the-maas-image-builder-on-14-04-lts">http://askubuntu.com/questions/744966/how-do-you-install-the-maas-image-builder-on-14-04-lts</a></p>

<h3 id="14-vagrant-for-maas">14. Vagrant For MAAS</h3>

<p><a href="https://github.com/battlemidget/vagrant-maas">https://github.com/battlemidget/vagrant-maas</a></p>

<p><a href="https://github.com/battlemidget/vagrant-maas-in-a-box/blob/master/Vagrantfile">https://github.com/battlemidget/vagrant-maas-in-a-box/blob/master/Vagrantfile</a></p>

<h3 id="15-convert-vm-to-physical">15. Convert vm to physical</h3>

<p>Thus you could enjoy packer building the physical machine! :)</p>

<pre><code>cd /media/wherever-the-image-is/

# for VMWare
sudo apt-get install qemu-kvm
qemu-img convert your-vmware-disk.vmdk -O raw disk.img

# For VirtualBox
VBoxManage internalcommands converttoraw your-virtualbox-disk.vdi /dev/sdX
</code></pre>

<h3 id="16-generate-random-seed">16. Generate Random Seed</h3>

<p>Error message is <code>Please do some other work to give
the OS a chance to collect more entropy!</code></p>

<pre><code>$ sudo aptitude install haveged
</code></pre>

<h3 id="17-deb-repository-in-cobbler">17. DEB Repository in Cobbler</h3>

<p><a href="https://github.com/cobbler/cobbler/wiki/Creating-custom-apt-repositories-in-centos-or-el-based-cobbler">https://github.com/cobbler/cobbler/wiki/Creating-custom-apt-repositories-in-centos-or-el-based-cobbler</a></p>

<p>Trouble-Shooting:<br />
<a href="https://github.com/cobbler/cobbler/issues/1530">https://github.com/cobbler/cobbler/issues/1530</a></p>

<h3 id="18-manually-install-mate-desktop">18. Manually Install Mate Desktop</h3>

<pre><code>echo &quot;debconf debconf/frontend select noninteractive&quot; | sudo debconf-set-selections
apt-get --allow-unauthenticated update -y
apt-get --allow-unauthenticated upgrade -y
apt-get --allow-unauthenticated install -y build-essential
apt-get --allow-unauthenticated install -y ubuntu-mate-desktop
apt-get --allow-unauthenticated install -y vim
apt-get --allow-unauthenticated install -y chromium-browser
apt-get --allow-unauthenticated install -y meld vim-gtk
apt-get --allow-unauthenticated install -y evince
sudo apt-get --allow-unauthenticated install -y language-pack-zh-hans language-pack-zh-hans-base language-pack-gnome-zh-hans language-pack-gnome-zh-hans-base
sudo apt-get --allow-unauthenticated install -y `check-language-support -l zh`
sudo localectl set-locale LANG=zh_CN.UTF-8
# TW/HK language support
sudo apt-get --allow-unauthenticated install -y language-pack-zh-hant language-pack-zh-hant-base language-pack-gnome-zh-hant language-pack-gnome-zh-hant-base
sudo apt-get --allow-unauthenticated install -y `check-language-support -l zh`
apt-get --allow-unauthenticated install -y fcitx
apt-get --allow-unauthenticated install -y fcitx-table-wubi fcitx-table-wubi-large
apt-get --allow-unauthenticated install -y fcitx-googlepinyin
apt-get --allow-unauthenticated install -y gimp
apt-get --allow-unauthenticated install -y ibus-pinyin 
apt-get --allow-unauthenticated install -y thunderbird-locale-en-us mythes-en-au hunspell-en-gb thunderbird-locale-en-gb fonts-arphic-ukai wbritish fcitx-sunpinyin openoffice.org-hyphenation language-pack-gnome-en hunspell-en-za fcitx-chewing fcitx-table-cangjie gimp-help-en language-pack-en mythes-en-us thunderbird-locale-en fcitx-module-cloudpinyin libreoffice-help-en-us firefox-locale-en libreoffice-help-en-gb fonts-arphic-uming hyphen-en-gb libreoffice-l10n-en-za fcitx-ui-qimpanel hunspell-en-au libreoffice-l10n-en-gb hyphen-en-us hunspell-en-ca 
apt-get --allow-unauthenticated install -y zsh
apt-get --allow-unauthenticated install -y fonts-wqy-zenhei fonts-wqy-microhei ttf-wqy-microhei  ttf-wqy-zenhei  xfonts-wqy
apt-get --allow-unauthenticated install -y eclipse
apt-get --allow-unauthenticated install -y gpicview
apt-get --allow-unauthenticated install -y scrot
apt-get --allow-unauthenticated install -y byobu
apt-get --allow-unauthenticated install -y subversion git
apt-get --allow-unauthenticated install -y kdiff3
apt-get --allow-unauthenticated install -y docker
</code></pre>

<p>Final Version should be:</p>

<pre><code>echo &quot;debconf debconf/frontend select noninteractive&quot; | sudo debconf-set-selections
unset DEBIAN_HAS_FRONTEND DEBIAN_FRONTEND DEBCONF_REDIR DEBCONF_OLD_FD_BASE
export DEBIAN_FRONTEND=noninteractive
apt-get update --assume-yes
apt-get dist-upgrade --assume-yes
apt-get install --assume-yes vim build-essential ubuntu-mate-desktop chromium-browser meld vim-gtk evince language-pack-zh-hans language-pack-zh-hans-base language-pack-gnome-zh-hans language-pack-gnome-zh-hans-base language-pack-zh-hant language-pack-zh-hant-base language-pack-gnome-zh-hant language-pack-gnome-zh-hant-base fcitx fcitx-table-wubi fcitx-table-wubi-large fcitx-googlepinyin gimp ibus-pinyin thunderbird-locale-en-us mythes-en-au hunspell-en-gb thunderbird-locale-en-gb fonts-arphic-ukai wbritish fcitx-sunpinyin openoffice.org-hyphenation language-pack-gnome-en hunspell-en-za fcitx-chewing fcitx-table-cangjie gimp-help-en language-pack-en mythes-en-us thunderbird-locale-en fcitx-module-cloudpinyin libreoffice-help-en-us firefox-locale-en libreoffice-help-en-gb fonts-arphic-uming hyphen-en-gb libreoffice-l10n-en-za fcitx-ui-qimpanel hunspell-en-au libreoffice-l10n-en-gb hyphen-en-us hunspell-en-ca zsh fonts-wqy-zenhei fonts-wqy-microhei ttf-wqy-microhei  ttf-wqy-zenhei  xfonts-wqy eclipse gpicview scrot byobu subversion git kdiff3 docker
apt-get install --assume-yes  `check-language-support -l zh`

</code></pre>

<h3 id="19-use-rync-for-resume-tranferring">19. Use rync for resume tranferring</h3>

<p>Command:</p>

<pre><code>$ rsync -P -e ssh remoteuser@remotehost:/remote/path /local/path
</code></pre>

<h3 id="20-rackhd-howto">20. RackHD Howto</h3>

<p><a href="http://dojoblog.emc.com/rackhd-cpi/setting-up-rackhd/">http://dojoblog.emc.com/rackhd-cpi/setting-up-rackhd/</a></p>

<h3 id="21-sync-repo">21. sync repo</h3>

<pre><code>vagrant@ubuntu-1404:/etc/apt$ cat /var/mirrors/ubuntu/14.04/var/postmirror.sh 
#!/bin/sh -x 
# the udebs script gets the actual files we need 
#/mnt/repo/apt-mirror/var/udebs.sh  
# A quick apt directory structure primer: 
# an apt server (e.g. archive.ubuntu.com) contains repositories (e.g. trusty-backports), 
# which contain archives (e.g. multiverse), which contain directories 
# a complete example - http://archive.ubuntu.com/ubuntu/dists/trusty-backports/multiverse/debian-installer/  
# With this in mind, we create bash 'arrays' of the structure: 
# server we're syncing against 
#MIRROR=&quot;cn.archive.ubuntu.com&quot; 
MIRROR=&quot;archive.ubuntu.com&quot; 
# repositories we're mirroring 
#REPOS=&quot;trusty trusty-updates trusty-security trusty-proposed trusty-backports&quot; 
REPOS=&quot;trusty&quot;
# archives in repositories 
#ARCHIVES=&quot;main multiverse restricted universe&quot; 
ARCHIVES=&quot;main&quot;
# installer location inside archive 
#DIRECTORIES=&quot;debian-installer dist-upgrader-all installer-amd64 installer-i386&quot; 
DIRECTORIES=&quot;debian-installer installer-amd64&quot;
#where we're storing it locally 
LOCALDIR=&quot;/var/mirrors/ubuntu/14.04/mirror/mirrors.aliyun.com&quot;
#LOCALDIR=&quot;/mnt/repo/apt-mirror/mirror/archive.ubuntu.com&quot;  
for REPO in $REPOS; do 
for ARCHIVE in $ARCHIVES; do 
for DIRECTORY in $DIRECTORIES;do 
# create directory structure 
if [ ! -e &quot;$LOCALDIR/ubuntu/dists/$REPO/$ARCHIVE/$DIRECTORY&quot; ]; then
mkdir -p &quot;$LOCALDIR/ubuntu/dists/$REPO/$ARCHIVE/$DIRECTORY&quot;
fi
# do the sync 
rsync --recursive --times --links --hard-links --delete --delete-after \
rsync://$MIRROR/ubuntu/dists/$REPO/$ARCHIVE/$DIRECTORY/ $LOCALDIR/ubuntu/dists/$REPO/$ARCHIVE/$DIRECTORY
done
done
done

</code></pre>

<h3 id="22-vagrantfile-for-adding-more-disks">22. Vagrantfile for adding more disks</h3>

<pre><code>To be done. 
</code></pre>

<h3 id="23-rvm-install-issue">23. rvm install issue</h3>

<p>With openssl patched you can install rvm successfully:</p>

<pre><code>$ wget https://github.com/ruby/ruby/commit/801e1fe46d83c856844ba18ae4751478c59af0d1.diff -O openssl.patch
$ rvm install --patch ./openssl.patch 2.2.3
</code></pre>

<h3 id="24-performance-tool">24. performance tool</h3>

<p><a href="http://www.tecmint.com/linux-cpu-load-stress-test-with-stress-ng-tool/2/">http://www.tecmint.com/linux-cpu-load-stress-test-with-stress-ng-tool/2/</a></p>

<h3 id="25-x11-forwarding-issue">25. X11 Forwarding Issue</h3>

<p>Problem:</p>

<pre><code>X11 forwarding request failed on channel 0
</code></pre>

<p>Solved via:</p>

<pre><code># pacman -S xorg-xauth
# vim /etc/ssh/sshd_config
AddressFamily any
X11Forwarding yes
</code></pre>

<p>Then restart the sshd daemon, you will get X11 on ssh forwarding enabled.</p>

<p>If you are under CentOS, then install the package <code>xorg-x11-xauth</code>.</p>

<p>Add new user <code>clouder</code>:</p>

<pre><code># useradd -d /home/clouder/ clouder
# chown -R clouder:clouder /home/clouder/
# usermod -aG kvm clouder
# usermod -aG libvirt clouder
</code></pre>

<p>polkit configuration:</p>

<pre><code># vim /etc/polkit-1/rules.d/50-libvirt.rules 
/* Allow users in kvm group to manage the libvirt
daemon without authentication */
polkit.addRule(function(action, subject) {
    if (action.id == &quot;org.libvirt.unix.manage&quot; &amp;&amp;
        subject.isInGroup(&quot;kvm&quot;)) {
            return polkit.Result.YES;
    }
});
</code></pre>

<p>Install following packages:</p>

<pre><code># pacman -Syu ebtables dnsmasq
</code></pre>

<p>Open nested kvm.</p>

<h3 id="26-hack-into-system">26. Hack into system</h3>

<p><a href="http://null-byte.wonderhowto.com/how-to/hack-like-pro-hack-shellshock-vulnerability-0157651/">http://null-byte.wonderhowto.com/how-to/hack-like-pro-hack-shellshock-vulnerability-0157651/</a></p>

<h3 id="27-quickly-setup-graphite-and-grafana">27. Quickly setup graphite and grafana</h3>

<p>On ArchLinux, do following:</p>

<pre><code>$ mkdir -p /root/data/graphite/storage/whisper/
$ sudo docker run -d \
  --name graphite \
  -p 8080:80 \
  -p 2003:2003 \
  -v /local/path/to/.htpasswd:/etc/nginx/.htpasswd \
  -v /root/data/graphite/storage/whisper:/opt/graphite/storage/whisper \
  sitespeedio/graphite
</code></pre>

<p>Now your graphite runs OK, default username/password is guest/guest.</p>

<p>Continue setup the docker container for grafana:</p>

<pre><code>$ docker run -i -p 3000:3000 grafana/grafana
</code></pre>

<p>Or, setup our own persistent storage via:</p>

<pre><code>$ mkdir -p /root/data/grafana/
$ chmod 777 -R /root/data/grafana/
$ docker run -d -v /root/data/grafana:/var/lib/grafana --name grafana-storage busybox:latest
$ docker run  -d -p 3000:3000 --name=grafana --volumes-from grafana-storage grafana/grafana
$ docker logs grafana
</code></pre>

<p>The correct way for running grfafana via following:</p>

<pre><code># docker run -d -p 3000:3000 --name=grafana -v /root/data/grafana:/var/lib/grafana  grafana/grafana
</code></pre>

<h3 id="28-docker-enter-issue">28. docker-enter issue</h3>

<p>If you met <code>importenv: not found</code> issue, do following to let docker-enter running:</p>

<pre><code># docker pull jpetazzo/nsenter
# docker run --rm -v /usr/local/bin:/target jpetazzo/nsenter
# docker-enter &lt;container_name&gt;
</code></pre>

<h3 id="29-docker-collectd">29. Docker-Collectd</h3>

<pre><code># docker run -d --net=host --privileged -v /:/hostfs:ro --name=collectd -e HOST_NAME=localhost -e \
GRAPHITE_HOST=192.168.1.79 andreasjansson/collectd-write-graphite
</code></pre>

<h3 id="30-for-using-bridged-vagrant-libvirt">30. For using bridged vagrant-libvirt</h3>

<p>An example Vagrantfile is listed as following , notice it&rsquo;s using ovsbr0.</p>

<pre><code># -*- mode: ruby -*-
# vi: set ft=ruby :

############### Vagrant Configuration Here #############
Vagrant.configure(2) do |config|

  # vagrant issues #1673..fixes hang with configure_networks
  config.ssh.shell = &quot;bash -c 'BASH_ENV=/etc/profile exec bash'&quot;
  config.ssh.username = 'vagrant'
  config.ssh.password = 'vagrant'
  config.ssh.insert_key = 'true'
  config.vm.provider :libvirt do |domain|
    domain.nic_model_type = 'e1000'
    domain.memory = 384
    domain.nested = true
    domain.cpu_mode = 'host-passthrough'
  end

  # bridge node. 
  # Add one networking, modify hostname, define memory, CPU cores.
  config.vm.define :bridge do |bridge|
    bridge.vm.box = &quot;csmgmtv4&quot;
    bridge.vm.hostname = &quot;bridgenode&quot;
    bridge.vm.network :public_network, 
	:dev =&gt; &quot;ovsbr0&quot;,
	:mode =&gt; &quot;bridge&quot;,
	:type =&gt; &quot;bridge&quot;,
	:ip =&gt; &quot;192.168.178.2&quot;,
	:ovs =&gt; &quot;true&quot;
    bridge.vm.provider :libvirt do |domain|
      domain.storage :file, :size =&gt; '100G'
      domain.memory = 1024
      domain.cpus = 1
      domain.nested = true
      domain.disk_bus = 'virtio'
      domain.nic_model_type = 'virtio'
      domain.volume_cache = 'writeback'
    end
  end
end

</code></pre>

<p>###31. Using VPN in CloudStack
<a href="https://portal.redbridge.se/faq/getting-started/accessing-your-instance-from-the-outside/">https://portal.redbridge.se/faq/getting-started/accessing-your-instance-from-the-outside/</a></p>

<p><a href="https://blog.remibergsma.com/2012/11/18/securely-connect-an-advanced-private-cloudstack-network-by-using-a-vlan-aware-switch-and-a-basic-vpn-device/">https://blog.remibergsma.com/2012/11/18/securely-connect-an-advanced-private-cloudstack-network-by-using-a-vlan-aware-switch-and-a-basic-vpn-device/</a></p>

<p><a href="http://www.furorteutonicus.eu/2013/08/04/enabling-host-guest-networking-with-kvm-macvlan-and-macvtap/">http://www.furorteutonicus.eu/2013/08/04/enabling-host-guest-networking-with-kvm-macvlan-and-macvtap/</a></p>

<h3 id="32-python-issue-easy-install">32. python issue(easy_install)</h3>

<p>Solved via:</p>

<pre><code>$ wget https://bootstrap.pypa.io/ez_setup.py -O - | python
</code></pre>

<h3 id="33-vpn-over-ssh">33. VPN Over ssh</h3>

<p>Established via:</p>

<pre><code>$ sudo pppd updetach noauth silent nodeflate pty &quot;/usr/bin/ssh root@192.168.1.79 \ 
/usr/bin/pppd nodetach notty noauth&quot; ipparam vpn 10.0.8.1:10.0.8.2
</code></pre>

<h3 id="34-x-windows-for-normal-user">34. X Windows for normal user</h3>

<p>X Window for normal user</p>

<pre><code>➜  ~ chmod u+s /usr/bin/Xorg 
</code></pre>

<h3 id="35-chromium-flash">35. Chromium Flash</h3>

<p>Install it via:</p>

<pre><code>$ proxychains4 yaourt chromium-pepper-flash
</code></pre>

<p>Then enable it in <code>chrome://plugins</code>.</p>

<h3 id="36-junos-issue">36. JunOS Issue</h3>

<p><a href="http://www.juniper.net/techpubs/en_US/junos-ansible1.0/topics/example/junos-ansible-playbooks-device-configuring.html">http://www.juniper.net/techpubs/en_US/junos-ansible1.0/topics/example/junos-ansible-playbooks-device-configuring.html</a></p>

<p><a href="https://ittechnologist.wordpress.com/2015/08/23/use-vagrant-with-juniper-junos-vms-on-ubuntu/">https://ittechnologist.wordpress.com/2015/08/23/use-vagrant-with-juniper-junos-vms-on-ubuntu/</a></p>

<p><a href="https://atlas.hashicorp.com/juniper">https://atlas.hashicorp.com/juniper</a></p>

<h3 id="37-hugo-materials">37. hugo materials</h3>

<p><a href="http://dongjian.github.io/post/howtobuildablog/">http://dongjian.github.io/post/howtobuildablog/</a></p>

<p><a href="http://bling.github.io/blog/2015/12/31/migrating-from-jekyll-octopress-to-hugo/">http://bling.github.io/blog/2015/12/31/migrating-from-jekyll-octopress-to-hugo/</a></p>

<p><a href="https://parsiya.net/blog/2016-02-02-from-octopress-to-hugo/">https://parsiya.net/blog/2016-02-02-from-octopress-to-hugo/</a></p>

<p><a href="http://nathanleclaire.com/blog/2014/12/22/migrating-to-hugo-from-octopress/">http://nathanleclaire.com/blog/2014/12/22/migrating-to-hugo-from-octopress/</a></p>

<h3 id="38-awk">38. awk</h3>

<p>Some tricks on awk:</p>

<pre><code>$ document_keywords=&quot;categories: linux unix windows&quot;
$ echo $document_keywords | awk '{
for(i=2;i&lt;=NF;i++){if(i!=NF){$i=&quot;\&quot;&quot;$i&quot;\&quot;&quot;&quot;,&quot;}else{$i=&quot;\&quot;&quot;$i&quot;\&quot;&quot;}}}1'
</code></pre>

<h3 id="39-sed-ways">39. sed ways</h3>

<p>Using sed for switching from octopress to hugo:</p>

<pre><code>$  cat edit.sh
    #!/bin/bash
    for i in `ls ./*.markdown`
    do
    	# Generate the modified result, like categories: &quot;a&quot;, &quot;b&quot;, &quot;c&quot;
    	replaceline=`grep -i &quot;categories:&quot; $i|awk \
    '{for(i=2;i&lt;=NF;i++){if(i!=NF){$i=&quot;\&quot;&quot;$i&quot;\&quot;&quot;&quot;,&quot;}else{$i=&quot;\&quot;&quot;$i&quot;\&quot;&quot;}}}1'`
    	sed -i &quot;2s|.*|$replaceline|&quot; $i
    done
$ sed -i '2s/\(:[[:blank:]]*\)\(.*\)/\1[\2]/' *.markdown
</code></pre>

<h3 id="40-gnome-terminal-go-to-the-same-directory">40. Gnome-terminal go to the same directory</h3>

<p>Added following definition(this is a bug)</p>

<pre><code>$ vim ~/.zshrc
. /etc/profile.d/vte.sh
</code></pre>

<h3 id="41-asoundconf">41. asoundconf</h3>

<p>Since I used GigaByte Brix for working, the alsasound should be configured.</p>

<p>Default card is via HDMI, but I want to use PCH. Following are the steps:</p>

<pre><code>$ yaourt asoundconf
$ asoundconf list
Names of available sound cards:
HDMI
PCH
$ asoundconf set-default-card PCH
</code></pre>

<p>Now you could enjoy the PCH output.</p>

<h3 id="42-ocr-under-linux">42. OCR under Linux</h3>

<p>Using tesseract:</p>

<pre><code>$ convert beforeconvert.jpg -auto-level -compress none converted.tiff
$ sudo pacman -S tesseract tesseract-data-eng
$ tesseract converted.tiff myoutput
</code></pre>

<p>The above commands first convert the jpg to tiff, then install tesseract and its
language pack, then we could recoginze the text out of the tiff picture.</p>

<h3 id="43-vagrant-provision-with-shell-scripts">43. Vagrant Provision With Shell Scripts</h3>

<p>Configuration for the Vagrantfile:</p>

<pre><code>Vagrant.configure(2) do |config|

  config.ssh.shell = &quot;bash -c 'BASH_ENV=/etc/profile exec bash'&quot;
  config.vm.provision :shell, path: &quot;bootstrap.sh&quot;
</code></pre>

<p>The <code>bootstrap.sh</code> configuration:</p>

<pre><code>#!/usr/bin/env bash
# Use the proxy for apt-get
sudo echo 'Acquire::http::Proxy
&quot;http://192.168.1.69:3142&quot;;'&gt;/etc/apt/apt.conf.d/01proxy
# Replace the repository
sudo sed -i 's/security.ubuntu.com/mirrors.aliyun.com/g' /etc/apt/sources.list
sudo sed -i 's/us.archive.ubuntu.com/mirrors.aliyun.com/g' /etc/apt/sources.list
sudo apt-get -y update
sudo apt-get -y upgrade

</code></pre>

<h3 id="44-python-ocr-web-appliation">44. Python OCR Web Appliation</h3>

<p><a href="https://realpython.com/blog/python/setting-up-a-simple-ocr-server/">https://realpython.com/blog/python/setting-up-a-simple-ocr-server/</a></p>

<h3 id="45-jenkins-user-priviledge">45. Jenkins user priviledge</h3>

<p>Run jenkins as the user &ldquo;johndoe&rdquo;:</p>

<pre><code>Let's say the user you want is called &quot;johndoe&quot; and it has an userid=2000 and
groupid=2004 in your box, do this:

1. Edit /etc/password

jenkins:x:2000:2004::/var/lib/jenkins:/bin/bash

2. Change permissions so they reflect the new ID

chown jenkins:jenkins -Rv /var/cache/jenkins/
chown -Rv jenkins:jenkins /var/lib/jenkins/
</code></pre>

<h3 id="46-disable-auto-detect-ethernet-name">46. Disable auto detect Ethernet Name</h3>

<p>On Ubuntu16.04:</p>

<pre><code>Try this: Edit your /etc/default/grub. Change the line from

GRUB_CMDLINE_LINUX=&quot;&quot;
to

GRUB_CMDLINE_LINUX=&quot;net.ifnames=0 biosdevname=0&quot;
and, finally run:

# update-grub
as root, and reboot your system.
</code></pre>

<h3 id="47-centos-network-issue">47. CentOS Network issue</h3>

<p>eth0 works but eth1/2/3/4 failed, because those SB didn&rsquo;t enable NetworkManager
Service!</p>

<pre><code>$ sudo systemctl enable NetworkManager.service
</code></pre>

<h3 id="48-vagrant-ansible">48. Vagrant/Ansible</h3>

<p><a href="https://www.codementor.io/development-process/tutorial/wrapping-lamp-project-into-vagrant-with-ansible">https://www.codementor.io/development-process/tutorial/wrapping-lamp-project-into-vagrant-with-ansible</a></p>

<h3 id="49-install-vagrant-libvirt-in-archlinux">49. Install vagrant-libvirt in ArchLinux</h3>

<p>Via following command:</p>

<pre><code>$ CONFIGURE_ARGS='with-ldflags=-L/opt/vagrant/embedded/lib with-libvirt-include=/usr/include/libvirt with-libvirt-lib=/usr/lib' \
  GEM_HOME=~/.vagrant.d/gems GEM_PATH=$GEM_HOME:/opt/vagrant/embedded/gems PATH=/opt/vagrant/embedded/bin:$PATH \
  vagrant plugin install vagrant-libvirt
</code></pre>

<p>Fix bug:</p>

<pre><code>export PATH=/opt/vagrant/embedded/bin:$PATH
export GEM_HOME=~/.vagrant.d/gems
export GEM_PATH=$GEM_HOME:/opt/vagrant/embedded/gems
gem uninstall ruby-libvirt
sudo mv /opt/vagrant/embedded/lib/libcurl.so{,.backup}
sudo mv /opt/vagrant/embedded/lib/libcurl.so.4{,.backup}
sudo mv /opt/vagrant/embedded/lib/libcurl.so.4.4.0{,.backup}
sudo mv /opt/vagrant/embedded/lib/pkgconfig/libcurl.pc{,.backup}
gem source -r https://rubygems.org
gem source -a http://mirrors.aliyun.com/rubygems
gem install ruby-libvirt
sudo mv /opt/vagrant/embedded/lib/libcurl.so{.backup,}
sudo mv /opt/vagrant/embedded/lib/libcurl.so.4{.backup,}
sudo mv /opt/vagrant/embedded/lib/libcurl.so.4.4.0{.backup,}
sudo mv /opt/vagrant/embedded/lib/pkgconfig/libcurl.pc{.backup,}
</code></pre>

<h3 id="50-update-ca-trust">50. update-ca-trust</h3>

<p>Using <code>update-ca-trust</code> could solve curl&rsquo;s CA ISSUE.</p>

<h3 id="51-squid-quickly">51. Squid quickly</h3>

<p>Install and run squid via:</p>

<pre><code>docker run --name squid -d --restart=always \
  --publish 3128:3128 \
  --volume /srv/docker/squid/cache:/var/spool/squid3 \
  sameersbn/squid:3.3.8-16
</code></pre>

<h3 id="52-installing-haroopad-on-centos">52. Installing Haroopad On CentOS</h3>

<p>URL:</p>

<p><a href="http://www.bonashen.com/post/artifice/20140805-install-haroopad-on-fedora-20-64bit">http://www.bonashen.com/post/artifice/20140805-install-haroopad-on-fedora-20-64bit</a></p>

<h3 id="53-xen-tools-issue">53. xen-tools issue</h3>

<p>Switching keystroke.</p>

<pre><code>hello! first install the xentools of your linux vm, then in the tools of xencenter hit
options , go to the console, change the keyboard shortcut for the fullscreen of vm from
ctrl alt to f12. then you can use the ctrl alt f1 to launch the console of your vm
linux
</code></pre>

<h3 id="54-delete-sr-in-xenserver">54. Delete sr in XenServer</h3>

<p>Some tips, may be indentified later:</p>

<pre><code>   15  service xapi restart
   16  exit
   17  xe list
   18  xe sr list
   19  xe sr-list
   20  xe pif 36be98fc-e046-44bf-aaa9-77e7c1f228b5
   21  xe pif-list sr-uuid=36be98fc-e046-44bf-aaa9-77e7c1f228b5
   22  xe pif-list sr_uuid=36be98fc-e046-44bf-aaa9-77e7c1f228b5
   23  xe pif-list sr-uuid=36be98fc-e046-44bf-aaa9-77e7c1f228b5
   24  xe pif-list help
   25  xe pif-list 
   26  help xe pif-list 
   27  xe help pif-list 
   28  xe help  pdp-list 
   29  xe  help
   30  xe  help --all 
   31  xe pbd-list
   32  xe pif-list 
   33  xe pif-list sr-uuid=36be98fc-e046-44bf-aaa9-77e7c1f228b5
   34  xe pbd-list sr-uuid=36be98fc-e046-44bf-aaa9-77e7c1f228b5
   35  xe pbd-unplug uuid=6f5d5678-87be-c5ba-7c57-8d01ba00c3ba
   36  xe pbd-list sr-uuid=36be98fc-e046-44bf-aaa9-77e7c1f228b5
   37  xe sr-unplug uuid=36be98fc-e046-44bf-aaa9-77e7c1f228b5
   38  xe help --all | grep sr
   39  xe sr-destroy uuid=36be98fc-e046-44bf-aaa9-77e7c1f228b5
   40  xe sr-detach uuid=36be98fc-e046-44bf-aaa9-77e7c1f228b5
   41  xe sr-forget uuid=36be98fc-e046-44bf-aaa9-77e7c1f228b5
   42  history
</code></pre>

<h3 id="55-vagrant-for-junos">55. Vagrant for junos</h3>

<p>Quickly setup junos dev env.</p>

<pre><code>$ vagrant box add hc-download --name &quot;juniper/ffp-12.1X47-D15.4-packetmode&quot;
$ vagrant init juniper/ffp-12.1X47-D15.4-packetmode
$ vagrant plugin install vagrant-junos
$ vagrant plugin install vagrant-host-shell
$ vagrant up --provider virtualbox
</code></pre>

<h3 id="56-cloudmonkey-error">56. cloudmonkey error</h3>

<p>request-toolbelt missing, solved via:</p>

<pre><code>$ easy_install --upgrade pip &amp;&amp; pip install --upgrade setuptools &amp;&amp; pip install --upgrade \
distribute &amp;&amp; wget https://bootstrap.pypa.io/ez_setup.py -O - | python
</code></pre>

<p>Simple solved:</p>

<pre><code>$ pip install --upgrade setuptools
</code></pre>

<h3 id="57-cloudmonkey-for-installing-templates">57. cloudmonkey for installing templates</h3>

<p>Install templates via:</p>

<pre><code>$ cloudmonkey list zones name=FirstZone | grep ^id | awk {'print $3'}
$  cloudmonkey register template hypervisor=XenServer
zoneid=47865946-c129-424c-9fe4-a2e1786193cb format=vhd name=ubuntu1404
displaytext=ubuntu1404 ispublic=true ostypeid=8f94fb50-5561-11e6-993d-5254002a1e68
hvm=false passwordenabled=true url=http://192.168.1.69/ubuntu1404.vhd
</code></pre>

<h3 id="58-make-specific-windows-image">58. make specific windows image</h3>

<p>Make the virtualbox based win2008 datacenter version:</p>

<pre><code>$ make virtualbox/eval-win2008r2-datacenter
</code></pre>

<h3 id="59-pushbullet-app">59. pushbullet app</h3>

<p>Could use it in IOT projects:</p>

<p><a href="https://docs.pushbullet.com/">https://docs.pushbullet.com/</a></p>

<h3 id="60-virtualbox-and-cloudstack">60. Virtualbox And Cloudstack</h3>

<p>For building a minimum environment:</p>

<p><a href="http://www.shapeblue.com/virtualbox-test-env/">http://www.shapeblue.com/virtualbox-test-env/</a></p>

<h3 id="61-windows-lifecycle">61. Windows LifeCycle</h3>

<p>Find out the lifecycle of windows:</p>

<p><a href="https://support.microsoft.com/en-us/lifecycle/search?sort=PN&amp;alpha=Windows%20Server%202008%20R2&amp;Filter=FilterNO">https://support.microsoft.com/en-us/lifecycle/search?sort=PN&amp;alpha=Windows%20Server%202008%20R2&amp;Filter=FilterNO</a></p>

<h3 id="62-creately-website">62. Creately website</h3>

<p>For drawing beautiful network diagrams:</p>

<p><a href="https://creately.com/app/#">https://creately.com/app/#</a></p>

<p>You can login with your google profiles.</p>

<h3 id="63-default-route-for-centos">63. Default route for CentOS</h3>

<p>Add following in <code>/etc/sysconfig/network-scripts/ifcfg-cloudbr</code>:</p>

<pre><code>DEFROUTE=yes
</code></pre>

<h3 id="64-ovs-bridge-example">64. OVS Bridge example</h3>

<p>You can remove some parameters, like intefaceid, target dev, alias name, etc.</p>

<pre><code>    &lt;interface type='bridge'&gt;
      &lt;mac address='52:54:00:63:d2:1e'/&gt;
      &lt;source bridge='ovsbr0'/&gt;
      &lt;virtualport type='openvswitch'&gt;
        &lt;parameters interfaceid='3f320d2c-7adc-46dd-857c-fb04a96ab416'/&gt;
      &lt;/virtualport&gt;
      &lt;target dev='vnet7'/&gt;
      &lt;model type='virtio'/&gt;
      &lt;alias name='net1'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x07' function='0x0'/&gt;
    &lt;/interface&gt;
</code></pre>

<h3 id="65-flatpak">65. flatpak</h3>

<p><a href="https://linux.cn/article-7673-1.html?utm_source=weibo&amp;utm_medium=weibo">https://linux.cn/article-7673-1.html?utm_source=weibo&amp;utm_medium=weibo</a></p>

<h3 id="66-cloudstack-apis">66. CloudStack APIs</h3>

<p><a href="http://docs.idcf.jp/cloud/introduction/">http://docs.idcf.jp/cloud/introduction/</a></p>

<p><a href="https://github.com/idcf/cloudstack-api">https://github.com/idcf/cloudstack-api</a></p>

<h3 id="67-specify-vagrant-deployment-vars-in-vagrantfile">67. Specify vagrant deployment vars in Vagrantfile</h3>

<p>An example in Vagrantfile:</p>

<pre><code>  # Install CloudStack Agent node. 
  config.vm.define &quot;allinone&quot; do |allinone|
    allinone.vm.provision :ansible do |ansible|
      ansible.playbook = &quot;./Ansible/CloudStackAgent.yml&quot;
      ansible.limit = CLOUDSTACK_ALLINONE_HOSTNAME
      ansible.inventory_path = &quot;./Ansible/vagrant&quot;
      ansible.inventory_path = &quot;./Ansible/vagrant&quot;
      ansible.extra_vars = { ansible_ssh_user: 'vagrant' }
      ansible.extra_vars = { ansible_ssh_pass: 'vagrant' }
      ansible.verbose = 'vvvv'
    end
  end
</code></pre>

<h3 id="68-ssh-login-with-rsa-issue">68. ssh login with RSA Issue</h3>

<p>First add following parameters:</p>

<pre><code>$ sudo vim /etc/ssh/sshd_config
RSAAuthentication yes
PubkeyAuthentication yes
</code></pre>

<p>Then restart the sshd service and also change the priviledge of the ssh configuration
directory:</p>

<pre><code>$ chmod go-w ~/
$ chmod 700 ~/.ssh
$ chmod 600 ~/.ssh/authorized_keys
</code></pre>

<p>Now restart the sshd service and it will work properly.</p>

<h3 id="69-auto-hide-menubar-in-gnome-terminal">69. Auto-Hide Menubar in gnome-terminal</h3>

<p>Under ArchLinux + Awesome, configure it via:</p>

<pre><code>$ vim ~/.config/rc.lua
terminal = &quot;gnome-terminal --hide-menubar&quot;
</code></pre>

<h3 id="70-qemu-qcow2-format-convertion">70. Qemu qcow2 Format Convertion</h3>

<p>Use following commands for convert to 0.10 version of qemu image:</p>

<pre><code>$ qemu-img convert -f qcow2 -O qcow2 -o compat=0.10 Origin.qcow2 Converted.qcow2
</code></pre>

<h3 id="71-grub-default-ok-for-packer">71. grub default OK For packer</h3>

<pre><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;net.ifnames=0 biosdevname=0 quiet text splash nomodeset&quot;
</code></pre>

<h3 id="hugo-after-changing-ssh-key">Hugo After Changing ssh-key</h3>

<p>Better if you remove the initial <code>.travis.yml</code>, and touch again.</p>

<pre><code>$ touch .travis.yml
$ travis login --org
$ cp ~/.ssh/id_rsa ./
$ travis encrypt-file id_rsa --add
$ rm -f ./id_rsa
</code></pre>

<p>Then add the hint message into your <code>.travis.yml</code> file, update.</p>

<h3 id="72-on-installing-xenserver">72. On installing XenServer</h3>

<p>Use ultraiso could directly write XenServer iso into a flash disk, then you could use
this flash disk for booting up the machine.</p>

<h3 id="73-resume-ansible-playbook-running">73. Resume ansible-playbook running</h3>

<p>Command:</p>

<pre><code>ansible-playbook -i inventory OnecloudPlaybooks/LAMP/main.yml  --start-at-task=&quot;Disable
Apache modules&quot; -u vagrant -k
</code></pre>

<h3 id="74-force-install">74. Force install</h3>

<p>apt-get method:</p>

<pre><code>$ /usr/bin/apt-get -y -o Dpkg::Options::=--force-confdef -o Dpkg::Options::=--force-confold 
</code></pre>

<h3 id="75-slack-and-ssh">75. slack and ssh</h3>

<p><a href="https://segmentfault.com/a/1190000006681056">https://segmentfault.com/a/1190000006681056</a></p>

<h3 id="76-php-info">76. php info</h3>

<p>Display php info:</p>

<pre><code>&lt;?php

// Show all information, defaults to INFO_ALL
phpinfo();

?&gt;
</code></pre>

<h3 id="77-wordpress">77. WordPress</h3>

<p>Edit the wordpress:</p>

<pre><code>wp-config.php in the root of your website and add there two lines:
define('WP_DEBUG', true);
@ini_set('display_errors', 1);
</code></pre>

<h3 id="78-packer-specify-var">78. Packer Specify var</h3>

<p>For using ansible playbooks:</p>

<pre><code>packer build \
    -var 'aws_access_key=foo' \
    -var 'aws_secret_key=bar' \
    template.json
</code></pre>

<h3 id="79-minimum-cloudstack-mem-usage">79. Minimum CloudStack Mem Usage</h3>

<p>To limit the memory usage.</p>

<pre><code>mysql -u cloud -p&lt;password&gt;
UPDATE cloud.service_offering SET ram_size='128', speed='128' WHERE vm_type='domainrouter';
UPDATE cloud.service_offering SET ram_size='128', speed='128' WHERE vm_type='elasticloadbalancervm';
UPDATE cloud.service_offering SET ram_size='128', speed='128' WHERE vm_type='secondarystoragevm';
UPDATE cloud.service_offering SET ram_size='128', speed='128' WHERE vm_type='internalloadbalancervm';
UPDATE cloud.service_offering SET ram_size='128', speed='128' WHERE vm_type='consoleproxy';
quit

</code></pre>

<h3 id="80-nethogs-in-ubuntu14-04">80. Nethogs In Ubuntu14.04</h3>

<p>The default version of nethogs is too old, thus won&rsquo;t be used properly.</p>

<pre><code># wget -c https://github.com/raboof/nethogs/archive/v0.8.5.tar.gz
# tar xf v0.8.5.tar.gz 
# cd ./nethogs-0.8.5/
# sudo apt-get install libncurses5-dev libpcap-dev
# make &amp;&amp; sudo make install 
</code></pre>

<h3 id="81-vagrant-disk-usage">81. Vagrant Disk Usage</h3>

<p>Standard VS LVM:</p>

<pre><code>Standard: 
    qemu: Filesystem      Size  Used Avail Use% Mounted on
    qemu: udev            228M     0  228M   0% /dev
    qemu: tmpfs            49M  1.8M   48M   4% /run
    qemu: /dev/vda1       211G  1.1G  199G   1% /
    qemu: tmpfs           245M     0  245M   0% /dev/shm
    qemu: tmpfs           5.0M     0  5.0M   0% /run/lock
    qemu: tmpfs           245M     0  245M   0% /sys/fs/cgroup
    qemu: tmpfs            49M     0   49M   0% /run/user/0
LVM:
    qemu: Filesystem                   Size  Used Avail Use% Mounted on
    qemu: udev                         227M     0  227M   0% /dev
    qemu: tmpfs                         49M  1.9M   48M   4% /run
    qemu: /dev/mapper/ubuntu--vg-root  3.0G  1.1G  1.8G  37% /
    qemu: tmpfs                        245M     0  245M   0% /dev/shm
    qemu: tmpfs                        5.0M     0  5.0M   0% /run/lock
    qemu: tmpfs                        245M     0  245M   0% /sys/fs/cgroup
    qemu: /dev/vda1                    472M   53M  395M  12% /boot
    qemu: tmpfs                         49M     0   49M   0% /run/user/0
</code></pre>

<p>The standard will take very long time for shrinking the disk.</p>

<p>So we have to choose lvm, and use vagrant command for enlarge it during start up.<br />
An example of Vagrantfile is listed as:</p>

<pre><code># -*- mode: ruby -*-
# vi: set ft=ruby :

############### Definitions Comes Here #################
OPENSTACK_HOSTNAME = &quot;openstackallinone&quot;


############### Vagrant Configuration Here #############
Vagrant.configure(2) do |config|

  # vagrant issues #1673..fixes hang with configure_networks
  config.ssh.shell = &quot;bash -c 'BASH_ENV=/etc/profile exec bash'&quot;
  config.vm.provision :shell, path: &quot;add_new_disk.sh&quot;
  config.ssh.username = 'root'
  config.ssh.password = 'YourPasswordForRoot'
  config.ssh.insert_key = 'true'
  config.vm.provider :libvirt do |domain|
    domain.nic_model_type = 'e1000'
    domain.memory = 384
    domain.nested = true
    domain.cpu_mode = 'host-model'
  end

  # openstackallinone node.
  # Add one networking, modify hostname, define memory, CPU cores.
  config.vm.define :openstackallinone do |openstackallinone|
    openstackallinone.vm.box = &quot;Ubuntu1604OneLVM&quot;
    openstackallinone.vm.boot_timeout = '36000'
    openstackallinone.vm.hostname = OPENSTACK_HOSTNAME
    openstackallinone.vm.network :public_network, 
	    :dev =&gt; &quot;br0&quot;,
	    :mode =&gt; &quot;bridge&quot;,
	    :type =&gt; &quot;bridge&quot;,
	    :ip =&gt; &quot;192.168.10.33&quot;
    # Disable mounting of vagrant folder as it's not supported on xenserver
    openstackallinone.vm.synced_folder &quot;.&quot;, &quot;/vagrant&quot;, disabled: true
    openstackallinone.vm.provider :libvirt do |domain|
      domain.memory = 10240
      domain.cpus = 8
      domain.storage :file, :size =&gt; '200G'
      domain.storage_pool_name = 'XenStoragePool'
      domain.nested = true
      domain.cpu_mode = 'host-model'
      domain.nic_model_type = 'virtio'
      domain.disk_bus = 'virtio'
      domain.volume_cache = 'writeback'
    end
  end

end
</code></pre>

<p>Make sure your <code>add_new_disk.sh</code> avaiable:</p>

<pre><code>set -e
set -x

if [ -f /etc/disk_added_date ]
then
   echo &quot;disk already added so exiting.&quot;
   exit 0
fi


sudo fdisk -u /dev/vdb &lt;&lt;EOF
n
p
1


t
8e
w
EOF

pvcreate /dev/vdb1
vgextend ubuntu-vg /dev/vdb1
lvextend -l +100%FREE  /dev/ubuntu-vg/root
resize2fs /dev/ubuntu-vg/root 

date &gt; /etc/disk_added_date
</code></pre>

<h3 id="82-quickly-add-swapfile">82. Quickly add swapfile</h3>

<p>Format a swapfile using following command:</p>

<pre><code># dd if=/dev/zero of=/swapfile bs=1M count=2048
# mkswap /swapfile 
# chmod 600 /swapfile 
# swapon /swapfile 
</code></pre>

<p>Add swapfile.</p>

<pre><code>echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
</code></pre>

<h3 id="83-vmware-tips">83. Vmware tips</h3>

<p>Issue:</p>

<pre><code>vmmon-only/linux/driver.c:390:8
</code></pre>

<p>Fixed by:</p>

<pre><code># cd /usr/lib/vmware/modules/source
# tar xf vmmon.tar
# nano ./vmmon-only/linux/driver.c
 #ifdef VMX86_DEVEL 
    unregister_chrdev(linuxState.major, linuxState.deviceName); 
 #else 
-   if (misc_deregister(&amp;linuxState.misc)) { 
-      Warning(&quot;Module %s: error unregistering\n&quot;, linuxState.deviceName); 
-   } 
+   misc_deregister(&amp;linuxState.misc); 
</code></pre>

<p>Then recompile the modules via:</p>

<pre><code># tar cf vmmon.tar ./vmmon-only
# vmware-modconfig --console --install-all
</code></pre>

<p>Before start vmware, you should include following library:</p>

<pre><code>export LD_LIBRARY_PATH=/usr/lib/vmware/lib/libglibmm-2.4.so.1/:$LD_LIBRARY_PATH
</code></pre>

<h3 id="84-good-material-on-openstack-building">84. Good Material On OpenStack building</h3>

<p><a href="http://blog.l1n3.net/category/cloud/openstack/">http://blog.l1n3.net/category/cloud/openstack/</a><br />
<a href="https://cunninghamshane.com/deploying-and-customizing-openstack-mitaka-with-openstack-ansible/">https://cunninghamshane.com/deploying-and-customizing-openstack-mitaka-with-openstack-ansible/</a></p>

<h3 id="85-digital-ocean-docker-issue">85. Digital Ocean docker issue</h3>

<p>Issue:</p>

<pre><code>DJANGO_APP=$(docker run -d -i -t -p 8000:8000 ubuntu /bin/bash)
WARNING: Docker detected local DNS server on resolv.conf. Using default external servers: [8.8.8.8 8.8.4.4]
WARNING: IPv4 forwarding is disabled.
2013/09/12 12:52:02 Error: Error starting container 037aac8ca3ab: iptables failed: iptables -t nat -A DOCKER -p tcp --dport 8000 ! -i docker0 -j DNAT --to-destination 172.17.0.3:8000
</code></pre>

<p>Solved by:</p>

<pre><code>$ modprobe xt_conntrack
$ sudo service docker restart
</code></pre>

<h3 id="86-studying-material-in-weekend">86. Studying material in weekend</h3>

<p><a href="https://www.zybuluo.com/gump88/note/440777">https://www.zybuluo.com/gump88/note/440777</a><br />
<a href="http://geek.csdn.net/news/detail/65292">http://geek.csdn.net/news/detail/65292</a></p>

<h3 id="87-xzoom">87. xzoom</h3>

<p>Could be a desktop magnifier. Install it via yaourt xzoom.</p>

<h3 id="88-questions">88.  Questions</h3>

<p>To be investigated:</p>

<pre><code>
十台服务器，关于并发的问题
十台 8C 16G 100M 这样配置的服务器，要是求支持 3w 并发，简单的三台 web ，做 nginx ，两
台调度器，做 lvs+keepalived ，四台做数据库集群架构，用 amoeba 做读写分离，简单的主从复
制，，这样的一个简单的架构方案能抗住 3w 并发吗？？？
</code></pre>

<h3 id="89-convertion-for-mobi">89. Convertion for mobi</h3>

<p>If your file extension is doc, then first convert it to rtf in libreoffice, then use
calibre for converting it to mobi.</p>

<h3 id="90-linux-pc-benchmark">90. Linux PC Benchmark</h3>

<p><a href="https://linux.cn/article-7810-1.html?utm_source=weibo&amp;utm_medium=weibo">https://linux.cn/article-7810-1.html?utm_source=weibo&amp;utm_medium=weibo</a></p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2016/05/04/working-tips-on-ansible-cobbler/">Working Tips On ansible-cobbler</a>
      </h1>
      <span class="post-date">May 4, 2016 
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/virtualization">Virtualization</a>
        
      </span>
      
      

<h3 id="source">Source</h3>

<p>The source are downloaded from:<br />
<a href="https://github.com/signed8bit/ansible-cobbler">https://github.com/signed8bit/ansible-cobbler</a></p>

<p>Git clone it via:</p>

<pre><code>$ git clone https://github.com/signed8bit/ansible-cobbler.git
</code></pre>

<h3 id="test">Test</h3>

<p>The test will be done via <code>vagrant up</code>, while we met the problem: the cobbler version
in ansible playbooks are too old, thus the command <code>cobbler get-loaders</code> won&rsquo;t acts
well. we have to changing to the newest cobbler version which is available in</p>

<p><a href="http://cobbler.github.io/">http://cobbler.github.io/</a></p>

<h3 id="manually-steps-ubuntu">Manually Steps(Ubuntu)</h3>

<p>Install the newest cobbler via:</p>

<pre><code>$ wget -qO - http://download.opensuse.org/repositories/home:/libertas-ict:/cobbler26/xUbuntu_14.04/Release.key | sudo apt-key add -
$ sudo add-apt-repository &quot;deb http://download.opensuse.org/repositories/home:/libertas-ict:/cobbler26/xUbuntu_14.04/ ./&quot;
$ sudo apt-get install -y cobbler 
$ cobbler --version
Cobbler 2.6.11
  source: ?, ?
  build time: Sat Jan 23 14:13:42 2016
</code></pre>

<p>Change Password of the <code>cobbler</code>:</p>

<pre><code>Change the password for the 'cobbler' username:
htdigest /etc/cobbler/users.digest &quot;Cobbler&quot; cobbler
</code></pre>

<p>visit the url of <code>http://xxx.xxx.xxx.xx/cobbler_web</code> and you could access the management interface of cobbler.</p>

<h3 id="import-centos7-2">Import CentOS7.2</h3>

<p>Import the iso via following command</p>

<pre><code>$ sudo mount -t iso9660 -o loop ./CentOS-7-x86_64-Everything-1511.iso /mnt1
$ sudo cobbler import --name=CentOS-7.2 --arch=x86_64 --path=/mnt1
</code></pre>

<p>Examine the imported iso:</p>

<pre><code>root@cobbler-ubuntu:~# cobbler profile list
   CentOS-7.2-x86_64
root@cobbler-ubuntu:~# cobbler distro list
   CentOS-7.2-x86_64
</code></pre>

<p>Change the default password of root:</p>

<pre><code># openssl passwd -1
# vim /etc/cobbler/settings 
- default_password_crypted: &quot;$1$mF86/UHC$WvcIcX2t6crBz2onWxyac.&quot;
+ default_password_crypted: &quot;$awegwaegoguoweuouoeh/&quot;
# cobbler sync
# service cobbler restart
# service cobblerd restart

</code></pre>

<h3 id="todo">Todo</h3>

<p>How to automatically install the mate desktop via kickstart?</p>

<p>First find out all of the pkgs in group, then add them into the kickstart file?</p>

<h3 id="for-making-mate">For Making Mate</h3>

<p>Steps are listed as following:</p>

<pre><code># curl http://mirrors.aliyun.com/repo/epel-7.repo&gt;/etc/yum.repos.d/epel-7.repo
# curl http://mirrors.aliyun.com/repo/Centos-7.repo&gt;CentOS-Base.repo
# yum groupinstall &quot;X Window system&quot;
# yum groupinstall &quot;MATE Desktop&quot;
</code></pre>

<p>Remain the yum cache:</p>

<pre><code>[root@localhost ~]# cat /etc/yum.conf 
[main]
#cachedir=/var/cache/yum/$basearch/$releasever
cachedir=/root/cache/$basearch/$releasever
keepcache=1
</code></pre>

<p>For setting mate as the default desktop envs:</p>

<pre><code># systemctl isolate graphical.target
# systemctl set-default graphical.target
</code></pre>

<h3 id="repo-in-cobbler">Repo In Cobbler</h3>

<p>We could setup the cobbler&rsquo;s repository via following steps:</p>

<p><img src="/images/2016_05_05_22_48_11_536x324.jpg" alt="/images/2016_05_05_22_48_11_536x324.jpg" /></p>

<p>The configuration of this repo:</p>

<p><img src="/images/2016_05_05_22_48_58_718x444.jpg" alt="/images/2016_05_05_22_48_58_718x444.jpg" /></p>

<p>Now you repo&rsquo;s configuration file should be like following:</p>

<pre><code>root@cobbler-ubuntu:/var/lib/cobbler/snippets# cat /srv/www/cobbler/repo_mirror/centos7_mate/config.repo 
[centos7_mate]
name=centos7_mate
baseurl=http://${http_server}/cobbler/repo_mirror/centos7_mate
enabled=1
priority=99
gpgcheck=0
</code></pre>

<p>Copy the rpms into <code>/srv/www/cobbler/repo_mirror/centos7_mate/</code>, and then <code>createrepo</code> for generating the package informations.</p>

<p>Now edit the existing profile&rsquo;s repo configurations:</p>

<pre><code># cobbler profile list
   CentOS-7.2-x86_64
# cobbler profile edit --name=CentOS-7.2-x86_64 --repo='centos7_mate'
</code></pre>

<p>Examine it via:</p>

<pre><code># cobbler repo report --name=centos7_mate
Name                           : centos7_mate
Apt Components (apt only)      : []
Apt Dist Names (apt only)      : []
Arch                           : x86_64
Breed                          : yum
Comment                        : This Repo is for installing MATE Desktop
Createrepo Flags               : &lt;&lt;inherit&gt;&gt;
Environment Variables          : {}
Keep Updated                   : False
Mirror                         : 
Mirror locally                 : True
Owners                         : ['admin']
Priority                       : 99
External proxy URL             : 
RPM List                       : []
Yum Options                    : {}
</code></pre>

<h3 id="using-the-repo-in-kickstart">Using the repo in kickstart</h3>

<p>First define the snippet:</p>

<pre><code>root@cobbler-ubuntu:/var/lib/cobbler/snippets# pwd
/var/lib/cobbler/snippets
root@cobbler-ubuntu:/var/lib/cobbler/snippets# cat mate
# Install mate
mkdir -p /etc/yum.repos.d/back
mv /etc/yum.repos.d/CentOS* /etc/yum.repos.d/back/
yum install -y abattis-cantarell-fonts abrt abrt-addon-ccpp abrt-addon-kerneloops abrt-addon-pstoreoops abrt-addon-python abrt-addon-vmcore abrt-addon-xorg abrt-dbus abrt-desktop abrt-gui abrt-gui-libs abrt-java-connector abrt-libs abrt-python abrt-retrace-client accountsservice adwaita-cursor-theme adwaita-gtk2-theme adwaita-icon-theme alsa-plugins-pulseaudio alsa-utils atk atkmm atril atril-caja atril-libs at-spi2-atk at-spi2-core audit-libs-python augeas-libs avahi-autoipd avahi-glib avahi-libs bind-libs-lite bind-license brasero brasero-libs bzip2 ca-certificates cairo cairo-gobject cairomm caja caja-extensions caja-extensions-common caja-image-converter caja-open-terminal caja-schemas caja-sendto cdparanoia cdparanoia-libs cdrdao centos-indexhtml check checkpolicy cjkuni-uming-fonts clutter clutter-gst2 clutter-gtk cogl colord-libs compat-libcogl12 compat-libcogl-pango12 compat-libcolord1 coreutils cpp crda cronie cronie-anacron cryptsetup cups-libs cyrus-sasl-lib dbus-x11 dconf dconf-editor dejavu-fonts-common dejavu-sans-fonts dejavu-sans-mono-fonts dejavu-serif-fonts desktop-file-utils device-mapper device-mapper-event device-mapper-event-libs device-mapper-libs djvulibre-libs dleyna-connector-dbus dleyna-core dleyna-server dosfstools dracut dracut-config-rescue dracut-network dvd+rw-tools elfutils emacs-filesystem enchant engrampa eom exempi fftw-libs-double filezilla firefox firewall-config flac-libs fontconfig fontpackages-filesystem fortune-mod fros fuse fuse-libs gamin GConf2 gcr gd gdb gdisk gdk-pixbuf2 genisoimage geoclue2 ghostscript ghostscript-fonts giflib glibc glibc-common glibmm24 glx-utils gmp gnome-abrt gnome-desktop3 gnome-icon-theme gnome-icon-theme-extras gnome-icon-theme-legacy gnome-keyring gnome-keyring-pam gnome-online-accounts gnome-python2 gnome-python2-canvas gnome-themes-standard gnote gnu-free-fonts-common gnu-free-mono-fonts gnu-free-sans-fonts gnu-free-serif-fonts gnutls gom google-crosextra-caladea-fonts google-crosextra-carlito-fonts gparted gpm-libs graphite2 grilo grilo-plugins grub2 grub2-tools gsm gssdp gstreamer gstreamer1 gstreamer1-plugins-bad-free gstreamer1-plugins-base gstreamer1-plugins-good gstreamer-plugins-bad-free gstreamer-plugins-base gstreamer-plugins-good gstreamer-tools gtk2 gtk2-engines gtk2-immodule-xim gtk3 gtk3-immodule-xim gtkmm24 gtkmm30 gtk-murrine-engine gtksourceview2 gtkspell3 gucharmap gupnp gupnp-av gupnp-dlna gvfs gvfs-afc gvfs-archive gvfs-fuse gvfs-gphoto2 gvfs-mtp gvfs-smb harfbuzz harfbuzz-icu hicolor-icon-theme hunspell hunspell-en-US ibus ibus-chewing ibus-gtk2 ibus-gtk3 ibus-hangul ibus-kkc ibus-libpinyin ibus-libs ibus-m17n ibus-rawcode ibus-sayura ibus-setup ibus-table ibus-table-chinese icedax ilmbase ImageMagick initscripts iso-codes iw jasper-libs jbigkit-libs jomolhari-fonts json-glib kernel kernel-tools kernel-tools-libs kexec-tools khmeros-base-fonts khmeros-fonts-common kpartx krb5-libs lcms2 libao libarchive libart_lgpl libasyncns libatasmart libavc1394 libblkid libbluray libburn libcanberra libcanberra-gtk2 libcanberra-gtk3 libcdio libcdio-paranoia libcgroup libchewing libdmapsharing libdmx libdnet libdv libdvdnav libdvdread libepoxy liberation-fonts-common liberation-mono-fonts liberation-sans-fonts liberation-serif-fonts libevdev libevent libexif libfontenc libgdata libgee06 libglade2 libgnomecanvas libgnome-keyring libgphoto2 libgpod libgsf libgtop2 libgudev1 libgusb libgxps libhangul libICE libicu libiec61883 libieee1284 libimobiledevice libiptcdata libisofs libjpeg-turbo libkkc libkkc-common libkkc-data libldb libmatekbd libmatemixer libmateweather libmateweather-data libmbim libmediaart libmount libmpc libmpcdec libmspack libmtp libmx libnatpmp libnl libnm-gtk libnotify libntlm liboauth libofa libogg libosinfo libpeas libpinyin libpinyin-data libplist libpng libqmi libraw1394 libreport libreport-centos libreport-filesystem libreport-gtk libreport-plugin-mantisbt libreport-plugin-reportuploader libreport-plugin-rhtsupport libreport-plugin-ureport libreport-python libreport-web librsvg2 libsamplerate libsecret libsemanage-python libsexy libshout libsigc++20 libSM libsmbclient libsndfile libspectre libsrtp libssh2 libtalloc libtar libtdb libteam libtevent libthai libtheora libtiff libtomcrypt libtommath libtool-ltdl libudisks2 libusal libusb libusbx libuser-python libuuid libv4l libvisual libvorbis libvpx libwbclient libwebp libwmf-lite libwnck libwnck3 libwvstreams libX11 libX11-common libXau libxcb libXcomposite libXcursor libXdamage libXdmcp libXevie libXext libXfixes libXfont libXft libXi libXinerama libxkbfile libxklavier libxml2 libxml2-python libXmu libXpm libXrandr libXrender libXres libXScrnSaver libxshmfence libxslt libXt libXtst libXv libXvMC libXxf86dga libXxf86misc libXxf86vm lightdm lightdm-gobject lightdm-gtk lightdm-gtk-common lklug-fonts lockdev logrotate lohit-assamese-fonts lohit-bengali-fonts lohit-devanagari-fonts lohit-gujarati-fonts lohit-kannada-fonts lohit-malayalam-fonts lohit-marathi-fonts lohit-nepali-fonts lohit-oriya-fonts lohit-punjabi-fonts lohit-tamil-fonts lohit-telugu-fonts lrzsz lvm2 lvm2-libs lz4 m17n-contrib m17n-db m17n-lib madan-fonts marco mariadb-libs marisa mate-applets mate-backgrounds mate-calc mate-control-center mate-control-center-filesystem mate-desktop mate-desktop-libs mate-dictionary mate-disk-usage-analyzer mate-icon-theme mate-media mate-menus mate-menus-libs mate-menus-preferences-category-menu mate-netspeed mate-notification-daemon mate-panel mate-panel-libs mate-polkit mate-power-manager mate-screensaver mate-screenshot mate-search-tool mate-session-manager mate-settings-daemon mate-system-log mate-system-monitor mate-terminal mate-themes mate-user-guide mate-utils-common mathjax mathjax-ams-fonts mathjax-caligraphic-fonts mathjax-fraktur-fonts mathjax-main-fonts mathjax-math-fonts mathjax-sansserif-fonts mathjax-script-fonts mathjax-size1-fonts mathjax-size2-fonts mathjax-size3-fonts mathjax-size4-fonts mathjax-typewriter-fonts mathjax-winchrome-fonts mathjax-winie6-fonts mdadm media-player-info mesa-dri-drivers mesa-filesystem mesa-libEGL mesa-libgbm mesa-libGL mesa-libglapi mesa-libGLU mesa-libxatracker mesa-private-llvm mobile-broadband-provider-info ModemManager ModemManager-glib mozilla-filesystem mozo mpfr mtdev net-tools NetworkManager NetworkManager-adsl network-manager-applet NetworkManager-glib NetworkManager-libnm NetworkManager-openconnect NetworkManager-openvpn NetworkManager-pptp NetworkManager-team NetworkManager-tui NetworkManager-vpnc NetworkManager-vpnc-gnome nhn-nanum-fonts-common nhn-nanum-gothic-fonts nm-connection-editor nspr nss nss-softokn nss-softokn-freebl nss-sysinit nss-tools nss-util numactl-libs oddjob oddjob-mkhomedir opencc openconnect OpenEXR-libs openjpeg-libs openldap open-sans-fonts openssh openssh-clients openssh-server openssl openssl-libs open-vm-tools open-vm-tools-desktop openvpn opus orc overpass-fonts PackageKit-glib PackageKit-gstreamer-plugin paktype-naskh-basic-fonts pango pangomm paratype-pt-sans-fonts pcsc-lite-libs perl perl-Carp perl-constant perl-Encode perl-Exporter perl-File-Path perl-File-Temp perl-Filter perl-Getopt-Long perl-HTTP-Tiny perl-libs perl-macros perl-parent perl-PathTools perl-Pod-Escapes perl-podlators perl-Pod-Perldoc perl-Pod-Simple perl-Pod-Usage perl-Scalar-List-Utils perl-Socket perl-Storable perl-Text-ParseWords perl-threads perl-threads-shared perl-Time-HiRes perl-Time-Local pexpect pinentry-gtk pixman pkcs11-helper pluma pluma-data plymouth-graphics-libs plymouth-plugin-label plymouth-plugin-two-step plymouth-system-theme plymouth-theme-charge policycoreutils-python polkit polkit-gnome poppler poppler-data poppler-glib pptp procps-ng psmisc pulseaudio pulseaudio-libs pulseaudio-libs-glib2 pulseaudio-module-x11 pulseaudio-utils pycairo pygobject2 pygobject3 pygtk2 pygtk2-libglade pygtksourceview pyOpenSSL pytalloc python-augeas python-backports python-backports-ssl_match_hostname python-beaker python-chardet python-cups python-dmidecode python-inotify python-IPy python-kitchen python-mako python-markupsafe python-paste python-perf python-pwquality python-pyudev python-setuptools python-six python-tempita pyxdg qemu-guest-agent rarian rarian-compat rdma realmd recode redhat-menus rest rhythmbox rtkit samba-client-libs samba-common samba-common-libs samba-common-tools samba-libs sane-backends-libs satyr SDL seahorse selinux-policy selinux-policy-targeted setools-libs setroubleshoot setroubleshoot-plugins setroubleshoot-server sg3_utils-libs sil-abyssinica-fonts sil-nuosu-fonts sil-padauk-fonts simple-scan skkdic smc-fonts-common smc-meera-fonts sos sound-theme-freedesktop soundtouch speex spice-vdagent startup-notification stix-fonts stoken-libs sudo system-config-date system-config-date-docs system-config-language system-config-printer system-config-printer-libs system-config-users system-config-users-docs systemd systemd-libs systemd-python systemd-sysv taglib teamd telepathy-glib texlive-kpathsea-lib thai-scalable-fonts-common thai-scalable-waree-fonts totem totem-pl-parser tracker transmission-common transmission-gtk tuned tzdata ucs-miscfixed-fonts udisks2 unique upower urw-fonts usb_modeswitch usb_modeswitch-data usbmuxd usermode usermode-gtk util-linux vim-common vim-enhanced vim-filesystem vlgothic-fonts vorbis-tools vpnc vpnc-script vte wavpack web-assets-filesystem webkitgtk webkitgtk3 webrtc-audio-processing wireless-tools wodim wqy-microhei-fonts wqy-zenhei-fonts wvdial wxBase wxGTK xcb-util xchat xdg-user-dirs xdg-user-dirs-gtk xdg-utils xkeyboard-config xml-common xmlrpc-c xmlrpc-c-client xorg-x11-drivers xorg-x11-drv-ati xorg-x11-drv-dummy xorg-x11-drv-evdev xorg-x11-drv-fbdev xorg-x11-drv-intel xorg-x11-drv-nouveau xorg-x11-drv-qxl xorg-x11-drv-synaptics xorg-x11-drv-v4l xorg-x11-drv-vesa xorg-x11-drv-vmmouse xorg-x11-drv-vmware xorg-x11-drv-void xorg-x11-drv-wacom xorg-x11-font-utils xorg-x11-server-common xorg-x11-server-utils xorg-x11-server-Xorg xorg-x11-utils xorg-x11-xauth xorg-x11-xinit xorg-x11-xkb-utils xvattr yelp yelp-libs yelp-xsl yumex zenity
systemctl isolate graphical.target
systemctl set-default graphical.target
</code></pre>

<p>Now involved this snippet in <code>ks_end</code></p>

<pre><code># pwd
/var/lib/cobbler/kickstarts
# vim sample_end.ks
    # Insert a key
    $SNIPPET('publickey')
    # Instal mate
    $SNIPPET('mate')
    # End final steps
    %end
</code></pre>

<p>Now run <code>cobbler sync</code> for syncing your configurations.</p>

<p>Next time you bootstrap a machine, it will automatically runs into MATE desktop.</p>

<p><img src="/images/2016_05_05_22_56_57_672x489.jpg" alt="/images/2016_05_05_22_56_57_672x489.jpg" /></p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2016/04/24/tipsonosexperiment/">TipsOnOSExperiment</a>
      </h1>
      <span class="post-date">Apr 24, 2016 
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/virtualization">virtualization</a>
        
      </span>
      
      

<p>为了在家里验证一下DevStack的网络配置，组建了一个网络，涉及到的点比较多，以下是
具体记录。</p>

<h3 id="交换机配置">交换机配置</h3>

<p>前段时间从美国亚马逊买回来一个TP-LINK的千兆交换机一直没用起来，型号是TL-SG108E
，8口可网管交换机。但前面有写过文章可以用来参考:</p>

<p><a href="http://purplepalmdash.github.io/blog/2015/12/12/ba-wan-tl-sg108e/">http://purplepalmdash.github.io/blog/2015/12/12/ba-wan-tl-sg108e/</a></p>

<p>但这篇文章里讲的主要还是ovs后虚拟机的vlan，和最近要做的DevStack的FloatIP配置稍
微有点差异。</p>

<h3 id="网络规划">网络规划</h3>

<p>家里已有网络192.168.177.0/24, 这个网络是可以访问Internet的。所以DevStack机器上
的eth0将连接到这个网段，并在其上分配floating IP.</p>

<p>另外我们需要创建一个VLAN隔离的private network，用于给DevStack里的虚拟机默认启
动后分配IP地址。将DevStack机器上的eth1连接到此网络。</p>

<h3 id="配置交换机">配置交换机</h3>

<p>TP-LINK的DEB-100网卡是比较皮实，奈何win10驱动需要找，随便找了个淘宝9.9包邮的
USB转10兆网卡连上SurfacePro，开始配置交换机。</p>

<p>步骤:<br />
打开桌面的<code>Easy Smart Configuration Utility</code>，开始自动发现局域网内的交换机，如
下图:</p>

<p><img src="/images/2016_04_24_17_58_49.jpg" alt="/images/2016_04_24_17_58_49.jpg" /></p>

<p>需要重新配置下USB有线网卡的IP地址才能连接上交换机:</p>

<p><img src="/images/2016_04_24_18_02_45.jpg" alt="/images/2016_04_24_18_02_45.jpg" /></p>

<p>双击发现的交换机，用<code>admin/admin</code>登录后的界面如下:</p>

<p><img src="/iamges/2016_04_24_18_08_04.jpg" alt="/images/2016_04_24_18_08_04.jpg" /></p>

<p>以前我曾经把这个交换机配置成802.1Q VLAN, 这次基于端口来隔离，所以要配置成<code>Port
Based VLAN</code>, 配置完毕后的画面如下:</p>

<p><img src="/images/2016_04_24_18_20_36.jpg" alt="/images/2016_04_24_18_20_36.jpg" /></p>

<p>这种基于端口VLAN的验证方法很简单，将上网机和宽带路由器分别插在1～4和5～8口，即
可测试出VLAN被端口隔离。但这好像不是DevStack中需要设置的。</p>

<p>还是继续配置802.1Q VLAN. 值得注意的是，如果之前配置端口VLAN时将SurfacePro的连
接和交换机网段隔离了，那可能会连接不上，换回同一VLAN即可连接上。</p>

<p>配置vlan100如以下图所示:</p>

<p><img src="/images/2016_04_24_19_51_15.jpg" alt="/images/2016_04_24_19_51_15.jpg" /></p>

<h3 id="测试vlan">测试VLAN</h3>

<p>将两台PC连接在5~8口上，VLAN100。</p>

<p>PC1, ArchLinux, Systemd配置VLAN:</p>

<pre><code>$ cat enp0s25.100.network
[Match]
Name=enp0s25.100

[Network]
DNS=192.168.2.1
Address=192.168.2.1/24
$ cat enp0s25.100.netdev 
[NetDev]
Name=enp0s25.100
Kind=vlan

[VLAN]
Id=100

[Network]
DNS=192.168.2.1
Address=192.168.2.1/24
Gateway=192.168.2.1
$ pwd
/etc/systemd/network
</code></pre>

<p>重新启动PC1后，<code>192.168.2.1</code>将成为VLAN100口的地址。作为<code>192.168.2.1</code>,我们在这
个端口上启动dhcp服务及路由转发等服务。</p>

<pre><code>$ sudo pacman -S dhcp
$ sudo systemctl enable dhcpd4.service
</code></pre>

<p>干掉冗余的默认dhcpd.conf文件，写一个最小的配置文件:</p>

<pre><code>$ sudo vim /etc/dhcpd.conf.example 
$ sudo vim /etc/dhcpd.conf         
option domain-name-servers 180.76.76.76,223.5.5.5;
option subnet-mask 255.255.255.0;
option routers 192.168.2.1;
subnet 192.168.2.0 netmask 255.255.255.0 {
  range 192.168.2.150 192.168.2.250;

  host macbookpro{
   hardware ethernet 70:56:81:22:33:44;
   fixed-address 192.168.2.199;
  }
}
</code></pre>

<p>开启dhcpd服务:</p>

<pre><code>$ sudo systemctl start dhcpd4.service
</code></pre>

<p>PC2, 用openvswitch的vlan配置, libvirt的XML配置如下:</p>

<pre><code>    &lt;interface type='bridge'&gt;
      &lt;mac address='52:54:00:fd:03:e9'/&gt;
      &lt;source bridge='ovsbr0'/&gt;
      &lt;vlan trunk='yes'&gt;
        &lt;tag id='100' nativeMode='untagged'/&gt;
      &lt;/vlan&gt;
      &lt;virtualport type='openvswitch'&gt;
        &lt;parameters interfaceid='fb3e7f34-6fcd-41dc-8fed-c3ffe0d54b18'/&gt;
      &lt;/virtualport&gt;
</code></pre>

<p>测试，即启动PC2上的虚拟机，若虚拟机能获得IP地址，则说明VLAN配置成功。</p>

<h3 id="devstack网络配置">DevStack网络配置</h3>

<p>操作系统为Ubuntu14.04, 网卡为eth0(192.168.177.100)和eth1(vlan 100)</p>

      
    </div>
    
    

<ul class="pagination">
    
    <li>
        <a href="/" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li
    >
    <a href="/page/29/" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/">1</a></li>
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/page/2/">2</a></li>
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/page/3/">3</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="disabled"><span aria-hidden="true">&hellip;</span></li>
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/page/29/">29</a></li>
    
    
    
    
    
    
        
        
    
    
    <li
    class="active"><a href="/page/30/">30</a></li>
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/page/31/">31</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="disabled"><span aria-hidden="true">&hellip;</span></li>
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/page/154/">154</a></li>
    
    
    <li
    >
    <a href="/page/31/" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li>
        <a href="/page/154/" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>

  </div>
</div>


<script src="http://purplepalmdash.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

