<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
	<meta name="generator" content="Hugo 0.32-DEV" />
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Dash &middot; Dash</title>

  
  <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/poole.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde-a.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/custom-additions.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/highlight/googlecode.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/8.5/styles/docco.min.css">
  <script type="text/javascript" src="//cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
  <script type="text/javascript" src="/js/html2canvas.js"></script>
  <script type='text/javascript'>
  function genPostShot() { 
          var rightNow = new Date();
          var imageName = rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");
          imageName += '.jpg'
          html2canvas(document.getElementsByClassName('post'), {
              background :'#FFFFFF',
              onrendered: function(canvas) {
  		
          	$('#test').attr('href', canvas.toDataURL("image/jpeg"));
          	$('#test').attr('download',imageName);
          	$('#test')[0].click();
              }
          });
  }; 
  
  </script>
  <script src="//cdn.bootcss.com/highlight.js/8.5/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124">
  <link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel="icon">

  
  
  
  <link href="http://purplepalmdash.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Dash &middot; Dash" />

  <meta name="description" content="Get busy living, or get busy dying.">
  <meta name="keywords" content="unix,virtualization,embedded,linux">
  
  
</head>
<body class="theme-base-0c">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <img src="http://purplepalmdash.github.io/images/mylogo.jpeg" alt="gravatar">
      <h1><a href="http://purplepalmdash.github.io/">Get busy living, or get busy dying.</a></h1>
      <a href="http://purplepalmdash.github.io/"><p>Dash</p></a>
    </div>

    <ul class="sidebar-nav">
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/">First Page</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/post/">All Posts</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/linux/">Linux</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/embedded/">Embedded System</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/virtualization">Virtualization</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/purplepalmdash"><i class="fa fa-github-square fa-3x"></i></a>
      
      <a href="https://cn.linkedin.com/in/yang-feipeng-1b909319"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="https://plus.google.com/u/0/106572959364703833986"><i class="fa fa-google-plus-square fa-3x"></i></a>
      <a href="https://www.facebook.com/yang.feipeng"><i class="fa fa-facebook-square fa-3x"></i></a>
      <a href="https://twitter.com/dashwillfly"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      <a href="http://purplepalmdash.github.io/index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
    </ul>

    

  </div>
</div>


<div class="content container">
  <div class="posts">
    
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2015/07/06/add-private-nat-networking-in-xenserver/">Add Private NAT Networking In XenServer</a>
      </h1>
      <span class="post-date">Jul 6, 2015 
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/virtualization">Virtualization</a>
        
      </span>
      
      

<h3 id="create-networking-in-xencenter">Create Networking In XenCenter</h3>

<p>Create the networking under the XenCenter UI&rsquo;s tab &ldquo;Networking&rdquo;.</p>

<h3 id="networking-setting">Networking Setting</h3>

<p>Enable the ip forward:</p>

<pre><code># vim /etc/sysctl.conf
net.ipv4.ip_forward = 1
# sysctl -p 
# cat /proc/sys/net/ipv4/ip_forward 
1
</code></pre>

<p>Use iptables for forwarding the network flow:</p>

<pre><code># iptables -A FORWARD --in-interface xapi0 -j ACCEPT
# iptables --table nat -A POSTROUTING --out-interface eth0 -j MASQUERADE
</code></pre>

<p>But this didn&rsquo;t bring up the internal networking, after discussing with college, edit the file:</p>

<pre><code>[root@xenserver-WolfHunter ~]# cat /etc/sysconfig/iptables
+++++  *nat
+++++  :PREROUTING ACCEPT [7019:539216]
+++++  :INPUT ACCEPT [77:3825]
+++++  :OUTPUT ACCEPT [104:6495]
+++++  :POSTROUTING ACCEPT [53:3228]
+++++  -A POSTROUTING -o xenbr0 -j MASQUERADE
+++++  COMMIT
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:RH-Firewall-1-INPUT - [0:0]
-A INPUT -j RH-Firewall-1-INPUT
++++ -A FORWARD -i xapi0 -j ACCEPT
-A FORWARD -j RH-Firewall-1-INPUT
-A RH-Firewall-1-INPUT -i lo -j ACCEPT
-A RH-Firewall-1-INPUT -p icmp --icmp-type any -j ACCEPT
# DHCP for host internal networks (CA-6996)
-A RH-Firewall-1-INPUT -p udp -m udp --dport 67 --in-interface xenapi -j ACCEPT
-A RH-Firewall-1-INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
# Linux HA hearbeat (CA-9394)
-A RH-Firewall-1-INPUT -m conntrack --ctstate NEW -m udp -p udp --dport 694 -j ACCEPT
-A RH-Firewall-1-INPUT -m conntrack --ctstate NEW -m tcp -p tcp --dport 22 -j ACCEPT
-A RH-Firewall-1-INPUT -m conntrack --ctstate NEW -m tcp -p tcp --dport 80 -j ACCEPT
-A RH-Firewall-1-INPUT -m conntrack --ctstate NEW -m tcp -p tcp --dport 443 -j ACCEPT
-A RH-Firewall-1-INPUT -j REJECT --reject-with icmp-host-prohibited
COMMIT

</code></pre>

<p>Restart XenServer and waiting for verification.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2015/07/04/preseed-file-for-ubuntu1404-in-cobblerserver/">Preseed File For Ubuntu1404 In CobblerServer</a>
      </h1>
      <span class="post-date">Jul 4, 2015 
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/virtualization">Virtualization</a>
        
      </span>
      
      

<h3 id="proseed-file">Proseed File</h3>

<pre><code>d-i time/zone string Asia/Shanghai

# Setup the installation source
d-i mirror/country string manual
d-i mirror/http/hostname string $http_server
#d-i mirror/http/directory string $install_source_directory
d-i mirror/http/directory string /cobbler/ks_mirror/Ubuntu-14.04-x86_64/ubuntu
d-i mirror/http/proxy string
d-i apt-setup/security_host string $http_server
d-i apt-setup/security_path string /cobbler/ks_mirror/Ubuntu-14.04-x86_64/ubuntu
</code></pre>

<h3 id="local-repository">Local Repository</h3>

<p>In one installed machine, do following for getting the repository of all of the installed packages:</p>

<pre><code>$ sudo apt-get install dselect
$ dpkg --get-selections | grep -v deinstall&gt;InstalledPackage.txt
$ awk {'print $1'} InstalledPackage.txt | xargs apt-get download
</code></pre>

<p>Use nginx for sharing the repository:</p>

<pre><code>$ sudo apt-get install -y nginx
$ sudo vim /etc/nginx/site-enabled/default
server {
        listen 80 default_server;
        listen [::]:80 default_server ipv6only=on;

        root /var/www/html;
        index index.html index.htm;

        # Make site accessible from http://localhost/
        server_name localhost;

        location / {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                try_files $uri $uri/ =404;
                autoindex on;
                # Uncomment to enable naxsi on this location
$ sudo service nginx restart
</code></pre>

<p>Now generate the repository server:</p>

<pre><code>$ mkdir -p /var/www/html/amd64
$ mv /root/Code/*.deb /var/www/html/amd64
$ cd /var/www/html/
$ dpkg-scanpackages amd64/ | gzip -9c &gt; amd64/Packages.gz
$ mv /root/Code/InstalledPackage.txt /var/www/html
</code></pre>

<h3 id="use-local-repository">Use Local Repository</h3>

<p>Change the repoisoty setting:</p>

<pre><code>root@Ubuntu-14:~# cat /etc/apt/sources.list
deb http://192.168.1.111 amd64/
root@Ubuntu-14:~# apt-get update &amp;&amp;  apt-get install -y dselect
root@Ubuntu-14:~# dselect update
root@Ubuntu-14:~# wget http://192.168.1.11/InstalledPackage.txt
root@Ubuntu-14:~# dpkg --set-selections &lt; InstalledPackage.txt &amp;&amp; apt-get -u dselect-upgrade 
</code></pre>

<p>After updating, you have the same system as your server.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2015/07/03/try-raid0-installation-on-ubuntu/">Try raid0 installation on Ubuntu</a>
      </h1>
      <span class="post-date">Jul 3, 2015 
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/linux">linux</a>
        
      </span>
      
      

<h3 id="preparation">Preparation</h3>

<p>Prepare the disks:</p>

<pre><code>[root:/home/juju/img]# mkdir Raid0
[root:/home/juju/img]# cd Raid0/
[root:/home/juju/img/Raid0]# ls
[root:/home/juju/img/Raid0]# qemu-img create -f qcow2 disk0.qcow2 10G
Formatting 'disk0.qcow2', fmt=qcow2 size=10737418240 encryption=off cluster_size=65536 
[root:/home/juju/img/Raid0]# qemu-img create -f qcow2 disk1.qcow2 10G
Formatting 'disk1.qcow2', fmt=qcow2 size=10737418240 encryption=off cluster_size=65536 
[root:/home/juju/img/Raid0]# qemu-img create -f qcow2 disk2.qcow2 10G
Formatting 'disk2.qcow2', fmt=qcow2 size=10737418240 encryption=off cluster_size=65536 
</code></pre>

<p>Prepare the Virtual Machine:<br />
<img src="/images/2015_07_03_11_06_03_658x441.jpg" alt="/images/2015_07_03_11_06_03_658x441.jpg" /></p>

<p><img src="/images/2015_07_03_11_06_57_556x325.jpg" alt="/images/2015_07_03_11_06_57_556x325.jpg" /></p>

<h3 id="partition">Partition</h3>

<p><img src="/images/2015_07_03_11_12_18_615x311.jpg" alt="/images/2015_07_03_11_12_18_615x311.jpg" /></p>

<p><img src="/images/2015_07_03_11_15_30_476x216.jpg" alt="/images/2015_07_03_11_15_30_476x216.jpg" /></p>

<p><img src="/images/2015_07_03_11_15_36_384x205.jpg" alt="/images/2015_07_03_11_15_36_384x205.jpg" /></p>

<p><img src="/images/2015_07_03_11_18_30_499x265.jpg" alt="/images/2015_07_03_11_18_30_499x265.jpg" /></p>

<h3 id="raid">Raid</h3>

<p>Configure the Software Raid0:</p>

<p><img src="/images/2015_07_03_11_19_31_441x260.jpg" alt="/images/2015_07_03_11_19_31_441x260.jpg" /></p>

<p><img src="/images/2015_07_03_11_20_41_655x244.jpg" alt="/images/2015_07_03_11_20_41_655x244.jpg" /></p>

<p><img src="/images/2015_07_03_11_22_43_728x243.jpg" alt="/images/2015_07_03_11_22_43_728x243.jpg" /></p>

<p>After Configuration of SoftRaid1, the screen displayed like:</p>

<p><img src="/images/2015_07_03_11_28_28_687x457.jpg" alt="/images/2015_07_03_11_28_28_687x457.jpg" /></p>

<p>Continue to install.</p>

<h3 id="verify-raid">Verify Raid.</h3>

<p>Use df and fdisk to verify the partition information:</p>

<pre><code>clouder@UbuntuRaid1:~$ df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/md0        9.3G  870M  7.9G  10% /
none            4.0K     0  4.0K   0% /sys/fs/cgroup
udev            235M  4.0K  235M   1% /dev
tmpfs            50M  440K   49M   1% /run
none            5.0M     0  5.0M   0% /run/lock
none            246M     0  246M   0% /run/shm
none            100M     0  100M   0% /run/user
clouder@UbuntuRaid1:~$ sudo fdisk -l
[sudo] password for clouder: 

Disk /dev/vda: 10.7 GB, 10737418240 bytes
255 heads, 63 sectors/track, 1305 cylinders, total 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x00035942

   Device Boot      Start         End      Blocks   Id  System
/dev/vda1   *        2048    19922943     9960448   fd  Linux raid autodetect
/dev/vda2        19924990    20969471      522241    5  Extended
/dev/vda5        19924992    20969471      522240   fd  Linux raid autodetect

Disk /dev/vdb: 10.7 GB, 10737418240 bytes
255 heads, 63 sectors/track, 1305 cylinders, total 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x000715e9

   Device Boot      Start         End      Blocks   Id  System
/dev/vdb1   *        2048    19922943     9960448   fd  Linux raid autodetect
/dev/vdb2        19924990    20969471      522241    5  Extended
/dev/vdb5        19924992    20969471      522240   fd  Linux raid autodetect

Disk /dev/md0: 10.2 GB, 10190979072 bytes
2 heads, 4 sectors/track, 2488032 cylinders, total 19904256 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x00000000

Disk /dev/md0 doesn't contain a valid partition table

Disk /dev/md1: 534 MB, 534446080 bytes
2 heads, 4 sectors/track, 130480 cylinders, total 1043840 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x00000000

Disk /dev/md1 doesn't contain a valid partition table
</code></pre>

<p>Verify the raid status:</p>

<pre><code>root@UbuntuRaid1:/etc/initramfs-tools/conf.d# cat /proc/mdstat 
Personalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] 
md1 : active raid1 vda5[0] vdb5[1]
      521920 blocks super 1.2 [2/2] [UU]
      
md0 : active raid1 vda1[0] vdb1[1]
      9952128 blocks super 1.2 [2/2] [UU]
      
unused devices: &lt;none&gt;
</code></pre>

<p>Query the status of SoftRaid1:</p>

<pre><code>root@UbuntuRaid1:/etc/initramfs-tools/conf.d# sudo mdadm --query --detail /dev/md0
/dev/md0:
        Version : 1.2
  Creation Time : Fri Jul  3 11:24:46 2015
     Raid Level : raid1
     Array Size : 9952128 (9.49 GiB 10.19 GB)
  Used Dev Size : 9952128 (9.49 GiB 10.19 GB)
   Raid Devices : 2
  Total Devices : 2
    Persistence : Superblock is persistent

    Update Time : Fri Jul  3 11:46:19 2015
          State : clean 
 Active Devices : 2
Working Devices : 2
 Failed Devices : 0
  Spare Devices : 0

           Name : UbuntuRaid1:0  (local to host UbuntuRaid1)
           UUID : bc091921:c198c219:7162e35c:bfff3c4e
         Events : 19

    Number   Major   Minor   RaidDevice State
       0     253        1        0      active sync   /dev/vda1
       1     253       17        1      active sync   /dev/vdb1
</code></pre>

<h3 id="remove-one-disk">Remove One Disk</h3>

<p>Remove one, and see if it could be startup.</p>

<p>Result:<br />
Done, it could start into the system.</p>

<pre><code>clouder@UbuntuRaid1:~$ cat /proc/mdstat 
Personalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] 
md1 : active (auto-read-only) raid1 vda5[1]
      521920 blocks super 1.2 [2/1] [_U]
      
md0 : active raid1 vda1[1]
      9952128 blocks super 1.2 [2/1] [_U]
      
unused devices: &lt;none&gt;
</code></pre>

<h3 id="add-a-new-empty-disk">Add A New Empty Disk</h3>

<p>Add a new disk into the system, and first partition.</p>

<pre><code>$ sudo fdisk -l 

Disk /dev/vdb: 10.7 GB, 10737418240 bytes
16 heads, 63 sectors/track, 20805 cylinders, total 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x00000000

Disk /dev/vdb doesn't contain a valid partition table
</code></pre>

<p>Clone the partition table from the vda to the newly added partion:</p>

<pre><code>$ sudo sfdisk -d /dev/vda &gt; vda.desc
$ cat vda.desc 
$ sudo sfdisk /dev/vdb&lt;./vda.desc
</code></pre>

<p>Now Add the new disk for usage:</p>

<pre><code>clouder@UbuntuRaid1:~$ cat /proc/mdstat 
Personalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] 
md1 : active (auto-read-only) raid1 vda5[1]
      521920 blocks super 1.2 [2/1] [_U]
      
md0 : active raid1 vda1[1]
      9952128 blocks super 1.2 [2/1] [_U]
      
unused devices: &lt;none&gt;
clouder@UbuntuRaid1:~$ sudo mdadm --manage /dev/md0 --add /dev/vdb1
mdadm: added /dev/vdb1
clouder@UbuntuRaid1:~$ sudo mdadm --manage /dev/md1 --add /dev/vdb5
mdadm: added /dev/vdb5
clouder@UbuntuRaid1:~$ cat /proc/mdstat 
Personalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] 
md1 : active raid1 vdb5[2] vda5[1]
      521920 blocks super 1.2 [2/1] [_U]
        resync=DELAYED
      
md0 : active raid1 vdb1[2] vda1[1]
      9952128 blocks super 1.2 [2/1] [_U]
      [===&gt;.................]  recovery = 16.6% (1662144/9952128) finish=1.8min speed=75552K/sec
      
unused devices: &lt;none&gt;
</code></pre>

<h3 id="known-bugs">Known Bugs</h3>

<p>Error and Solution:</p>

<pre><code>error:  Diskfilter writes are not supported

Edit :/etc/grub.d/10_linux

Replace 'quick_boot=&quot;1&quot;' with 'quick_boot=&quot;0&quot;'

Then :

sudo update-grub

</code></pre>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2015/06/29/insert-public-key-into-cobbler-deployed-system/">Insert public key into Cobbler Deployed System</a>
      </h1>
      <span class="post-date">Jun 29, 2015 
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/virtualization">Virtualization</a>
        
      </span>
      
      <p>First edit your kickstart file, add following line before the end of your kickstart:</p>

<pre><code>[root@z_WHServer kickstarts]# pwd
/var/lib/cobbler/kickstarts
[root@z_WHServer kickstarts]# cat sample_end.ks
# Start final steps
+ $SNIPPET('publickey_root')
$SNIPPET('kickstart_done')
# End final steps
%end
</code></pre>

<p>And the <code>publickey_root</code> should be edited as following:</p>

<pre><code>[root@z_WHServer snippets]# pwd
/var/lib/cobbler/snippets
[root@z_WHServer snippets]# cat publickey_root
# Install CobblerServer's(10.47.58.2) public key for root user
cd /root
mkdir --mode=700 .ssh
cat &gt;&gt; .ssh/authorized_keys &lt;&lt; &quot;PUBLIC_KEY&quot;
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA3B3GtGuKY0l2Ak9+WSkorY7R+Cx5/u3RMua/7GrvP05IPywQdkR+mqwdRydNjyhB96nHlYZtr8Fbfn5iwqn0j8dz8wmTZicBNeRqIdbe/YUje5NjXxDXjYda63VfDhpgzJ53KICTx6pBhGaeOKS/U5HqCpDbF7ODP8siU7bRhk1LkIQ6VwZYUg7b0oR+Sw6XJ31Z7gs4CWF6zfjfQQoF7EoMA+dnqvt2K4PQPXNSBJQx3qb9jyXIXvo333PcfIX6mD1TW1wDAIXLm4qz4mi7C8Ax9h+T/D98r08WX360vC5Tzr8feXMs6H4il4s4Ftq7RVoqCNKmG3AB1LTp4AQAzw== root@z_WHServer
PUBLIC_KEY
chmod 600 .ssh/authorized_keys
cat &gt;&gt; .ssh/config &lt;&lt;EOF
StrictHostKeyChecking no
UserKnownHostsFile /dev/null
EOF
</code></pre>

<p>Better you run <code>cobber sync</code> after updating your kickstart file.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2015/06/29/linux-tips-2/">Linux Tips(2)</a>
      </h1>
      <span class="post-date">Jun 29, 2015 
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/linux">Linux</a>
        
      </span>
      
      

<h3 id="1-xencenter-installation">1. XenCenter Installation</h3>

<p>Just use your windows&rsquo;s browser point to your XenServer IP Address, Download the XenCenter, and install it.</p>

<p>Update Some tools on XenServer:</p>

<pre><code>$ vim /etc/yum.repos.d/CentOS-Base.repo
...
enabled=1
...
$ yum install -y lm_sensors
</code></pre>

<p>After installation of lm_sensors you could see more detailed information on XenServer.</p>

<h3 id="2-disable-specified-repository">2. Disable Specified Repository</h3>

<p>Since citrix have no data in its repository, simply disable it.</p>

<pre><code>$ yum update --disablerepo=citrix
</code></pre>

<h3 id="3-yum-shell">3. Yum Shell</h3>

<pre><code>yum shell
remove ffmpeg-libpostproc
remove ffmpeg
install ffmpeg-compat
run
</code></pre>

<h3 id="4-install-lm-sensors-in-xenserver">4. Install lm_sensors In XenServer</h3>

<p>The default lm_sensors could not be insalled due to dependency errors, so we download the source code from lm_sensors website and manually build and install it:</p>

<pre><code>$ wget http://dl.lm-sensors.org/lm-sensors/releases/lm_sensors-3.4.0.tar.bz2
$ tar xzvf lm_sensors-3.4.0.tar.bz2
$ cd lm_sensors
$ yum install -y gcc make flex bison 
$ make &amp;&amp; make install
$ export PATH=/usr/local/bin:$PATH
$ sensors-detect
$ sensors
</code></pre>

<p>In 79 machine, sensors won&rsquo;t printout cpu fan, solved by:</p>

<pre><code>$ modprobe it87 force_id=0x8728
</code></pre>

<p>Or configure the modprobe.d:</p>

<pre><code>[root:/etc/modprobe.d]# cat it87.conf 
options it87 force_id=0x8603

[root:/etc/modprobe.d]# pwd
/etc/modprobe.d
</code></pre>

<h3 id="5-detect-an-amd-chipset">5. Detect an AMD Chipset</h3>

<p>First using <code>sensors-detect</code> for detecting the sensors, the result is listed as:</p>

<pre><code>Now follows a summary of the probes I have just done.

Driver `w83627ehf':
  * ISA bus, address 0x290
    Chip `Nuvoton W83677HG-I (NCT5572D/NCT6771F/NCT6772F/NCT6775F) Super IO Sensors' (confidence: 9)

Driver `k10temp' (autoloaded):
  * Chip `AMD Family 12h and 14h thermal sensors' (confidence: 9)
</code></pre>

<p>Now go to the modules directory for finding out the corresponding driver:</p>

<pre><code>[root@xenserver-WolfHunter 3.10.0+2]# find . | grep -i w83
./kernel/drivers/hwmon/w83795.ko
./kernel/drivers/hwmon/w83627hf.ko
./kernel/drivers/hwmon/w83l786ng.ko
./kernel/drivers/hwmon/w83792d.ko
./kernel/drivers/hwmon/w83l785ts.ko
./kernel/drivers/hwmon/w83791d.ko
./kernel/drivers/hwmon/w83793.ko
./kernel/drivers/hwmon/w83781d.ko
./kernel/drivers/hwmon/w83627ehf.ko
[root@xenserver-WolfHunter 3.10.0+2]# pwd
/lib/modules/3.10.0+2
[root@xenserver-WolfHunter 3.10.0+2]# modprobe w83627ehf.ko
</code></pre>

<p>Now you could detect more infos, add to automatically:</p>

<pre><code>[root@xenserver-WolfHunter modprobe.d]# cat w83627ehf.conf
#!/bin/sh 
/sbin/insmod /lib/modules/3.10.0+2/kernel/drivers/hwmon/w83627ehf.ko
</code></pre>

<h3 id="6-headless-ubuntu">6. Headless Ubuntu</h3>

<p>Headless Ubuntu, for updating grub.</p>

<pre><code>Add: GRUB_RECORDFAIL_TIMEOUT = 15 in /etc/default/grub, and run &quot;sudo update-grub&quot;. You can change the 15 to any arbitrary number of seconds that you like.
</code></pre>

<h3 id="7-joggler-bootloader-configuration">7.Joggler Bootloader Configuration</h3>

<p>Notice there are 2 systems available on Joggler.</p>

<pre><code>[dash@/run/media/dash/linux-boot]$ cat grub.cfg
loadfont /unicode.pf2
terminal_output gfxterm
set timeout=5
menuentry &quot;Ubuntu 12.04 LTS (Precise) - 3.2.32joggler1&quot; {
  # text mode
  #linux /vmlinuz-3.2.32joggler1 root=LABEL=linux-root 3 ro text pci=routeirq
  # Graphical mode
  linux /vmlinuz-3.2.32joggler1 root=LABEL=linux-root 3 ro pci=routeirq
  initrd /initrd.img-3.2.32joggler1
}
###############Xubuntu#####################3
#menuentry &quot;XUbuntu 12.04 LTS (Precise) - 3.2.32joggler1&quot; {
#  linux /vmlinuz-3.2.32joggler1 root=LABEL=Xubuntu ro quiet splash 
#  initrd /initrd.img-3.2.32joggler1
}
</code></pre>

<h3 id="8-use-joggler-as-a-digitalframe">8. Use Joggler As a DigitalFrame</h3>

<pre><code>#!/bin/sh
#
# Script to run Digital Picture Frame using Feh
# drware@thewares.net
#

# Change number below to the duration, in seconds
# for each photo to be displayed
DELAY=&quot;5&quot;

# hide the cursor after 15 seconds
#/usr/bin/unclutter -idle 15 &amp;

# Start slide show
# /usr/bin/feh --quiet --recursive --randomize --full-screen \ --slideshow-delay $DELAY /home/dash/800480/
/usr/bin/feh --hide-pointer -D $DELAY --quiet --recursive --randomize --full-screen \ --slideshow-delay $DELAY /home/dash/800480 &amp;

# Phone home and sync
# /home/dsl/frame/rsync.sh

exit 0
</code></pre>

<h3 id="9-resolving-git-conflicts">9. Resolving git conflicts</h3>

<p>Once you installed meld or other tools, using following commands.</p>

<pre><code>$ git mergetool
</code></pre>

<h3 id="10-enlarge-volume">10. Enlarge Volume</h3>

<p>Enlarge the qemu disk via:</p>

<pre><code>$ sudo qemu-img resize abc.qcow2 +200GB
</code></pre>

<p>Enlarge the disk via following command:</p>

<pre><code>[root@fuel ~]# df -h
Filesystem            Size  Used Avail Use% Mounted on
/dev/mapper/os-root   9.6G  976M  8.1G  11% /
/dev/mapper/os-var     27G  5.4G   20G  22% /var
[root@fuel ~]# lvs
  LV           VG   Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root         os   -wi-ao----  9.78g                                                    
  swap         os   -wi-ao----  2.94g                                                    
  var          os   -wi-ao---- 26.66g       
 
</code></pre>

<p>Use gparted livecd for enlarge the disk, now you could enjoy the whole 300GiB disk size.</p>

<p>Resize the var partition:</p>

<pre><code>Disk /dev/mapper/os-var: 28.6 GB, 28621930496 bytes
255 heads, 63 sectors/track, 3479 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
[root@fuel ~]# lvextend -L+50G /dev/mapper/os-var
  Size of logical volume os/var changed from 26.66 GiB (853 extents) to 76.66 GiB (2453 extents).
  Logical volume var successfully resized
######Reboot to gdisk iso, and resize2fs.   
# resize2fs /dev/mapper/os-var
</code></pre>

<h3 id="11-gpg-generation">11. gpg Generation</h3>

<pre><code>$ apt-get install -y rng-tools
$ rngd -r /dev/urandom
$ gpg --gen-key
$ gpg --list-secret-keys
$ gpg-agent --homedir /home/dash/.gnupg --use-standard-socket --daemon
$ sudo apt-get install gnupg
</code></pre>

<h3 id="12-syslogd-related">12. Syslogd related</h3>

<p>Redirect bash script&rsquo;s output to syslogd:<br />
<a href="http://urbanautomaton.com/blog/2014/09/09/redirecting-bash-script-output-to-syslog/">http://urbanautomaton.com/blog/2014/09/09/redirecting-bash-script-output-to-syslog/</a></p>

<p>Then limit the syslogd activity:</p>

<p>via logrotate, syslogd don&rsquo;t care about the log file size.</p>

<pre><code>So in the end the top portion of my /etc/logrotate.conf file looks like this:

size 250M
rotate 2
create
#compress
include /etc/logrotate.d
</code></pre>

<h3 id="13-brake">13. Brake</h3>

<pre><code>http://www.miroslavnovak.com/qemu-brake_en.php
</code></pre>

<h3 id="14-install-specified-pip-version">14. install specified pip version</h3>

<pre><code>$ sudo pip install &quot;PyOpenSSL&gt;=0.13&quot;
</code></pre>

<h3 id="15-tips-for-using-vfense">15. Tips for using vFense</h3>

<pre><code>   57  sudo pip install &quot;PyOpenSSL&gt;=0.13&quot;
   58  apt-cache search libffi
   59  sudo apt-get install -y libffi-dev
dash@fenseServer:~$ sudo mkdir /usr/share/rethinkdb

</code></pre>

<h3 id="16-cgroup-error">16. Cgroup error</h3>

<pre><code>
cloudstack4.5.1 在centos7.1 上的 bug 
此bug 会导致 系统vm state 状态获取不到
在agent的log中获取到的错误信息为
Controller 'cpuacct' is not wanted, but 'cpu' is co-mounted: Invalid argument

解决方法

注释这个文件中的这行 /usr/lib64/python2.7/site-packages/cloudutils/serviceConfig.py
cfo.addEntry(&quot;cgroup_controllers&quot;, &quot;[\&quot;cpu\&quot;]&quot;)
和这个文件中的这行 /etc/libvirt/qemu.conf
cgroup_controllers=[&quot;cpu&quot;]
重启libvirtd服务

官网bug连接：https://issues.apache.org/jira/browse/CLOUDSTACK-8443
</code></pre>

<h3 id="17-pxe-boot-debian">17. PXE Boot Debian:</h3>

<pre><code>Install:   
http://backreference.org/2013/12/23/diskless-iscsi-boot-with-pxe-howto/
iscsi:    
http://www.sysprobs.com/guide-how-to-create-iscsi-storage-disks-freenas-08
Trouble Shooting: Use the latest version!!!
https://www.howtoforge.com/community/threads/debian-boot-over-iscsi-problem.67536/#post-321516
iscsi and kvm:
https://www.berrange.com/posts/2010/05/05/provisioning-kvm-virtual-machines-on-iscsi-the-hard-way-part-2-of-2/
</code></pre>

<h3 id="18-quickly-connect-to-rdp">18. Quickly Connect to RDP</h3>

<pre><code># ssh -L 2333:10.0.0.2:3389 192.168.10.187 -l root
# rdesktop -u YourUseName -p YourPassword localhost:2333 -g 1400x800
</code></pre>

<h3 id="18-nginx-enable-directory-displaying-and-follow-links">18. nginx enable directory displaying and follow links:</h3>

<p>On CentOS 7, do following:</p>

<pre><code>$ sudo vim /etc/nginx/nginx.conf
http {
        disable_symlinks off;
}

server {
        root         /var/www/html;

        location / {
                        autoindex on;
        }
</code></pre>

<p>Restart the nginx service now you could get the local directory avaiable in browser.</p>

<h3 id="20-get-back-the-passwd">20. Get Back the passwd</h3>

<p>In Grub, add <code>single</code> at the <code>linux   /boot/vmlinuz-</code>&hellip;&hellip;</p>

<p>Press F10, and now you can do whatever you want to do.</p>

<h3 id="21-enable-nested-kvm">21. Enable Nested KVM</h3>

<pre><code># virsh edit VM_NAME
&lt;vcpu placement='static' cpuset='0-3'&gt;4&lt;/vcpu&gt;
Also change the cpu model.  
&lt;cpu&gt;
....
&lt;/cpu&gt; 
remove the tsc related item.   
</code></pre>

<h3 id="22-restart-windows-under-cmd">22. Restart Windows Under CMD</h3>

<p>Specify the timeout(5 seconds) under the cmd line:</p>

<pre><code># shutdown /r /t 5
</code></pre>

<h3 id="23-cleanup-windows7-disk">23. Cleanup Windows7 Disk</h3>

<p>Right click the disk, and select <code>Disk Cleanup</code>, then select <code>Clean up system files</code>, then your winsxs directory will be cleaned, thus saved your partition volumn.</p>

<h3 id="24-vim-spell-checking">24. vim spell checking</h3>

<pre><code>: set spell spelllang=en_us
</code></pre>

<h3 id="25-startup-synergy-at-system-startup">25. Startup Synergy At System Startup</h3>

<pre><code># vim /etc/lightdm/lightdm.conf
greeter-setup-script=/usr/bin/synergys --config /home/dash/mysynergy.conf
</code></pre>

<h3 id="26-install-cobbler-on-ubuntu">26. Install Cobbler On Ubuntu</h3>

<pre><code># wget -qO - http://download.opensuse.org/repositories/home:/libertas-ict:/cobbler26/xUbuntu_14.04/Release.key | sudo apt-key add -
OK
# sudo add-apt-repository &quot;deb http://download.opensuse.org/repositories/home:/libertas-ict:/cobbler26/xUbuntu_14.04/ ./&quot;
# apt-get update
</code></pre>

<h3 id="27-install-restricted-extra-packages">27. Install restricted extra packages</h3>

<p>Install it via:</p>

<pre><code> # sudo apt-get install ubuntu-restricted-extras
</code></pre>

<h3 id="28-view-allocated-dhcp-address">28. View Allocated DHCP Address</h3>

<pre><code>$ more /var/lib/dhcpd/dhcpd.leases
</code></pre>

<h3 id="29-apt-mirror-for-launchpad">29. apt-mirror for launchpad</h3>

<p>The steps are the same as the ordinary repository.</p>

<pre><code># vim  /etc/apt/mirror.list
 deb http://ppa.launchpad.net/landscape/15.01/ubuntu trusty main
# apt-mirror
</code></pre>

<h3 id="30-specify-architecture-of-sources-list">30. Specify architecture of sources.list</h3>

<p>Only include amd64:</p>

<pre><code>$ sudo vim /etc/apt.sources.list
deb [arch=amd64] http://192.168.0.79/landscape/15.01/ubuntu/ trusty main
</code></pre>

<h3 id="31-use-cobbler-repository">31. Use Cobbler Repository</h3>

<pre><code>[root@localhost yum.repos.d]# cat cobbler.repo 
[core-0]
name=core-0
baseurl=http://10.9.10.1/ks_mirror/CentOS-6.5-x86_64
enabled=1
gpgcheck=0
priority=1
</code></pre>

<h3 id="32-jenkins-worktips">32. Jenkins Worktips</h3>

<p>Worktips:</p>

<pre><code># visudo
jenkins ALL=(ALL) NOPASSWD:ALL
</code></pre>

<h3 id="33-query-packages">33. Query packages</h3>

<pre><code>$ yum whatprovides &quot;*/mkpasswd&quot;
-or-
$ repoquery -q --file */mkpasswd
</code></pre>

<h3 id="34-encrypt-kickstart-used-passwd">34. Encrypt kickstart used passwd</h3>

<pre><code># perl -e &quot;print crypt('engine123','sa')&quot;
saWbOtynpFXBA%
</code></pre>

<h3 id="35-disable-ssh-x-warning">35. Disable ssh -X warning</h3>

<p>Problem:</p>

<pre><code>Couldn't connect to accessibility bus: Failed to connect to socket /tmp/dbus-*
</code></pre>

<p>Solution:</p>

<pre><code># vim ~/.bashrc
export NO_AT_BRIDGE=1
</code></pre>

<h3 id="36-manually-add-gpg-key">36. Manually add gpg key</h3>

<pre><code># wget http://download.opensuse.org/repositories/home:/libertas-ict:/cobbler26/xUbuntu_15.04/Release.key
# cat Release.key |sudo apt-key add -
</code></pre>

<h3 id="37-quick-setup-the-centos7-network">37. Quick Setup the CentOS7 Network</h3>

<pre><code># cat /etc/sysconfig/network-scripts/ifcfg-eth0
# Generated by dracut initrd
DEVICE=&quot;eth0&quot;
ONBOOT=yes
NETBOOT=yes
UUID=&quot;99c6b60e-1932-46f9-a86a-d9836f42cecb&quot;
IPV6INIT=yes
BOOTPROTO=static
IPADDR=10.9.10.100
GATEWAY=10.9.10.1
TYPE=Ethernet
NAME=&quot;eth0&quot;
DNS1=223.5.5.5
DNS2=180.76.76.76
</code></pre>

<h3 id="38-gpg-key-error">38. GPG Key Error</h3>

<pre><code>Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
GPG key retrieval failed: [Errno 14] curl#37 - &quot;Couldn't open file
/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7&quot;
</code></pre>

<p>Solution:</p>

<pre><code># wget http://mirrors.aliyun.com/epel/RPM-GPG-KEY-EPEL-7
# rpm --import RPM-GPG-KEY-EPEL-7 
</code></pre>

<h3 id="39-sync-repository">39. Sync REpository</h3>

<pre><code>[root@SpaceWalker ~]# spacewalk-repo-sync -c centos7-x86_64 --url=file:///var/distro-trees/centos7_64/
======================================
| Channel: centos7-x86_64
======================================

Repo URL: file:///var/distro-trees/centos7_64/
Packages in repo:              8652
No new packages to sync.
Repo file:///var/distro-trees/centos7_64/ has comps file 0e6e90965f55146ba5025ea450f822d1bb0267d0299ef64dd4365825e6bad995-c7-x86_64-comps.xml.gz.
Repo file:///var/distro-trees/centos7_64/ has 0 errata.
Sync completed.
Total time: 0:01:58
</code></pre>

<h3 id="40-resuming-until-you-success">40. Resuming until you success</h3>

<pre><code># cat ./abc.sh
until sudo xxxxxxx
do
	do something
done
# ./abc.sh
</code></pre>

<h3 id="41-pacman-yaourt">41. pacman/yaourt</h3>

<p>Ignore the pacman PGP check:</p>

<pre><code>$ sudo vim /etc/pacman.conf
SigLevel = Never
</code></pre>

<p>yaourt use disable PGP options:</p>

<pre><code>yaourt --m-arg &quot;--skipchecksums --skippgpcheck&quot; -S xxxxxx
</code></pre>

<h3 id="42-install-pandoc">42. Install pandoc</h3>

<p>Add 3rd-party repository</p>

<pre><code># vim /etc/pacman.conf
[haskell-core]
Server = http://xsounds.org/~haskell/core/x86_64/
</code></pre>

<p>With the above ignore PGP settting, run <code>proxychains pacman -Sy</code>.</p>

<p>Then you type-in <code>proxychain pacman -S haskell-pandoc</code> for installing the pandoc.</p>

<h3 id="43-change-docker-image-save-directory">43. Change Docker Image Save Directory</h3>

<p>Only works under CentOS:</p>

<pre><code># cat /etc/sysconfig/docker
other_args='-g /home/xxxxxxx/dockerimage'
</code></pre>

<h3 id="44-define-locale-under-centos">44. Define locale under CentOS</h3>

<pre><code># localedef -v -c -i en_US -f UTF-8 en_US.UTF-8
</code></pre>

<h3 id="45-install-nethogs-in-centos-7">45. Install nethogs in CentOS 7</h3>

<pre><code># yum install libpcap-devel -y
# rpm -ivh http://cdn.kanachan.me.uk/dl/rpms/nethogs/nethogs-0.8.0-1.el6.x86_64.rpm
</code></pre>

<h3 id="46-cs7-related">46. CS7 Related</h3>

<pre><code>[root@spacewalkercs7 zones]# cat db.spacewalkercs7
;
;
$TTL 604800
@       IN      SOA     spacewalkercs7. root.spacewalker.cs. (
                                3               ;Serial
                                604800          ;Refresh
                                86400           ;Retry
                                2419200         ;Expire
                                604800 )        ;Negative Cache TTL
;
; name servers - NS records
      IN      NS      spacewalkercs7.

; name servers  - A records
spacewalkercs7.         IN      A       10.9.10.12
[root@spacewalkercs7 zones]# pwd
/etc/named/zones
[root@spacewalkercs7 zones]# cat /etc/named.conf
//
// named.conf
//
// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
// server as a caching only nameserver (as a localhost DNS resolver only).
//
// See /usr/share/doc/bind*/sample/ for example named configuration files.
//

options {
        listen-on port 53 { 127.0.0.1; 10.9.10.12; };
        listen-on-v6 port 53 { ::1; };
        directory       &quot;/var/named&quot;;
        dump-file       &quot;/var/named/data/cache_dump.db&quot;;
        statistics-file &quot;/var/named/data/named_stats.txt&quot;;
        memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;
        allow-query     { localhost; 10.9.10.0/24;};
        allow-transfer     { localhost; 10.9.10.0/24;};

        /* 
         - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.
         - If you are building a RECURSIVE (caching) DNS server, you need to enable 
           recursion. 
         - If your recursive DNS server has a public IP address, you MUST enable access 
           control to limit queries to your legitimate users. Failing to do so will
           cause your server to become part of large scale DNS amplification 
           attacks. Implementing BCP38 within your network would greatly
           reduce such attack surface 
        */
        recursion yes;

        dnssec-enable yes;
        dnssec-validation yes;
        dnssec-lookaside auto;

        /* Path to ISC DLV key */
        bindkeys-file &quot;/etc/named.iscdlv.key&quot;;

        managed-keys-directory &quot;/var/named/dynamic&quot;;

        pid-file &quot;/run/named/named.pid&quot;;
        session-keyfile &quot;/run/named/session.key&quot;;
};

logging {
        channel default_debug {
                file &quot;data/named.run&quot;;
                severity dynamic;
        };
};

zone &quot;.&quot; IN {
        type hint;
        file &quot;named.ca&quot;;
};


zone &quot;spacewalkercs7&quot; {
        type master;
        file &quot;/etc/named/zones/db.spacewalkercs7&quot;;
};

include &quot;/etc/named.rfc1912.zones&quot;;
include &quot;/etc/named.root.key&quot;;


[root@spacewalkercs7 zones]# cat /etc/dhcp/dhcpd.conf
#
# DHCP Server Configuration file.
#   see /usr/share/doc/dhcp*/dhcpd.conf.example
#   see dhcpd.conf(5) man page
#
option domain-name &quot;server.world&quot;;
# specify name server's hostname or IP address
option domain-name-servers dlp.server.world;
# default lease time
default-lease-time 600;
# max lease time
max-lease-time 7200;
# this DHCP server to be declared valid
authoritative;
# specify network address and subnet mask
subnet 10.9.10.0 netmask 255.255.255.0 {
    # specify the range of lease IP address
    range dynamic-bootp 10.9.10.200 10.9.10.254;
    # specify broadcast address
    option broadcast-address 10.9.10.255;
    # specify default gateway
    option routers 10.9.10.1;
    # Specify default dns server
    option domain-name-servers 10.9.10.12;
}


</code></pre>

<h3 id="47-on-dns-server">47. On DNS Server</h3>

<pre><code>http://www.unixmen.com/setting-dns-server-centos-7/
https://www.digitalocean.com/community/tutorials/how-to-configure-bind-as-a-private-network-dns-server-on-centos-7
</code></pre>

<h3 id="48-install-x-windows-under-centos">48. Install X windows under CentOS</h3>

<pre><code># yum groupinstall 'X Window System' -y
</code></pre>

<h3 id="49-quickly-create-start-kvm-machine">49. Quickly Create/Start KVM Machine</h3>

<pre><code># virsh dumpxml VM_A&gt;A.xml
# vim A.xml
Change its name/uuid/disk file
# virsh start vmname
</code></pre>

<h3 id="50-view-io-statistics">50. View io statistics</h3>

<pre><code># iostat -m 1
# iotop
</code></pre>

<h3 id="51-traffic-control">51. Traffic Control</h3>

<p><a href="http://lartc.org/LARTC-zh_CN.GB2312.pdf">http://lartc.org/LARTC-zh_CN.GB2312.pdf</a></p>

<h3 id="52-system-config-kickstart-start-error">52. system-config-kickstart Start Error</h3>

<p>Problem:</p>

<pre><code># system-config-kickstart
RuntimeError: Could not read video driver database
</code></pre>

<p>Solution:</p>

<pre><code># apt-get remove hwdata
# wget ftp://mirror.ovh.net/mirrors/ftp.debian.org/debian/pool/main/h/hwdata/hwdata_0.234-1_all.deb
# dpkg -i hwdata_0.267-1_all.deb
</code></pre>

<h3 id="53-query-configuration-file-of-yum">53. Query Configuration file of yum</h3>

<p>Use <code>rpm -qc</code> for querying the configuration files of specified software.</p>

<pre><code>$ rpm -qc xxxxx
</code></pre>

<h3 id="54-shellshock">54. ShellShock</h3>

<pre><code># export foo='() { :; }; echo Hello World'
# env x='() { :;}; echo vulnerable'  bash -c &quot;echo this is a test&quot;
# 
</code></pre>

<p>Detailed info:<br />
<a href="http://www.cnblogs.com/chenyueyi/p/4520375.html">http://www.cnblogs.com/chenyueyi/p/4520375.html</a></p>

<h3 id="55-install-wine1-7">55. Install Wine1.7</h3>

<p>Do the following changes:</p>

<pre><code>$ sudo vim /etc/apt/sources.list
deb [arch=amd64,i386]  http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse
deb [arch=amd64,i386]  http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse
deb [arch=amd64,i386]  http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse
deb [arch=amd64,i386]  http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse
deb [arch=amd64,i386]  http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse
$ sudo dpkg --add-architecture i386
$ sudo apt-get update &amp;&amp; sudo apt-get -y upgrade &amp;&amp; sudo apt-get -y dist-upgrade
$ sudo aptitude --full-resolver -f install wine1.7
6) 	wine1.7 [Not Installed]
7) 	wine1.7-amd64 [Not Installed]
8) 	wine1.7-i386:i386 [Not Installed]


Accept this solution? [Y/n/q/?] 6
Action &quot;6&quot;: Removing wine1.7
Accept this solution? [Y/n/q/?] r 6
.....
</code></pre>

<h1 id="then-you-will-get-wine1-7-installed-in-your-system">Then you will get wine1.7 installed in your system.</h1>

<h3 id="55-quickly-remove-the-know-hosts">55. Quickly Remove the know hosts</h3>

<pre><code>ssh-keygen -f &quot;/home/xxxx/.ssh/known_hosts&quot; -R 10.9.10.2
</code></pre>

<h3 id="56-install-mirrordir-from-rpmforge">56. Install mirrordir from rpmforge</h3>

<p>Import rpmforge and install mirrordir.</p>

<pre><code>$ rpm -Uvh http://pkgs.repoforge.org/rpmforge-release/rpmforge-release-0.5.3-1.el7.rf.x86_64.rpm
$ yum search mirrordir
$ yum install mirrordir
</code></pre>

<h3 id="57-convert-recorded-videos-into-gif">57. Convert recorded videos into gif</h3>

<p>From the ogv into the gif.</p>

<pre><code>#  mplayer -ao null ./chromium.ogv -vo jpeg:outdir=output
#  ls output
#  convert output/* output.gif
</code></pre>

<h3 id="58-clear-bios-password-in-linux">58. Clear BIOS Password In Linux</h3>

<p><a href="http://www.cgsecurity.org/wiki/CmosPwd#CmosPwd_Download">http://www.cgsecurity.org/wiki/CmosPwd#CmosPwd_Download</a></p>

<pre><code># sudo ./cmospwd /k
....
1 - Kill cmos
2 - Kill cmos (try to keep date and time)
0 - Abort
# 2
</code></pre>

<p>Reboot and see CMOS.</p>

<h3 id="59-mate-on-centos7">59. MATE On CentOS7</h3>

<p>First you should switches to the epel and official, then install via groupinstall:</p>

<pre><code>$  yum groupinstall &quot;MATE Desktop&quot; -y
</code></pre>

<p>I don&rsquo;t know why I can install it from my own repository.</p>

<p>To change the runlevel of the CentOS Server, use following command:</p>

<p>Graphical:</p>

<pre><code># systemctl set-default  graphical.target
</code></pre>

<p>Multi-User:</p>

<pre><code># systemctl set-default  multi-user.target
</code></pre>

<h3 id="60-re-install-centos7-related">60. Re-install CentOS7 Related</h3>

<pre><code>Tips for monitor of centos7: 
https://mrkmg.com/posts/changing-the-login-screen-resolution-in-centos-7-for-gnome-3/
https://jaketremper.com/?p=23

Chinese Input Method: 
http://blog.csdn.net/maokexu123/article/details/44495395
</code></pre>

<h3 id="61-mount-error-solution">61. Mount Error Solution</h3>

<pre><code>3.2.8内核加载模块错误的临时解决方案

论坛用户反映升级3.2.8内核后出现加载内核模块错误，一般的报错信息如：

ERROR: could not insert 'module-name': Exec format error

原帖在这里，用户cuihao给出了临时的解决方法。

    重命名/lib/modules/extramodules-3.2-ARCH/ （官方内核）或/lib/modules/extramodules-3.2-ck/ （ck内核）下对应的模块文件(.ko.gz)，然后重新编译，命令：

    make clean
    make
    make install
    depmod -a

    之后再加载内核模块即可。 
</code></pre>

<h3 id="62-build-fedora-images">62. Build Fedora Images</h3>

<pre><code>https://www.rdoproject.org/Creating_CentOS_and_Fedora_images_ready_for_Openstack
</code></pre>

<p>Bug for gpg in Fedora21:</p>

<pre><code>rpmkeys --import /etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-21-x86_64
</code></pre>

<p>Error:</p>

<pre><code>Unable to create appliance : Unable to run ['/usr/bin/firewall-offline-cmd', '--disabled']!

</code></pre>

<h3 id="63-kickstart-online-generate">63. KickStart Online Generate</h3>

<p><a href="https://access.redhat.com/labs/kickstartconfig/">https://access.redhat.com/labs/kickstartconfig/</a></p>

<h3 id="64-text-based-vm-installation">64. Text Based vm Installation</h3>

<p>First mount the installation media to /mnt, then run the installtion like following
command.</p>

<pre><code># qemu-system-x86_64 --enable-kvm -m 1024 -smp 2 -hda ./temp_test.qcow2  -cdrom \
/media/opensuse/dash/iso/CentOS-6.6-x86_64-bin-DVD1.iso --nographic -bios \
/usr/share/qemu/bios.bin -append console=ttyS0 -kernel /mnt/isolinux/vmlinuz -initrd \
/mnt/isolinux/initrd.img 

</code></pre>

<h3 id="65-gzip-gz-file">65. Gzip gz file</h3>

<pre><code>gzip -c Packages &gt; Packages.gz
</code></pre>

<h3 id="66-osad-problem">66. osad problem</h3>

<p>Trusty should use saucy debs, try it tomorrow.</p>

<h3 id="67-quick-configure-centos7-newly-installed">67. Quick Configure CentOS7(newly installed)</h3>

<pre><code># cd /etc/yum.repos.d/
# mkdir back &amp;&amp; mv * back/
# wget http://192.168.0.79/mrepo7.repo &amp;&amp; yum makecache
# vim /etc/sysconfig/network-scripts/ifcfg-****
IPADDR=192.168.0.xxx
NETMASK=255.255.0.0
GATEWAY=192.168.0.xxxx
DNS1=223.5.5.5
DNS2=180.76.76.76
# useradd -m ccccccc
# visudo
# passwd ccccc
# vim /etc/hostname
pc0xxx
# vim /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4 pc0xx
</code></pre>

<p>Configure the resolution:</p>

<pre><code># cat /etc/gdm/Init/Default 
# 1440x900 59.89 Hz (CVT 1.30MA) hsync: 55.93 kHz; pclk: 106.50 MHz 
# Modeline &quot;1440x900_60.00&quot;  106.50  1440 1528 1672 1904  900 903 909 934 -hsync  
xrandr --newmode &quot;1440x900_60.00&quot; 106.50  1440 1528 1672 1904  900 903 909 934 -hsync +vsync                                                   
xrandr --addmode VGA1 &quot;1440x900_60.00&quot;                                            
xrandr --output VGA1 --mode &quot;1440x900_60.00&quot;
</code></pre>

<p>Configure the network:</p>

<pre><code>$ cat /etc/sysconfig/network-scripts/route-enp2s0 
172.xx.0.0/16 via 192.168.0.xxx dev enp2s0
$ sudo  systemctl restart network
</code></pre>

<h3 id="68-systemd-tips">68. Systemd tips</h3>

<p>View specified PID status.</p>

<pre><code>#  systemctl status systemd-logind.service         
root:~/ # journalctl _PID=403  
</code></pre>

<h3 id="69-systemd-networkd-and-resolvd">69. systemd networkd and resolvd</h3>

<p>Configuration files are listed as following:</p>

<pre><code>$ pwd
/etc/systemd/network
$ ls
MyBridge.netdev  MyBridge.network  MyEth.network

$ cat MyBridge.netdev
[NetDev]
Name=br0
MACAddress=xx:xx:xx:xx:xx
Kind=bridge

$ cat MyBridge.network
[Match]
Name=br0

[Network]
DNS=180.76.76.76,223.5.5.5

[Address]
Address=192.168.1.11/24

[Route]
Gateway=192.168.1.1

$ cat MyEth.network
[Match]
Name=enp0s25

[Network]
Bridge=br0
</code></pre>

<p>Enable the systemd service:</p>

<pre><code>$ sudo systemctl enable systemd-networkd.service
$ sudo systemctl enable systemd-resolved.service
$ sudo  ln -s /run/systemd/resolve/resolv.conf /etc/resolv.conf
</code></pre>

<h3 id="70-quickly-install-vbox-extensional">70. Quickly install vbox extensional</h3>

<pre><code>sudo  VBoxManage extpack install ./Oracle_VM_VirtualBox_Extension_Pack-5.0.0-101573.vbox-extpack 
</code></pre>

<h3 id="71-vnc-with-specified-language">71. VNC With Specified Language</h3>

<pre><code># export LANG=zh_CN.utf8
# vncserver
</code></pre>

<p>Then your vnc will start with zh support.</p>

<h3 id="72-proxy-with-username-passwd">72. Proxy With Username/Passwd</h3>

<pre><code># export http_proxy=http://easwy:123456@192.168.1.1:8080
</code></pre>

<h3 id="73-combine-dvd-files">73. Combine DVD files</h3>

<p><a href="https://wiki.centos.org/TipsAndTricks/CDtoDVDMedia">https://wiki.centos.org/TipsAndTricks/CDtoDVDMedia</a></p>

<h3 id="74-nested-cpu-for-centos-7">74. Nested CPU For CentOS 7</h3>

<p><a href="http://www.server-world.info/en/note?os=CentOS_7&amp;p=kvm&amp;f=7">http://www.server-world.info/en/note?os=CentOS_7&amp;p=kvm&amp;f=7</a></p>

<h3 id="75-add-tag-branch-for-git">75. Add Tag/Branch For Git</h3>

<p>Added tag for the last commit:</p>

<pre><code># git log
# git tag -a V1.0 0293c397f62e5b2c025a35615c046fb0ecb40a2f
# git push --tags
</code></pre>

<p>Create a new branch for name version1:</p>

<pre><code># git branch version1
</code></pre>

<p>View all of the branches, and checkout to the specified branch:</p>

<pre><code># git branch
# git checkout master
</code></pre>

<p>Once you want to delete the branch:</p>

<pre><code># git branch -d checkout
</code></pre>

<p>Commit all of the changes to remote:</p>

<pre><code># git push --all -u
</code></pre>

<h3 id="76-auto-wrap">76. Auto wrap</h3>

<pre><code># vim ~/.vimrc
set textwidth=78
set wrap
</code></pre>

<p>For chinese Wrapped:</p>

<pre><code>&quot; Wrap for Chinese
set formatoptions+=mM
</code></pre>

<h3 id="77-more-detailed-systemd">77. More Detailed Systemd</h3>

<p>Will display more detailed infos via:</p>

<pre><code># journalctl -r
</code></pre>

<h3 id="78-on-build-cloudstack">78. On Build CloudStack</h3>

<pre><code>http://giraffeforestg.blog.fc2.com/blog-entry-194.html
http://cloudstack-administration.readthedocs.org/en/latest/templates.html
http://cloudstack-installation.readthedocs.org/en/latest/building_from_source.html#prerequisites-for-building-apache-cloudstack
</code></pre>

<h3 id="79-cloudinit">79. CloudInit</h3>

<pre><code>http://shankerbalan.net/blog/cloud-init-supports-cloudstack-as-data-source/
http://www.slideshare.net/shankerbalan/creating-centos-template-for-cloudstack
http://serverfault.com/questions/622707/cloud-init-does-not-grow-the-partition-nor-the-filesystem
</code></pre>

<h3 id="80-view-vnc-port">80. View VNC Port</h3>

<pre><code>[root@csagent ~]# virsh list
 Id    Name                           State
----------------------------------------------------
 2     v-1-VM                         running
 3     s-2-VM                         running
 4     r-7-VM                         running
 6     i-2-9-VM                       running

[root@csagent ~]# virsh vncdisplay i-2-9-VM
192.168.139.3:3

</code></pre>

<p>Then you could view it via vncviewer. Get the password for vnc via:</p>

<pre><code>$ virsh edit 6
xxxxxx
$ vncviewer 192.168.139.3:3
</code></pre>

      
    </div>
    
    

<ul class="pagination">
    
    <li>
        <a href="/" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li
    >
    <a href="/page/55/" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/">1</a></li>
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/page/2/">2</a></li>
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/page/3/">3</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="disabled"><span aria-hidden="true">&hellip;</span></li>
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/page/55/">55</a></li>
    
    
    
    
    
    
        
        
    
    
    <li
    class="active"><a href="/page/56/">56</a></li>
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/page/57/">57</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="disabled"><span aria-hidden="true">&hellip;</span></li>
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/page/154/">154</a></li>
    
    
    <li
    >
    <a href="/page/57/" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li>
        <a href="/page/154/" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>

  </div>
</div>


<script src="http://purplepalmdash.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

