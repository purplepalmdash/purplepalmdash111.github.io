<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
	<meta name="generator" content="Hugo 0.17-DEV" />
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Dash &middot; Dash</title>

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/poole.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/hyde-a.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/custom-additions.css?ref=abc124">
  <link rel="stylesheet" href="http://purplepalmdash.github.io/css/highlight/googlecode.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124">
  <link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel="icon">

  
  
  
  <link href="http://purplepalmdash.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Dash &middot; Dash" />

  <meta name="description" content="Get busy living, or get busy dying.">
  <meta name="keywords" content="unix,virtualization,embedded,linux">
  <link rel="author" href="http://plus.google.com/106572959364703833986">
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-42175003-1', 'auto');
      ga('send', 'pageview');
  </script>

</head>
<body class="theme-base-0c">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <img src="https://www.gravatar.com/avatar/49381c0004d32c0a4296b92dff0c0ae5?s=200" alt="gravatar">
      <h1><a href="http://purplepalmdash.github.io/">Get busy living, or get busy dying.</a></h1>
      <a href="http://purplepalmdash.github.io/"><p>Dash</p></a>
    </div>

    <ul class="sidebar-nav">
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/">First Page</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/post/">All Posts</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/linux/">Linux</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/embedded/">Embedded System</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/virtualization">Virtualization</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/purplepalmdash"><i class="fa fa-github-square fa-3x"></i></a>
      
      <a href="https://cn.linkedin.com/in/yang-feipeng-1b909319"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="https://plus.google.com/u/0/106572959364703833986"><i class="fa fa-google-plus-square fa-3x"></i></a>
      <a href="https://www.facebook.com/yang.feipeng"><i class="fa fa-facebook-square fa-3x"></i></a>
      <a href="https://twitter.com/dashwillfly"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      <a href="http://purplepalmdash.github.io/index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
    </ul>

    

  </div>
</div>


<div class="content container">
  <div class="posts">
    
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2014/05/21/moving-from-working-pc-to-own-usb-disk-based-2/">Moving From Working PC To Own USB-Disk Based 2</a>
      </h1>
      <span class="post-date">May 21, 2014  &middot; <a href="http://purplepalmdash.github.io/2014/05/21/moving-from-working-pc-to-own-usb-disk-based-2/#disqus_thread">Comments</a>
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/linux">linux</a>
        
      </span>
      
      

<h3 id="install-software">Install Software</h3>

<h4 id="internet">Internet</h4>

<p>Chromium, we need this browser absolutesly:</p>

<pre><code>$ sudo pacman -S chromium
Select 1/8

</code></pre>

<p>Oh, we forget install X, so first we will install X:</p>

<h4 id="x-window">X Window</h4>

<p>Install xorg first:</p>

<pre><code>$ sudo pacman -S xorg xorg-xinit

</code></pre>

<p>Awesome Window Manager;</p>

<pre><code>$ sudo pacman -S awesome

</code></pre>

<p>Edit the .xinitrc file, add following lines:</p>

<pre><code>exec awesome

</code></pre>

<p>Necessary video driver:</p>

<pre><code>$ sudo pacman -S xf86-video-intel xf86-video-ati

</code></pre>

<h4 id="continue-internet">Continue Internet</h4>

<p>Firefox, another browser, pidgin, for chatting, thunderbird for email, wget for downloading:</p>

<pre><code>sudo pacman -S firefox pidgin thunderbird wget

</code></pre>

<h4 id="office">Office</h4>

<p>Libreoffice,need download 253MB, so take a break:</p>

<pre><code>$ sudo pacman -S libreoffice
# choose Enter-&gt; 25-&gt; Enter

</code></pre>

<h4 id="terminals">Terminals</h4>

<p>Install xterm first, initial term:</p>

<pre><code>$ sudo pacman -S xterm

</code></pre>

<p>xfce4-terminal will be installed in next chapter<code>Vncserver</code>.<br />
gnome-terminal is a good option:</p>

<pre><code>$ sudo pacman -S gnome-terminal

</code></pre>

<h4 id="vncserver">Vncserver</h4>

<p>Install tigervnc</p>

<pre><code>$ sudo pacman -S tigervnc

</code></pre>

<p>Use xfce4 for remote vnc(For many users may not familiar with awesome desktop):</p>

<pre><code>$ sudo pacman -S xfce4 
# choose (default=all)

</code></pre>

<p>Configure vncserver:</p>

<pre><code>$ cat ~/.vnc/xstartup 
#!/bin/sh

export XKL_XMODMAP_DISABLE=1
exec startxfce4

</code></pre>

<p>With VNC, you can start up the X and let the chromium sync up its bookmarks.</p>

<h4 id="documents">Documents</h4>

<p>Install evince for viewing pdf and other documents:</p>

<pre><code>$ sudo pacman -S evince

</code></pre>

<p>Install gimp for processing pictures:</p>

<pre><code>$ sudo pacman -S gimp

</code></pre>

<h4 id="video-fun">Video/Fun</h4>

<p>Install smplayer:</p>

<pre><code>sudo pacman -S smplayer

</code></pre>

<p>Without ALSA, you can do nothing, so install it.</p>

<pre><code>sudo pacman -S alsa-utils

</code></pre>

<h4 id="development">Development</h4>

<p>Install gvim and eclipse:</p>

<pre><code>$ sudo pacman -S gvim eclipse

</code></pre>

<p>Git and Subversion:</p>

<pre><code>$ sudo pacman -S git subversion

</code></pre>

<p>Wireshark and Tcpdump:</p>

<pre><code>$ sudo pacman -S wireshark-gtk tcpdump

</code></pre>

<p>ddd and gdb for debugging:</p>

<pre><code>$ sudo pacman -S ddd gdb

</code></pre>

<p>meld for comparing files:</p>

<pre><code>$ sudo pacman -S meld

</code></pre>

<h4 id="virtualization">Virtualization</h4>

<p>Install qemu and virtualbox:</p>

<pre><code>sudo pacman -S virtualbox qemu

</code></pre>

<h4 id="chinese-localization">Chinese Localization</h4>

<p>Install fonts for chinese:</p>

<pre><code>$ sudo pacman -S wqy-bitmapfont wqy-microhei wqy-microhei-lite wqy-zenhei

</code></pre>

<p>Install fcitx input method:</p>

<pre><code>$ sudo pacman -S fcitx fcitx-libpinyin fcitx-configtool fcitx-qt4 fcitx-qt5

</code></pre>

<p>Configuration will be wrote later.</p>

<h4 id="system-tools">System Tools</h4>

<p>rox for file browser:</p>

<pre><code>$ sudo pacman -S rox

</code></pre>

<p>gpicview for picture viewer:</p>

<pre><code>$ sudo pacman -S gpicview

</code></pre>

<p>Conky for viewing the tasks:</p>

<pre><code>$ sudo pacman -S conky

</code></pre>

<p>.conky file will be downloaded from the github(Later I will upload).
.xinitrc file will be uploaded to github.</p>

<p>Now step2 is OK, we will use usd-disk for rebooting.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2014/05/19/using-harddisk-for-booting-raspberrypi/">Using HardDisk For Booting RaspberryPI</a>
      </h1>
      <span class="post-date">May 19, 2014  &middot; <a href="http://purplepalmdash.github.io/2014/05/19/using-harddisk-for-booting-raspberrypi/#disqus_thread">Comments</a>
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/linux">linux</a>
        
      </span>
      
      

<h3 id="准备">准备</h3>

<p>RaspberryPI, SD卡（4G以上), 移动硬盘，操作系统镜像文件，最好有一个外接供电带电路隔离的USB HUB。 鼠标、键盘等。</p>

<h3 id="用sd卡启动">用SD卡启动</h3>

<p>将SD卡插入电脑，将镜像文件写入到SD卡后，将写好的SD卡插入RaspberryPI，加电开机。各种配置（譬如显存大小，是否启动到X等等）完成之后，进入到Linux桌面。</p>

<h3 id="准备硬盘">准备硬盘</h3>

<p>将硬盘插入USB口，如果之前有分好区的，可以略过这一节，直接到<code>拷贝至硬盘</code>一节。<br />
在RaspberryPI系统里(wheezy or archLinux)，搜索gparted, 这个工具可以在图形化界面下对硬盘进行分区。<br />
命令行下你可以通过下列命令查看已挂载的存储设备信息：</p>

<pre><code>[root@alarmpi ~]# fdisk -l

Disk /dev/mmcblk0: 7.3 GiB, 7822376960 bytes, 15278080 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x00047c7a

Device         Boot     Start       End  Blocks  Id System
/dev/mmcblk0p1           8192    122879   57344   c W95 FAT32 (LBA)
/dev/mmcblk0p2         122880  15278079 7577600  83 Linux


Disk /dev/sda: 465.8 GiB, 500105740288 bytes, 976769024 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x0004f23a

Device    Boot     Start       End    Blocks  Id System
/dev/sda1           2048   1050623    524288  82 Linux swap / Solaris
/dev/sda2        1050624 126879743  62914560  83 Linux
/dev/sda3      126879744 546310143 209715200   7 HPFS/NTFS/exFAT
/dev/sda4      546310144 976769023 215229440   5 Extended
/dev/sda5      546312192 588255231  20971520  83 Linux
/dev/sda6      588257280 976769023 194255872  83 Linux

</code></pre>

<p>上面的代码中可以看到，我的RaspberryPI上挂载的硬盘大小是500G。分成了若干个区。</p>

<h3 id="拷贝文件系统到硬盘分区">拷贝文件系统到硬盘分区</h3>

<p>分区决定于你自己，用gparted或者别的分区工具都可以分好，记得选择Linux ext4为文件系统。<br />
这里我选择<code>/dev/sda5</code>作为我的根分区，所以在终端上，执行下列命令：</p>

<pre><code>$ mkfs.ext4 /dev/sda5
$ sudo mount /dev/sda5 /mnt
$ cd /mnt
$ tar cjvf /mnt/rootfs.tar.bz2 /

</code></pre>

<p>备份完毕后，解压：</p>

<pre><code>$ tar xjvf /mnt/rootfs.tar.bz2 -C /mnt/

</code></pre>

<p>这里用tar备份文件系统时主要是为了防止系统中某些可能的链接/设备文件的丢失，干脆先压缩后再解压，一劳永逸，代价是时间会花多一点。用rsync是既保险又快速的方法，如果你系统上安装了rsync，试下下面的命令：</p>

<pre><code>rsync -rv --exclude=/mnt / /mnt

</code></pre>

<p>总之，这一步的目的是把SD卡上的文件系统完整复制到硬盘分区上。</p>

<h3 id="修改启动选项">修改启动选项</h3>

<p>修改SD的boot分区上内容，文件<code>cmdline.txt</code>以使得其适配硬盘启动：</p>

<pre><code>$ cd /boot
$ cp cmdline.txt cmdline.txt.SD
$ &gt;cmdline.txt
$ echo &quot;smsc95xx.turbo_mode=N dwc_otg.lpm_enable=0 console=ttyAMA0,115200 kgdboc=ttyAMA0,115200 console=tty1 root=/dev/sda5 rootfstype=ext4 elevator=noop rootwait&quot;&gt;cmdline.txt

</code></pre>

<p>上面命令的作用是把<code>root=</code>参数从<code>root=/dev/mmcblk0p2</code>换到<code>root=/dev/sda5</code>，你的硬盘分区可能不是sda5，这取决于你在上两步中采用了哪块分区。例如sda(1?2?3?4?)，这里的数值和你在上两步中应该保持一致。<br />
如果你的移动硬盘上创建了交换分区，即swap分区，记得在<code>/etc/fstab</code>文件中加入相应的条目，下面是的系统上，用sda1作为swap分区时的配置</p>

<pre><code># cat /etc/fstab
# 
# /etc/fstab: static file system information
#
# &lt;file system&gt;	&lt;dir&gt;	&lt;type&gt;	&lt;options&gt;	&lt;dump&gt;	&lt;pass&gt;
/dev/mmcblk0p1  /boot           vfat    defaults        0       0
/dev/sda1  	none		swap 	defaults        0       0

</code></pre>

<p>为了确保写入成功，在操作的最后，麻烦运行一下:</p>

<pre><code>$ sudo sync

</code></pre>

<p>这可以保证所有的外接设备上的数据被安全写入。</p>

<p>没有问题的话，现在重新启动RaspberryPI，你的文件系统就应该跑在硬盘上了。</p>

<p>如果有失败的话，把SD卡插入电脑，把cmdline.txt文件恢复成cmdline.txt.SD文件即可。</p>

<h3 id="特别强调">特别强调</h3>

<p>特别强调的一点，彻底从硬盘启动是不可能的！！！也就是说，你依然需要插入一张SD卡在RaspberryPI的槽中。因为RaspberryPI每次都是从固定地址读取启动代码的。<br />
上述做法的好处是避免了频繁读写SD卡，延长了SD卡的使用寿命。<br />
缺点是： USB硬盘的速度，最多也就是USB2.0的极速。 SD卡，CLASS10的速度可能要超过USB2.0的速度。某些时候会慢一点，但是秒杀CLASS4的卡是没问题的。</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2014/05/14/node-dot-js-quick-start/">Node.js Quick Start</a>
      </h1>
      <span class="post-date">May 14, 2014  &middot; <a href="http://purplepalmdash.github.io/2014/05/14/node-dot-js-quick-start/#disqus_thread">Comments</a>
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/nodejs">nodejs</a>
        
      </span>
      
      

<h3 id="installation">Installation</h3>

<p>Via following command</p>

<pre><code>$ yaourt -S nodejs

</code></pre>

<h3 id="quick-start">Quick Start</h3>

<pre><code>$ node
&gt; console.log(&quot;Hello!&quot;)
Hello!
undefined

</code></pre>

<p>Hit twice &ldquo;Ctrl+c&rdquo; you will get out of the terminal.<br />
A simple example is like:</p>

<pre><code>var http = require(&quot;http&quot;);

http.createServer(function(request, response) {
	  response.writeHead(200, {&quot;Content-Type&quot;: &quot;text/plain&quot;});
	    response.write(&quot;Hello World&quot;);
	      response.end();
}).listen(8888);
$ node server.js

$ curl http://localhost:8888
Hello World%

</code></pre>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2014/05/13/write-python-weather-app-on-heroku-10/">Write Python Weather APP on Heroku(10)</a>
      </h1>
      <span class="post-date">May 13, 2014  &middot; <a href="http://purplepalmdash.github.io/2014/05/13/write-python-weather-app-on-heroku-10/#disqus_thread">Comments</a>
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/python">python</a>
        
      </span>
      
      

<h3 id="use-template-in-flask">Use Template In Flask</h3>

<p>To use template in flask, we should put the static file under the <code>templates</code> folder under the root directory. Our index page should looks like following:<br />
<img src="/images/frontpage.jpg" alt="/images/frontpage.jpg" /></p>

<p>So our html file shall wrote like following:</p>

<pre><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
&lt;title&gt;{{title}}&lt;/title&gt;
&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/static/assets/css/styles.css&quot; /&gt;

&lt;!--[if IE]&gt;&lt;script src=&quot;assets/js/excanvas.min.js&quot;&gt;&lt;/script&gt;&lt;![endif]--&gt;

&lt;/head&gt;
&lt;body&gt;

&lt;div id=&quot;page&quot;&gt;
	&lt;div id=&quot;header&quot;&gt;
        &lt;h1&gt;{{title}}&lt;/h1&gt;
        &lt;h2&gt;Nanjing Weather/PM Statistics&lt;/h2&gt;

        &lt;div id=&quot;periodDropDown&quot;&gt;
        
        	&lt;span class=&quot;left&quot;&gt;&lt;/span&gt;
            &lt;span class=&quot;currentPeriod&quot;&gt;Last 24 hours&lt;/span&gt;
            &lt;span class=&quot;arrow&quot;&gt;&lt;/span&gt;
            &lt;span class=&quot;right&quot;&gt;&lt;/span&gt;
            
        	&lt;ul&gt;
            	&lt;li data-action=&quot;24hours&quot;&gt;Last 24 hours&lt;/li&gt;
                &lt;li data-action=&quot;7days&quot;&gt;Last 7 Days&lt;/li&gt;
                &lt;li data-action=&quot;30days&quot;&gt;Last 30 Days&lt;/li&gt;
            &lt;/ul&gt;
	&lt;/div&gt;
	&lt;/div&gt;

    &lt;div class=&quot;temperature section&quot;&gt;
    	&lt;h3&gt;Temperature&lt;/h3&gt;
       	&lt;div id=&quot;plot&quot;&gt;
        	&lt;span class=&quot;preloader&quot;&gt;&lt;/span&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;div class=&quot;humidity section&quot;&gt;
	    &lt;h3&gt;Humidity&lt;/h3&gt;
	    &lt;div id=&quot;humi_plot&quot;&gt;
		    &lt;span class=&quot;preloader&quot;&gt;&lt;/span&gt;
	    &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;div class=&quot;pm2.5 section&quot;&gt;
	    &lt;h3&gt;PM2.5&lt;/h3&gt;
	    &lt;div id=&quot;pm25_plot&quot;&gt;
		    &lt;span class=&quot;preloader&quot;&gt;&lt;/span&gt;
	    &lt;/div&gt;
    &lt;/div&gt;

    &lt;div class=&quot;pm10 section&quot;&gt;
	    &lt;h3&gt;PM10&lt;/h3&gt;
	    &lt;div id=&quot;pm10_plot&quot;&gt;
		    &lt;span class=&quot;preloader&quot;&gt;&lt;/span&gt;
	    &lt;/div&gt;
    &lt;/div&gt;

	

    
&lt;/div&gt;

&lt;p id=&quot;footer&quot;&gt;
{{year}} &amp;copy; {{title}}. Powered by &lt;a href=&quot;kkkttt.github.io&quot;&gt;Dash&lt;/a&gt; UTC: {{utctime}}
&lt;/p&gt;
&lt;script src=&quot;/static/assets/js/jquery.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;/static/assets/js/script.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;/static/assets/js/jquery.flot.min.js&quot;&gt;&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;

</code></pre>

<p>To use CSS file to make sure the vision effect, to use css in flask, put your files into the directory <code>static</code> under the root directory. Just like following :</p>

<pre><code>$ tree static 
static
└── assets
    ├── css
    │   └── styles.css
    ├── img
    │   ├── bg_tile.jpg
    │   ├── bg_vert.jpg
    │   ├── preloader.gif
    │   └── sprite.png
    └── js
        ├── jquery.flot.min.js
        ├── jquery.min.js
        └── script.js


</code></pre>

<h3 id="rendering-html">Rendering Html</h3>

<p>In genhtml.py, we define the function which rendering the html template like following:</p>

<pre><code># @app.route('/index')
@app.route('/')
# Generate the index page, for debugging now
def index():
    # Use template for rendering the content
    Current_Year = datetime.now().strftime(&quot;%Y::%H:%M &quot;)
    Current_UTC = datetime.utcnow().strftime(&quot;%H:%M&quot;)
    return render_template('index.html', title=&quot;NanJing Weather and PM2.5/10 Statistics&quot;, year=Current_Year, utctime=Current_UTC)

</code></pre>

<p>Now open your first page, you will see the rendered effect. But the flot div remains empty, next chapter we will introduce the javascript which used for draw the flot picture and AJAX which used for updating the content.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="http://purplepalmdash.github.io/2014/05/13/write-python-weather-app-on-heroku-11/">Write Python Weather APP on Heroku(11)</a>
      </h1>
      <span class="post-date">May 13, 2014  &middot; <a href="http://purplepalmdash.github.io/2014/05/13/write-python-weather-app-on-heroku-11/#disqus_thread">Comments</a>
      
      <br/>
      <a class="a_cat" href="http://purplepalmdash.github.io/categories/python">python</a>
        
      </span>
      
      

<h3 id="draw-flot-picture">Draw Flot Picture</h3>

<p>Since the article is mainly on writing apps, I don&rsquo;t want to spend much time on how to use javascript or flot for drawing picture.<br />
Simply checkout the code on github, you will see the code which is used for retrieving the data and start drawing plot pictures.</p>

<h3 id="fetching-24-hours-data">Fetching 24-hours Data</h3>

<p>Fetching 24 latest records from the postgres database, and then add them into the chart, chart then has been sent to simplejson which used for updating the flot picture locally .</p>

<pre><code>@app.route('/ajax/24hours/')
# ajax updateing for 24-hour data
def TwentyFourHours():
    # Here we will visit postgres for retrieving back the last 24 hours' data
    # Local version
    # engine = create_engine('postgresql+psycopg2://Trusty:@localhost:5432/mylocaldb', echo=True)
    # Heroku Version
    db_conn = os.environ['DATABASE_URL']
    engine = create_engine(db_conn)
    # Engine selection
    metadata=MetaData(bind=engine)
    weather_table=Table('weather',metadata,
        Column('Insert_Time', DateTime(timezone=True),primary_key=True),
        Column('Temperature', Integer),
        Column('Humidity', Integer),
        Column('PmTen', Integer),
        Column('PmTwoFive', Integer),
    )
    s = select([weather_table]).order_by(weather_table.c.Insert_Time.desc()).limit(24)
    conn = engine.connect()
    result = conn.execute(s)
    chart = []
    for row in result:
        # row[0], datetime; 
        # row[1], Temperature;
        # row[2], Humidity;
        # row[3], PM10;
        # row[4], PM2.5; 

        ###  append row[x] into the char ###
        # chart.append({
        chart.insert(0, {
            &quot;label&quot;: (row[0] + timedelta(hours = 8)).strftime(&quot;%H:%M&quot;),
            &quot;value&quot;: row[1],
            &quot;humi_value&quot;: row[2],
            &quot;pm25_value&quot;: row[4],
            &quot;pm10_value&quot;: row[3]
            })

    jsonStr = simplejson.dumps({
        # This is char, will be used in script.js
        &quot;chart&quot; :{
            # tooltip is used by the jQuery chart:
            &quot;tooltip&quot;   : &quot;Temperature at %1: %2 degree&quot;,
            # humi_tooltip is used for jQuery chart for humidity:
            &quot;humi_tooltip&quot; : &quot;Humidity at %1: %2 \%&quot;,
            &quot;pm25_tooltip&quot; : &quot;PM2.5 at %1: %2 ug/m(3)&quot;,
            &quot;pm10_tooltip&quot; : &quot;PM10 at %1: %2 ug/m(3)&quot;,
            &quot;data&quot;      : chart
            },
        # This is &quot;downtime&quot; will be used in script.js
             &quot;downtime&quot;  : getDowntime(1)
        })

    return jsonStr;

</code></pre>

<p>The periodic task which runs in <code>tasks.py</code> will fetching the data from the python api and the webpage, then insert them into the postgres database, so here in 24-hours&rsquo; function we just get them out and fill in the flot picture.</p>

<h3 id="daily-data">Daily Data</h3>

<p>Daily data shall be generated via calculating them at the mid-night, that is, at the beginning of a brand new day, we will calculate out the last day&rsquo;s average data.<br />
The code is implemented in <code>tasks.py</code> as a crontab task, the code is listed as following:</p>

<pre><code># Every Day we will run a periodly work which will calculate 
# the average temperature/humidity/pm2.5/pm10 task, and store
# it into the daily database, thus we have to define new Database
# here and insert data into.
# Beijing is locate at east 8 zone, thus 16:12 + 8 hour = 24:12
# At every mid-night(24:12) it will caculate the average value for
# the past 24 hours. 
@periodic_task(run_every=crontab(hour=16, minute=12))
def OneDayHandler():
    # First Get the last 24 hours' data set
    # Local Engine
    # engine = create_engine('postgresql+psycopg2://Trusty:@localhost:5432/mylocaldb',echo=True)
    # Heroku Engine
    db_conn = environ['DATABASE_URL']
    engine = create_engine(db_conn)
    metadata=MetaData(bind=engine)
    # Definition of the weather table
    weather_table=Table('weather',metadata,
    	Column('Insert_Time', DateTime(timezone=True),primary_key=True),
    	Column('Temperature', Integer),
    	Column('Humidity', Integer),
    	Column('PmTen', Integer),
    	Column('PmTwoFive', Integer),
    )
    # Get last 24 records, If we suppose there are truely 24 records in last 24 hours, we can enable this sentense. But sometimes, this will be wrong. 
    s = select([weather_table]).order_by(weather_table.c.Insert_Time.asc()).limit(24)
    conn = engine.connect()
    results = conn.execute(s)

    # Temperature
    totTemperature = 0
    avgTemperature = 0
    # Humidity
    totHumidity = 0
    avgHumidity = 0
    # PM2.5
    totPm25 = 0
    avgPm25 = 0
    # PM10
    totPm10 = 0
    avgPm10 = 0

    records_number = 0 
    for item in results:
        totTemperature += item[1]
        totHumidity += item[2]
        totPm25 += item[4]
        totPm10 += item[3]
        records_number += 1

    if records_number&gt;0:
        avgTemperature = totTemperature/records_number
        avgHumidity = totHumidity/records_number
        avgPm25 = totPm25/records_number
        avgPm10 = totPm10/records_number

    # Definition of the avg_eather table
    avg_metadata = MetaData(bind=engine)
    avg_weather_table=Table('avg_weather',avg_metadata,
    	Column('avg_Insert_Time', DateTime(timezone=True),primary_key=True),
    	Column('avg_Temperature', Integer),
    	Column('avg_Humidity', Integer),
    	Column('avg_PmTen', Integer),
    	Column('avg_PmTwoFive', Integer),
    )
    # Create table in db
    avg_metadata.create_all(checkfirst=True)
    # Create insert sentense
    avg_ins = avg_weather_table.insert()
    # Really insert
    avg_ins = avg_weather_table.insert().values(avg_Insert_Time=datetime.utcnow(), avg_Temperature = avgTemperature, avg_Humidity = avgHumidity, avg_PmTen = avgPm10, avg_PmTwoFive = av
gPm25)
    # Connect to engine and execute
    avg_conn = engine.connect()
    avg_conn.execute(avg_ins)

    return 1

</code></pre>

<p>We defined a new table named avg_weather, and at the mid-night we will retrieve the latest 24 records, calculating their average value, then insert them into the aver_weather table.</p>

<h3 id="displaying-daily-data">Displaying Daily Data</h3>

<p>The main procedure is mainly like in 24-hours datas, but notice we are select from avg_weather, and we only select 7 items.<br />
30-days data is very simple, change the day from 7 to 30, then you can see the monthly data.</p>

<h3 id="write-testing-interface">Write Testing Interface</h3>

<p>We hope we can manually test the functions via web. So we added following testing APIs in genhtml.py:</p>

<pre><code>@app.route('/test/fetch/')
def fetch():
    fetch_and_store_data()
    return &quot;Fetching Test Done!!!&quot;;

@app.route('/test/gen/')
def generateOneDay():
    OneDayHandler()
    return &quot;Generate Test Done!!!&quot;;

</code></pre>

<p>If we visit <a href="http://Your_app_address/test/fetch">http://Your_app_address/test/fetch</a>, the program will fetch back the data.  And for <a href="http://Your_app_address/test/gen">http://Your_app_address/test/gen</a>, the daily average data will be generated.</p>

<p>Next Chapter is the last one. We simply paste the screenshots of the APP.</p>

      
    </div>
    
    
    
    <ul class="pagination">
        
        <li>
            <a href="/" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
        </li>
        
        <li
        >
        <a href="/page/84/" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
        </li>
        
        <li
        ><a href="/">1</a></li>
        
        <li
        ><a href="/page/2/">2</a></li>
        
        <li
        ><a href="/page/3/">3</a></li>
        
        <li
        ><a href="/page/4/">4</a></li>
        
        <li
        ><a href="/page/5/">5</a></li>
        
        <li
        ><a href="/page/6/">6</a></li>
        
        <li
        ><a href="/page/7/">7</a></li>
        
        <li
        ><a href="/page/8/">8</a></li>
        
        <li
        ><a href="/page/9/">9</a></li>
        
        <li
        ><a href="/page/10/">10</a></li>
        
        <li
        ><a href="/page/11/">11</a></li>
        
        <li
        ><a href="/page/12/">12</a></li>
        
        <li
        ><a href="/page/13/">13</a></li>
        
        <li
        ><a href="/page/14/">14</a></li>
        
        <li
        ><a href="/page/15/">15</a></li>
        
        <li
        ><a href="/page/16/">16</a></li>
        
        <li
        ><a href="/page/17/">17</a></li>
        
        <li
        ><a href="/page/18/">18</a></li>
        
        <li
        ><a href="/page/19/">19</a></li>
        
        <li
        ><a href="/page/20/">20</a></li>
        
        <li
        ><a href="/page/21/">21</a></li>
        
        <li
        ><a href="/page/22/">22</a></li>
        
        <li
        ><a href="/page/23/">23</a></li>
        
        <li
        ><a href="/page/24/">24</a></li>
        
        <li
        ><a href="/page/25/">25</a></li>
        
        <li
        ><a href="/page/26/">26</a></li>
        
        <li
        ><a href="/page/27/">27</a></li>
        
        <li
        ><a href="/page/28/">28</a></li>
        
        <li
        ><a href="/page/29/">29</a></li>
        
        <li
        ><a href="/page/30/">30</a></li>
        
        <li
        ><a href="/page/31/">31</a></li>
        
        <li
        ><a href="/page/32/">32</a></li>
        
        <li
        ><a href="/page/33/">33</a></li>
        
        <li
        ><a href="/page/34/">34</a></li>
        
        <li
        ><a href="/page/35/">35</a></li>
        
        <li
        ><a href="/page/36/">36</a></li>
        
        <li
        ><a href="/page/37/">37</a></li>
        
        <li
        ><a href="/page/38/">38</a></li>
        
        <li
        ><a href="/page/39/">39</a></li>
        
        <li
        ><a href="/page/40/">40</a></li>
        
        <li
        ><a href="/page/41/">41</a></li>
        
        <li
        ><a href="/page/42/">42</a></li>
        
        <li
        ><a href="/page/43/">43</a></li>
        
        <li
        ><a href="/page/44/">44</a></li>
        
        <li
        ><a href="/page/45/">45</a></li>
        
        <li
        ><a href="/page/46/">46</a></li>
        
        <li
        ><a href="/page/47/">47</a></li>
        
        <li
        ><a href="/page/48/">48</a></li>
        
        <li
        ><a href="/page/49/">49</a></li>
        
        <li
        ><a href="/page/50/">50</a></li>
        
        <li
        ><a href="/page/51/">51</a></li>
        
        <li
        ><a href="/page/52/">52</a></li>
        
        <li
        ><a href="/page/53/">53</a></li>
        
        <li
        ><a href="/page/54/">54</a></li>
        
        <li
        ><a href="/page/55/">55</a></li>
        
        <li
        ><a href="/page/56/">56</a></li>
        
        <li
        ><a href="/page/57/">57</a></li>
        
        <li
        ><a href="/page/58/">58</a></li>
        
        <li
        ><a href="/page/59/">59</a></li>
        
        <li
        ><a href="/page/60/">60</a></li>
        
        <li
        ><a href="/page/61/">61</a></li>
        
        <li
        ><a href="/page/62/">62</a></li>
        
        <li
        ><a href="/page/63/">63</a></li>
        
        <li
        ><a href="/page/64/">64</a></li>
        
        <li
        ><a href="/page/65/">65</a></li>
        
        <li
        ><a href="/page/66/">66</a></li>
        
        <li
        ><a href="/page/67/">67</a></li>
        
        <li
        ><a href="/page/68/">68</a></li>
        
        <li
        ><a href="/page/69/">69</a></li>
        
        <li
        ><a href="/page/70/">70</a></li>
        
        <li
        ><a href="/page/71/">71</a></li>
        
        <li
        ><a href="/page/72/">72</a></li>
        
        <li
        ><a href="/page/73/">73</a></li>
        
        <li
        ><a href="/page/74/">74</a></li>
        
        <li
        ><a href="/page/75/">75</a></li>
        
        <li
        ><a href="/page/76/">76</a></li>
        
        <li
        ><a href="/page/77/">77</a></li>
        
        <li
        ><a href="/page/78/">78</a></li>
        
        <li
        ><a href="/page/79/">79</a></li>
        
        <li
        ><a href="/page/80/">80</a></li>
        
        <li
        ><a href="/page/81/">81</a></li>
        
        <li
        ><a href="/page/82/">82</a></li>
        
        <li
        ><a href="/page/83/">83</a></li>
        
        <li
        ><a href="/page/84/">84</a></li>
        
        <li
        class="active"><a href="/page/85/">85</a></li>
        
        <li
        ><a href="/page/86/">86</a></li>
        
        <li
        ><a href="/page/87/">87</a></li>
        
        <li
        ><a href="/page/88/">88</a></li>
        
        <li
        ><a href="/page/89/">89</a></li>
        
        <li
        ><a href="/page/90/">90</a></li>
        
        <li
        ><a href="/page/91/">91</a></li>
        
        <li
        ><a href="/page/92/">92</a></li>
        
        <li
        ><a href="/page/93/">93</a></li>
        
        <li
        ><a href="/page/94/">94</a></li>
        
        <li
        ><a href="/page/95/">95</a></li>
        
        <li
        ><a href="/page/96/">96</a></li>
        
        <li
        ><a href="/page/97/">97</a></li>
        
        <li
        ><a href="/page/98/">98</a></li>
        
        <li
        ><a href="/page/99/">99</a></li>
        
        <li
        ><a href="/page/100/">100</a></li>
        
        <li
        ><a href="/page/101/">101</a></li>
        
        <li
        ><a href="/page/102/">102</a></li>
        
        <li
        ><a href="/page/103/">103</a></li>
        
        <li
        ><a href="/page/104/">104</a></li>
        
        <li
        ><a href="/page/105/">105</a></li>
        
        <li
        ><a href="/page/106/">106</a></li>
        
        <li
        ><a href="/page/107/">107</a></li>
        
        <li
        ><a href="/page/108/">108</a></li>
        
        <li
        ><a href="/page/109/">109</a></li>
        
        <li
        ><a href="/page/110/">110</a></li>
        
        <li
        ><a href="/page/111/">111</a></li>
        
        <li
        ><a href="/page/112/">112</a></li>
        
        <li
        ><a href="/page/113/">113</a></li>
        
        <li
        ><a href="/page/114/">114</a></li>
        
        <li
        ><a href="/page/115/">115</a></li>
        
        <li
        ><a href="/page/116/">116</a></li>
        
        <li
        ><a href="/page/117/">117</a></li>
        
        <li
        ><a href="/page/118/">118</a></li>
        
        <li
        ><a href="/page/119/">119</a></li>
        
        <li
        ><a href="/page/120/">120</a></li>
        
        <li
        ><a href="/page/121/">121</a></li>
        
        <li
        ><a href="/page/122/">122</a></li>
        
        <li
        ><a href="/page/123/">123</a></li>
        
        <li
        ><a href="/page/124/">124</a></li>
        
        <li
        ><a href="/page/125/">125</a></li>
        
        <li
        ><a href="/page/126/">126</a></li>
        
        <li
        ><a href="/page/127/">127</a></li>
        
        <li
        ><a href="/page/128/">128</a></li>
        
        <li
        ><a href="/page/129/">129</a></li>
        
        <li
        ><a href="/page/130/">130</a></li>
        
        <li
        ><a href="/page/131/">131</a></li>
        
        <li
        ><a href="/page/132/">132</a></li>
        
        <li
        ><a href="/page/133/">133</a></li>
        
        <li
        >
        <a href="/page/86/" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
        </li>
        
        <li>
            <a href="/page/133/" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
        </li>
        
    </ul>
    
  </div>
</div>


<script type="text/javascript">
var disqus_shortname = "dashsagittariussglory";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>

<script src="http://purplepalmdash.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

